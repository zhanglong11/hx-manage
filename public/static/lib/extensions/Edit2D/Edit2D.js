/*!
 * LMV v7.9.0
 * 
 * Copyright 2019 Bimfish, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Bimfish, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Bimfish, Inc.
 * 
 * Bimfish Forge Viewer Usage Limitations:
 * 
 * The Bimfish Forge viewer can only be used to view files generated by
 * Bimfish Forge services. The Bimfish Forge Viewer JavaScript must be
 * delivered from an Bimfish hosted URL.
 */
Bimfish.Extensions.Edit2D=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./extensions/Edit2D/Edit2D.js")}({"./extensions/Edit2D/Actions.js":
/*!**************************************!*\
  !*** ./extensions/Edit2D/Actions.js ***!
  \**************************************/
/*! exports provided: Actions */function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),e}i.r(t),i.d(t,"Actions",(function(){return d}));var c=function(){function e(t){l(this,e),this.layer=t}return u(e,[{key:"undo",value:function(){throw new Error("Abstract method invoked")}},{key:"redo",value:function(){throw new Error("Abstract method invoked")}}]),e}(),d={Action:c,AddShape:function(e){function t(e,i){var n;return l(this,t),(n=o(this,s(t).call(this,e))).shape=i,n}return r(t,e),u(t,[{key:"undo",value:function(){this.layer.removeShape(this.shape)}},{key:"redo",value:function(){this.layer.addShape(this.shape)}}]),t}(c),AddShapes:function(e){function t(e,i){var n;return l(this,t),(n=o(this,s(t).call(this,e))).shapes=i,n}return r(t,e),u(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}}]),t}(c),MoveShape:function(e){function t(e,i,n,r){var a;return l(this,t),(a=o(this,s(t).call(this,e))).shape=i,a.delta={x:n,y:r},a.beforeState=a.shape.clone(),a.afterState=a.shape.clone(),a.afterState.move(n,r),a}return r(t,e),u(t,[{key:"undo",value:function(){this.shape.copy(this.beforeState)}},{key:"redo",value:function(){this.shape.copy(this.afterState)}}]),t}(c),RemoveShape:function(e){function t(e,i){var n;return l(this,t),(n=o(this,s(t).call(this,e))).shape=i,n}return r(t,e),u(t,[{key:"undo",value:function(){this.layer.addShape(this.shape)}},{key:"redo",value:function(){this.layer.removeShape(this.shape)}}]),t}(c),RemoveShapes:function(e){function t(e,i){var n;return l(this,t),(n=o(this,s(t).call(this,e))).shapes=i,n}return r(t,e),u(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}}]),t}(c),AddVertex:function(e){function t(e,i,n,r){var a;return l(this,t),(a=o(this,s(t).call(this,e))).poly=i,a.vIndex=n,a.point=r.clone(),a}return r(t,e),u(t,[{key:"undo",value:function(){this.poly.removePoint(this.vIndex)}},{key:"redo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}}]),t}(c),MoveVertex:function(e){function t(e,i,n,r){var a;return l(this,t),(a=o(this,s(t).call(this,e))).poly=i,a.vIndex=n,a.posBefore=i.getPoint(n),a.posAfter=r.clone(),a}return r(t,e),u(t,[{key:"undo",value:function(){this.poly.updatePoint(this.vIndex,this.posBefore.x,this.posBefore.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.vIndex,this.posAfter.x,this.posAfter.y)}}]),t}(c),RemoveVertex:function(e){function t(e,i,n){var r;return l(this,t),(r=o(this,s(t).call(this,e))).poly=i,r.vIndex=n,r.point=i.getPoint(n),r}return r(t,e),u(t,[{key:"undo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}},{key:"redo",value:function(){this.poly.removePoint(this.vIndex)}}]),t}(c),MoveEdge:function(e){function t(e,i,n,r,a){var h;l(this,t),(h=o(this,s(t).call(this,e))).poly=i,h.ia=n,h.ib=(n+1)%i.length;var u=i.getPoint(h.ia),c=i.getPoint(h.ib);return h.edgeBefore={a:u,b:c},h.edgeAfter={a:r.clone(),b:a.clone()},h}return r(t,e),u(t,[{key:"undo",value:function(){this.poly.updatePoint(this.ia,this.edgeBefore.a.x,this.edgeBefore.a.y),this.poly.updatePoint(this.ib,this.edgeBefore.b.x,this.edgeBefore.b.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.ia,this.edgeAfter.a.x,this.edgeAfter.a.y),this.poly.updatePoint(this.ib,this.edgeAfter.b.x,this.edgeAfter.b.y)}}]),t}(c)}},"./extensions/Edit2D/AngleSnapper.js":
/*!*******************************************!*\
  !*** ./extensions/Edit2D/AngleSnapper.js ***!
  \*******************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return y}));var n=i(/*! ./EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ./Math2D.js */"./extensions/Edit2D/Math2D.js");function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}var l=function(){function e(t,i){s(this,e),this.a=t.clone(),this.b=i.clone(),this.dir=o.Math2D.getEdgeDirection(t,i)}return a(e,[{key:"intersect",value:function(e,t){return o.Math2D.intersectLines(this.a,this.dir,e.a,e.dir,t)}},{key:"snapToLine",value:function(e){o.Math2D.projectToLine(e,this.a,this.dir)}},{key:"isUsable",value:function(e,t){return o.Math2D.pointLineDistance(e,this.a,this.dir)<t}},{key:"isEqual",value:function(e,t){return o.Math2D.collinear(this.a,this.dir,e.a,e.dir,t)}}]),e}(),h=function(e,t,i){(t||i)&&(i?t?t.intersect(i,e):i.snapToLine(e):t.snapToLine(e))},u=function(e,t){return t=(t+e.length)%e.length,e.getPoint(t)},c=function(e,t){var i=new THREE.Vector2,n=new THREE.Vector2,s=new THREE.Vector2,r=[];return e.enumEdges((function(e,a,h,u){h!=t&&u!=t&&(o.Math2D.edgeIsDegenerated(e,a)||function(e,t){r.push(new l(e,t)),i=o.Math2D.turnLeft(o.Math2D.getEdgeDirection(e,t,i)),n=o.Math2D.getEdgeCenter(e,t,n),s.copy(e).add(i),r.push(new l(e,s)),s.copy(n).add(i),r.push(new l(n,s)),s.copy(t).add(i),r.push(new l(t,s))}(e,a))})),r},d=function(e,t,i,n,o){var s=new THREE.Vector2;return i.intersect(e,s)?s.distanceTo(n)>o?t:t?Math.abs(i.dir.dot(e.dir))>Math.abs(i.dir.dot(t.dir))?e:t:e:t},p=new THREE.Vector2(1,0),f=Bimfish.Viewing,y=function(){function e(t){s(this,e),this.poly=null,this.vIndex=-1,this.snapAngles=[0,45,90,135,180,225,270,315,360],this.snapAngleTolerance=2,this.snapRadius=10,this.gizmoLayer=t,this.setGlobalManager(t.globalManager),this.movedPoint=new THREE.Vector2,this.prevPoint=new THREE.Vector2,this.prevPoint2=new THREE.Vector2,this.edgeDir=new THREE.Vector2,this.alignAxis=new THREE.Vector2,this.edgeSnapLines=[],this.snapLine1=null,this.snapLine2=null,this.snapLineExt=null,this.snapLineStyle=new n.Style({lineColor:"rgb(255, 0, 0)",lineWidth:1,lineStyle:10}),this.snapLineGizmos=[],this.snapLineGizmosUsed=0}return a(e,[{key:"onSetGlobalManager",value:function(e){this.globalManager=e,this.snapLineGizmos.forEach((function(t){return t.setGloblaManager(e)}))}},{key:"acquireSnapLineGizmo",value:function(){var e=this.snapLineGizmos[this.snapLineGizmosUsed];return e||((e=new n.Polyline([],this.snapLineStyle)).setGlobalManager(this.globalManager),this.snapLineGizmos[this.snapLineGizmosUsed]=e),this.snapLineGizmosUsed++,e}},{key:"clearSnappingGizmos",value:function(){var e=this;this.snapLineGizmos.forEach((function(t){return e.gizmoLayer.removeShape(t)})),this.snapLineGizmosUsed=0}},{key:"startSnapping",value:function(e,t){this.poly=e,this.vIndex=t,this.edgeSnapLines=c(e,t)}},{key:"stopSnapping",value:function(){this.poly=null,this.vIndex=-1,this.snapLine1=null,this.snapLine2=null,this.clearSnappingGizmos()}},{key:"clearSnappingResult",value:function(){this.snapLine1=null,this.snapLine2=null}},{key:"getPrevSnapLine",value:function(e){var t=u(this.poly,this.vIndex-1),i=u(this.poly,this.vIndex-2),n=o.Math2D.getEdgeDirection(i,t);return this.computeAngleSnapLine(e,t,n)}},{key:"getNextSnapLine",value:function(e){if(this.poly.isPolyline()&&this.vIndex>=this.poly.length-2)return null;var t=u(this.poly,this.vIndex+1),i=u(this.poly,this.vIndex+2),n=o.Math2D.getEdgeDirection(t,i,n);return this.computeAngleSnapLine(e,t,n)}},{key:"snapToAngle",value:function(e,t){var i=this;if(this.snapLine1=null,this.snapLine2=null,this.snapLineExt=t&&new l(t.a,t.b),this.active&&!(this.poly.length<=1)){var n=u(this.poly,this.vIndex-1);if(2==this.poly.length){var o=this.computeAngleSnapLine(e,n,p);return o&&this.snapLineExt?this.snapLine1=d(o,null,this.snapLineExt,e,a):this.snapLine1=o,void h(e,this.snapLine1,this.snapLineExt)}var s=this.getPrevSnapLine(e),r=this.getNextSnapLine(e),a=this.snapRadius*this.gizmoLayer.getUnitsPerPixel(),c=function(t){return!!t&&(i.snapLineExt?Boolean(d(t,null,i.snapLineExt,e,a)):t.isUsable(e,a))},f=this.edgeSnapLines.filter(c);if(s=c(s)&&s,r=c(r)&&r,this.snapLine1=s||r||f[0],this.snapLine1){if(this.snapLineExt)return h(e,this.snapLine1,this.snapLineExt);if(s&&r&&(this.snapLine2=d(r,null,this.snapLine1,e,a)),!this.snapLine2)for(var y=0;y<f.length;y++){var v=f[y];this.snapLine2=d(v,this.snapLine2,this.snapLine1,e,a)}return h(e,this.snapLine1,this.snapLine2)}}}},{key:"isSnapped",value:function(){return Boolean(this.snapLine1||this.snapLine2)}},{key:"updateSnapLineGizmos",value:function(e){var t=this;if(this.clearSnappingGizmos(),this.poly){var i=[],n=function(t){return t&&t.isUsable(e,1e-4)};if(2==this.poly.length){var o=u(this.poly,this.vIndex-1),s=this.computeAngleSnapLine(e,o,p);s&&n(s)&&i.push(s)}else{i=this.edgeSnapLines.filter(n);var r=this.getPrevSnapLine(e),a=this.getNextSnapLine(e);n(r)&&i.push(r),n(a)&&i.push(a)}i=i.filter((function(e,t){for(var n=!1,o=0;o<t;o++){var s=i[o];if(e.isEqual(s,1e-4)){n=!0;break}}return!n}));for(var l=this.gizmoLayer.viewport.width,h=this.gizmoLayer.viewport.height,c=Math.sqrt(l*l+h*h),d=function(e,i){if(e){var n=e.a;i.makeLine(n.x-c*e.dir.x,n.y-c*e.dir.y,n.x+c*e.dir.x,n.y+c*e.dir.y),t.gizmoLayer.addShape(i)}},f=0;f<i.length;f++){d(i[f],this.acquireSnapLineGizmo())}}}},{key:"dtor",value:function(){this.clearSnapping()}},{key:"computeAngleSnapLine",value:function(e,t,i){if(o.Math2D.edgeIsDegenerated(t,e))return null;for(var n=e.clone().sub(t),s=THREE.Math.radToDeg(o.Math2D.angleBetweenDirections(n,i)),r=-1,a=0;a<this.snapAngles.length;a++){var h=this.snapAngles[a];if(Math.abs(h-s)<this.snapAngleTolerance){r=a;break}}if(-1==r)return null;var u=THREE.Math.degToRad(this.snapAngles[r]),c=o.Math2D.rotateAround(i.clone(),u),d=t.distanceTo(e),p=c.multiplyScalar(d).add(t);return new l(t,p)}},{key:"active",get:function(){return this.poly}}]),e}();f.GlobalManagerMixin.call(y.prototype)},"./extensions/Edit2D/CanvasGizmo.js":
/*!******************************************!*\
  !*** ./extensions/Edit2D/CanvasGizmo.js ***!
  \******************************************/
/*! exports provided: AlignX, AlignY, CanvasGizmoBase, CanvasGizmo, ShapeLabel, LengthLabel, AreaLabel, EdgeGizmo, EdgeMoveGizmo, EdgeLabel, VertexGizmo, LabelFilter, DefaultLabelFilter, LabelStyleRule, FadeOutStyleRule, ShapeLabelRule */function(e,t,i){"use strict";i.r(t),i.d(t,"AlignX",(function(){return y})),i.d(t,"AlignY",(function(){return v})),i.d(t,"CanvasGizmoBase",(function(){return m})),i.d(t,"CanvasGizmo",(function(){return x})),i.d(t,"ShapeLabel",(function(){return S})),i.d(t,"LengthLabel",(function(){return E})),i.d(t,"AreaLabel",(function(){return k})),i.d(t,"EdgeGizmo",(function(){return P})),i.d(t,"EdgeMoveGizmo",(function(){return w})),i.d(t,"EdgeLabel",(function(){return T})),i.d(t,"VertexGizmo",(function(){return D})),i.d(t,"LabelFilter",(function(){return C})),i.d(t,"DefaultLabelFilter",(function(){return M})),i.d(t,"LabelStyleRule",(function(){return I})),i.d(t,"FadeOutStyleRule",(function(){return V})),i.d(t,"ShapeLabelRule",(function(){return A}));var n=i(/*! ./Math2D.js */"./extensions/Edit2D/Math2D.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,i){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function r(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?a(e):t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,i){return t&&d(e.prototype,t),i&&d(e,i),e}var f=function(e){return e.toString()+"px"},y={Left:1,Center:2,Right:3},v={Top:1,Center:2,Bottom:3},g=Bimfish.Viewing,m=function(){function e(){c(this,e)}return p(e,[{key:"update",value:function(){}}]),e}();g.GlobalManagerMixin.call(m.prototype);var x=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c(this,t),(i=r(this,l(t).call(this))).layer=e,i.setGlobalManager(e.globalManager),i.layerPos=new THREE.Vector2,i.canvasPos=new THREE.Vector2;var o=i.getDocument();return i.container=o.createElement("div"),i.container.style.position="absolute",i.container.style.transformOrigin="50% 50%",i.visible=!1,i.alignX=y.Center,i.alignY=v.Center,i.angle=0,n&&i.setVisible(!0,!1),i.isUnderMouse=!1,i.container.addEventListener("mouseenter",(function(){return i.isUnderMouse=!0})),i.container.addEventListener("mouseleave",(function(){return i.isUnderMouse=!1})),i.container.addEventListener("contextmenu",(function(e){i.isUnderMouse=!0,i.layer.viewer.triggerContextMenu(e)})),i}return h(t,e),p(t,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setVisible",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e!=this.visible&&(e?(this.layer.viewer.canvasWrap.appendChild(this.container),this.layer.addCanvasGizmo(this),t&&this.update()):(this.layer.viewer.canvasWrap.removeChild(this.container),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"setAlignX",value:function(e){this.alignX=e,this.update()}},{key:"setAlignY",value:function(e){this.alignY=e,this.update()}},{key:"setRotation",value:function(e){this.angle=e,this.update()}},{key:"update",value:function(){this.canvasPos.copy(this.layer.layerToCanvas(this.layerPos.x,this.layerPos.y));var e,t,i=this.canvasPos,n=this.container.style;switch(n.left=f(i.x),n.top=f(i.y),this.alignX){case y.Left:e="0%";break;case y.Center:e="-50%";break;case y.Right:e="-100%"}switch(this.alignY){case v.Top:t="0%";break;case v.Center:t="-50%";break;case v.Bottom:t="-100%"}n.transform="translate(".concat(e,", ").concat(t,") rotate(").concat(this.angle,"deg)")}},{key:"setPosition",value:function(e,t){this.layerPos.set(e,t),this.update()}},{key:"setClassEnabled",value:function(e,t){t?this.container.classList.add(e):this.container.classList.remove(e)}},{key:"setSelected",value:function(e){this.setClassEnabled("selected",e)}},{key:"isSelected",value:function(){return this.container.classList.contains("selected")}},{key:"setHoverEnabled",value:function(e){this.setClassEnabled("enable-hover",e)}},{key:"setName",value:function(e){this.name=e,this.container.id=e||""}}]),t}(m),b=function(e){e.container.classList.add("measure-length"),e.container.classList.add("visible");var t=e.getDocument();e.textDiv=t.createElement("div"),e.textDiv.classList.add("measure-length-text"),e.container.appendChild(e.textDiv),e.setText=function(e){this.textDiv.textContent=e}.bind(e)},S=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return c(this,t),n=r(this,l(t).call(this,i,o)),b(a(n)),n.shape=e,n.valueValid=!0,n.update(),n}return h(t,e),p(t,[{key:"update",value:function(){if(this.shape&&this.valueValid){if(this.container.style.visibility="visible",this.shape.isPolyline()){var e=this.shape.getEdgeCount(),i=Math.floor(e/2);if(this.shape.edgeIndexValid(i)){var n=new THREE.Vector2,o=new THREE.Vector2;this.shape.getEdge(i,n,o),this.layerPos.set(.5*(n.x+o.x),.5*(n.y+o.y))}}else this.shape.computeBBox(),this.shape.bbox.center(this.layerPos);s(l(t.prototype),"update",this).call(this)}else this.container.style.visibility="hidden"}},{key:"setShape",value:function(e){this.shape=e,this.update()}}]),t}(x),E=function(e){function t(e,i,n){var o,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return c(this,t),(o=r(this,l(t).call(this,e,i,s))).unitHandler=n,o}return h(t,e),p(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getLength&&this.shape.getLength(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.lengthToString(e);this.setText(i)}s(l(t.prototype),"update",this).call(this)}}]),t}(S),k=function(e){function t(e,i,n){var o,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return c(this,t),(o=r(this,l(t).call(this,e,i,s))).unitHandler=n,o}return h(t,e),p(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getArea&&this.shape.getArea(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.areaToString(e);this.setText(i)}s(l(t.prototype),"update",this).call(this)}}]),t}(S),P=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c(this,t),(i=r(this,l(t).call(this,e,n))).posA=new THREE.Vector2,i.posB=new THREE.Vector2,i.posValid=!1,i.edgeDir=new THREE.Vector2,i.poly=null,i.edgeIndex=0,i.container.classList.add("edge-gizmo"),i.maxRelativeLength=void 0,i}return h(t,e),p(t,[{key:"attachToEdge",value:function(e,t){this.poly=e,this.edgeIndex=t,this.update()}},{key:"detachFromEdge",value:function(){this.poly=null,this.edgeIndex=-1,this.posValid=!1,this.update()}},{key:"update",value:function(){this.poly&&this.poly.edgeIndexValid(this.edgeIndex)&&(this.poly.getEdge(this.edgeIndex,this.posA,this.posB),this.posValid=!0);var e=this._shouldBeShown();this.container.style.visibility=e?"visible":"hidden",e&&(this.layerPos.set(.5*(this.posA.x+this.posB.x),.5*(this.posA.y+this.posB.y)),this._updateRotation(),s(l(t.prototype),"update",this).call(this))}},{key:"_shouldBeShown",value:function(){if(!this.posValid)return!1;if(this.maxRelativeLength){var e=this.layer.layerToCanvas(this.posA.x,this.posA.y),t=this.layer.layerToCanvas(this.posB.x,this.posB.y),i=e.distanceTo(t)*this.maxRelativeLength,n=this.getWindow();return parseFloat(n.getComputedStyle(this.container).width)<i}return!0}},{key:"_updateRotation",value:function(){var e=n.Math2D.getEdgeDirection(this.posA,this.posB,this.edgeDir),t=Math.atan2(e.y,e.x);e.x<0&&(t+=Math.PI),this.angle=-THREE.Math.radToDeg(t)}}]),t}(x),w=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return c(this,t),(n=r(this,l(t).call(this,e,o))).setName(i),n.container.classList.add("edge-move-gizmo"),n.maxRelativeLength=.3,n}return h(t,e),t}(P),T=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c(this,t),i=r(this,l(t).call(this,e,n)),b(a(i)),i.maxRelativeLength=1,i}return h(t,e),t}(P),D=function(e){function t(e,i,n,o){var s;return c(this,t),(s=r(this,l(t).call(this,e,!0))).setPosition(i,n),s.setName(o),s.container.classList.add("vertex-gizmo"),s}return h(t,e),t}(x),C=function(){function e(){c(this,e)}return p(e,[{key:"accepts",value:function(e,t){return!0}}]),e}(),L=function(e,t){e.updateBBox();var i=e.bbox,n=i.max.x-i.min.x;return n*t.getPixelsPerUnit()*n},M=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return c(this,t),(e=r(this,l(t).call(this))).minWidth=i,e}return h(t,e),p(t,[{key:"accepts",value:function(e,t,i){var n=L(e,i);return Boolean(t)&&n>=this.minWidth}}]),t}(C),I=function(){function e(){c(this,e)}return p(e,[{key:"apply",value:function(e,t,i,n){}}]),e}(),V=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return c(this,t),(e=r(this,l(t).call(this))).rangeStart=i,e.rangeEnd=n,e}return h(t,e),p(t,[{key:"apply",value:function(e,t,i){var n=(L(t,i)-this.rangeStart)/(this.rangeEnd-this.rangeStart),o=THREE.Math.clamp(n,0,1);e.container.style.opacity=o}}]),t}(I),A=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V;c(this,e),this.layer=t,this.shapeToLabelText=i,this.labels=[],this.labelsUsed=0,this.layer.addCanvasGizmo(this),this.visible=!0,this.layer.update(),this.filter=n,this.styleRule=o}return p(e,[{key:"setTextRule",value:function(e){this.shapeToLabelText=e,this.update()}},{key:"setVisible",value:function(e){e!==this.visible&&(e?(this.layer.addCanvasGizmo(this),this.update()):(this.clearLabels(),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"dtor",value:function(){this.setVisible(!1)}},{key:"clearLabels",value:function(){for(var e=0;e<this.labelsUsed;e++)this.labels[e].setShape(null),this.labels[e].setVisible(!1);this.labelsUsed=0}},{key:"acquireLabel",value:function(){return this.labelsUsed===this.labels.length&&this.labels.push(new S(null,this.layer)),this.labels[this.labelsUsed++]}},{key:"update",value:function(){this.clearLabels();for(var e=this.layer.shapes,t=0;t<e.length;t++){var i=e[t],n=this.shapeToLabelText(i);if(!this.filter||this.filter.accepts(i,n,this.layer)){var o=this.acquireLabel();o.setShape(i),o.setText(n),o.setVisible(!0),this.styleRule&&this.styleRule.apply(o,i,this.layer)}}}}]),e}()},"./extensions/Edit2D/Edit2D.css":
/*!**************************************!*\
  !*** ./extensions/Edit2D/Edit2D.css ***!
  \**************************************/
/*! no static exports found */function(e,t,i){var n=i(/*! !../../node_modules/css-loader!../../node_modules/sass-loader/dist/cjs.js!./Edit2D.css */"./node_modules/css-loader/index.js!./node_modules/sass-loader/dist/cjs.js!./extensions/Edit2D/Edit2D.css");"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(/*! ../../node_modules/style-loader/lib/addStyles.js */"./node_modules/style-loader/lib/addStyles.js")(n,o);n.locals&&(e.exports=n.locals)},"./extensions/Edit2D/Edit2D.js":
/*!*************************************!*\
  !*** ./extensions/Edit2D/Edit2D.js ***!
  \*************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return _}));var n=i(/*! ./EditLayer.js */"./extensions/Edit2D/EditLayer.js"),o=i(/*! ./EditShapes.js */"./extensions/Edit2D/EditShapes.js"),s=i(/*! ./Selection.js */"./extensions/Edit2D/Selection.js"),r=i(/*! ./Math2D.js */"./extensions/Edit2D/Math2D.js"),a=i(/*! ./Actions.js */"./extensions/Edit2D/Actions.js"),l=i(/*! ./UndoStack.js */"./extensions/Edit2D/UndoStack.js"),h=i(/*! ./Edit2DSnapper.js */"./extensions/Edit2D/Edit2DSnapper.js"),u=i(/*! ./Edit2DContextMenu.js */"./extensions/Edit2D/Edit2DContextMenu.js"),c=i(/*! ./UnitHandler.js */"./extensions/Edit2D/UnitHandler.js"),d=i(/*! ./CanvasGizmo.js */"./extensions/Edit2D/CanvasGizmo.js"),p=i(/*! ./TangentGizmo.js */"./extensions/Edit2D/TangentGizmo.js"),f=i(/*! ./SegmentTree.js */"./extensions/Edit2D/SegmentTree.js"),y=i(/*! ./tools/MoveTool.js */"./extensions/Edit2D/tools/MoveTool.js"),v=i(/*! ./tools/PolygonTool.js */"./extensions/Edit2D/tools/PolygonTool.js"),g=i(/*! ./tools/PolygonEditTool.js */"./extensions/Edit2D/tools/PolygonEditTool.js"),m=i(/*! ./tools/InsertSymbolTool.js */"./extensions/Edit2D/tools/InsertSymbolTool.js"),x=i(/*! ./tools/RectangleTool.js */"./extensions/Edit2D/tools/RectangleTool.js"),b=i(/*! ./tools/UndoTool.js */"./extensions/Edit2D/tools/UndoTool.js"),S=i(/*! ./tools/CopyTool.js */"./extensions/Edit2D/tools/CopyTool.js"),E=i(/*! ./tools/LineTool.js */"./extensions/Edit2D/tools/LineTool.js"),k=i(/*! ./MeasureTransform.js */"./extensions/Edit2D/MeasureTransform.js");i(/*! ./Edit2D.css */"./extensions/Edit2D/Edit2D.css");function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t,i,n,o,s,r){try{var a=e[s](r),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function T(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var I=AutodeskNamespace("Bimfish.Edit2D"),V=Bimfish.Viewing,A=function e(t,i){M(this,e),this.name=t,this.autoReactivate=i,this.context=null,this.tools={}},_=function(e){function t(e,i){var n,o,s;return M(this,t),o=this,(n=!(s=D(t).call(this,e,i))||"object"!==P(s)&&"function"!=typeof s?C(o):s).undoStack=new l.default,n._registeredTools=new Map,n._boundOnModelAdded=n._onModelAdded.bind(C(n)),n._boundOnModelRemoved=n._onModelRemoved.bind(C(n)),n._boundOnSelectionChanged=n._onSelectionChanged.bind(C(n)),n}var i,o,r,a,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,e),i=t,(o=[{key:"load",value:(a=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.viewer.impl.createOverlayScene("Edit2D"),e.next=3,this.viewer.loadExtension("Bimfish.Snapping");case 3:this.viewer.addEventListener(V.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.addEventListener(V.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),this.undoTool=new b.default(this.undoStack),this.viewer.toolController.registerTool(this.undoTool),this.viewer.toolController.activateTool(this.undoTool.getName());case 8:case"end":return e.stop()}}),e,this)})),h=function(){var e=this,t=arguments;return new Promise((function(i,n){var o=a.apply(e,t);function s(e){w(o,i,n,s,r,"next",e)}function r(e){w(o,i,n,s,r,"throw",e)}s(void 0)}))},function(){return h.apply(this,arguments)})},{key:"unload",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this._registeredTools.keys()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var s=n.value;this.unregisterTools(s)}}catch(e){t=!0,i=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}return this.viewer.toolController.deregisterTool(this.undoTool),this.undoTool=null,this.viewer.removeEventListener(V.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.removeEventListener(V.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),!0}},{key:"_onModelAdded",value:function(){var e=this;if(1===this.viewer.getVisibleModels().length){var t=!0,i=!1,n=void 0;try{for(var o,s=this._registeredTools.values()[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var r=o.value;r.autoReactivate&&r.toolsToReactivate.forEach((function(t){return e.viewer.toolController.activateTool(t)}))}}catch(e){i=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw n}}}}},{key:"_onModelRemoved",value:function(){if(0===this.viewer.getVisibleModels().length){var e=this.viewer.toolController,t=!0,i=!1,n=void 0;try{for(var o,s=this._registeredTools.values()[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var r=o.value;r.autoReactivate&&(r.toolsToReactivate=Object.values(r.tools).map((function(e){return e.getNames()})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(t){return e.isToolActivated(t)})),r.toolsToReactivate.forEach((function(t){return e.deactivateTool(t)})))}}catch(e){i=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw n}}}}},{key:"_onSelectionChanged",value:function(e){var t=e.target,i=!0,n=!1,o=void 0;try{for(var s,r=this._registeredTools.values()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=s.value;t===a.context.selection||t.empty()||a.context.selection.clear()}}catch(e){n=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(n)throw o}}}},{key:"registerDefaultTools",value:function(){this.defaultContext=this.registerTools("default")}},{key:"registerTools",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._registeredTools.get(e);if(i)return console.warn("Edit 2D tools are already registered for tool set '".concat(e,"'")),i.context;i=new A(e,t),this._registeredTools.set(e,i);var n=i.context=new z(this,e);n.selection.addEventListener(s.default.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),i.tools.polygonTool=new v.default(n,v.default.Mode.Polygon),i.tools.polylineTool=new v.default(n,v.default.Mode.Polyline),i.tools.moveTool=new y.default(n),i.tools.polygonEditTool=new g.default(n),i.tools.insertSymbolTool=new m.default(n),i.tools.copyTool=new S.default(n);var o=this.viewer.toolController;return o.registerTool(i.tools.polygonTool),o.registerTool(i.tools.polylineTool),o.registerTool(i.tools.moveTool),o.registerTool(i.tools.polygonEditTool),o.registerTool(i.tools.insertSymbolTool),o.registerTool(i.tools.copyTool),o.activateTool(i.tools.copyTool.getName()),i.contextMenu=new u.default(this.viewer,i),i.contextMenu.register(),n}},{key:"unregisterDefaultTools",value:function(){this.unregisterTools("default"),this.defaultContext=null}},{key:"unregisterTools",value:function(e){var t=this._registeredTools.get(e);if(t){var i=this.viewer.toolController;i.deregisterTool(t.tools.polygonTool),i.deregisterTool(t.tools.polylineTool),i.deregisterTool(t.tools.moveTool),i.deregisterTool(t.tools.polygonEditTool),i.deregisterTool(t.tools.insertSymbolTool),i.deregisterTool(t.tools.copyTool),t.context.selection.removeEventListener(s.default.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),t.contextMenu.unregister(),t.contextMenu=null,this._registeredTools.delete(e)}}},{key:"createLayer",value:function(){var e=this.viewer.model;e&&e.is2d()||console.error("A 2D model is needed to adjust viewport");var t=e.getBoundingBox(),i=t.max.x-t.min.x,o=t.max.y-t.min.y,s=new n.default(i,o,this.viewer);return this.viewer.impl.overlayScenes.Edit2D.scene.add(s.scene),s}},{key:"defaultTools",get:function(){var e=this._registeredTools.get("default");return e&&e.tools}}])&&T(i.prototype,o),r&&T(i,r),t}(V.Extension),z=function e(t,i){var n=this;M(this,e),this.toolSetName=i,this.viewer=t.viewer,this.layer=t.createLayer(),this.gizmoLayer=t.createLayer(),this.undoStack=t.undoStack,this.selection=new s.default(this.layer,this.undoStack),this.snapper=new h.default(this.viewer,this.layer,this.gizmoLayer),this.unitHandler=new c.DefaultUnitHandler(this.viewer);this.viewer.addEventListener(Bimfish.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,(function(){n.layer.updateCanvasGizmos(),n.gizmoLayer.updateCanvasGizmos()}))};Bimfish.Viewing.theExtensionManager.registerExtension("Bimfish.Edit2D",_),I.Shape=o.Shape,I.Polygon=o.Polygon,I.Polyline=o.Polyline,I.PolyBase=o.PolyBase,I.Path=o.Path,I.Circle=o.Circle,I.Style=o.Style,I.PolygonTool=v.default,I.Selection=s.default,I.MoveTool=y.default,I.PolygonEditTool=g.default,I.InsertSymbolTool=m.default,I.Math2D=r.Math2D,I.VertexGizmo=d.VertexGizmo,I.RectangleTool=x.default,I.LineTool=E.default,I.CopyTool=S.default,I.Actions=a.Actions,I.UndoStack=l.default,I.UndoTool=b.default,I.Edit2DContext=z,I.CanvasGizmo=d.CanvasGizmo,I.CanvasGizmoBase=d.CanvasGizmoBase,I.ShapeLabel=d.ShapeLabel,I.AlignX=d.AlignX,I.AlignY=d.AlignY,I.AreaLabel=d.AreaLabel,I.EdgeLabel=d.EdgeLabel,I.UnitHandler=c.UnitHandler,I.DefaultUnitHandler=c.DefaultUnitHandler,I.ShapeLabelRule=d.ShapeLabelRule,I.ShapeWrapper=o.ShapeWrapper,I.SegmentTree=f.default,I.TangentGizmo=p.default,I.MeasureTransform=k.MeasureTransform,I.DefaultMeasureTransform=k.DefaultMeasureTransform},"./extensions/Edit2D/Edit2DContextMenu.js":
/*!************************************************!*\
  !*** ./extensions/Edit2D/Edit2DContextMenu.js ***!
  \************************************************/
/*! exports provided: default */function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t),i.d(t,"default",(function(){return o}));var o=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.toolSet=i,this.callbackId="Edit2D_".concat(i.name),this.callback=this.onContextMenu.bind(this)}var t,i,o;return t=e,(i=[{key:"register",value:function(){this.viewer.registerContextMenuCallback(this.callbackId,this.callback)}},{key:"unregister",value:function(){this.viewer.unregisterContextMenuCallback(this.callbackId)}},{key:"vertexGizmoUnderMouse",value:function(e,t){var i=this.toolSet.tools.polygonEditTool.vertexGizmos,n=document.elementFromPoint(e,t);return i.findIndex((function(e){return e.container===n}))}},{key:"onContextMenu",value:function(e,t){var i=this.toolSet.tools.polygonEditTool,n=this.toolSet.context.layer,o=t.event;if(Boolean(i.poly)){var s=n.canvasToLayer(t.canvasX,t.canvasY),r=this.vertexGizmoUnderMouse(o.clientX,o.clientY),a=r>=0,l=i.findEdgeUnderMouse(s),h=i.getNewVertexPosition(s,l),u=Boolean(h);(n.hitTest(s.x,s.y)||a||u)&&(e.length=0,a?e.push({title:"Remove Vertex",target:function(){i.removePoint(r)}}):h&&e.push({title:"Insert Vertex",target:function(){var e=l+1;i.insertPoint(e,h)}}))}}}])&&n(t.prototype,i),o&&n(t,o),e}()},"./extensions/Edit2D/Edit2DSnapper.js":
/*!********************************************!*\
  !*** ./extensions/Edit2D/Edit2DSnapper.js ***!
  \********************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var n=i(/*! ./AngleSnapper.js */"./extensions/Edit2D/AngleSnapper.js"),o=i(/*! ./SegmentTree.js */"./extensions/Edit2D/SegmentTree.js");function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=Bimfish.Viewing.MeasureCommon.SnapType,a=Bimfish.Viewing,l=function(){function e(t,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.setGlobalManager(t.globalManager),this.layer=i,this.gizmoLayer=o,this.sheetSnapper=new Bimfish.Viewing.Extensions.Snapping.Snapper(t),this.layerSnapper=new Bimfish.Viewing.Extensions.Snapping.Snapper(t),this.angleSnapper=new n.default(o),this.snapBox=new THREE.Box2,this.sheetSnapper.activate(),this.layerSnapper.activate(),this.onCameraChangeCb=this.onCameraChange.bind(this),this.viewer.addEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb),this.initSegmentTrees()}var t,i,a;return t=e,(i=[{key:"dtor",value:function(){this.sheetSnapper.deactivate(),this.layerSnapper.deactivate(),this.viewer.removeEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb)}},{key:"onCameraChange",value:function(){this.updateSnapperIndicators()}},{key:"initSegmentTrees",value:function(){var e=this;this.viewer.getVisibleModels().forEach((function(t){var i=!(!t.myData||!t.myData.isLeaflet);t.is2d()&&!i&&!t.segmentTree&&t.isLoadDone()&&(t.segmentTree=new o.default(e.viewer.impl.use2dInstancing),t.segmentTree.buildFromModel(t))}))}},{key:"updateSnapperIndicators",value:function(){this.sheetSnapper.isSnapped()?this.sheetSnapper.indicator.render():this.layerSnapper.indicator.render()}},{key:"getSnapPosition",value:function(e,t,i){var n=this._getSnapPosition(e,t,i);return this.angleSnapper.updateSnapLineGizmos(n),this.updateSnapperIndicators(),n}},{key:"clearSnappingGizmos",value:function(){this.angleSnapper.clearSnappingGizmos(),this.sheetSnapper.clearSnapped(),this.sheetSnapper.indicator&&this.sheetSnapper.indicator.clearOverlays(),this.layerSnapper.clearSnapped(),this.layerSnapper.indicator&&this.layerSnapper.indicator.clearOverlays()}},{key:"startAngleSnapping",value:function(e,t){this.angleSnapper.startSnapping(e,t)}},{key:"stopAngleSnapping",value:function(){this.angleSnapper.stopSnapping()}},{key:"_getSnapPosition",value:function(e,t,i){this.angleSnapper.clearSnappingResult(),this.sheetSnapper.clearSnapped(),this.layerSnapper.clearSnapped();var n=this.layer.canvasToLayer(e,t),o=this._getGeomSnapPosition(e,t,i),s=this._getGeomSnapLine();if(o&&!s)return o;if(this.angleSnapper.snapToAngle(n,s),s&&!this.angleSnapper.isSnapped())return o;if(s&&this.angleSnapper.isSnapped()){var a=this._getGeomSnapResult();a.geomType=r.SNAP_INTERSECTION,a.snapPoint=n.clone(),a.geomVertex=a.snapPoint}return n}},{key:"_getGeomSnapPosition",value:function(e,t,i){var n=this.layer.canvasToLayer(e,t),o=this._getSheetSnapPosition(e,t),s=this._getEditLayerSnapPosition(e,t,i);return o||s?s?o?THREE.Vector2.prototype.distanceToSquared.call(o,n)<THREE.Vector2.prototype.distanceToSquared.call(s,n)?(this.layerSnapper.clearSnapped(),o):(this.sheetSnapper.clearSnapped(),s):s:o:null}},{key:"_getGeomSnapResult",value:function(){var e=this.sheetSnapper.isSnapped(),t=this.layerSnapper.isSnapped();return e||t?(e?this.sheetSnapper:this.layerSnapper).getSnapResult():null}},{key:"_getGeomSnapLine",value:function(){var e=this._getGeomSnapResult();if(!e)return null;if(e.geomEdge){var t=e.geomEdge.vertices;return{a:t[0],b:t[1]}}return null}},{key:"_getEditLayerSnapPosition",value:function(e,t,i){var n=this.viewer.impl.intersectGround(e,t),o=this.layerSnapper.setDetectRadius(n);this.snapBox.min.set(n.x-o,n.y-o),this.snapBox.max.set(n.x+o,n.y+o);var s={};this.layer.enumShapes(this.snapBox,(function(e){i&&!i(e)||(s[e.id]=!0)}));var r=[];if(this.layer.enumMeshes(this.snapBox,(function(e){return r.push(e)})),this.layerSnapper.clearSnapped(),this.layerSnapper.snapping2DOverlay(n,r,(function(e){return Boolean(s[e])})),this.layerSnapper.isSnapped()){var a=this.layerSnapper.getSnapResult();return Bimfish.Viewing.MeasureCommon.getSnapResultPosition(a,this.viewer)}}},{key:"_getSheetSnapPosition",value:function(e,t){var i=this;this.initSegmentTrees();var n=this.viewer.impl.intersectGround(e,t);if(this.sheetSnapper.snapping2DWithSegmentEnum(n,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=i.viewer.getVisibleModels();o.forEach((function(e){var i;e.is2d()&&e.segmentTree&&(i=e.segmentTree).enumSegments.apply(i,t)}))})),this.sheetSnapper.isSnapped()){var o=this.sheetSnapper.getSnapResult(),s=Bimfish.Viewing.MeasureCommon.getSnapResultPosition(o,this.viewer);return(new THREE.Vector2).copy(s)}}}])&&s(t.prototype,i),a&&s(t,a),e}();a.GlobalManagerMixin.call(l.prototype)},"./extensions/Edit2D/EditLayer.js":
/*!****************************************!*\
  !*** ./extensions/Edit2D/EditLayer.js ***!
  \****************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var n=i(/*! ../PDF/LmvCanvasContext.js */"./extensions/PDF/LmvCanvasContext.js"),o=i(/*! ../PDF/test-pattern.js */"./extensions/PDF/test-pattern.js");function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=1,a=Bimfish.Viewing,l=function(){function e(t,i,s){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a.EventDispatcher.prototype.apply(this),this.scene=new THREE.Scene,this.shapes=[],this.canvasGizmos=[],this.id=r++;this.viewport={width:t,height:i};this.context=new n.LmvCanvasContext(this.viewport,1,this._processMesh.bind(this),null),this.viewer=s,this.setGlobalManager(s.globalManager),this.autoUpdate=!0,this.toPageUnits=1,this.styleModifiers=[],Object(o.addContextCurrentTransform)(this.context.canvasContext),this.onCameraChange=function(){return l.updateCanvasGizmos()},this.viewer.addEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.context.setTessParams({numIterations:100,minSegLenFraction:.01})}var t,i,l;return t=e,(i=[{key:"dtor",value:function(){this._clearScene(),this.viewer.removeEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}},{key:"addShape",value:function(t){this.shapes.push(t),this.dispatchEvent({type:e.SHAPE_ADDED,shape:t}),this._onModified()}},{key:"removeShape",value:function(t){var i=this.shapes.indexOf(t);return-1!==i&&(this.shapes.splice(i,1),this.dispatchEvent({type:e.SHAPE_REMOVED,shape:t}),this._onModified(),!0)}},{key:"clear",value:function(){this.shapes.length=0,this.dispatchEvent({type:e.LAYER_CLEARED}),this._onModified()}},{key:"update",value:function(){this._clearScene();for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e],i=this._getOverrideStyle(t);t.draw(this.context,i)}this.context.flushBuffer(0,!0),this.viewer.impl.invalidate(!1,!1,!0),this.updateCanvasGizmos()}},{key:"updateCanvasGizmos",value:function(){for(var e=0;e<this.canvasGizmos.length;e++)this.canvasGizmos[e].update()}},{key:"addCanvasGizmo",value:function(e){this.canvasGizmos.push(e)}},{key:"removeCanvasGizmo",value:function(e){var t=this.canvasGizmos.indexOf(e);return-1!==t&&(this.canvasGizmos.splice(t,1),!0)}},{key:"getViewport",value:function(){return this.viewport}},{key:"hitTest",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.shapes.length-1;n>=0;n--){var o=this.shapes[n],s=this.getLineHitRadius(o,i);if(o.hitTest(e,t,s))return o}}},{key:"getLineHitRadius",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=this.getUnitsPerPixel(),n=(e.style.isScreenSpace?i:1)*e.style.lineWidth;return Math.max(n,t*i)}},{key:"addStyleModifier",value:function(e){this.styleModifiers.push(e),this._onModified()}},{key:"removeStyleModifier",value:function(e){var t=this.styleModifiers.indexOf(e);return-1!=t&&(this.styleModifiers.splice(t,1),this._onModified(),!0)}},{key:"layerToCanvas",value:function(e,t){var i=this.viewer.impl.worldToClient(new THREE.Vector3(e,t,0));return new THREE.Vector2(i.x,i.y)}},{key:"getPixelsPerUnit",value:function(){if(!this.viewer.model)return console.warn("Accessing EditLayer.getPixelsPerUnit is impossible when no model is loaded."),1;var e=this.viewer.impl.camera,t=this.viewer.impl.getVisibleBounds(),i=this.getWindow();return this.viewer.impl.getPixelsPerUnit(e,t)/i.devicePixelRatio}},{key:"getUnitsPerPixel",value:function(){return 1/this.getPixelsPerUnit()}},{key:"canvasToLayer",value:function(e,t){var i=this.viewer.impl.intersectGround(e,t);return new THREE.Vector2(i.x,i.y)}},{key:"enumShapes",value:function(e,t){for(var i=0;i<this.shapes.length;i++){var n=this.shapes[i];n.updateBBox(),e.isIntersectionBox(n.bbox)&&t(n)}}},{key:"enumMeshes",value:function(e,t){for(var i=0;i<this.scene.children.length;i++){var n=this.scene.children[i],o=n.geometry.boundingBox;e.isIntersectionBox(o)&&t(n)}}},{key:"findShapeById",value:function(e){return this.shapes.find((function(t){return t.id==e}))}},{key:"_processMesh",value:function(e){var t={mesh:e,is2d:!0,packId:"0",meshIndex:0};Bimfish.Viewing.Private.BufferGeometryUtils.meshToGeometry(t);var i=t.geometry,n=this.viewer.impl.getMaterials(),o=n.create2DMaterial(null,e.material),s=n.findMaterial(null,o),r=new THREE.Mesh(i,s);this.scene.children.push(r)}},{key:"_onModified",value:function(){this.autoUpdate&&this.update()}},{key:"_getOverrideStyle",value:function(e){for(var t=e.style,i=0;i<this.styleModifiers.length;i++)t=(0,this.styleModifiers[i])(e,t)||t;return t}},{key:"_clearScene",value:function(){for(var e=this.scene.children,t=0;t<e.length;t++)e[t].geometry.dispose();this.scene.children.length=0}}])&&s(t.prototype,i),l&&s(t,l),e}();a.GlobalManagerMixin.call(l.prototype),l.SHAPE_ADDED="shapeAdded",l.SHAPE_REMOVED="shapeRemoved",l.LAYER_CLEARED="layerCleared"},"./extensions/Edit2D/EditShapes.js":
/*!*****************************************!*\
  !*** ./extensions/Edit2D/EditShapes.js ***!
  \*****************************************/
/*! exports provided: Style, Shape, PolyBase, Polygon, Polyline, Path, Circle, ShapeWrapper */function(e,t,i){"use strict";i.r(t),i.d(t,"Style",(function(){return b})),i.d(t,"Shape",(function(){return k})),i.d(t,"PolyBase",(function(){return P})),i.d(t,"Polygon",(function(){return w})),i.d(t,"Polyline",(function(){return T})),i.d(t,"Path",(function(){return C})),i.d(t,"Circle",(function(){return L})),i.d(t,"ShapeWrapper",(function(){return M}));var n=i(/*! ./Math2D.js */"./extensions/Edit2D/Math2D.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t,i){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,i){return t&&d(e.prototype,t),i&&d(e,i),e}var f=1,y=Bimfish.Viewing,v=new DOMParser,g=function(e,t,i){return"rgb("+e+","+t+","+i+")"},m=Math.pow(10,4),x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||null===t)return e;var i=4===t?m:Math.pow(10,t);return Math.round(e*i)/i},b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,64)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,64)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace}return p(e,[{key:"setFillColor",value:function(e,t,i){this.fillColor=g(e,t,i)}},{key:"setLineColor",value:function(e,t,i){this.lineColor=g(e,t,i)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this}}]),e}();b.toColor=g;var S=new b,E=function(e,t){t.makeEmpty();for(var i=0;i<e.length;i++)t.expandByPoint(e[i])},k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.clone();c(this,e),this.style=t,this.id=f++,this.bbox=new THREE.Box2,this.bboxDirty=!0,this.name=this.id.toString()}return p(e,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"toSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.toSVGPath(e,t);if(i)return'<svg xmlns="http://www.w3.org/2000/svg"><path d="'.concat(i.join(" "),'"/></svg>')}},{key:"toSVGPath",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.error("Must be implemented by derived class.")}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}}],[{key:"fromSVG",value:function(e){if(e){var t=v.parseFromString(e,"application/xml").firstChild;if(!t)throw"svg node was not found";if("svg"!==t.nodeName)throw"Function does only support svg";if(1!==t.childNodes.length)throw"Function does only support svg with a single element: path, circle";var i=t.firstChild;if("circle"===i.nodeName)return L._fromDOMNode(i);if("path"===i.nodeName)return C._fromDOMNode(i);throw"Unsupported svg node type: ".concat(i.nodeName)}}}]),e}();y.GlobalManagerMixin.call(k.prototype);var P=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.clone();return c(this,t),(e=s(this,l(t).call(this,n))).points=i,e}return h(t,e),p(t,[{key:"isPolygon",value:function(){return this instanceof w}},{key:"isPolyline",value:function(){return this instanceof T}},{key:"isPath",value:function(){return this instanceof C}},{key:"addPoint",value:function(e,t){var i={x:e,y:t};return this.points.push(i),this.modified(),i}},{key:"getPoint",value:function(e,t){return(t=t||new THREE.Vector2).copy(this.points[e])}},{key:"removePoint",value:function(e){this.points.splice(e,1)}},{key:"updatePoint",value:function(e,t,i){var n=this.points[e];n.x=t,n.y=i,this.modified()}},{key:"insertPoint",value:function(e,t){this.points.splice(e,0,t)}},{key:"clear",value:function(){this.points.length=0,this.modified()}},{key:"enumEdges",value:function(e){for(var t=this.isPolygon()?this.length:this.length-1,i=0;i<t;i++){var n=i,o=(i+1)%this.length;if(e(this.getPoint(n),this.getPoint(o),n,o))return}}},{key:"findEdgeIndex",value:function(e,t){var i=-1;return this.enumEdges((function(o,s,r){var a=n.Math2D.isPointOnEdge(e,o,s,t);return a&&(i=r),a})),i}},{key:"move",value:function(e,t){for(var i=0;i<this.points.length;i++)this.points[i].x+=e,this.points[i].y+=t;return this.modified(),this}},{key:"copy",value:function(e){return a(l(t.prototype),"copy",this).call(this,e),this.points=e.points.map((function(e){return{x:e.x,y:e.y}})),this.modified(),this}},{key:"toSVGPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.length){var i=0,o=function(o,s,r,a){if(!r)return o.push("M ".concat(x(s.x,t),",").concat(x(s.y,t))),o;var l,h,u=a[i],c=n.Math2D.pointDelta(u,s,t);return c?(Math.abs(c.x)<=e?(l="V",h=x(s.y,t)):Math.abs(c.y)<=e?(l="H",h=x(s.x,t)):(l="L",h="".concat(x(s.x,t),",").concat(x(s.y,t))),o.push("".concat(l," ").concat(h)),i=r,o):o},s=this.points.reduce(o,[]);return this.isPolygon()&&s.push("Z"),s}}},{key:"computeBBox",value:function(){E(this.points,this.bbox)}},{key:"nextIndex",value:function(e){return(e+1)%this.length}},{key:"prevIndex",value:function(e){return(e+this.length-1)%this.length}},{key:"edgeIndexValid",value:function(e){var t=this.getEdgeCount();return e>=0&&e<t}},{key:"getEdge",value:function(e,t,i){var n=e,o=this.nextIndex(e);this.getPoint(n,t),this.getPoint(o,i)}},{key:"getEdgeCount",value:function(){return this.isPolygon()?this.length:this.length-1}},{key:"getLength",value:function(e){for(var t=new THREE.Vector2,i=new THREE.Vector2,n=0,o=0;o<this.getEdgeCount();o++)this.getEdge(o,t,i),e&&e.apply(t),e&&e.apply(i),n+=t.distanceTo(i);return n}},{key:"length",get:function(){return this.points.length}}]),t}(k),w=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.clone();return c(this,t),s(this,l(t).call(this,e,i))}return h(t,e),p(t,[{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1)e.lineTo(this.points[n].x,this.points[n].y);e.closePath();var o=e.canvasContext;o.fillStyle=i.fillColor,o.globalAlpha=i.fillAlpha,e.fill(),o.strokeStyle=i.lineColor,o.globalAlpha=i.lineAlpha,o.lineWidth=i.lineWidth;var s=this.getWindow();i.isScreenSpace&&(o.lineWidth*=s.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"hitTest",value:function(e,t){for(var i=new Bimfish.Extensions.CompGeom.ComplexPolygon(this.points),n=[],o=0;o<this.length;o++)n.push(o);return i.pointInContour(e,t,n)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"getArea",value:function(e){if(this.points.length<3)return 0;var t=0;return this.enumEdges((function(i,n){e&&e.apply(i),e&&e.apply(n),t+=i.x*n.y-n.x*i.y})),Math.abs(.5*t)}}]),t}(P),T=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.clone();return c(this,t),s(this,l(t).call(this,e,i))}return h(t,e),p(t,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.length?(this.clear(),this.addPoint(e,t),this.addPoint(i,n)):(this.updatePoint(0,e,t),this.updatePoint(1,i,n)),this}},{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)e.lineTo(this.points[n].x,this.points[n].y);var o=e.canvasContext;o.strokeStyle=i.lineColor,o.globalAlpha=i.lineAlpha,o.lineWidth=i.lineWidth;var s=this.getWindow();i.isScreenSpace&&(o.lineWidth*=s.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"computeBBox",value:function(){E(this.points,this.bbox)}},{key:"hitTest",value:function(e,t,i){return-1!==this.findEdgeIndex({x:e,y:t},i)}}]),t}(P),D=1,C=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.clone();return c(this,t),s(this,l(t).call(this,e,i))}return h(t,e),p(t,[{key:"updatePoint",value:function(e,t,i){var n=this.points[e],o=t-n.x,s=i-n.y;if(this.isBezierArc(e)&&(n.cp1x+=o,n.cp1y+=s),this.length>1){var r=this.prevIndex(e);if(this.isBezierArc(r)){var a=this.points[r];a.cp2x+=o,a.cp2y+=s}}n.x=t,n.y=i,this.modified()}},{key:"setBezierArc",value:function(e,t,i,n,o){var s=this.points[e];s.arcType=D,s.cp1x=t,s.cp1y=i,s.cp2x=n,s.cp2y=o}},{key:"isBezierArc",value:function(e){return this.points[e].arcType===D}},{key:"getControlPoint",value:function(e,t,i){var n=i||new THREE.Vector2,o=this.points[e];return 1===t?(n.x=o.cp1x,n.y=o.cp1y):(n.x=o.cp2x,n.y=o.cp2y),n}},{key:"updateControlPoint",value:function(e,t,i,n){var o=this.points[e];1===t?(o.cp1x=i,o.cp1y=n):(o.cp2x=i,o.cp2y=n),this.modified()}},{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1){var o=this.points[n-1],s=this.points[n];o.arcType===D?e.bezierCurveTo(o.cp1x,o.cp1y,o.cp2x,o.cp2y,s.x,s.y):e.lineTo(s.x,s.y)}var r=this.points[this.points.length-1],a=this.points[0];r.arcType===D?e.bezierCurveTo(r.cp1x,r.cp1y,r.cp2x,r.cp2y,a.x,a.y):e.lineTo(a.x,a.y),e.closePath();var l=e.canvasContext;l.fillStyle=i.fillColor,l.globalAlpha=i.fillAlpha,e.fill(),l.strokeStyle=i.lineColor,l.globalAlpha=i.lineAlpha,l.lineWidth=i.lineWidth,i.isScreenSpace&&(l.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"hitTest",value:function(e,t){for(var i=new Bimfish.Extensions.CompGeom.ComplexPolygon(this.points),n=[],o=0;o<this.length;o++)n.push(o);return i.pointInContour(e,t,n)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){a(l(t.prototype),"copy",this).call(this,e);for(var i=0;i<e.points.length;i++)if(e.isBezierArc(i)){var n=e.points[i],o=this.points[i];o.arcType=n.arcType,o.cp1x=n.cp1x,o.cp1y=n.cp1y,o.cp2x=n.cp2x,o.cp2y=n.cp2y}return this}},{key:"toSVGPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.length)return[];var i=[];i.push("M ".concat(x(this.points[0].x,t),",").concat(x(this.points[0].y,t)));for(var o=1;o<this.points.length;o+=1){var s=this.points[o-1],r=this.points[o],a=void 0;if(s.arcType===D)a="C ".concat(x(s.cp1x,t),",").concat(x(s.cp1y,t),",").concat(x(s.cp2x,t),",").concat(x(s.cp2y,t),",").concat(x(r.x,t),",").concat(x(r.y,t));else{var l=n.Math2D.pointDelta(s,r,t);if(!l)continue;a=Math.abs(l.x)<=e?"V ".concat(x(r.y,t)):Math.abs(l.y)<=e?"H ".concat(x(r.x,t)):"L ".concat(x(r.x,t),",").concat(x(r.y,t))}i.push(a)}var h=this.points[this.points.length-1];if(h.arcType===D){var u=this.points[0],c="C ".concat(x(h.cp1x,t),",").concat(x(h.cp1y,t),",").concat(x(h.cp2x,t),",").concat(x(h.cp2y,t),",").concat(x(u.x,t),",").concat(x(u.y,t));i.push(c)}return i.push("Z"),i}},{key:"move",value:function(e,i){a(l(t.prototype),"move",this).call(this,e,i);for(var n=0;n<this.points.length;n++)if(this.isBezierArc(n)){var o=this.points[n];o.cp1x+=e,o.cp1y+=i,o.cp2x+=e,o.cp2y+=i}return this.modified(),this}}],[{key:"_fromDOMNode",value:function(e){var i=e.getAttribute("d");if(i){var n=t._parsePath(i),o=n.points,s=n.isPolygon;return o.find((function(e){return void 0!==e.arcType}))?new t(o):s?new w(o):new T(o)}}},{key:"_parsePath",value:function(e){for(var t,i=e.split(/ (?=[a-zA-Z])/gi),o={x:0,y:0},s=[],r=!1,a=0;a<i.length;a++){var l=i[a];if(!"MLHVCZ".contains(l[0]))throw'"'.concat(l[0],'" is not a supported or invalid glyph: ').concat(l);var h=l.substring(1);switch(l[0]){case"M":case"L":var u=h.split(",");t={x:parseFloat(u[0]),y:parseFloat(u[1])},"M"===l[0]&&s.shift();break;case"H":t={x:parseFloat(h),y:o.y};break;case"V":t={x:o.x,y:parseFloat(h)};break;case"C":var c=h.split(",");t={x:parseFloat(c[4]),y:parseFloat(c[5])},o.arcType=D,o.cp1x=parseFloat(c[0]),o.cp1y=parseFloat(c[1]),o.cp2x=parseFloat(c[2]),o.cp2y=parseFloat(c[3]);break;case"Z":r=!0;continue}o=t,s.push(t)}return n.Math2D.pointDelta(s[0],s[s.length-1],0)||s.pop(),{points:s,isPolygon:r}}}]),t}(P),L=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.clone(),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return c(this,t),(e=s(this,l(t).call(this,r))).polygon=new w([],r),e.polygon.id=e.id,e.centerX=i,e.centerY=n,e.radius=o,e.tessSegments=a,e.needsUpdate=!0,e}return h(t,e),p(t,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var i=360/this.tessSegments,n=0;n<360;n+=i){var o=n*Math.PI/180,s=this.radius*Math.cos(o),r=this.radius*Math.sin(o);this.polygon.addPoint(this.centerX+s,this.centerY+r)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){this.centerX+=e,this.centerY+=t,this.modified()}},{key:"hitTest",value:function(e,t){var i=e-this.centerX,n=t-this.centerY;return i*i+n*n<this.radius*this.radius}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){return a(l(t.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"toSVG",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return'<svg xmlns="http://www.w3.org/2000/svg"><circle cx="'.concat(x(this.centerX,e),'" cy="').concat(x(this.centerY,e),'" r="').concat(x(this.radius,e),'"/></svg>')}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}],[{key:"_fromDOMNode",value:function(e){if(!e.hasAttributes||!e.hasAttributes())throw"No attributes available on the <circle/> node";for(var i=new t,n=e.attributes.length-1;n>=0;n--){var o=e.attributes[n];switch(o.name){case"cx":i.centerX=parseFloat(o.value);break;case"cy":i.centerY=parseFloat(o.value);break;case"r":i.radius=parseFloat(o.value)}}return i}}]),t}(k),M=function(e){function t(e){var i;return c(this,t),(i=s(this,l(t).call(this))).shape=e,Object.defineProperty(r(i),"bbox",{get:function(){return i.shape.bbox},set:function(e){i.shape.bbox=e}}),Object.defineProperty(r(i),"id",{get:function(){return i.shape.id},set:function(e){i.shape.id=e}}),Object.defineProperty(r(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(e){i.shape.bboxDirty=e}}),Object.defineProperty(r(i),"name",{get:function(){return i.shape.name},set:function(e){i.shape.name=e}}),i}return h(t,e),p(t,[{key:"draw",value:function(){var e;return(e=this.shape).draw.apply(e,arguments)}},{key:"hitTest",value:function(){var e;return(e=this.shape).hitTest.apply(e,arguments)}},{key:"move",value:function(){var e;return(e=this.shape).move.apply(e,arguments)}},{key:"modified",value:function(){var e;return(e=this.shape).modified.apply(e,arguments)}},{key:"computeBBox",value:function(){var e;return(e=this.shape).computeBBox.apply(e,arguments)}},{key:"updateBBox",value:function(){var e;return(e=this.shape).updateBBox.apply(e,arguments)}},{key:"clone",value:function(){return new t(this.shape.clone())}},{key:"copy",value:function(e){this.shape.copy(e.shape)}}]),t}(k)},"./extensions/Edit2D/Math2D.js":
/*!*************************************!*\
  !*** ./extensions/Edit2D/Math2D.js ***!
  \*************************************/
/*! exports provided: Math2D */function(e,t,i){"use strict";i.r(t),i.d(t,"Math2D",(function(){return a}));var n,o=function(e,t,i){var n=(e.x-t.x)*i.x+(e.y-t.y)*i.y;e.set(t.x+n*i.x,t.y+n*i.y)},s=(n=new THREE.Vector2,function(e,t,i){return o(n.copy(e),t,i),e.distanceTo(n)}),r=function(e,t,i){return Math.abs(e-t)<i},a={getEdgeDirection:function(e,t,i){return(i=i||new THREE.Vector2).copy(t).sub(e).normalize()},projectToLine:o,pointLineDistance:s,intersectLines:function(e,t,i,n,o){var s=n.y*t.x-n.x*t.y;if(Math.abs(s)<1e-8)return!1;var r=e.x-i.x,a=e.y-i.y,l=n.x*a-n.y*r;return o&&(o.x=e.x+l/s*t.x,o.y=e.y+l/s*t.y),!0},rotateAround:function(e,t,i){var n=Math.cos(t),o=Math.sin(t);i&&e.sub(i);var s=e.x,r=e.y;return e.x=s*n-r*o,e.y=s*o+r*n,i&&e.add(i),e},angleBetweenDirections:function(e,t){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i+=2*Math.PI),i},getEdgeCenter:function(e,t,i){return(i=i||new THREE.Vector2).set(.5*(e.x+t.x),.5*(e.y+t.y))},getEdgeLength:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},turnLeft:function(e){var t=e.x;return e.x=-e.y,e.y=t,e},isPointOnEdge:function(e,t,i,n){var o=i.x-t.x,s=i.y-t.y,r=Math.sqrt(o*o+s*s),a={v1:t,dx:o,dy:s,length:r,length2:r*r};return Bimfish.Extensions.CompGeom.pointOnLine(e.x,e.y,a,!0,n)},pointDelta:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={x:t.x-e.x,y:t.y-e.y};if(i){var o=Math.pow(10,i);n.x=Math.round(n.x*o)/o,n.y=Math.round(n.y*o)/o}if(n.x||n.y)return n},edgeIsDegenerated:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return e.distanceToSquared(t)<i},mirrorPointOnPoint:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(i=i||new THREE.Vector2).x=t.x-(e.x-t.x),i.y=t.y-(e.y-t.y),i},fuzzyEqual:r,collinear:function(e,t,i,n,o){var s=r(t.x,n.x,o)&&r(t.y,n.y,o),a=r(t.x,-n.x,o)&&r(t.y,-n.y,o);if(!s&&!a)return!1;var l=i.x-e.x,h=i.y-e.y,u=l*t.x+h*t.y;return Math.abs(u)<o}}},"./extensions/Edit2D/MeasureTransform.js":
/*!***********************************************!*\
  !*** ./extensions/Edit2D/MeasureTransform.js ***!
  \***********************************************/
/*! exports provided: MeasureTransform, DefaultMeasureTransform */function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e}i.r(t),i.d(t,"MeasureTransform",(function(){return u})),i.d(t,"DefaultMeasureTransform",(function(){return c}));var u=function(){function e(){a(this,e)}return h(e,[{key:"apply",value:function(e){}}]),e}(),c=function(e){function t(e){var i;return a(this,t),(i=o(this,s(t).call(this))).viewer=e,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(t,e),h(t,[{key:"apply",value:function(e){var t=this.viewer.model;if(t){var i=function(e){var t=e.getData().viewports;if(!t)return-1;for(var i=-1,n=-1,o=0;o<t.length;o++){var s=t[o];if(s.transform){var r=s.geom_metrics.db_ids;r>n&&(i=o,n=r)}}return i}(t);t.pageToModel(e,null,i)}}}]),t}(u)},"./extensions/Edit2D/SegmentTree.js":
/*!******************************************!*\
  !*** ./extensions/Edit2D/SegmentTree.js ***!
  \******************************************/
/*! exports provided: default */function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}i.r(t),i.d(t,"default",(function(){return d}));var r={Line:1,CircularArc:2,EllipticalArc:3},a=function(e,t,i,n,o){return{type:r.Line,x1:e,y1:t,x2:i,y2:n,vpId:o}},l=function(e,t,i,n,o,s){return{type:r.CirularArc,cx:e,cy:t,start:i,end:n,radius:o,vpId:s}},h=function(e,t,i,n,o,s,a,l){return{type:r.EllipticalArc,cx:e,cy:t,start:i,end:n,major:o,minor:s,tilt:a,vpId:l}},u=function(e,t){switch(e.type){case r.Line:t.onLineSegment(e.x1,e.y1,e.x2,e.y2,e.vpId);break;case r.CirularArc:t.onCircularArc(e.cx,e.cy,e.start,e.end,e.radius,e.vpId);break;case r.EllipticalArc:t.onEllipticalArc(e.cx,e.cy,e.tart,e.end,e.major,e.minor,e.tilt,e.vpId)}},c=function(){function e(){n(this,e),this.boundsCb=new Bimfish.Viewing.Private.BoundsCallback(new THREE.Box2),this.queryBox=new THREE.Box2,this.tmpPoint=new THREE.Vector2}return s(e,[{key:"getSegmentBox",value:function(e){return this.boundsCb.bounds.makeEmpty(),u(e,this.boundsCb),this.boundsCb.bounds}},{key:"getQueryBox",value:function(e,t,i,n){return this.queryBox.min.set(e,t),this.queryBox.max.set(i,n),this.queryBox}},{key:"intersectsBox",value:function(e,t,i,n,o){var s=this.getQueryBox(t,i,n,o),r=this.getSegmentBox(e);return s.isIntersectionBox(r)}},{key:"getPoint",value:function(e,t){var i=this.getSegmentBox(e).center(this.tmpPoint);t.x=i.x,t.y=i.y}}]),e}(),d=function(){function e(){n(this,e)}return s(e,[{key:"buildFromModel",value:function(e){var t=e.getBoundingBox();this.tree=new Bimfish.Extensions.CompGeom.QuadTree(t.min.x,t.min.y,t.max.x,t.max.y,0,new c);for(var i=e.getFragmentList(),n=i.getCount(),o=0;o<n;o++){var s=i.getGeometry(o);this.addGeometry(s)}}},{key:"addGeometry",value:function(e){var t=this,i={onLineSegment:function(){return t.tree.addItem(a.apply(void 0,arguments))},onCircularArc:function(){return t.tree.addItem(l.apply(void 0,arguments))},onEllipticalArc:function(){return t.tree.addItem(h.apply(void 0,arguments))}};new Bimfish.Viewing.Private.VertexBufferReader(e).enumGeoms(null,i)}},{key:"enumSegments",value:function(e,t,i,n,o){this.tree.enumInBox(e,t,i,n,(function(e){return u(e,o)}))}}]),e}()},"./extensions/Edit2D/Selection.js":
/*!****************************************!*\
  !*** ./extensions/Edit2D/Selection.js ***!
  \****************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var n=i(/*! ./EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ./UndoStack.js */"./extensions/Edit2D/UndoStack.js"),s=i(/*! ./EditLayer.js */"./extensions/Edit2D/EditLayer.js");function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=Bimfish.Viewing,l=function(){function e(t,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a.EventDispatcher.prototype.apply(this),this.isSelected={},this.hoveredId=0,this.tmpStyle=new n.Style,this.modifier=function(e,t){var i=r.isSelected[e.id],n=e.id===r.hoveredId;if(i||n)return r.tmpStyle.copy(t),i?(r.tmpStyle.fillAlpha=Math.min(r.tmpStyle.fillAlpha+.3,1),r.tmpStyle.lineWidth*=1.5):(r.tmpStyle.fillAlpha=Math.min(r.tmpStyle.fillAlpha+.2,1),r.tmpStyle.lineWidth*=1.5),r.tmpStyle},this.layer=t,this.onShapeRemoved=this.onShapeRemoved.bind(this),this.onLayerCleared=this.onLayerCleared.bind(this),this.layer.addEventListener(s.default.SHAPE_REMOVED,this.onShapeRemoved),this.layer.addEventListener(s.default.LAYER_CLEARED,this.onLayerCleared),this.layer.addStyleModifier(this.modifier),this.undoStack=i,this.onActionCb=function(e){return r.onAction(e)},this.undoStack.addEventListener(o.default.AFTER_ACTION,this.onActionCb)}var t,i,l;return t=e,(i=[{key:"dtor",value:function(){this.layer.removeStyleModifier(this.modifier),this.undoStack.removeEventListener(o.default.AFTER_ACTION,this.onActionCb),this.undoStack.removeEventListener(s.default.SHAPE_REMOVED,this.onShapeRemoved),this.undoStack.removeEventListener(s.default.LAYER_CLEARED,this.onLayerCleared)}},{key:"setSelection",value:function(e){e=e||[];var t=!1;if(this.getSelectedShapes().length!=e.length)t=!0;else for(var i=0;i<e.length;i++){var n=e[i];this.isSelected[n.id]||(t=!0)}if(t){this.isSelected={};for(var o=0;o<e.length;o++){var s=e[o];this.isSelected[s.id]=s}this.modified()}}},{key:"empty",value:function(){return!Object.keys(this.isSelected).length}},{key:"selectOnly",value:function(e){this.setSelection(e&&[e])}},{key:"clear",value:function(){this.setSelection([])}},{key:"getSelectedShapes",value:function(){return Object.values(this.isSelected)}},{key:"getSelectedIds",value:function(){return Object.keys(this.isSelected)}},{key:"modified",value:function(){this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_CHANGED})}},{key:"onAction",value:function(){if(!this.empty()){var e=this.getSelectedShapes();if(1!=e.length){var t={};this.layer.shapes.forEach((function(e){return t[e.id]=!0})),e=e.filter((function(e){return t[e.id]})),this.setSelection(e)}else this.layer.findShapeById(e[0].id)||this.clear()}}},{key:"onShapeRemoved",value:function(e){var t=e.shape;this.empty()||this.isSelected[t.id]&&(delete this.isSelected[t.id],this.modified())}},{key:"onLayerCleared",value:function(){this.empty()||this.clear()}},{key:"setHoveredId",value:function(e){e!==this.hoveredId&&(this.hoveredId=e,this.layer.update())}}])&&r(t.prototype,i),l&&r(t,l),e}();l.Events={SELECTION_CHANGED:"selectionChanged"}},"./extensions/Edit2D/TangentGizmo.js":
/*!*******************************************!*\
  !*** ./extensions/Edit2D/TangentGizmo.js ***!
  \*******************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return u}));var n=i(/*! ./Math2D.js */"./extensions/Edit2D/Math2D.js"),o=i(/*! ./EditShapes.js */"./extensions/Edit2D/EditShapes.js"),s=i(/*! ./CanvasGizmo.js */"./extensions/Edit2D/CanvasGizmo.js");function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=-1,l=0,h=1,u=function(){function e(t,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=t,this.gizmoLayer=r,this.layer=n,this.index=i,this.line=new o.Polyline,this.lineVisible=!1,this.line.style.isScreenSpace=!0,this.line.style.lineColor="rgb(255, 0, 255)",this.line.style.lineWidth=1,this.line.style.lineStyle=10,this.line.style.lineAlpha=1,this.vertexGizmo1=new s.VertexGizmo(this.gizmoLayer,0,0,"TangentGizmo-$vertexIndex-$sideIndex"),this.vertexGizmo2=new s.VertexGizmo(this.gizmoLayer,0,0,"TangentGizmo-$vertexIndex-$sideIndex"),this.vertexGizmo1.setVisible(!1),this.vertexGizmo2.setVisible(!1),this.pStart=new THREE.Vector2,this.pEnd=new THREE.Vector2,this.layer.addCanvasGizmo(this),this.dragIndex=a,this.lastDragPos=new THREE.Vector2,this.dragOffset=new THREE.Vector2(0,0),this.update()}var t,i,u;return t=e,(i=[{key:"dtor",value:function(){this.setVisible(!1),this.layer.removeCanvasGizmo(this)}},{key:"setVisible",value:function(e){this.vertexGizmo1.setVisible(e),this.vertexGizmo2.setVisible(e),e!==this.lineVisible&&(e?this.gizmoLayer.addShape(this.line):this.gizmoLayer.removeShape(this.line)),this.lineVisible=e}},{key:"update",value:function(){var e=this.path.prevIndex(this.index),t=this.path.isBezierArc(e),i=this.path.isBezierArc(this.index);if(t||i){var o=this.path.points[this.index];if(i)this.pEnd.set(o.cp1x,o.cp1y),n.Math2D.mirrorPointOnPoint(this.pEnd,o,this.pStart);else{var s=this.path.points[e];this.pStart.set(s.cp2x,s.cp2y),n.Math2D.mirrorPointOnPoint(this.pStart,o,this.pEnd)}this.vertexGizmo1.setPosition(this.pStart.x,this.pStart.y),this.vertexGizmo2.setPosition(this.pEnd.x,this.pEnd.y),this.line.makeLine(this.pStart.x,this.pStart.y,this.pEnd.x,this.pEnd.y),this.gizmoLayer.update(),this.setVisible(!0)}else this.setVisible(!1)}},{key:"setTangentEndPoints",value:function(e,t){var i=this.path.prevIndex(this.index);this.path.isBezierArc(i)&&this.path.updateControlPoint(i,2,e.x,e.y),this.path.isBezierArc(this.index)&&this.path.updateControlPoint(this.index,1,t.x,t.y),this.update()}},{key:"onStartVertexMoved",value:function(e){var t=this.path.getPoint(this.index),i=n.Math2D.mirrorPointOnPoint(e,t);this.setTangentEndPoints(e,i)}},{key:"onEndVertexMoved",value:function(e){var t=this.path.getPoint(this.index),i=n.Math2D.mirrorPointOnPoint(e,t);this.setTangentEndPoints(i,e)}},{key:"startDrag",value:function(e,t,i){this.dragIndex=i;var n=i===l?this.pStart:this.pEnd,o=this.layer.layerToCanvas(n.x,n.y);this.dragOffset.set(o.x-e,o.y-t),this.lastDragPos.copy(n)}},{key:"endDrag",value:function(e,t){this.moveDrag(e,t),this.dragIndex=a}},{key:"moveDrag",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.layer.canvasToLayer(i,n);this.dragIndex===l?this.onStartVertexMoved(o):this.dragIndex===h&&this.onEndVertexMoved(o),this.layer.update()}},{key:"onButtonDown",value:function(e,t){var i=this.vertexGizmo1.isUnderMouse,n=this.vertexGizmo2.isUnderMouse;if(!i&&!n)return!1;var o=i?l:h;return this.startDrag(e,t,o),!0}},{key:"isDragging",value:function(){return this.dragIndex!==a}}])&&r(t.prototype,i),u&&r(t,u),e}()},"./extensions/Edit2D/UndoStack.js":
/*!****************************************!*\
  !*** ./extensions/Edit2D/UndoStack.js ***!
  \****************************************/
/*! exports provided: default */function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t),i.d(t,"default",(function(){return s}));var o=Bimfish.Viewing,s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o.EventDispatcher.prototype.apply(this),this.stack=[],this.current=0}var t,i,s;return t=e,(i=[{key:"run",value:function(t){this.stack.length=this.current,this.dispatchEvent({type:e.BEFORE_ACTION,action:t}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t}),this.stack.push(t),this.current=this.stack.length}},{key:"undo",value:function(){if(!this.current)return!1;this.current--;var t=this.stack[this.current];return this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!0}),t.undo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!0}),t.layer.update(),!0}},{key:"redo",value:function(){var t=this.stack[this.current];return!!t&&(this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!1}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!1}),this.current++,t.layer.update(),!0)}},{key:"clear",value:function(){this.stack.length=0,this.current=0}}])&&n(t.prototype,i),s&&n(t,s),e}();s.BEFORE_ACTION="beforeAction",s.AFTER_ACTION="afterAction"},"./extensions/Edit2D/UnitHandler.js":
/*!******************************************!*\
  !*** ./extensions/Edit2D/UnitHandler.js ***!
  \******************************************/
/*! exports provided: UnitHandler, SimpleUnitHandler, DefaultUnitHandler */function(e,t,i){"use strict";i.r(t),i.d(t,"UnitHandler",(function(){return f})),i.d(t,"SimpleUnitHandler",(function(){return y})),i.d(t,"DefaultUnitHandler",(function(){return v}));var n=i(/*! ./MeasureTransform.js */"./extensions/Edit2D/MeasureTransform.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,i){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function r(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),e}var p=Bimfish.Viewing.Private,f=function(){function e(){u(this,e),this.measureTransform=null}return d(e,[{key:"lengthToString",value:function(e){console.error("Not implemented")}},{key:"areaToString",value:function(e){console.error("Not implemented")}}]),e}(),y=function(e){function t(e){var i;return u(this,t),(i=r(this,a(t).call(this))).viewer=e,i.config={layerUnits:"inch",displayUnits:"inch",precision:2,scaleFactor:1},i}return l(t,e),d(t,[{key:"lengthToString",value:function(e){var t=this.config;return e=p.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e),p.formatValueWithUnits(e,t.displayUnits,3,t.precision)}},{key:"areaToString",value:function(e){var t=this.config;e=p.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e,"square");var i=t.displayUnits?"".concat(t.displayUnits,"^2"):null;return p.formatValueWithUnits(e,i,3,t.precision)}}]),t}(f),v=function(e){function t(e){var i;return u(this,t),(i=r(this,a(t).call(this,e))).measureTransform=new n.DefaultMeasureTransform(e),i}return l(t,e),d(t,[{key:"updateConfig",value:function(){var e=this.config,t=this.viewer.model;e.layerUnits=t?t.getUnitString():"inch";var i=this.viewer.getExtension("Bimfish.Measure"),n=i&&i.sharedMeasureConfig;n?(e.displayUnits=n.units,e.precision=n.precision,e.scaleFactor=n.calibrationFactor):(e.displayUnits=this.config.layerUnits,e.precision=2,e.scaleFactor=1)}},{key:"lengthToString",value:function(e){return this.updateConfig(),s(a(t.prototype),"lengthToString",this).call(this,e)}},{key:"areaToString",value:function(e){return this.updateConfig(),s(a(t.prototype),"areaToString",this).call(this,e)}}]),t}(y)},"./extensions/Edit2D/tools/CopyTool.js":
/*!*********************************************!*\
  !*** ./extensions/Edit2D/tools/CopyTool.js ***!
  \*********************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var n=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js");function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=Bimfish.Viewing,r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Bimfish.Viewing.EventDispatcher.prototype.apply(this),this.viewer=t.viewer,this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.clipBoard=[],this.pasteCounter=0}var t,i,r;return t=e,(i=[{key:"copy",value:function(){this.clipBoard.length=0;var e=this.selection.getSelectedShapes();this.originalShapes=e,this.clipBoard=e.slice(),this.pasteCounter=0}},{key:"paste",value:function(){this.pasteCounter++;var t=30*this.pasteCounter*this.layer.getUnitsPerPixel(),i=[],o={type:e.BEFORE_PASTE,originalShapes:this.originalShapes,veto:!1};if(this.dispatchEvent(o),!o.veto){for(var s=0;s<this.clipBoard.length;s++){var r=this.clipBoard[s].clone();r.move(t,t),i.push(r)}this.selection.setSelection(i),this.undoStack.run(new n.Actions.AddShapes(this.layer,i)),this.dispatchEvent({type:e.AFTER_PASTE,originalShapes:this.originalShapes,shapes:i})}}},{key:"delete",value:function(){var e=this.selection.getSelectedShapes();this.undoStack.run(new n.Actions.RemoveShapes(this.layer,e)),this.selection.clear()}},{key:"handleKeyDown",value:function(e,t){if(!this.selection.empty()){if(t===s.KeyCode.DELETE)return this.delete(),!0;if(e.ctrlKey&&t===s.KeyCode.c)return this.copy(),!0}if(0!==this.clipBoard.length&&e.ctrlKey&&t===s.KeyCode.v)return this.paste(),!0}},{key:"getName",value:function(){return"Edit2_CopyTool"+this.nameSuffix}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&o(t.prototype,i),r&&o(t,r),e}();r.BEFORE_PASTE="BEFORE_PASTE",r.AFTER_PASTE="AFTER_PASTE"},"./extensions/Edit2D/tools/EditToolBase.js":
/*!*************************************************!*\
  !*** ./extensions/Edit2D/tools/EditToolBase.js ***!
  \*************************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var n=i(/*! ../Selection.js */"./extensions/Edit2D/Selection.js"),o=i(/*! ../UndoStack.js */"./extensions/Edit2D/UndoStack.js");function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=Bimfish.Viewing,a=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.layer=t.layer,this.gizmoLayer=t.gizmoLayer,this.snapper=t.snapper,this.selection=t.selection,this.undoStack=t.undoStack,this.unitHandler=t.unitHandler,this.nameSuffix="_".concat(t.toolSetName),this.ignoreDragging=!1,this.ignoreActions=!1,this.onActionCb=function(e){i.ignoreActions||i.handleExternalAction(e)},this.suppressSnapping=!1,this.keyMap={SnapKey:r.KeyCode.SHIFT,PanKey:r.KeyCode.SPACE},this.selection&&(this.selectionCb=function(){i.active&&i.onSelectionChanged&&i.onSelectionChanged()},this.selection.addEventListener(n.default.Events.SELECTION_CHANGED,this.selectionCb)),this.active=!1,this.canvasPos=new THREE.Vector2,this.keyState={ctrl:!1,shift:!1,alt:!1}}var t,i,a;return t=e,(i=[{key:"getSnapPosition",value:function(e,t){var i=this;return this.snapper&&!this.suppressSnapping?this.snapper.getSnapPosition(e,t,(function(e){return i.snappingFilter(e)})):(this.snapper.clearSnappingGizmos(),this.layer.canvasToLayer(e,t))}},{key:"dtor",value:function(){this.selectionCb&&this.selection.removeEventListener(n.default.Events.SELECTION_CHANGED,this.selectionCb)}},{key:"getNames",value:function(){return[this.getName()]}},{key:"handleKeyDown",value:function(e,t){if(this.keyState[t]=!0,t!==this.keyMap.SnapKey||this.suppressSnapping||(this.suppressSnapping=!0,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===r.KeyCode.BACKSPACE)return!0;t===this.keyMap.PanKey&&(this.ignoreDragging=!0)}},{key:"handleKeyUp",value:function(e,t){this.keyState[t]=!1,t===this.keyMap.SnapKey&&this.suppressSnapping&&(this.suppressSnapping=!1,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===this.keyMap.PanKey&&(this.ignoreDragging=!1)}},{key:"handleExternalAction",value:function(e){}},{key:"runAction",value:function(e){this.ignoreActions=!0,this.undoStack.run(e),this.ignoreActions=!1}},{key:"activate",value:function(){this.active=!0,this.undoStack.addEventListener(o.default.AFTER_ACTION,this.onActionCb)}},{key:"deactivate",value:function(){this.active=!1,this.undoStack.removeEventListener(o.default.AFTER_ACTION,this.onActionCb),this.snapper&&this.snapper.clearSnappingGizmos()}},{key:"register",value:function(){}},{key:"mapKey",value:function(e,t){for(var i in t){var n=t[i];if(e.keyCode==n)return i;if(Array.isArray(n)&&n.includes(e.keyCode))return i}return null}},{key:"snappingFilter",value:function(){return!0}},{key:"trackMousePos",value:function(e){this.canvasPos.set(e.canvasX,e.canvasY)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e)}},{key:"handleSingleClick",value:function(e){this.trackMousePos(e)}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonUp",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){this.trackMousePos(e)}}])&&s(t.prototype,i),a&&s(t,a),e}();r.GlobalManagerMixin.call(a.prototype)},"./extensions/Edit2D/tools/InsertSymbolTool.js":
/*!*****************************************************!*\
  !*** ./extensions/Edit2D/tools/InsertSymbolTool.js ***!
  \*****************************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c}));var n=i(/*! ../EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js"),s=i(/*! ./EditToolBase */"./extensions/Edit2D/tools/EditToolBase.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(e){var i,o,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=!(s=l(t).call(this,e))||"object"!==r(s)&&"function"!=typeof s?h(o):s,Bimfish.Viewing.EventDispatcher.prototype.apply(h(i)),i.symbol=new n.Circle(0,0,.2,new n.Style({fillAlpha:1,lineWidth:.01,fillColor:"rgb(255, 255, 0)"})),i}var i,s,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),i=t,(s=[{key:"getName",value:function(){return"Edit2_InsertSymbolTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"setSymbol",value:function(e){this.symbol=e}},{key:"handleMouseMove",value:function(e){}},{key:"handleSingleClick",value:function(e){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.symbol.clone();return n.move(i.x,i.y),this.undoStack.run(new o.Actions.AddShape(this.layer,n)),this.dispatchEvent({type:t.SYMBOL_INSERTED,symbol:n}),!0}},{key:"handleDoubleClick",value:function(){return!0}},{key:"getCursor",value:function(){return"crosshair"}}])&&a(i.prototype,s),c&&a(i,c),t}(s.default);c.SYMBOL_INSERTED="symbolInserted"},"./extensions/Edit2D/tools/LineTool.js":
/*!*********************************************!*\
  !*** ./extensions/Edit2D/tools/LineTool.js ***!
  \*********************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return y}));var n=i(/*! ../EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js"),s=i(/*! ../Math2D.js */"./extensions/Edit2D/Math2D.js"),r=i(/*! ./EditToolBase.js */"./extensions/Edit2D/tools/EditToolBase.js"),a=i(/*! ../CanvasGizmo */"./extensions/Edit2D/CanvasGizmo.js");function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=Bimfish.Viewing,y=function(e){function t(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.Style;return h(this,t),(i=c(this,d(t).call(this,e))).style=o,i.line=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.lengthLabel=new a.LengthLabel(null,i.layer,e.unitHandler,!1),i}var i,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),i=t,(r=[{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_LineTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){if(0==t)return this.handleMouseMove(e),this.dragCanceled?(this.dragCanceled=!1,!0):this.endDrag()}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.line&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.line=new n.Polyline([e.clone(),e.clone()],this.style.clone()),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.line)}},{key:"updateLine",value:function(){this.isDragging()&&(this.line.updatePoint(1,this.endPoint.x,this.endPoint.y),this.gizmoLayer.update(),this.lengthLabel.setShape(this.line))}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateLine()}},{key:"endDrag",value:function(){return!!this.line&&(this.gizmoLayer.removeShape(this.line),!s.Math2D.edgeIsDegenerated(this.startPoint,this.endPoint)&&this.undoStack.run(new o.Actions.AddShape(this.layer,this.line)),this.line=null,this.lengthLabel.setShape(null),!0)}},{key:"cancelDrag",value:function(){this.line&&(this.gizmoLayer.removeShape(this.line),this.line=null,this.dragCanceled=!0,this.lengthLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.line)}},{key:"handleKeyDown",value:function(e,t){t==f.KeyCode.SHIFT&&this.updateLine(!0)}},{key:"handleKeyUp",value:function(e,t){t==f.KeyCode.SHIFT&&this.updateLine(!1)}}])&&u(i.prototype,r),l&&u(i,l),t}(r.default)},"./extensions/Edit2D/tools/MoveTool.js":
/*!*********************************************!*\
  !*** ./extensions/Edit2D/tools/MoveTool.js ***!
  \*********************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var n=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js");function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=Bimfish.Viewing,r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.shape=null,this.dragStartPoint=new THREE.Vector2,this.backupShape=null,this.keyMap={CancelEdit:s.KeyCode.ESCAPE},this.lastMousePos=new THREE.Vector2}var t,i,r;return t=e,(i=[{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"Edit2_MoveTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.layer.hitTest(i.x,i.y);return n&&this.startDrag(n,i),this.shape?this.selection.selectOnly(this.shape):this.selection.clear(),Boolean(this.shape)}}},{key:"startDrag",value:function(e,t){this.shape=e,this.dragStartPoint.copy(t),this.backupShape=e.clone()}},{key:"moveDrag",value:function(e){var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;this.shape.copy(this.backupShape),this.shape.move(t,i),this.layer.update()}},{key:"resetDragging",value:function(){this.shape=null,this.backupShape=null}},{key:"endDrag",value:function(e){if(this.shape){this.shape.copy(this.backupShape);var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;return this.undoStack.run(new n.Actions.MoveShape(this.layer,this.shape,t,i)),!!this.shape&&(this.shape=null,!0)}}},{key:"cancelDrag",value:function(){this.isDragging()&&(this.shape.copy(this.backupShape),this.layer.update(),this.resetDragging())}},{key:"isDragging",value:function(){return Boolean(this.shape)}},{key:"handleMouseMove",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.lastMousePos.copy(t),!!this.shape&&(this.moveDrag(t),!0)}},{key:"handleButtonUp",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.endDrag(i)}}},{key:"handleKeyDown",value:function(e,t){t===this.keyMap.CancelEdit&&this.cancelDrag()}},{key:"getCursor",value:function(){return this.shape||this.layer.hitTest(this.lastMousePos.x,this.lastMousePos.y)?"move":void 0}}])&&o(t.prototype,i),r&&o(t,r),e}()},"./extensions/Edit2D/tools/PolygonEditTool.js":
/*!****************************************************!*\
  !*** ./extensions/Edit2D/tools/PolygonEditTool.js ***!
  \****************************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return x}));var n=i(/*! ../EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js"),s=i(/*! ../Math2D.js */"./extensions/Edit2D/Math2D.js"),r=i(/*! ../CanvasGizmo.js */"./extensions/Edit2D/CanvasGizmo.js"),a=i(/*! ../TangentGizmo.js */"./extensions/Edit2D/TangentGizmo.js"),l=i(/*! ./MoveTool.js */"./extensions/Edit2D/tools/MoveTool.js"),h=i(/*! ./EditToolBase.js */"./extensions/Edit2D/tools/EditToolBase.js");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e,t,i){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=Bimfish.Viewing,g=function(e){return"PolygonEditTool_vertexGizmo_"+e.toString()},m=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.setName(g(t)),i.update(!1)}},x=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=d(this,f(t).call(this,e))).moveTool=new l.default(e),i.poly=null,i.lastDragPoint=new THREE.Vector2,i.vertexGizmos=[],i.draggedVertex=-1,i.dragVertexStartPos=new THREE.Vector2,i.dragEdgeStartPos={a:new THREE.Vector2,b:new THREE.Vector2},i.draggedEdge=-1,i.draggedEdgeNormal=new THREE.Vector2,i.selectedVertex=-1,i.dragOffset=new THREE.Vector2(0,0),i.edgeGizmo=new n.Polyline,i.edgeGizmoShown=!1,i.keyMap.DeleteSelectedVertex=v.KeyCode.BACKSPACE,i.keyMap.CancelEdit=v.KeyCode.ESCAPE,i.mousePos=new THREE.Vector2,i.areaLabel=new r.AreaLabel(null,i.layer,e.unitHandler,!1),i.lengthLabel=new r.LengthLabel(null,i.layer,e.unitHandler,!1),i.edgeGizmos=[],i.tangentGizmos=[],i.hoverEnabled=!0,i}var i,h,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,e),i=t,(h=[{key:"setHoverEnabled",value:function(e){this.hoverEnabled&&!e&&this.selection.setHovered(null),this.hoverEnabled=e}},{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_PolygonEditTool"+this.nameSuffix}},{key:"deactivate",value:function(){p(f(t.prototype),"deactivate",this).call(this),this.reset()}},{key:"createVertexGizmos",value:function(){for(var e=0;e<this.poly.points.length;e++){var t=this.poly.points[e],i=new r.VertexGizmo(this.gizmoLayer,t.x,t.y,g(e),this.poly.style);this.vertexGizmos.push(i),i.setHoverEnabled(!0)}}},{key:"updateVertexGizmos",value:function(){var e=this.poly?this.poly.length:0,t=new THREE.Vector2;if(e==this.vertexGizmos.length)for(var i=0;i<e;i++)this.poly.getPoint(i,t),this.vertexGizmos[i].setPosition(t.x,t.y);else this.clearVertexGizmos(),this.createVertexGizmos()}},{key:"clearVertexGizmos",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"clearEdgeGizmos",value:function(){for(var e=0;e<this.edgeGizmos.length;e++)this.edgeGizmos[e].dtor();this.edgeGizmos.length=0}},{key:"createEdgeGizmos",value:function(){this.clearEdgeGizmos();for(var e=this.poly?this.poly.getEdgeCount():0,t=0;t<e;t++){var i=new r.EdgeMoveGizmo(this.layer,"PolygonEditTool_edgeGizmo_"+t.toString());i.attachToEdge(this.poly,t),this.edgeGizmos.push(i)}}},{key:"updateVertexHighlighting",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].setSelected(e===this.selectedVertex)}},{key:"setSelectedVertex",value:function(e){this.selectedVertex=this.poly?e:-1,this.updateVertexHighlighting()}},{key:"getVertexIndex",value:function(e,t){for(var i=0;i<this.vertexGizmos.length;i++)if(this.vertexGizmos[i].isUnderMouse)return i;return-1}},{key:"getEdgeIndex",value:function(e,t){for(var i=0;i<this.edgeGizmos.length;i++)if(this.edgeGizmos[i].isUnderMouse)return i;return-1}},{key:"reset",value:function(){this.poly&&(this.clearVertexGizmos(),this.clearEdgeGizmos(),this.clearTangentGizmos(),this.areaLabel.setShape(null),this.lengthLabel.setShape(null),this.poly=null,this.draggedVertex=-1,this.selectedVertex=-1,this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.createVertexGizmos(),this.createEdgeGizmos(),this.createTangentGizmos());var t=e&&e.isPolygon()?e:null;this.areaLabel.setShape(t);var i=e&&e.isPolyline()?e:null;this.lengthLabel.setShape(i)}},{key:"insertPoint",value:function(e,t){this.runAction(new o.Actions.AddVertex(this.layer,this.poly,e,t));var i=new r.VertexGizmo(this.gizmoLayer,t.x,t.y,void 0,this.poly.style);i.setHoverEnabled(!0),this.vertexGizmos.splice(e,0,i),m(this.vertexGizmos),this.createEdgeGizmos(),this.createTangentGizmos(),this.layer.update()}},{key:"removePoint",value:function(e){var t=this.poly.isPolygon()?3:2;if(this.poly.length<=t)return this.runAction(new o.Actions.RemoveShape(this.layer,this.poly)),void this.reset();this.runAction(new o.Actions.RemoveVertex(this.layer,this.poly,e));var i=this.vertexGizmos.splice(e,1)[0];m(this.vertexGizmos),this.createEdgeGizmos(),this.createTangentGizmos(),i.dtor(),this.selectedVertex===e&&this.setSelectedVertex(-1),this.layer.update()}},{key:"startDragVertex",value:function(e,t){this.snapper.startAngleSnapping(this.poly.clone(),t),this.draggedVertex=t;var i=this.poly.points[this.draggedVertex],n=this.layer.layerToCanvas(i.x,i.y);this.dragOffset.set(n.x-e.canvasX,n.y-e.canvasY),this.setSelectedVertex(this.draggedVertex),this.lastDragPoint.copy(i),this.dragVertexStartPos.copy(i)}},{key:"moveDragVertex",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.getSnapPosition(i,n),s=o.x-this.lastDragPoint.x,r=o.y-this.lastDragPoint.y,a=this.poly.points[this.draggedVertex];this.poly.updatePoint(this.draggedVertex,a.x+s,a.y+r),this.vertexGizmos[this.draggedVertex].setPosition(a.x,a.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(o)}},{key:"restoreDragVertex",value:function(){this.poly.updatePoint(this.draggedVertex,this.dragVertexStartPos.x,this.dragVertexStartPos.y)}},{key:"endDragVertex",value:function(){this.restoreDragVertex();var e=this.dragVertexStartPos,t=this.lastDragPoint,i=.5*this.layer.getUnitsPerPixel();e.distanceTo(t)>i&&this.runAction(new o.Actions.MoveVertex(this.layer,this.poly,this.draggedVertex,t)),this.draggedVertex=-1,this.snapper.clearSnappingGizmos()}},{key:"startDragEdge",value:function(e,t){this.setSelectedEdge(t),this.draggedEdgeNormal=function(e,t,i){var n=t,o=(t+1)%e.length,s=e.getPoint(n),r=e.getPoint(o);i.subVectors(r,s).normalize();var a=i.x;return i.x=-i.y,i.y=a,i}(this.poly,t,this.draggedEdgeNormal),this.lastDragPoint.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY));var i=this.draggedEdge,n=(this.draggedEdge+1)%this.poly.length;this.dragEdgeStartPos.a.copy(this.poly.getPoint(i)),this.dragEdgeStartPos.b.copy(this.poly.getPoint(n))}},{key:"moveDragEdge",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY),i=t.clone().sub(this.lastDragPoint),n=this.poly.prevIndex(this.draggedEdge),o=this.poly.nextIndex(this.draggedEdge),r=new THREE.Vector2,a=new THREE.Vector2,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector2,c=new THREE.Vector2;this.poly.getEdge(n,r,a),this.poly.getEdge(this.draggedEdge,l,h),this.poly.getEdge(o,u,c),l.add(i),h.add(i);var d=s.Math2D.getEdgeDirection(r,a),p=s.Math2D.getEdgeDirection(l,h),f=s.Math2D.getEdgeDirection(u,c),y=new THREE.Vector2,v=new THREE.Vector2;if(s.Math2D.intersectLines(r,d,l,p,y)&&s.Math2D.intersectLines(u,f,l,p,v)){var g=this.draggedEdge,m=this.poly.nextIndex(g);this.poly.updatePoint(g,y.x,y.y),this.poly.updatePoint(m,v.x,v.y),this.vertexGizmos[g].setPosition(y.x,y.y),this.vertexGizmos[m].setPosition(v.x,v.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(t),this.updateEdgeGizmo()}}},{key:"restoreDragEdge",value:function(){var e=this.dragEdgeStartPos.a,t=this.dragEdgeStartPos.b,i=this.draggedEdge,n=this.poly.nextIndex(i);this.poly.updatePoint(i,e.x,e.y),this.poly.updatePoint(n,t.x,t.y)}},{key:"endDragEdge",value:function(){var e=this.draggedEdge,t=this.poly.nextIndex(e),i=this.poly.getPoint(e),n=this.poly.getPoint(t);this.restoreDragEdge(),this.runAction(new o.Actions.MoveEdge(this.layer,this.poly,e,i,n)),this.setSelectedEdge(-1)}},{key:"edgeMovePossible",value:function(){return this.poly&&this.poly.length>2}},{key:"findEdgeUnderMouse",value:function(e){var t=17*this.layer.getUnitsPerPixel();return this.poly?this.poly.findEdgeIndex(e,t):-1}},{key:"getNewVertexPosition",value:function(e,t){if(!this.poly||!this.poly.edgeIndexValid(t))return null;var i=new THREE.Vector2,n=new THREE.Vector2;this.poly.getEdge(t,i,n);var o=s.Math2D.getEdgeDirection(i,n),r=e.clone();return s.Math2D.projectToLine(r,i,o),s.Math2D.isPointOnEdge(r,i,n,1e-4)?r:null}},{key:"handleButtonDown",value:function(e,i){if(this.ignoreDragging)return!1;if(p(f(t.prototype),"handleButtonDown",this).call(this,e,i),0==!i)return!1;var o=this.layer.canvasToLayer(e.canvasX,e.canvasY);this.mousePos.copy(o);var s=this.getVertexIndex(o.x,o.y);if(-1!=s)return this.startDragVertex(e,s),!0;var r=-1;if(e.ctrlKey){var a=this.findEdgeUnderMouse(this.mousePos),l=this.getNewVertexPosition(this.mousePos,a);if(l)return r=a+1,this.insertPoint(r,l),this.startDragVertex(e,r),!0}this.setSelectedVertex(-1);for(var h=0;h<this.tangentGizmos.length;h++)if(this.tangentGizmos[h].onButtonDown(e.canvasX,e.canvasY))return!0;var u=this.getEdgeIndex(o.x,o.y);if(this.edgeMovePossible()&&-1!==u)return this.startDragEdge(e,u),!0;if(this.poly){var c=this.layer.getLineHitRadius(this.poly);if(this.poly.hitTest(o.x,o.y,c))return this.moveTool.startDrag(this.poly,o),!0}var d=this.layer.hitTest(o.x,o.y),y=d instanceof n.Polygon,v=d instanceof n.Polyline,g=d instanceof n.Path;return y||v||g||(d=null),this.selection.selectOnly(d),Boolean(this.poly)}},{key:"handleSingleClick",value:function(e){return p(f(t.prototype),"handleSingleClick",this).call(this,e),Boolean(this.poly)}},{key:"handleMouseMove",value:function(e){if(p(f(t.prototype),"handleMouseMove",this).call(this,e),this.mousePos.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY)),this.updateMouseOverHighlights(),!this.poly)return!1;if(-1!=this.draggedVertex)return this.moveDragVertex(e.canvasX,e.canvasY),!0;-1!=this.draggedEdge&&this.moveDragEdge(e),this.moveTool.isDragging()&&(this.moveTool.moveDrag(this.mousePos),this.updateVertexGizmos());var i=this.findDraggedTangentGizmo();return i&&i.moveDrag(e.canvasX,e.canvasY),!1}},{key:"handleButtonUp",value:function(e,i){if(p(f(t.prototype),"handleButtonUp",this).call(this,e,i),-1!==this.draggedVertex)return this.endDragVertex(),!0;if(-1!==this.draggedEdge)return this.endDragEdge(),!0;if(this.moveTool.isDragging()){var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.ignoreActions=!0,this.moveTool.endDrag(n),this.ignoreActions=!1,this.updateVertexGizmos(),!0}var o=this.findDraggedTangentGizmo();return o&&o.endDrag(e.canvasX,e.canvasY),!this.ignoreDragging&&this.poly&&0==i}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes()[0];e instanceof n.PolyBase?this.setEditPoly(e):this.setEditPoly(null)}},{key:"handleKeyDown",value:function(e,i){var n=p(f(t.prototype),"handleKeyDown",this).call(this,e,i);return i===this.keyMap.DeleteSelectedVertex&&this.poly&&-1!==this.selectedVertex&&(this.removePoint(this.selectedVertex),n=!0),i===this.keyMap.CancelEdit?(this.cancelDrag(),!0):n}},{key:"onSnappingToggled",value:function(e,t){-1!==this.draggedVertex&&this.moveDragVertex(e,t)}},{key:"cancelDrag",value:function(){var e=!1;-1!==this.draggedVertex&&(this.restoreDragVertex(),this.draggedVertex=-1,e=!0),-1!==this.draggedEdge&&(this.restoreDragEdge(),this.draggedEdge=-1,e=!0),this.moveTool.isDragging()&&(this.moveTool.cancelDrag(),this.updateVertexGizmos()),e&&(this.layer.update(),this.updateVertexGizmos()),this.snapper.clearSnappingGizmos()}},{key:"handleExternalAction",value:function(){this.poly&&(Boolean(this.layer.findShapeById(this.poly.id))||this.reset(),this.updateVertexGizmos(),this.cancelDrag(),this.snapper.clearSnappingGizmos())}},{key:"updateEdgeGizmo",value:function(){var e=this.getEdgeIndex(this.mousePos.x,this.mousePos.y),t=-1!=this.getVertexIndex(this.mousePos.x,this.mousePos.y)||-1!=this.draggedVertex,i=this.edgeMovePossible(),n=this.poly&&-1!=this.draggedEdge,o=n||i&&-1!=e&&!t;if(o&&!this.edgeGizmoShown?(this.gizmoLayer.addShape(this.edgeGizmo),this.edgeGizmoShown=!0):!o&&this.edgeGizmoShown&&(this.gizmoLayer.removeShape(this.edgeGizmo),this.edgeGizmoShown=!1),o){var s=n?this.draggedEdge:e,r=new THREE.Vector2,a=new THREE.Vector2;this.poly.getEdge(s,r,a),this.edgeGizmo.makeLine(r.x,r.y,a.x,a.y),this.edgeGizmo.style.lineWidth=this.poly.style.lineWidth,this.edgeGizmo.style.isScreenSpace=this.poly.style.isScreenSpace,n?(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=1):(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=.5),this.gizmoLayer.update()}}},{key:"setSelectedEdge",value:function(e){this.draggedEdge=e,this.updateEdgeGizmo();for(var t=0;t<this.edgeGizmos.length;t++)this.edgeGizmos[t].setSelected(t==this.draggedEdge)}},{key:"updateMouseOverHighlights",value:function(){if(this.updateEdgeGizmo(),this.hoverEnabled){var e=this.layer.hitTest(this.mousePos.x,this.mousePos.y);this.selection.setHoveredId(e?e.id:0)}}},{key:"getCursor",value:function(){if(this.poly){var e=this.mousePos;if(this.moveTool.isDragging())return"move";if(-1!=this.draggedVertex||-1!=this.draggedEdge)return"move";if(this.keyState[v.KeyCode.CONTROL]){var t=17*this.layer.getUnitsPerPixel();if(-1!==(this.poly?this.poly.findEdgeIndex(this.mousePos,t):-1))return"copy"}var i=this.layer.getLineHitRadius(this.poly);return this.poly.hitTest(e.x,e.y,i)?"move":void 0}}},{key:"clearTangentGizmos",value:function(){this.tangentGizmos.forEach((function(e){return e.dtor()})),this.tangentGizmos.length=0}},{key:"createTangentGizmos",value:function(){if(this.clearTangentGizmos(),this.poly&&this.poly.isPath())for(var e=0;e<this.poly.points.length;e++)this.tangentGizmos.push(new a.default(this.poly,e,this.layer,this.gizmoLayer))}},{key:"findDraggedTangentGizmo",value:function(){return this.tangentGizmos.find((function(e){return e.isDragging()}))}}])&&c(i.prototype,h),u&&c(i,u),t}(h.default)},"./extensions/Edit2D/tools/PolygonTool.js":
/*!************************************************!*\
  !*** ./extensions/Edit2D/tools/PolygonTool.js ***!
  \************************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return b}));var n=i(/*! ../EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ../CanvasGizmo.js */"./extensions/Edit2D/CanvasGizmo.js"),s=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js"),r=i(/*! ./EditToolBase.js */"./extensions/Edit2D/tools/EditToolBase.js"),a=i(/*! ./RectangleTool.js */"./extensions/Edit2D/tools/RectangleTool.js"),l=i(/*! ./LineTool.js */"./extensions/Edit2D/tools/LineTool.js");function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,i){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g={Polyline:1,Polygon:2},m=Bimfish.Viewing,x=new n.Style,b=function(e){function t(e){var i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.Polygon,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Style;return u(this,t),(i=d(this,y(t).call(this,e))).lineRectTool=s===g.Polygon?new a.default(e,r):new l.default(e,r),Bimfish.Viewing.EventDispatcher.prototype.apply(p(i)),i.vertexGizmos=[],i.poly=void 0,i.style=r,i.edgePreviewStyle=new n.Style({lineWidth:2,isScreenSpace:!0,lineStyle:11}),i.mode=s,i.lastClickX=void 0,i.lastClickY=void 0,i.keyMap.CANCEL_EDIT=m.KeyCode.ESCAPE,i.keyMap.REMOVE_LAST_VERTEX=m.KeyCode.BACKSPACE,i.keyMap.FINISH_EDIT=[m.KeyCode.ENTER,m.KeyCode.c],i.fillGizmo=null,i.outlineGizmo=null,i.edgePreviewGizmo=null,i.mousePos=new THREE.Vector2,i.areaLabel=new o.AreaLabel(null,i.gizmoLayer,i.unitHandler,!1),i.lengthLabel=new o.EdgeLabel(i.gizmoLayer,!1),i}var i,r,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),i=t,(r=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"deactivate",value:function(){f(y(t.prototype),"deactivate",this).call(this),this.cancelEdit()}},{key:"isPolygon",value:function(){return this.poly instanceof n.Polygon}},{key:"setStyles",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.lineColor===x.lineColor&&t||(this.style.lineColor=e.lineColor),e.lineAlpha===x.lineAlpha&&t||(this.style.lineAlpha=e.lineAlpha),e.lineWidth===x.lineWidth&&t||(this.style.lineWidth=e.lineWidth,this.lineRectTool.style.lineWidth=e.lineWidth,this.edgePreviewStyle.lineWidth=2*e.lineWidth/3),e.lineStyle===x.lineStyle&&t||(this.style.lineStyle=e.lineStyle,this.lineRectTool.style.lineStyle=e.lineStyle),e.fillColor===x.fillColor&&t||(this.style.fillColor=e.fillColor),e.fillAlpha===x.fillAlpha&&t||(this.style.fillAlpha=e.fillAlpha)}},{key:"initGizmos",value:function(){this.isPolygon()&&(this.fillGizmo=new n.Polygon([],this.style.clone()),this.fillGizmo.style.lineAlpha=0,this.gizmoLayer.addShape(this.fillGizmo)),this.outlineGizmo=new n.Polyline([],this.style.clone()),this.gizmoLayer.addShape(this.outlineGizmo),this.edgePreviewGizmo=new n.Polyline([],this.edgePreviewStyle),this.edgePreviewGizmo.style.lineColor=this.poly.style.lineColor,this.gizmoLayer.addShape(this.edgePreviewGizmo),this.areaLabel.setShape(this.fillGizmo),this.poly&&this.poly.isPolyline()&&this.lengthLabel.attachToEdge(this.edgePreviewGizmo,0)}},{key:"clearGizmos",value:function(){this.fillGizmo&&(this.gizmoLayer.removeShape(this.fillGizmo),this.fillGizmo=null),this.areaLabel.setShape(null),this.lengthLabel.detachFromEdge(),this.outlineGizmo&&(this.gizmoLayer.removeShape(this.outlineGizmo),this.outlineGizmo=null),this.edgePreviewGizmo&&(this.gizmoLayer.removeShape(this.edgePreviewGizmo),this.edgePreviewGizmo=null);for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"polyModified",value:function(){this.updateGizmos();var e=this.poly.clone();e.addPoint(this.mousePos.x,this.mousePos.y),this.snapper.startAngleSnapping(e,this.poly.length)}},{key:"updateGizmos",value:function(){if(this.fillGizmo){this.fillGizmo.clear();for(var e=0;e<this.poly.length;e++){var t=this.poly.getPoint(e);this.fillGizmo.addPoint(t.x,t.y)}this.fillGizmo.addPoint(this.mousePos.x,this.mousePos.y)}if(this.outlineGizmo.clear(),this.poly.length>=2)for(var i=0;i<this.poly.length;i++){var n=this.poly.getPoint(i);this.outlineGizmo.addPoint(n.x,n.y)}if(this.edgePreviewGizmo.clear(),this.poly.length>=1){var o=this.poly.getPoint(this.poly.length-1);this.edgePreviewGizmo.addPoint(o.x,o.y),this.edgePreviewGizmo.addPoint(this.mousePos.x,this.mousePos.y),this.updateLengthLabel()}this.gizmoLayer.update()}},{key:"updateLengthLabel",value:function(){if(this.poly&&this.poly.isPolyline()){var e=this.unitHandler.measureTransform,t=this.poly.getLength(e)+this.edgePreviewGizmo.getLength(e),i=this.unitHandler.lengthToString(t);this.lengthLabel.setText(i)}}},{key:"getName",value:function(){return(this.mode===g.Polygon?"Edit2_PolygonTool":"Edit2_PolylineTool")+this.nameSuffix}},{key:"handleMouseMove",value:function(e){return f(y(t.prototype),"handleMouseMove",this).call(this,e),e.buttons?this.lineRectTool.handleMouseMove(e):(this.onHover(e.canvasX,e.canvasY),!1)}},{key:"onHover",value:function(e,t){if(this.poly){var i=this.layer.canvasToLayer(e,t),n=this.poly.length>=3&&this.vertexGizmos[0].isUnderMouse;this.setStartVertexHighlighted(n),n?(this.snapper.clearSnappingGizmos(),i.copy(this.vertexGizmos[0].layerPos)):i=this.getSnapPosition(e,t),this.mousePos.copy(i),this.edgePreviewGizmo.updatePoint(1,i.x,i.y),this.fillGizmo&&this.fillGizmo.updatePoint(this.fillGizmo.length-1,i.x,i.y),this.gizmoLayer.update(),this.updateLengthLabel()}else this.getSnapPosition(e,t)}},{key:"handleStartVertexClicked",value:function(e){if(this.poly||!(this.poly.length<3)){if(this.poly.isPolyline()){var t=this.poly.getPoint(0);this.addVertex(t.x,t.y)}this.finishPolygon(),e.stopPropagation()}}},{key:"handleSingleClick",value:function(e,i){return f(y(t.prototype),"handleSingleClick",this).call(this,e,i),0!=!i&&(this.vertexGizmos.length>0&&e.canvasX===this.lastClickX&&e.canvasY===this.lastClickY||(this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.mousePos.copy(this.getSnapPosition(e.canvasX,e.canvasY)),this.poly||this.startPoly(this.mousePos.x,this.mousePos.y),this.addVertex(this.mousePos.x,this.mousePos.y)),!0)}},{key:"handleButtonDown",value:function(e,t){return!this.ignoreDragging&&!this.poly&&(this.selection.clear(),this.lineRectTool.handleButtonDown(e,t))}},{key:"handleButtonUp",value:function(e,t){return this.lineRectTool.handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,i){return f(y(t.prototype),"handleDoubleClick",this).call(this,e,i),0!=!i&&(this.finishPolygon(),!0)}},{key:"startPoly",value:function(e,t){this.mode===g.Polygon?this.poly=new n.Polygon([],this.style.clone()):this.poly=new n.Polyline([],this.style.clone()),this.initGizmos()}},{key:"addVertex",value:function(e,t){var i=this;this.poly.addPoint(e,t);var n="PolygonTool_vertexGizmo_"+this.vertexGizmos.length,s=new o.VertexGizmo(this.gizmoLayer,e,t,n);this.vertexGizmos.push(s),1===this.vertexGizmos.length&&s.container.addEventListener("click",(function(e){return i.handleStartVertexClicked(e)})),this.polyModified()}},{key:"removeLastVertex",value:function(){this.poly&&this.poly.length&&(this.poly.length<=1?this.cancelEdit():(this.poly.removePoint(this.poly.length-1),this.vertexGizmos[this.vertexGizmos.length-1].dtor(),this.vertexGizmos.pop(),this.polyModified()))}},{key:"finishPolygon",value:function(){this.clearGizmos(),this.snapper.stopAngleSnapping(),this.runAction(new s.Actions.AddShape(this.layer,this.poly)),this.dispatchEvent({type:t.POLYGON_ADDED,polygon:this.poly}),this.poly=null}},{key:"cancelEdit",value:function(){this.lineRectTool.isDragging()&&this.lineRectTool.cancelDrag(),this.poly&&(this.gizmoLayer.removeShape(this.poly),this.poly=null),this.clearGizmos(),this.snapper.stopAngleSnapping()}},{key:"handleFinishKey",value:function(e){return!(!this.poly||this.isPolygon()&&this.poly.length<3||(this.finishPolygon(),0))}},{key:"handleKeyDown",value:function(e,i){var n=f(y(t.prototype),"handleKeyDown",this).call(this,e,i);switch(n=this.lineRectTool.handleKeyDown(e,i)||n,this.mapKey(e,this.keyMap)){case"CANCEL_EDIT":this.cancelEdit(),n=!0;break;case"REMOVE_LAST_VERTEX":this.removeLastVertex(),n=!0;break;case"FINISH_EDIT":n=this.handleFinishKey(e)}return n}},{key:"handleKeyUp",value:function(e,i){f(y(t.prototype),"handleKeyUp",this).call(this,e,i),this.lineRectTool.handleKeyUp(e,i)}},{key:"onSnappingToggled",value:function(e,t){this.onHover(e,t)}},{key:"mouseOnStartVertex",value:function(e){return!!this.vertexGizmos[0]&&(this.layer.canvasToLayer(e.canvasX,e.canvasY),this.vertexGizmos[0].isUnderMouse)}},{key:"setStartVertexHighlighted",value:function(e){this.vertexGizmos[0]&&this.vertexGizmos[0].setSelected(e)}},{key:"getCursor",value:function(){return"crosshair"}}])&&c(i.prototype,r),h&&c(i,h),t}(r.default);b.POLYGON_ADDED="polygonAdded",b.Mode=g},"./extensions/Edit2D/tools/RectangleTool.js":
/*!**************************************************!*\
  !*** ./extensions/Edit2D/tools/RectangleTool.js ***!
  \**************************************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return y}));var n=i(/*! ../EditShapes.js */"./extensions/Edit2D/EditShapes.js"),o=i(/*! ../Actions.js */"./extensions/Edit2D/Actions.js"),s=i(/*! ./EditToolBase.js */"./extensions/Edit2D/tools/EditToolBase.js"),r=i(/*! ../CanvasGizmo */"./extensions/Edit2D/CanvasGizmo.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?d(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=Bimfish.Viewing,y=function(e){function t(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.Style;return l(this,t),i=u(this,c(t).call(this,e)),Bimfish.Viewing.EventDispatcher.prototype.apply(d(i)),i.style=o,i.rect=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.areaLabel=new r.AreaLabel(null,i.layer,e.unitHandler,!1),i}var i,s,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),i=t,(s=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_RectangleTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){return 0==t&&(this.dragCanceled?(this.dragCanceled=!1,!0):(this.handleMouseMove(e),this.endDrag()))}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.rect&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.rect=new n.Polygon([e.clone(),e.clone(),e.clone(),e.clone()],this.style.clone()),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.rect)}},{key:"updateRect",value:function(e){if(this.isDragging()){var t=this.startPoint,i=this.endPoint;if(e){var n=i.x-t.x,o=i.y-t.y,s=Math.max(Math.abs(n),Math.abs(o)),r=Math.sign(n),a=Math.sign(o);this.rect.updatePoint(1,t.x+s*r,t.y),this.rect.updatePoint(2,t.x+s*r,t.y+s*a),this.rect.updatePoint(3,t.x,t.y+s*a)}else this.rect.updatePoint(1,i.x,t.y),this.rect.updatePoint(2,i.x,i.y),this.rect.updatePoint(3,t.x,i.y);this.gizmoLayer.update(),this.areaLabel.setShape(this.rect)}}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateRect(t)}},{key:"endDrag",value:function(){if(!this.rect)return!1;var e=this.endPoint.x-this.startPoint.x,t=this.endPoint.y-this.startPoint.y,i=Math.abs(e)>1e-10&&Math.abs(t)>1e-10;return this.gizmoLayer.removeShape(this.rect),i&&this.undoStack.run(new o.Actions.AddShape(this.layer,this.rect)),this.rect=null,this.areaLabel.setShape(null),!0}},{key:"cancelDrag",value:function(){this.rect&&(this.gizmoLayer.removeShape(this.rect),this.rect=null,this.dragCanceled=!0,this.areaLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.rect)}},{key:"handleKeyDown",value:function(e,t){t==f.KeyCode.SHIFT&&this.updateRect(!0)}},{key:"handleKeyUp",value:function(e,t){t==f.KeyCode.SHIFT&&this.updateRect(!1)}}])&&h(i.prototype,s),a&&h(i,a),t}(s.default)},"./extensions/Edit2D/tools/UndoTool.js":
/*!*********************************************!*\
  !*** ./extensions/Edit2D/tools/UndoTool.js ***!
  \*********************************************/
/*! exports provided: default */function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t),i.d(t,"default",(function(){return s}));var o=Bimfish.Viewing,s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=t}var t,i,s;return t=e,(i=[{key:"handleKeyDown",value:function(e,t){if(t!==o.KeyCode.z||!e.ctrlKey)return!1;e.shiftKey?this.undoStack.redo():this.undoStack.undo()}},{key:"getName",value:function(){return"Edit2_UndoTool"}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&n(t.prototype,i),s&&n(t,s),e}()},"./extensions/PDF/LmvCanvasContext.js":
/*!********************************************!*\
  !*** ./extensions/PDF/LmvCanvasContext.js ***!
  \********************************************/
/*! exports provided: hijackContextAPI, LmvCanvasContext */function(e,t,i){"use strict";i.r(t),i.d(t,"hijackContextAPI",(function(){return c})),i.d(t,"LmvCanvasContext",(function(){return b}));var n=i(/*! ./path2d */"./extensions/PDF/path2d.js"),o=i(/*! ./bezier */"./extensions/PDF/bezier.js");function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}var a=Bimfish.Viewing,l=a.Private,h=l.VertexBufferBuilder,u=a.getGlobal().document;function c(e,t){["fillRect","strokeRect","clearRect","beginPath","closePath","moveTo","lineTo","arc","arcTo","quadraticCurveTo","bezierCurveTo","rect","fill","stroke","clip","strokeText","fillText","drawImage","save","restore","setLineDash","beginMarkedContent","beginMarkedContentProps","endMarkedContent","setCurrentOperatorIndex","needDelegateInlineImageGroup"].forEach((function(i){e["_original"+i]=e[i],e[i]=t[i].bind(t)}))}var d=new Array(6),p=new THREE.Vector2,f=new THREE.Box2,y=new THREE.Vector3,v=new THREE.Quaternion,g=new THREE.Vector3,m=new THREE.Vector3,x=new THREE.Matrix4,b=function(){function e(t,i,n,s,r,l,d){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var p=u.createElement("canvas"),f=p.getContext("2d");if(p.height=t.height,p.width=t.width,this.canvasContext=f,this.viewport=t,this.toPageUnits=i,this.meshCallback=n,1==t.clipToViewport){var y=t.offsetX||0,v=t.offsetY||0;this.bounds=new THREE.Vector4(y*i,v*i,(t.width+y)*i,(t.height+v)*i)}this.currentMeshIndex=0,this.imageNumber=0,this.currentVbb=new h(!1),this._curPath=null,this._curClip=null,this.first=!0,this.states=[],this.glyphCache={},this.usingTextLayer=r,this.precisionTolerance=.1,this.dbId=-1,this.consecutiveIds=!1,a.isMobileDevice()&&Object(o.SetTesselationParams)(void 0,.1),this.fontEngine=s,this.lineStyle=0,this.isScreenSpace=!1,c(f,this),this.layers={},this.defaultLayerId=0,this.currentLayerId=this.defaultLayerId,this.sequencedDbId=-1,this.taggedId=null,this.defaultVPId=0,this.currentVpId=this.defaultVPId,this.viewports=[this.createViewPortData((new THREE.Matrix4).elements)],this.viewportMap={},this.ocgStack=[],this.idRemap=[],this.idIndexMap={},this.msdfRender=!0,this.fontAtlas=l,this.pdfRefMap=d||{}}return r(e,null,[{key:"isRef",value:function(e){return null!=e&&"number"==typeof e.num&&"number"==typeof e.gen}},{key:"refKey",value:function(e){return"".concat(e.num,"-").concat(e.gen)}}]),r(e,[{key:"updateDBId",value:function(){null!=this.taggedId?null!=this.idIndexMap[this.taggedId]?this.dbId=this.idIndexMap[this.taggedId]:(this.sequencedDbId++,this.dbId=this.sequencedDbId,this.idRemap[this.dbId]=this.taggedId,this.idIndexMap[this.taggedId]=this.dbId):(this.consecutiveIds&&(this.sequencedDbId++,this.dbId=this.sequencedDbId),this.idRemap[this.dbId]=this.dbId)}},{key:"save",value:function(){this.states.push({clip:this._curClip,consecutiveIds:this.consecutiveIds,dbId:this.dbId,lineDashedDef:this.lineDashedDef,lineStyle:this.lineStyle}),this.canvasContext._originalsave()}},{key:"restore",value:function(){var e=this.states.pop();e&&(this._curClip=e.clip,this.consecutiveIds=e.consecutiveIds,this.dbId=e.dbId,this.lineDashedDef=e.lineDashedDef,this.lineStyle=e.lineStyle),this.canvasContext._originalrestore()}},{key:"flushBuffer",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.currentVbb.vcount||t){var n=t;if((n=n||this.currentVbb.isFull(e))&&this.currentVbb.vcount){var o=this.currentVbb.toMesh();o.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing,isScreenSpace:!this.currentImage,hasLineStyles:this.currentVbb.hasLineStyles,msdfFontTexture:!!i,viewportBounds:this.bounds},this.currentImage&&(o.material.image=this.currentImage,o.material.image.name=this.currentImage.cacheKey||this.imageNumber++,o.material.opacity=this.canvasContext.globalAlpha,this.currentImage=null),this.meshCallback(o,this.currentMeshIndex++),this.currentVbb.reset(0),i&&this.currentVbb.expandStride()}}}},{key:"addPolyTriangle",value:function(e,t,i,n,o,s){var r=this,a=null,l=this.currentVpId;function h(e,t){if(e>t){var i=e;e=t,t=i}if(a[e]){var n=a[e],o=n.lastIndexOf(t);-1==o?n.push(t):n[o]=-1}else a[e]=[t]}function u(t,s){if(t>s){var h=t;t=s,s=h}var u=a[t];u&&(-1!=u.indexOf(s)&&(r.flushBuffer(4),r.currentVbb.addSegment(e[2*t],e[2*t+1],e[2*s],e[2*s+1],r.currentLayerId,-.5,i,n,o,l,r.lineStyle)))}if(s){a=new Array(e.length/2);for(var c=0,d=t.length;c<d;c+=3){var p=t[c],f=t[c+1],y=t[c+2];h(p,f),h(f,y),h(y,p)}}if(this.currentVbb.useInstancing){var v=t.length;for(c=0;c<v;c+=3){p=t[c],f=t[c+1],y=t[c+2];this.flushBuffer(4),this.currentVbb.addTriangleGeom(e[2*p],e[2*p+1],e[2*f],e[2*f+1],e[2*y],e[2*y+1],i,n,o,l),s&&(u(p,f),u(f,y),u(y,p))}}else{v=e.length/2;this.flushBuffer(v);var g=this.currentVbb,m=g.vcount;for(c=0;c<v;++c){var x=e[2*c],b=e[2*c+1];g.addVertexPolytriangle(x,b,i,n,o,l)}g.addIndices(t,m),s&&function(){for(var t=0,s=a.length;t<s;t++){var h=a[t];if(h)for(var u=0;u<h.length;u++){var c=h[u];-1!=c&&(r.flushBuffer(4),r.currentVbb.addSegment(e[2*t],e[2*t+1],e[2*c],e[2*c+1],r.currentLayerId,-.5,i,n,o,l,r.lineStyle))}}}()}}},{key:"getFillColor",value:function(){if("string"!=typeof this.canvasContext.fillStyle)return console.warn("Unsupported fill style."),0;var e=parseInt(this.canvasContext.fillStyle.slice(1),16);return 255*this.canvasContext.globalAlpha<<24|(255&e)<<16|65280&e|e>>16&255}},{key:"getStrokeColor",value:function(){var e=this.canvasContext;if(this.lastStrokeStyle===e.strokeStyle&&e.globalAlpha===this.lastAlpha)return this.lastRgb;var t=parseInt(e.strokeStyle.slice(1),16),i=255*e.globalAlpha<<24|(255&t)<<16|65280&t|t>>16&255;return this.lastRgb=i,this.lastStrokeStyle=e.strokeStyle,this.lastAlpha=e.globalAlpha,i}},{key:"getCurrentTransform",value:function(){var e=this.canvasContext.mozCurrentTransform;if(this.isFontChar){var t=this.invXform,i=e[0],n=e[1],o=e[2],s=e[3],r=e[4],a=e[5];return d[0]=t[0]*i+t[2]*n,d[1]=t[1]*i+t[3]*n,d[2]=t[0]*o+t[2]*s,d[3]=t[1]*o+t[3]*s,d[4]=t[0]*r+t[2]*a+t[4],d[5]=t[1]*r+t[3]*a+t[5],d}return e}},{key:"tx",value:function(e,t,i){return(e*(i=i||this.getCurrentTransform())[0]+t*i[2]+i[4])*(this.isFontChar?1:this.toPageUnits)}},{key:"ty",value:function(e,t,i){return(e*(i=i||this.getCurrentTransform())[1]+t*i[3]+i[5])*(this.isFontChar?1:this.toPageUnits)}},{key:"scaleValue",value:function(e,t){return t=t||this.getCurrentTransform(),this.toPageUnits*Math.sqrt(Math.abs(t[0]*t[3]-t[1]*t[2]))*e}},{key:"transformBox",value:function(e,t,i){return t=t||this.getCurrentTransform(),f.makeEmpty(),p.set(this.tx(e.min.x,e.min.y,t),this.ty(e.min.x,e.min.y,t)),f.expandByPoint(p),p.set(this.tx(e.max.x,e.min.y,t),this.ty(e.max.x,e.min.y,t)),f.expandByPoint(p),p.set(this.tx(e.max.x,e.max.y,t),this.ty(e.max.x,e.max.y,t)),f.expandByPoint(p),p.set(this.tx(e.min.x,e.max.y,t),this.ty(e.min.x,e.max.y,t)),f.expandByPoint(p),i?(i.copy(f),i):f.clone()}},{key:"fillRect",value:function(e,t,i,n){this.updateDBId();var o=this.getCurrentTransform(),s=[this.tx(e,t,o),this.ty(e,t,o),this.tx(e+i,t,o),this.ty(e+i,t,o),this.tx(e+i,t+n,o),this.ty(e+i,t+n,o),this.tx(e,t+n,o),this.ty(e,t+n,o)],r=this.getFillColor(),a=this.first?-1:this.dbId;this.addPolyTriangle(s,[0,1,2,0,2,3],r,a,this.currentLayerId,!1),this.first=!1}},{key:"strokeRect",value:function(e,t,i,n){console.log("strokeRect")}},{key:"clearRect",value:function(e,t,i,n){console.log("clearRect")}},{key:"_beginTextChar",value:function(e,t,i,n,o){this.isFontChar=!0,this.invXform=this.canvasContext.mozCurrentTransformInverse,this.hashKey=e.charCodeAt(0)+"/"+n.loadedName+"/"+o,this.cachedGlyph=this.glyphCache[this.hashKey],this.cachedGlyph?this.skipPath=!0:this.skipPath=!1}},{key:"drawMSDFText",value:function(e,t,i,n,o){var s=n.name;if(this.fontAtlas&&this.fontAtlas.charsMap&&this.fontAtlas.charsMap[s]){var r=this.fontAtlas.charsMap[s][e.charCodeAt(0)];if(null==r)return!1;this.currentVbb.isFull(4)&&this.flushBuffer(0,!0);var a=this.fontAtlas.chars[r];if(a.page>0)return!1;for(var l=this.fontAtlas.common[a.common],h=o/this.fontAtlas.info[a.info].size,u=a.width*(h+0),c=a.inverseYAxis?-1:1,d=a.height*(h+i)*c,p=a.txoffset*(h+0),f=a.tyoffset*(h+i)*-c,y=[p,f,p,f+d,p+u,f+d,p+u,f],v=[],g=0;g<y.length;g+=2)v.push(this.tx(y[g],y[g+1])),v.push(this.ty(y[g],y[g+1]));if(a.inverseYAxis)var m=[a.x/l.scaleW,1-a.y/l.scaleH,a.x/l.scaleW,1-(a.y+a.height)/l.scaleH,(a.x+a.width)/l.scaleW,1-(a.y+a.height)/l.scaleH,(a.x+a.width)/l.scaleW,1-a.y/l.scaleH];else m=[a.x/l.scaleW,1-(a.y+a.height)/l.scaleH,a.x/l.scaleW,1-a.y/l.scaleH,(a.x+a.width)/l.scaleW,1-a.y/l.scaleH,(a.x+a.width)/l.scaleW,1-(a.y+a.height)/l.scaleH];for(var x=this.currentVbb.vcount,b=y.length/2,S=0;S<b;S++)this.currentVbb.addVertexMSDFPolytriangle(v[2*S],v[2*S+1],m[2*S],m[2*S+1],this.getFillColor(),this.dbId,this.currentLayerId,0);return this.currentVbb.addIndices([0,2,1,0,2,3],x),this.currentImage=this.fontAtlas.pages[a.page],!0}return!1}},{key:"beginPath",value:function(e,t,i,o,s){this.updateDBId(),"string"==typeof e&&o&&s?this.fontAtlas&&this.drawMSDFText(e,t,i,o,s)||!0===this.usingTextLayer?this.skipPath=!0:this._beginTextChar(e,t,i,o,s):(this.skipPath=!1,this.isFontChar=!1,this.cachedGlyph=null),this.skipPath?this._curPath=null:(this._curPath=new n.Path2D(this.isFontChar?1e-4:this.precisionTolerance),this._curPath.setTessParams(this.tessParams))}},{key:"closePath",value:function(){this.skipPath||(this._curPath.closePath(),this.cachedGlyph=null)}},{key:"moveTo",value:function(e,t){if(!this.skipPath){this._curPath||this.beginPath();var i=this.getCurrentTransform();this._curPath.moveTo(this.tx(e,t,i),this.ty(e,t,i))}}},{key:"lineTo",value:function(e,t){if(!this.skipPath){var i=this.getCurrentTransform();this._curPath.lineTo(this.tx(e,t,i),this.ty(e,t,i))}}},{key:"arc",value:function(e,t,i,n,o,s){this.skipPath||this._curPath.arc(e,t,i,n,o,s)}},{key:"arcTo",value:function(e,t,i,n,o){if(!this.skipPath){var s=this.getCurrentTransform();this._curPath.arcTo(this.tx(e,t,s),this.ty(e,t,s),this.tx(i,n,s),this.ty(i,n,s),this.scaleValue(o,s))}}},{key:"quadraticCurveTo",value:function(e,t,i,n){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath.quadraticCurveTo(this.tx(e,t,o),this.ty(e,t,o),this.tx(i,n,o),this.ty(i,n,o))}}},{key:"bezierCurveTo",value:function(e,t,i,n,o,s){if(!this.skipPath){var r=this.getCurrentTransform();this._curPath.bezierCurveTo(this.tx(e,t,r),this.ty(e,t,r),this.tx(i,n,r),this.ty(i,n,r),this.tx(o,s,r),this.ty(o,s,r))}}},{key:"rect",value:function(e,t,i,n){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath||this.beginPath(),this._curPath.moveTo(this.tx(e,t,o),this.ty(e,t,o)),this._curPath.lineTo(this.tx(e+i,t,o),this.ty(e+i,t,o)),this._curPath.lineTo(this.tx(e+i,t+n,o),this.ty(e+i,t+n,o)),this._curPath.lineTo(this.tx(e,t+n,o),this.ty(e,t+n,o)),this._curPath.closePath()}}},{key:"fill",value:function(){var e=!1;if(arguments.length){var t,i=(t=arguments.length-1)<0||arguments.length<=t?void 0:arguments[t];"boolean"==typeof i&&(e=i)}this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.cacheTriangulation()),this.isFontChar=!1,this.cachedGlyph?this.cachedGlyph.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!0):this._curPath&&this._curPath.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!1,e),this.skipPath=!1}},{key:"stroke",value:function(){this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.cacheTriangulation()),this.updateLineDashStyle(),this.isFontChar=!1;var e=this.isScreenSpace?-1:1;this.cachedGlyph?this.cachedGlyph.stroke(this,e*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!0,this.lineStyle):this._curPath&&this._curPath.stroke(this,e*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!1,this.lineStyle),this.skipPath=!1}},{key:"clip",value:function(e,t){void 0!==t&&void 0!==e?(this._curClip=e,console.log("Probably unsupported use case")):(this._curClip?this._curClip=this._curClip.clip(this._curPath,e):this._curClip=this._curPath,this._curPath=null)}},{key:"strokeText",value:function(e,t,i,n,o,s){var r=this.canvasContext;r.save(),r.translate(t,i),this.fontEngine.drawText(this,e,0,0,o,s),this.stroke(),r.restore()}},{key:"fillText",value:function(e,t,i,n,o,s){var r=this.canvasContext;r.save(),r.translate(t,i),this.fontEngine.drawText(this,e,0,0,o,s),this.fill(),r.restore()}},{key:"drawImage",value:function(e,t,i,n,o,s,r,a,l){if(this.inlineImageGroups&&null!=this.inlineImageGroups.map[this.currentOpIndex]){var h=this.inlineImageGroups.map[this.currentOpIndex],u=this.inlineImageGroups.groups[h];if(1==u.rendered)return;u.rendered=!0,e=u.canvas;var c=1/u.minScale;s=u.bounds.min.x,r=u.bounds.min.y,a=e.width/c,l=e.height/c}if(0!==e.width&&0!==e.height)if(void 0===s&&(s=t,r=i,a=n,l=o),void 0===a&&(a=e.width,l=e.height),a){var d=this.getCurrentTransform(),p=this.tx(s+a/2,r+l/2),f=this.ty(s+a/2,r+l/2);x.elements[0]=d[0],x.elements[1]=d[1],x.elements[4]=d[2],x.elements[5]=d[3],x.elements[12]=d[4],x.elements[13]=d[5],x.decompose(y,v,g);var b=a*g.x*this.toPageUnits,S=-l*g.y*this.toPageUnits,E=Math.sqrt(1-v.w*v.w);m.set(v.x/E,v.y/E,v.z/E);var k=2*Math.acos(Math.max(Math.min(1,v.w),-1));v.z<0&&(k=-k),k<0&&(k+=2*Math.PI),this.flushBuffer(0,!0),this.currentVbb.addTexturedQuad(p,f,b,S,k,4294902015,0,this.currentLayerId,0),this.currentImage=e,this.flushBuffer(0,!0,!1)}else console.warn("Zero size image, skipping");else console.warn("Zero size image, skipping")}},{key:"_processProperties",value:function(t){for(var i in e.isRef(t)&&(t=this.pdfRefMap[e.refKey(t)]),t)e.isRef(t[i])&&(t[i]=this.pdfRefMap[e.refKey(t[i])]);return t}},{key:"beginMarkedContent",value:function(e){e&&(e=this._processProperties(e));var t=e.name||e.DBID;isNaN(t)?this.taggedId=null:this.taggedId=parseInt(t),null!=this.taggedId&&this.dbId!=this.taggedId&&this.updateDBId(),e.VP&&(this.currentVpId=this.viewports.length,this.viewports.push(this.createViewPortData(JSON.parse(e.VP),e.UNITS))),this.ocgStack.push({taggedId:this.taggedId,viewPortId:this.currentVpId})}},{key:"beginMarkedContentProps",value:function(e,t){if(t&&(t=this._processProperties(t)),"OC"===e){var i=t.ocgId,n=this.layers[i];null==n&&(n=this.defaultLayerId),this.currentLayerId=n,this.ocgStack.push({layerId:this.currentLayerId})}else isNaN(e)||(this.taggedId=parseInt(e),this.dbId!=this.taggedId&&this.updateDBId()),t?(t.VP&&(this.currentVpId=this.viewports.length,this.viewports.push(this.createViewPortData(JSON.parse(t.VP),t.UNITS))),this.ocgStack.push({viewPortId:this.currentVpId,taggedId:this.taggedId})):this.ocgStack.push({})}},{key:"endMarkedContent",value:function(){var e=this.ocgStack.pop(),t=this.taggedId;if(e&&(null!=e.taggedId&&(this.taggedId=null),e.layerId&&(this.currentLayerId=this.defaultLayerId),e.viewPortId&&(this.currentVpId=this.defaultVPId)),this.ocgStack.length>0){var i=this.ocgStack[this.ocgStack.length-1];null!=i.taggedId&&(this.taggedId=i.taggedId),null!=i.currentLayerId&&(this.currentLayerId=i.currentLayerId),null!=i.viewPortId&&(this.currentVpId=i.viewPortId)}else this.currentLayerId=this.defaultLayerId,this.taggedId=null,this.currentVpId=this.defaultVPId;t!=this.taggedId&&this.updateDBId()}},{key:"setLineStyleParam",value:function(e){if(!this.lineStyleInitialized){for(var t=l.LineStyleDefs.length,i=1,n=0;n<l.LineStyleDefs.length;n++)i=Math.max(l.LineStyleDefs[n].def.length,i);var o=l.createLinePatternTextureData(Math.max(e.width,i),e.height+t+1),s=o.tex,r=o.pw,a=o.lineStyleTex;this.lineStyleIndex=0,this.lineStylePw=r,this.lineStyleTexData=s,this.lineStyleTexture=a,this.lineStyleIndexMap={};for(n=0;n<l.LineStyleDefs.length;n++)this.addNewDashedLineStyle(l.LineStyleDefs[n],96);this.lineStyle=0,this.lineStyleInitialized=!0}}},{key:"addNewDashedLineStyle",value:function(e,t){var i=e.def.join("/");if(null!=this.lineStyleIndexMap[i])return this.lineStyleIndexMap[i];l.createLinePatternForDef(e,this.lineStyleTexData,this.lineStyleIndex,this.lineStylePw,t);var n=this.lineStyleIndex;return this.lineStyleIndexMap[i]=n,this.lineStyleIndex++,n}},{key:"setLineDash",value:function(e){this.lineStyleInitialized||this.setLineStyleParam({width:5,height:4}),this.lineDashedDef=e}},{key:"updateLineDashStyle",value:function(){var e=this.lineDashedDef;if(e)if(e.length>0){for(var t=this.getCurrentTransform(),i=[],n=0;n<e.length;n++){var o=(e[n]*t[0]+e[n]*t[2])*this.toPageUnits;o=parseFloat(o.toFixed(6)),i.push(o)}this.lineStyle=this.addNewDashedLineStyle({def:i},96/72/this.toPageUnits)}else this.lineStyle=0}},{key:"setCircleInfo",value:function(e){this.circleInfo=e}},{key:"setCurrentOperatorIndex",value:function(e){if(this.currentOpIndex=e,this.circleInfo&&this.circleInfo[e]){var t=this.getCurrentTransform(),i=this.tx(this.circleInfo[e][0],this.circleInfo[e][1],t),n=this.ty(this.circleInfo[e][0],this.circleInfo[e][1],t),o=this.currentVbb.addVertexLine(i,n,0,1e-4,0,0,1,this.dbId,this.currentLayerId,this.currentVpId);this.currentVbb.finalizeQuad(o)}}},{key:"setInlineImageGroups",value:function(e){e.groups.length>0&&(this.inlineImageGroups=e)}},{key:"needDelegateInlineImageGroup",value:function(){return this.inlineImageGroups&&null!=this.inlineImageGroups.map[this.currentOpIndex]}},{key:"setTessParams",value:function(e){this.tessParams=e}},{key:"finish",value:function(){this.flushBuffer(0,!0),this.fontAtlas=null}},{key:"createViewPortData",value:function(e,t){return{units:t||"feet and inches",transform:e,geom_metrics:this.initGeomMetrics()}}},{key:"initGeomMetrics",value:function(){return{arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]}}}]),e}()},"./extensions/PDF/bezier.js":
/*!**********************************!*\
  !*** ./extensions/PDF/bezier.js ***!
  \**********************************/
/*! exports provided: SetTesselationParams, TesselateCubic, TesselateQuad */function(e,t,i){"use strict";i.r(t),i.d(t,"SetTesselationParams",(function(){return o})),i.d(t,"TesselateCubic",(function(){return s})),i.d(t,"TesselateQuad",(function(){return r}));var n={numIterations:100,minSegLenFraction:.05};function o(e,t){e&&(n.numIterations=e),t&&(n.minSegLenFraction=t)}function s(e,t,i,o,s,r,a,l,h,u,c){c=c||n;for(var d=(u=u||1/c.minSegLenFraction)*c.minSegLenFraction,p=1/c.numIterations,f=p*p*p,y=3*p,v=y*p,g=v+v,m=6*f,x=t-2*o+r,b=i-2*s+a,S=3*(o-r)-t+l,E=3*(s-a)-i+h,k=t,P=i,w=(o-t)*y+x*v+S*f,T=(s-i)*y+b*v+E*f,D=x*g+S*m,C=b*g+E*m,L=S*m,M=E*m,I=0,V=0|1/p-.5,A=0;A<V;A++)k+=w,P+=T,w+=D,T+=C,C+=M,D+=L,(I+=Math.sqrt(w*w+T*T))>=d&&(e.lineTo(k,P),I=0);e.lineTo(l,h)}function r(e,t,i,o,s,r,a,l,h){h=h||n;for(var u=(l=l||1/h.minSegLenFraction)*h.minSegLenFraction,c=1/h.numIterations,d=c*c,p=t-2*o+r,f=i-2*s+a,y=t,v=i,g=2*(o-t)*c+p*d,m=2*(s-i)*c+f*d,x=2*p*d,b=2*f*d,S=0,E=0|1/c-.5,k=0;k<E;k++)y+=g,v+=m,g+=x,m+=b,(S+=Math.sqrt(g*g+m*m))>=u&&(e.lineTo(y,v),S=0);e.lineTo(r,a)}},"./extensions/PDF/path2d.js":
/*!**********************************!*\
  !*** ./extensions/PDF/path2d.js ***!
  \**********************************/
/*! exports provided: Path2D */function(e,t,i){"use strict";i.r(t),i.d(t,"Path2D",(function(){return r}));var n=i(/*! ./bezier */"./extensions/PDF/bezier.js"),o=new THREE.Vector2,s=new THREE.Box2;function r(e){this.segTypes=[],this.segData=[],this.hasCurves=!1,this.bbox=new THREE.Box2,this.precisionTolerance=e}r.prototype.setTessParams=function(e){this.tessParams=e},r.prototype.closePath=function(){this.segTypes.length&&7===this.segTypes[this.segTypes.length-1]||this.segTypes.push(7)},r.prototype.moveTo=function(e,t){this.segTypes.push(0),this.segData.push(e,t),this.bbox.expandByPoint(o.set(e,t))},r.prototype.lineTo=function(e,t){this.segTypes.push(1),this.segData.push(e,t),this.bbox.expandByPoint(o.set(e,t))},r.prototype.arc=function(e,t,i,n,s,r){this.hasCurves=!0,this.segTypes.push(2),this.segData.push(e,t,i,n,s,r),this.bbox.expandByPoint(o.set(e,t))},r.prototype.arcTo=function(e,t,i,n,s){this.hasCurves=!0,this.segTypes.push(3),this.segData.push(e,t,i,n,s),this.bbox.expandByPoint(o.set(e,t)),this.bbox.expandByPoint(o.set(i,n))},r.prototype.quadraticCurveTo=function(e,t,i,n){this.hasCurves=!0,this.segTypes.push(4),this.segData.push(e,t,i,n),this.bbox.expandByPoint(o.set(e,t)),this.bbox.expandByPoint(o.set(i,n))},r.prototype.bezierCurveTo=function(e,t,i,n,s,r){this.hasCurves=!0,this.segTypes.push(5),this.segData.push(e,t,i,n,s,r),this.bbox.expandByPoint(o.set(e,t)),this.bbox.expandByPoint(o.set(i,n)),this.bbox.expandByPoint(o.set(s,r))},r.prototype.flatten=function(e){for(var t=new r(this.precisionTolerance),i=0,o=0,s=0,a=o,l=s,h=this.segTypes,u=this.segData,c=this.bbox.size().length(),d=0;d<h.length;d++){switch(h[d]){case 0:e&&(o===a&&s===l||t.closePath()),a=o=u[i++],l=s=u[i++],t.moveTo(o,s);break;case 7:t.closePath();break;case 1:var p=u[i++],f=u[i++];p===o&&f===s||(t.lineTo(p,f),o=p,s=f);break;case 4:var y=u[i++],v=u[i++];p=u[i++],f=u[i++];Object(n.TesselateQuad)(t,o,s,y,v,p,f,c,this.tessParams),o=p,s=f;break;case 5:y=u[i++],v=u[i++];var g=u[i++],m=u[i++];p=u[i++],f=u[i++];Object(n.TesselateCubic)(t,o,s,y,v,g,m,p,f,c,this.tessParams),o=p,s=f;break;case 2:console.warn("not implemented: arc"),i+=6;break;case 3:console.warn("not implemented: arcto"),i+=4}}return e&&(o===a&&s===l||t.closePath()),t},r.prototype.applyTransform=function(e,t){for(var i=0;i<this.segData.length;i+=2){var n=this.segData[i],o=this.segData[i+1];this.segData[i]=e.tx(n,o,t),this.segData[i+1]=e.ty(n,o,t)}},r.prototype.stroke=function(e,t,i,n,o,s,r,h){var c=!1;if(s){var d=s.isAABBContain(this.bbox);if(d===l)return;d===a&&(c=!0)}var p,f,y=this;(r||this.hasCurves)&&(y=this.flatten(!1)),r&&(p=e.getCurrentTransform()),c||(f=s&&s.cachedCset,s&&!f&&(f=u(s))&&(f.triangulate(),s.cachedCset=f));for(var v=f&&!f.triangulationFailed&&f.polygon,g=0,m=0,x=0,b=0,S=0,E=y.segTypes,k=y.segData,P=0;P<E.length;P++){var w=E[P];switch(w){case 0:var T=k[g++],D=k[g++];r?(b=e.tx(T,D,p),S=e.ty(T,D,p)):(b=T,S=D),m=b,x=S;break;case 7:case 1:var C=void 0,L=void 0;if(7===w)C=b,L=S;else{var M=k[g++],I=k[g++];r?(C=e.tx(M,I,p),L=e.ty(M,I,p)):(C=M,L=I)}if(C!==m||L!==x){var V=v&&v.findSegmentIntersections(m,x,C,L);if(V){var A=V.length;e.flushBuffer(4+2*A);var _=v.pointInPolygon(.5*(m+V[0].x),.5*(x+V[0].y));_&&e.currentVbb.addSegment(m,x,V[0].x,V[0].y,0,t,i,n,o,e.currentVpId||0,h),_=!_;for(var z=0;z<V.length-1;z++)_&&e.currentVbb.addSegment(V[z].x,V[z].y,V[z+1].x,V[z+1].y,0,t,i,n,o,e.currentVpId||0,h),_=!_;_&&e.currentVbb.addSegment(V[V.length-1].x,V[V.length-1].y,C,L,0,t,i,n,o,e.currentVpId||0,h)}else{(!v||v.pointInPolygon(.5*(m+C),.5*(x+L)))&&(e.flushBuffer(4),e.currentVbb.addSegment(m,x,C,L,0,t,i,n,o,e.currentVpId||0,h))}m=C,x=L}break;default:console.error("Path must be flattened before rendering")}}},r.prototype.isAABB=function(){var e=this.segTypes;if(6!==e.length&&5!==e.length)return!1;if(0!==e[0])return!1;if(6===e.length&&7!==e[5])return!1;if(5===e.length&&7!==e[4]&&1!==e[4])return!1;for(var t=1;t<e.length-1;t++)if(1!==e[t])return!1;var i=this.segData,n=i[2]-i[0],o=i[3]-i[1],s=i[6]-i[4],r=i[7]-i[5],a=Math.sqrt(n*n+o*o),l=Math.sqrt(s*s+r*r);if(Math.abs(a-l)>1e-10)return!1;var h=(n/=a)*(s/=l)+(o/=a)*(r/=l);if(Math.abs(1+h)>.001)return!1;var u=i[4]-i[2],c=i[5]-i[3],d=i[8]-i[6],p=i[9]-i[7],f=Math.sqrt(u*u+c*c),y=Math.sqrt(d*d+p*p);return!(Math.abs(f-y)>1e-10)&&(h=(u/=f)*(d/=y)+(c/=f)*(p/=y),!(Math.abs(1+h)>.001)&&(h=n*u+o*c,!(Math.abs(h)>.001)&&!(Math.abs(n)>1e-10&&Math.abs(o))))};var a=1,l=2;function h(e,t,i){if(e.containsBox(t))return a;var n=i;return void 0===n&&(n=.001/e.size().length()),t.min.x-e.max.x>n||t.min.y-e.min.y>n||t.max.x-e.max.x<-n||t.max.y-e.max.y<-n?l:t.min.x-e.min.x<-n||t.min.y-e.min.y<-n||t.max.x-e.max.x>n||t.max.y-e.max.y>n?4:a}function u(e){if(!e.segTypes.length)return null;var t,i=Bimfish.Viewing.Extensions.CompGeom.ContourSet,n=Bimfish.Viewing.Extensions.CompGeom.UniquePointList,o=new i,s=new n(e.bbox),r=e.segTypes,a=e.segData,l=0,h=[];function u(e){if(e.length){var t=!1,i=e[0]===e[e.length-1];i&&e.length<=3&&(t=!0),i||console.log("Unexpected non-closed polygon contour"),t||o.addContour(e,!0)}}for(var c=0;c<r.length;c++){switch(r[c]){case 0:u(h),t=s.findOrAddPoint(a[l],a[l+1]),l+=2,h=[t];break;case 7:h[0]!==h[h.length-1]&&h.push(h[0]),u(h),h=[];break;case 1:t=s.findOrAddPoint(a[l],a[l+1]),l+=2,t!==h[h.length-1]&&h.push(t);break;default:console.warn("Path must be flattened before triangulating.")}}return u(h),o}function c(e){var t=u(e);return t&&t.triangulate(),t}function d(e){var t=new(0,Bimfish.Viewing.Extensions.CompGeom.DCEL)(e.bbox);return e._addToDCEL(t,1,!1),t.finalize(!0),t.closedAreas}function p(e,t,i){var n=Bimfish.Viewing.Extensions.CompGeom.DCEL;i||(i="AND");var o=new n(e.bbox.clone().union(t.bbox));e._addToDCEL(o,1),t._addToDCEL(o,2);var s=c(e),r=c(t);if(!s)return r;if(!r)return s;if(!s.contours.length)return"AND"===i?s:r;if(!r.contours.length)return"AND"===i?r:s;var a=s.polygon,l=r.polygon,h={pointInPolygon:function(){switch(i){case"AND":return function(e,t){return a.pointInPolygon(e,t)&&l.pointInPolygon(e,t)};case"XOR":return function(e,t){return a.quadTreeEdges.pointInPolygon(e,t)^l.quadTreeEdges.pointInPolygon(e,t)};case"OR":return function(e,t){return a.pointInPolygon(e,t)||l.pointInPolygon(e,t)};default:return}}()};return o.finalize(!0,h),o.closedAreas}r.prototype.isAABBContain=function(e){return this.isAABB()?h(this.bbox,e,this.precisionTolerance):4},r.prototype._addToDCEL=function(e,t,i){for(var n=this.segTypes,o=this.segData,s=0,r=0,a=0,l=0,h=0,u=0;u<n.length;u++){switch(n[u]){case 0:l===r&&h===a||e.addDirectedEdge(l,h,r,a,i,t),l=r=o[s++],h=a=o[s++];break;case 7:e.addDirectedEdge(l,h,r,a,i,t);break;case 1:var c=o[s++],d=o[s++];e.addDirectedEdge(l,h,c,d,i,t),l=c,h=d}}l===r&&h===a||e.addDirectedEdge(l,h,r,a,i,t)},r.prototype.cacheTriangulation=function(){var e;this.flattened=this.flatten(!0),this.isCached=!0,this.flattened.isCached=!0,(e=c(this.flattened))&&e.triangulationFailed&&(e=d(this.flattened));var t=e?e.polygon:null;this.polygon=[t],t&&(this.flattened.polygon=this.polygon)},r.prototype.clip=function(e,t){var i,n=this,o=n.bbox,s=!1,u=n.isAABB(),c=e.isAABB();if(c){var d=h(e.bbox,o,this.precisionTolerance);d===l?s=!0:d===a&&(i=n)}else if(u){var f=h(o,e.bbox,this.precisionTolerance);f===l?s=!0:f===a&&(i=e)}if(s)return console.warn("No overlap between nested clip regions."),null;if(i)return i;if(c&&u){var y=Math.max(n.bbox.min.x,e.bbox.min.x),v=Math.max(n.bbox.min.y,e.bbox.min.y),g=Math.min(n.bbox.max.x,e.bbox.max.x),m=Math.min(n.bbox.max.y,e.bbox.max.y),x=new r(this.precisionTolerance);return x.moveTo(y,v),x.lineTo(g,v),x.lineTo(g,m),x.lineTo(y,m),x.closePath(),x}if(!s&&!i){console.log("Complex clipped clip.");var b,S=p(e,n,"AND");if(!S)return console.warn("Complex clipped clip failed."),null;S&&(b=Array.isArray(S)?S.map((function(e){return e.polygon})):[S.polygon]);for(var E=new r(this.precisionTolerance),k=0;k<b.length;k++)for(var P=b[k],w=0;w<P.contours.length;w++){for(var T=P.contours[w],D=0;D<T.length;D++){var C=P.pts[T[D]].x,L=P.pts[T[D]].y;0!==D?E.lineTo(C,L):E.moveTo(C,L)}E.closePath()}return E}},r.prototype.fill=function(e,t,i,n,o,r,u){var f=this.flattened||this.flatten(!0);if(!(f.segTypes.length<3||3===f.segTypes.length&&7===f.segTypes[2]&&1===f.segTypes[1]&&0===f.segTypes[0])){var y;o&&(y=o.flattened||o.flatten(!0),o.flattened=y);var v,g,m,x=f.polygon,b=this.bbox;r&&(v=e.getCurrentTransform(),b=e.transformBox(b,v,s));var S=!1;if(y){if(y.isAABB()){var E=h(y.bbox,b,this.precisionTolerance);E===l?S=!0:E===a&&(x?m=f:(g=c(f)).triangulationFailed||(m=f))}else if(f.isAABB()){var k=h(b,y.bbox,this.precisionTolerance);k===l?S=!0:k===a&&(x?m=y:g=c(y),g&&!g.triangulationFailed&&(m=y))}S||m||(r&&y&&((f=f.flatten(!0)).applyTransform(e,v),r=!1,x=null),(g=p(y,f,"AND"))&&!g.triangulationFailed||(!0,g=function(e){var t=c(e);return t.triangulationFailed&&(t=d(e)),t}(f)))}else x||(g=c(f)),g&&g.triangulationFailed&&(g=d(f)),m=f;if(g&&(x=Array.isArray(g)?g.map((function(e){return e.polygon})):[g.polygon]),!S&&x){for(var P=0;P<x.length;P++){var w=x[P];if(w&&w.indices&&w.indices.length){for(var T=w.pts,D=[],C=0;C<T.length;C++){var L=T[C].x,M=T[C].y;r?D.push(e.tx(L,M,v),e.ty(L,M,v)):D.push(L,M)}e.addPolyTriangle(D,w.indices,t,i,n,!m)}}m&&!u&&m.stroke(e,-.5,t,i,n,null,r)}}}},"./extensions/PDF/test-pattern.js":
/*!****************************************!*\
  !*** ./extensions/PDF/test-pattern.js ***!
  \****************************************/
/*! exports provided: addContextCurrentTransform, generateTestPattern */function(e,t,i){"use strict";i.r(t),i.d(t,"addContextCurrentTransform",(function(){return o})),i.d(t,"generateTestPattern",(function(){return l}));var n=i(/*! ./bezier */"./extensions/PDF/bezier.js");function o(e){e.mozCurrentTransform||(e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[],Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){var e=this._transformMatrix,t=e[0],i=e[1],n=e[2],o=e[3],s=e[4],r=e[5],a=t*o-i*n,l=i*n-t*o;return[o/a,i/l,n/l,t/a,(o*s-n*r)/l,(i*s-t*r)/a]}}),e.save=function(){var e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){var e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){var i=this._transformMatrix;i[4]=i[0]*e+i[2]*t+i[4],i[5]=i[1]*e+i[3]*t+i[5],this._originalTranslate(e,t)},e.scale=function(e,t){var i=this._transformMatrix;i[0]=i[0]*e,i[1]=i[1]*e,i[2]=i[2]*t,i[3]=i[3]*t,this._originalScale(e,t)},e.transform=function(t,i,n,o,s,r){var a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*i,a[1]*t+a[3]*i,a[0]*n+a[2]*o,a[1]*n+a[3]*o,a[0]*s+a[2]*r+a[4],a[1]*s+a[3]*r+a[5]],e._originalTransform(t,i,n,o,s,r)},e.setTransform=function(t,i,n,o,s,r){this._transformMatrix=[t,i,n,o,s,r],e._originalSetTransform(t,i,n,o,s,r)},e.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),n=this._transformMatrix;this._transformMatrix=[n[0]*t+n[2]*i,n[1]*t+n[3]*i,n[0]*-i+n[2]*t,n[1]*-i+n[3]*t,n[4],n[5]],this._originalRotate(e)})}function s(e,t,i){var n=[];t=t||1;for(var o=i=i||0;o<360+i;o+=360/e){var s=o*Math.PI/180,r=t*Math.cos(s),a=t*Math.sin(s);n.push(r),n.push(a)}return n}function r(e,t,i,n,o,r){var a=s(n,o,r);e.beginPath(),e.moveTo(a[0]+t,a[1]+i);for(var l=2;l<a.length;l+=2)e.lineTo(a[l]+t,a[l+1]+i);e.closePath()}function a(e,t,i,n,o,r){var a=s(n,o,r);e.beginPath(),e.moveTo(a[0]+t,a[1]+i);for(var l=0,h=2,u=a.length/2;l<u;)e.lineTo(a[2*h]+t,a[2*h+1]+i),h+=2,h%=u,l++;e.closePath()}function l(e){Object(n.SetTesselationParams)(300,.005);var t=e.canvasContext;o(t),t.fillStyle="rgba(255, 255, 255, 1)";var i=e.viewport;e.beginPath(),e.moveTo(0,0),e.lineTo(i.width,0),e.lineTo(i.width,i.height),e.lineTo(0,i.height),e.closePath(),e.fill(),t.strokeStyle="rgba(0, 0, 0, 1)",t.fillStyle="rgba(3, 137, 255, 1)",r(e,120,50,5,30,90),e.fill(),e.stroke(),t.fillStyle="rgba(255, 95, 3, 1)",a(e,190,50,5,30,90),e.fill(),e.stroke(),t.fillStyle="rgba(255, 255, 0, 1)",r(e,240,350,7,30,0),e.fill(),e.stroke(),t.fillStyle="rgba(90, 255, 123, 1)",a(e,310,350,7,30,0),e.fill(),e.stroke(),t.fillStyle="rgba(66, 66, 66, 1)",t.save(),t.translate(50,150),t.scale(1,-1),e.fillText("The quick brown",0,0,800,{name:"Arial"},24),t.restore(),t.save(),t.translate(50,186),t.scale(1,-1),e.fillText("fox jumps",0,0,800,{name:"Courier"},72),t.restore(),t.save(),t.translate(50,350),t.scale(1,-1),t.rotate(13),e.fillText("over the lazy dog.",0,0,800,{name:"Times"},36),t.restore(),t.fillStyle="rgba(91, 167, 255, 1)",t.save(),r(e,150,450,5,30,90),e.fill(),e.stroke(),e.clip(),t.fillStyle="rgba(255, 167, 91, 1)",r(e,170,450,6,30,90),e.fill(),t.strokeStyle="rgba(255, 0, 0, 1)",e.stroke(),t.restore()}},"./node_modules/css-loader/index.js!./node_modules/sass-loader/dist/cjs.js!./extensions/Edit2D/Edit2D.css":
/*!*******************************************************************************************************!*\
  !*** ./node_modules/css-loader!./node_modules/sass-loader/dist/cjs.js!./extensions/Edit2D/Edit2D.css ***!
  \*******************************************************************************************************/
/*! no static exports found */function(e,t,i){(e.exports=i(/*! ../../node_modules/css-loader/lib/css-base.js */"./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,".adsk-viewing-viewer .edge-gizmo:hover {\n  background-color: lime; }\n\n.adsk-viewing-viewer .edge-gizmo {\n  position: absolute;\n  background-color: #009bff;\n  box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.25);\n  border-radius: 8px;\n  cursor: move;\n  z-index: 1;\n  /* Place above the viewer but below the measure labels, which are at 2 */\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }\n\n.adsk-viewing-viewer .edge-gizmo.selected {\n  background-color: lime; }\n\n.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover {\n  border-color: lime; }\n\n.adsk-viewing-viewer .vertex-gizmo {\n  display: inline-block;\n  position: absolute;\n  width: 7px;\n  height: 7px;\n  left: -2px;\n  top: -2px;\n  background-color: #009bff;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #FFFFFF;\n  border-radius: 100px;\n  box-shadow: 0 2px 5px 0 #182A3D;\n  z-index: 1;\n  /* Place above the viewer but below the measure labels, which are at 2 */\n  cursor: move; }\n\n.adsk-viewing-viewer .vertex-gizmo.selected {\n  border-color: lime; }\n\n.adsk-viewing-viewer .edge-move-gizmo {\n  width: 20px;\n  /* width along the edge */\n  height: 6px;\n  /* height vertical to the edge */ }\n",""])},"./node_modules/css-loader/lib/css-base.js":
/*!*************************************************!*\
  !*** ./node_modules/css-loader/lib/css-base.js ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),s=n.sources.map((function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}));return[i].concat(s).concat([o]).join("\n")}var r;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(n[s]=!0)}for(o=0;o<e.length;o++){var r=e[o];"number"==typeof r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),t.push(r))}},t}},"./node_modules/style-loader/lib/addStyles.js":
/*!****************************************************!*\
  !*** ./node_modules/style-loader/lib/addStyles.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,i){var n,o,s={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var n=a.call(this,e,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),h=null,u=0,c=[],d=i(/*! ./urls */"./node_modules/style-loader/lib/urls.js");function p(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=s[n.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](n.parts[r]);for(;r<n.parts.length;r++)o.parts.push(x(n.parts[r],t))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(x(n.parts[r],t));s[n.id]={id:n.id,refs:1,parts:a}}}}function f(e,t){for(var i=[],n={},o=0;o<e.length;o++){var s=e[o],r=t.base?s[0]+t.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function y(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),c.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,i);i.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return i.nc}();n&&(e.attrs.nonce=n)}return m(t,e.attrs),y(e,t),t}function m(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function x(e,t){var i,n,o,s;if(t.transform&&e.css){if(!(s="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=s}if(t.singleton){var r=u++;i=h||(h=g(t)),n=E.bind(null,i,r,!1),o=E.bind(null,i,r,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),y(e,t),t}(t),n=P.bind(null,i,t),o=function(){v(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),n=k.bind(null,i),o=function(){v(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=r()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=f(e,t);return p(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var r=i[o];(a=s[r.id]).refs--,n.push(a)}e&&p(f(e,t),t);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete s[a.id]}}}};var b,S=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function E(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=S(t,o);else{var s=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function k(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function P(e,t,i){var n=i.css,o=i.sourceMap,s=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||s)&&(n=d(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var r=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}},"./node_modules/style-loader/lib/urls.js":
/*!***********************************************!*\
  !*** ./node_modules/style-loader/lib/urls.js ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,s=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?e:(o=0===s.indexOf("//")?s:0===s.indexOf("/")?i+s:n+s.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}}});