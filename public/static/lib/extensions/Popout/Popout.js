/*!
 * LMV v7.9.0
 * 
 * Copyright 2019 Bimfish, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Bimfish, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Bimfish, Inc.
 * 
 * Bimfish Forge Viewer Usage Limitations:
 * 
 * The Bimfish Forge viewer can only be used to view files generated by
 * Bimfish Forge services. The Bimfish Forge Viewer JavaScript must be
 * delivered from an Bimfish hosted URL.
 */
Bimfish.Extensions.Popout=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./extensions/Popout/index.js")}({"./extensions/Popout/index.js":
/*!************************************!*\
  !*** ./extensions/Popout/index.js ***!
  \************************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var o=n(/*! ./thirdparty/popout */"./extensions/Popout/thirdparty/popout.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?c(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=Bimfish.Viewing,p=d.Private,h=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(this,t),(n=s(this,u(t).call(this,e,o)))._viewer=e,n._popoutInstance=null,n._viewerParentNode=null,n._onBeforeUnload=n._onBeforeUnload.bind(c(n)),n}var n,r,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),n=t,(r=[{key:"load",value:function(){return!0}},{key:"unload",value:function(){return!0}},{key:"popoutToChild",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.viewer,l=p.logger;if(e){var s=e.document.getElementById(t);s?i.container?this._isPoppedOut()?l.info("Already popped out"):(this._popoutInstance=new o.Popout({hidden:!1,onBeforeUnload:this._onBeforeUnload}),n&&this._popoutInstance.copyStyles(e),this._popoutInstance.setupChild(s,e,r),this._moveViewerTo(e,t)):l.error("Viewer is not part of DOM"):l.error("Invalid element ".concat(t))}else l.error("Invalid child")}},{key:"popoutToBlank",value:function(e,t,n,r){var i=this,l=this.viewer,s=p.logger;if(l.container)if(this._isPoppedOut())s.info("Already popped out");else{var u={options:e,hidden:!1,html:"<!DOCTYPE html><html><head></head><body></body></html>",onBeforeUnload:function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t&&t.apply(null,n),i._onBeforeUnload.apply(null,n)},onClose:n,onBlocked:r};this._popoutInstance=new o.Popout(u),this._popoutInstance.renderChildWindow(),this._popoutInstance.child&&!this._popoutInstance.child.closed&&this._moveViewerTo(this._popoutInstance.child,this._popoutInstance.container.id)}else s.error("Viewer is not part of DOM")}},{key:"popin",value:function(){this._popoutInstance&&this._popoutInstance.closeChildWindowIfOpened()}},{key:"_onBeforeUnload",value:function(){this._moveViewerBack(),this._popoutInstance=null}},{key:"_moveViewerTo",value:function(e,t){if(this._isPoppedOut())logger.info("Already popped out");else{var n=e.document.getElementById(t);n&&(this._viewerParentNode=this.viewer.container.parentNode,Object(o.resetImageBlobUrls)(this.viewer.container),n.appendChild(this.viewer.container),this.setWindow(e))}}},{key:"_moveViewerBack",value:function(){this._isPoppedOut()?(Object(o.resetImageBlobUrls)(this.viewer.container),this._viewerParentNode.appendChild(this.viewer.container),this.setWindow(d.getGlobal()),this.viewer.resize()):logger.info("Not popped out")}},{key:"_isPoppedOut",value:function(){return this.getWindow().opener===d.getGlobal()}}])&&l(n.prototype,r),h&&l(n,h),t}(d.Extension);d.theExtensionManager.registerExtension("Bimfish.Viewing.Popout",h)},"./extensions/Popout/thirdparty/popout.js":
/*!************************************************!*\
  !*** ./extensions/Popout/thirdparty/popout.js ***!
  \************************************************/
/*! exports provided: Popout, resetImageBlobUrls */function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"Popout",(function(){return p})),n.d(t,"resetImageBlobUrls",(function(){return h}));var l=Bimfish.Viewing.getGlobal();function s(e){var t={left:0,top:0,height:600,width:800,location:!1,menubar:!1,resizable:!1,scrollbars:!1,status:!1,toolbar:!1};return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(n,!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},e),Object.getOwnPropertyNames(t).map((function(e){return"".concat(e,"=").concat("boolean"==typeof(n=t[e])?n?"1":"0":n?String(n):void 0);var n})).join(",")}var u={id:"__$$VIEWER_POPOUT_COMPONENT$$__",set:function(e,t){l[this.id]=l[this.id]||{},l[this.id][e]=t},get:function(e){return l[this.id]&&l[this.id][e]}},c={},a={};function d(e){return e&&!e.closed}u.set("startMonitor",(function(e){a[e]=setTimeout((function t(){c[e]&&c[e].props.onClose&&(!c[e].child||c[e].child.closed?(!function(e){a[e]&&(clearTimeout(a[e]),delete a[e])}(e),c[e].props.onClose(),c[e].child=null):a[e]=setTimeout(t,250))}),250)})),u.set("dispose",(function(e){delete c[e]}));var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=null,this.setupAttempts=0,this.styleElement=null,this.child=null,this.props=t,this.styleCount=0}var t,n,r;return t=e,(n=[{key:"setupOnCloseHandler",value:function(e,t){var n,o=this;if(!(this.setupAttempts>=5))if(t&&t.document&&t.document.head){var r=t.document.createElement("script"),i="\n            window.onbeforeunload = function(e) {\n                var result = window.opener.".concat(u.id,".onBeforeUnload.call(window, '").concat(e,"', e);\n\n                if (result) {\n                    window.opener.").concat(u.id,".startMonitor.call(window.opener, '").concat(e,"');\n\n                    e.returnValue = result;\n                    return result;\n                } else {\n                    window.opener.").concat(u.id,".onChildClose.call(window.opener, '").concat(e,"');\n                }\n\n                // Added by LMV - free memory\n                window.opener.").concat(u.id,".dispose.call(window.opener, '").concat(e,"');\n            }");r.innerHTML="\n            window.onload = function(e) {\n                ".concat(i,"\n            };\n            "),n="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",(/Edge/.test(n)||/Trident/.test(n)||!this.props.url)&&(r.innerHTML=i),t.document.head.appendChild(r),this.setupCleanupCallbacks()}else this.setupAttempts++,setTimeout((function(){return o.setupOnCloseHandler(e,t)}),50)}},{key:"setupCleanupCallbacks",value:function(){var e=this;window.addEventListener("unload",(function(t){return e.closeChildWindowIfOpened()})),u.set("onChildClose",(function(e){c[e]&&c[e].props.onClose&&c[e].props.onClose()})),u.set("onBeforeUnload",(function(e,t){if(c[e]&&c[e].props.onBeforeUnload)return c[e].props.onBeforeUnload(t)}))}},{key:"setupStyleElement",value:function(e){this.styleElement=e.document.createElement("style"),this.styleElement.setAttribute("data-this-styles","true"),this.styleElement.type="text/css",e.document.head.appendChild(this.styleElement)}},{key:"injectHtml",value:function(e,t){var n;if(this.props.html)t.document.write(this.props.html),this.copyStyles(t),(n=t.document.getElementById(e))||((n=t.document.createElement("div")).id=e,t.document.body.appendChild(n));else{for(var o="<!DOCTYPE html><html><head>",r=window.document.styleSheets.length-1;r>=0;r--){var i=window.document.styleSheets[r];try{var l=i.cssText;o+="<style>".concat(l,"</style>")}catch(e){}}o+='</head><body><div id="'.concat(e,'"></div></body></html>'),t.document.write(o),n=t.document.getElementById(e)/*! as HTMLDivElement*/}return this.setupStyleElement(t),n}},{key:"copyStyles",value:function(e){for(var t=e.document.head,n="",o=null,r=l.document.styleSheets.length-1;r>=0;r--){var i=l.document.styleSheets[r];try{o=i.cssRules}catch(n){var s=e.document.createElement("link");s.type=i.type,s.rel="stylesheet",s.href=i.href,t.appendChild(s)}finally{if(o)for(var u=0;u<o.length;u++)try{n+=o[u].cssText}catch(e){}}o=null}var c=e.document.createElement("style");c.innerHTML=n,t.appendChild(c)}},{key:"setupStyleObserver",value:function(e){new MutationObserver((function(t){t.forEach((function(t){"childList"==t.type&&function(e,t,n){for(var o,r=0;r<e.length;r++)"STYLE"==(o=e[r]).tagName&&t.call(n,o,r)}(t.addedNodes,(function(t){e.document.head.appendChild(function(e,t){var n=t.createElement(e.tagName);if(n.innerHTML=e.innerHTML,e.hasAttributes())for(var o,r=0;r<e.attributes.length;r++)o=e.attributes[r],n.setAttribute(o.name,o.value);return n}(t,e.document))}))}))})).observe(document.head,{childList:!0})}},{key:"initializeChildWindow",value:function(e,t){if(c[e]=this,this.props.url)return this.setupOnCloseHandler(e,t),null;var n=this.injectHtml(e,t);return this.setupStyleObserver(t),this.setupOnCloseHandler(e,t),n}},{key:"setupChild",value:function(e,t,n){this.child=t,this.container=e,c[e.id]=this,n&&this.setupStyleObserver(t),this.setupOnCloseHandler(e.id,t)}},{key:"openChildWindow",value:function(){var e,t=s(this.props.options||{}),n=function(e){return e||Math.random().toString(12).slice(2)}(this.props.name);if(this.child=!(e=window.open(this.props.url||"about:blank",n,t))||e.closed||void 0===e||void 0===e.closed?null:e,this.child){var o="__".concat(n,"_container__");this.container=this.initializeChildWindow(o,this.child)}else this.props.onBlocked&&this.props.onBlocked(),this.container=null}},{key:"closeChildWindowIfOpened",value:function(){d(this.child)&&(this.child.close(),this.child.close(),this.child=null,this.props.onClose&&this.props.onClose())}},{key:"renderChildWindow",value:function(){!function(e){if(e){var t=document.createElement("a");t.href=e;var n=l.location;if(t.hostname&&n.hostname!=t.hostname||t.protocol&&n.protocol!=t.protocol)throw new Error("react-popup-component error: cross origin URLs are not supported (window=".concat(n.protocol,"//").concat(n.hostname,"; popout=").concat(t.protocol,"//").concat(t.hostname,")"))}}(this.props.url),this.props.hidden?this.closeChildWindowIfOpened():d(this.child)||this.openChildWindow()}}])&&o(t.prototype,n),r&&o(t,r),e}();function h(e){for(var t=e.querySelectorAll("img"),n=function(e){var n=t[e];if(0!==n.src.indexOf("blob:"))return"continue";n.onload=function(){URL.revokeObjectURL(n.src)},function(e){var t=e.ownerDocument.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}(n).toBlob((function(e){var t=URL.createObjectURL(e);n.src=t}),"image/png"),n.src=""},o=0;o<t.length;++o)n(o)}}});