/*!
 * LMV v7.9.0
 * 
 * Copyright 2019 Bimfish, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Bimfish, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Bimfish, Inc.
 * 
 * Bimfish Forge Viewer Usage Limitations:
 * 
 * The Bimfish Forge viewer can only be used to view files generated by
 * Bimfish Forge services. The Bimfish Forge Viewer JavaScript must be
 * delivered from an Bimfish hosted URL.
 */
Bimfish.Extensions.Markup=function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="./extensions/Markup/Markup.js")}({"./extensions/Markup/Markup.js":
/*!*************************************!*\
  !*** ./extensions/Markup/Markup.js ***!
  \*************************************/
/*! exports provided: Core, Gui */function(t,e,i){"use strict";i.r(e),i.d(e,"Core",(function(){return Ct})),i.d(e,"Gui",(function(){return Dt}));var n=i(/*! ./core/MarkupsCore */"./extensions/Markup/core/MarkupsCore.js"),s=i(/*! ./gui/MarkupsGui */"./extensions/Markup/gui/MarkupsGui.js"),o=i(/*! ./core/edit-clipboard/Clipboard */"./extensions/Markup/core/edit-clipboard/Clipboard.js"),r=i(/*! ./core/edit-actions/CloneMarkup */"./extensions/Markup/core/edit-actions/CloneMarkup.js"),a=i(/*! ./core/edit-actions/CreateArrow */"./extensions/Markup/core/edit-actions/CreateArrow.js"),h=i(/*! ./core/edit-actions/CreateCallout */"./extensions/Markup/core/edit-actions/CreateCallout.js"),u=i(/*! ./core/edit-actions/CreateCircle */"./extensions/Markup/core/edit-actions/CreateCircle.js"),l=i(/*! ./core/edit-actions/CreateCloud */"./extensions/Markup/core/edit-actions/CreateCloud.js"),c=i(/*! ./core/edit-actions/CreateDimension */"./extensions/Markup/core/edit-actions/CreateDimension.js"),d=i(/*! ./core/edit-actions/CreateFreehand */"./extensions/Markup/core/edit-actions/CreateFreehand.js"),p=i(/*! ./core/edit-actions/CreateHighlight */"./extensions/Markup/core/edit-actions/CreateHighlight.js"),f=i(/*! ./core/edit-actions/CreatePolycloud */"./extensions/Markup/core/edit-actions/CreatePolycloud.js"),y=i(/*! ./core/edit-actions/CreatePolyline */"./extensions/Markup/core/edit-actions/CreatePolyline.js"),g=i(/*! ./core/edit-actions/CreateRectangle */"./extensions/Markup/core/edit-actions/CreateRectangle.js"),v=i(/*! ./core/edit-actions/CreateText */"./extensions/Markup/core/edit-actions/CreateText.js"),m=i(/*! ./core/edit-actions/DeleteArrow */"./extensions/Markup/core/edit-actions/DeleteArrow.js"),M=i(/*! ./core/edit-actions/DeleteCallout */"./extensions/Markup/core/edit-actions/DeleteCallout.js"),x=i(/*! ./core/edit-actions/DeleteCircle */"./extensions/Markup/core/edit-actions/DeleteCircle.js"),E=i(/*! ./core/edit-actions/DeleteCloud */"./extensions/Markup/core/edit-actions/DeleteCloud.js"),k=i(/*! ./core/edit-actions/DeleteDimension */"./extensions/Markup/core/edit-actions/DeleteDimension.js"),b=i(/*! ./core/edit-actions/DeleteFreehand */"./extensions/Markup/core/edit-actions/DeleteFreehand.js"),T=i(/*! ./core/edit-actions/DeleteHighlight */"./extensions/Markup/core/edit-actions/DeleteHighlight.js"),w=i(/*! ./core/edit-actions/DeletePolycloud */"./extensions/Markup/core/edit-actions/DeletePolycloud.js"),S=i(/*! ./core/edit-actions/DeletePolyline */"./extensions/Markup/core/edit-actions/DeletePolyline.js"),C=i(/*! ./core/edit-actions/DeleteRectangle */"./extensions/Markup/core/edit-actions/DeleteRectangle.js"),A=i(/*! ./core/edit-actions/DeleteText */"./extensions/Markup/core/edit-actions/DeleteText.js"),P=i(/*! ./core/edit-actions/EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),j=i(/*! ./core/edit-actions/EditActionGroup */"./extensions/Markup/core/edit-actions/EditActionGroup.js"),D=i(/*! ./core/edit-actions/EditActionManager */"./extensions/Markup/core/edit-actions/EditActionManager.js"),I=i(/*! ./core/EditFrame */"./extensions/Markup/core/EditFrame.js"),R=i(/*! ./core/edit-modes/EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),O=i(/*! ./core/edit-modes/EditModeArrow */"./extensions/Markup/core/edit-modes/EditModeArrow.js"),_=i(/*! ./core/edit-modes/EditModeCallout */"./extensions/Markup/core/edit-modes/EditModeCallout.js"),N=i(/*! ./core/edit-modes/EditModeCircle */"./extensions/Markup/core/edit-modes/EditModeCircle.js"),B=i(/*! ./core/edit-modes/EditModeCloud */"./extensions/Markup/core/edit-modes/EditModeCloud.js"),z=i(/*! ./core/edit-modes/EditModeDimension */"./extensions/Markup/core/edit-modes/EditModeDimension.js"),H=i(/*! ./core/edit-modes/EditModeFreehand */"./extensions/Markup/core/edit-modes/EditModeFreehand.js"),L=i(/*! ./core/edit-modes/EditModeHighlight */"./extensions/Markup/core/edit-modes/EditModeHighlight.js"),V=i(/*! ./core/edit-modes/EditModePen */"./extensions/Markup/core/edit-modes/EditModePen.js"),F=i(/*! ./core/edit-modes/EditModePolycloud */"./extensions/Markup/core/edit-modes/EditModePolycloud.js"),U=i(/*! ./core/edit-modes/EditModePolyline */"./extensions/Markup/core/edit-modes/EditModePolyline.js"),G=i(/*! ./core/edit-modes/EditModeRectangle */"./extensions/Markup/core/edit-modes/EditModeRectangle.js"),Y=i(/*! ./core/edit-modes/EditModeText */"./extensions/Markup/core/edit-modes/EditModeText.js"),W=i(/*! ./core/edit-modes/EditorTextInput */"./extensions/Markup/core/edit-modes/EditorTextInput.js"),K=i(/*! ./core/Markup */"./extensions/Markup/core/Markup.js"),X=i(/*! ./core/MarkupArrow */"./extensions/Markup/core/MarkupArrow.js"),q=i(/*! ./core/MarkupCallout */"./extensions/Markup/core/MarkupCallout.js"),$=i(/*! ./core/MarkupCircle */"./extensions/Markup/core/MarkupCircle.js"),Z=i(/*! ./core/MarkupCloud */"./extensions/Markup/core/MarkupCloud.js"),J=i(/*! ./core/MarkupDimension */"./extensions/Markup/core/MarkupDimension.js"),Q=i(/*! ./core/MarkupFreehand */"./extensions/Markup/core/MarkupFreehand.js"),tt=i(/*! ./core/MarkupHighlight */"./extensions/Markup/core/MarkupHighlight.js"),et=i(/*! ./core/MarkupPen */"./extensions/Markup/core/MarkupPen.js"),it=i(/*! ./core/MarkupPolycloud */"./extensions/Markup/core/MarkupPolycloud.js"),nt=i(/*! ./core/MarkupPolyLine */"./extensions/Markup/core/MarkupPolyLine.js"),st=i(/*! ./core/MarkupRectangle */"./extensions/Markup/core/MarkupRectangle.js"),ot=i(/*! ./core/MarkupText */"./extensions/Markup/core/MarkupText.js"),rt=i(/*! ./core/MarkupTool */"./extensions/Markup/core/MarkupTool.js"),at=i(/*! ./core/edit-actions/SetArrow */"./extensions/Markup/core/edit-actions/SetArrow.js"),ht=i(/*! ./core/edit-actions/SetCallout */"./extensions/Markup/core/edit-actions/SetCallout.js"),ut=i(/*! ./core/edit-actions/SetCircle */"./extensions/Markup/core/edit-actions/SetCircle.js"),lt=i(/*! ./core/edit-actions/SetCloud */"./extensions/Markup/core/edit-actions/SetCloud.js"),ct=i(/*! ./core/edit-actions/SetDimension */"./extensions/Markup/core/edit-actions/SetDimension.js"),dt=i(/*! ./core/edit-actions/SetFreehand */"./extensions/Markup/core/edit-actions/SetFreehand.js"),pt=i(/*! ./core/edit-actions/SetHighlight */"./extensions/Markup/core/edit-actions/SetHighlight.js"),ft=i(/*! ./core/edit-actions/SetPolycloud */"./extensions/Markup/core/edit-actions/SetPolycloud.js"),yt=i(/*! ./core/edit-actions/SetPolyline */"./extensions/Markup/core/edit-actions/SetPolyline.js"),gt=i(/*! ./core/edit-actions/SetPosition */"./extensions/Markup/core/edit-actions/SetPosition.js"),vt=i(/*! ./core/edit-actions/SetRectangle */"./extensions/Markup/core/edit-actions/SetRectangle.js"),mt=i(/*! ./core/edit-actions/SetRotation */"./extensions/Markup/core/edit-actions/SetRotation.js"),Mt=i(/*! ./core/edit-actions/SetSize */"./extensions/Markup/core/edit-actions/SetSize.js"),xt=i(/*! ./core/edit-actions/SetStyle */"./extensions/Markup/core/edit-actions/SetStyle.js"),Et=i(/*! ./core/edit-actions/SetText */"./extensions/Markup/core/edit-actions/SetText.js"),kt=i(/*! ./core/MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),bt=i(/*! ./core/MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),Tt=i(/*! ./core/MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),wt=i(/*! ./core/StyleUtils */"./extensions/Markup/core/StyleUtils.js"),St=i(/*! ./core/EditModeManager */"./extensions/Markup/core/EditModeManager.js"),Ct={Clipboard:o.Clipboard,CloneMarkup:r.CloneMarkup,CreateArrow:a.CreateArrow,CreateCallout:h.CreateCallout,CreateCircle:u.CreateCircle,CreateCloud:l.CreateCloud,CreateDimension:c.CreateDimension,CreateFreehand:d.CreateFreehand,CreateHighlight:p.CreateHighlight,CreatePolycloud:f.CreatePolycloud,CreatePolyline:y.CreatePolyline,CreateRectangle:g.CreateRectangle,CreateText:v.CreateText,DeleteArrow:m.DeleteArrow,DeleteCallout:M.DeleteCallout,DeleteCircle:x.DeleteCircle,DeleteCloud:E.DeleteCloud,DeleteDimension:k.DeleteDimension,DeleteFreehand:b.DeleteFreehand,DeleteHighlight:T.DeleteHighlight,DeletePolycloud:w.DeletePolycloud,DeletePolyline:S.DeletePolyline,DeleteRectangle:C.DeleteRectangle,DeleteText:A.DeleteText,EditAction:P.EditAction,EditActionGroup:j.EditActionGroup,EditActionManager:D.EditActionManager,EditFrame:I.EditFrame,EditMode:R.EditMode,EditModeArrow:O.EditModeArrow,EditModeCallout:_.EditModeCallout,EditModeCircle:N.EditModeCircle,EditModeCloud:B.EditModeCloud,EditModeDimension:z.EditModeDimension,EditModeFreehand:H.EditModeFreehand,EditModeHighlight:L.EditModeHighlight,EditModePen:V.EditModePen,EditModePolycloud:F.EditModePolycloud,EditModePolyline:U.EditModePolyline,EditModeRectangle:G.EditModeRectangle,EditModeText:Y.EditModeText,EditorTextInput:W.EditorTextInput,Markup:K.Markup,MarkupArrow:X.MarkupArrow,MarkupCallout:q.MarkupCallout,MarkupCircle:$.MarkupCircle,MarkupCloud:Z.MarkupCloud,MarkupDimension:J.MarkupDimension,MarkupFreehand:Q.MarkupFreehand,MarkupHighlight:tt.MarkupHighlight,MarkupPen:et.MarkupPen,MarkupPolycloud:it.MarkupPolycloud,MarkupPolyline:nt.MarkupPolyline,MarkupRectangle:st.MarkupRectangle,MarkupText:ot.MarkupText,MarkupTool:rt.MarkupTool,MarkupsCore:n.MarkupsCore,SetArrow:at.SetArrow,SetCallout:ht.SetCallout,SetCircle:ut.SetCircle,SetCloud:lt.SetCloud,SetDimension:ct.SetDimension,SetFreehand:dt.SetFreehand,SetHighlight:pt.SetHighlight,SetPolycloud:ft.SetPolycloud,SetPolyline:yt.SetPolyline,SetPosition:gt.SetPosition,SetRectangle:vt.SetRectangle,SetRotation:mt.SetRotation,SetSize:Mt.SetSize,SetStyle:xt.SetStyle,SetText:Et.SetText,MarkupEvents:kt,MarkupTypes:bt,theEditModeManager:St.theEditModeManager,Utils:Tt};for(var At in bt)Ct[At]=bt[At];for(var Pt in kt)Ct[Pt]=kt[Pt];for(var jt in wt){if(jt in Ct.Utils)throw new Error("Property ".concat(jt," from StyleUtils already present in MarkupsCoreUtils."));Ct.Utils[jt]=wt[jt]}var Dt={MarkupsGui:s.MarkupsGui};Bimfish.Viewing.Extensions.Markups={Core:Ct}},"./extensions/Markup/core/DomElementStyle.js":
/*!***************************************************!*\
  !*** ./extensions/Markup/core/DomElementStyle.js ***!
  \***************************************************/
/*! exports provided: DomElementStyle */function(t,e,i){"use strict";function n(){this.reset()}i.r(e),i.d(e,"DomElementStyle",(function(){return n}));var s=["-ms-","-webkit-","-moz-","-o-"],o=n.prototype;o.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},o.setAttribute=function(t,e,i){if(this.attributes[t]=e,i&&i.allBrowsers){var n=this;s.forEach((function(i){n.attributes[i+t]=e}))}return this.dirty=!0,this},o.removeAttribute=function(t){Array.isArray(t)||(t=[t]);var e=this;return t.forEach((function(t){t in e.attributes&&(delete e.attributes[t],e.dirty=!0)})),this},o.getStyleString=function(){return this.dirty&&(this.styleString=function(t){var e=[];for(var i in t){var n=t[i];e.push(i),e.push(":"),e.push(n),e.push("; ")}return e.join("")}(this.attributes),this.dirty=!1),this.styleString},o.clone=function(){var t=new n,e=this.attributes;for(var i in e)t.setAttribute(i,e[i]);return t}},"./extensions/Markup/core/EditFrame.js":
/*!*********************************************!*\
  !*** ./extensions/Markup/core/EditFrame.js ***!
  \*********************************************/
/*! exports provided: EditFrame */function(t,e,i){"use strict";i.r(e),i.d(e,"EditFrame",(function(){return c}));var n=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),s=i(/*! ./MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),o=i(/*! ./edit-actions/CloneMarkup */"./extensions/Markup/core/edit-actions/CloneMarkup.js"),r=i(/*! ./edit-actions/SetPosition */"./extensions/Markup/core/edit-actions/SetPosition.js"),a=i(/*! ./edit-actions/SetSize */"./extensions/Markup/core/edit-actions/SetSize.js"),h=i(/*! ./edit-actions/SetRotation */"./extensions/Markup/core/edit-actions/SetRotation.js"),u=Bimfish.Viewing,l=Bimfish.Viewing.Private;function c(t,e){this.containingDiv=t,this.editor=e,this.setGlobalManager(this.editor.viewer.globalManager),this.selectionLayer=f.bind(this)(),this.frameMargin=n.EDIT_FRAME_DEFAULT_MARGIN,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},k.bind(this)(),Object(n.isTouchDevice)()&&(this.hammer=new u.Hammer.Manager(this.selectionLayer,{recognizers:[u.GestureRecognizers.drag,u.GestureRecognizers.doubletap,u.GestureRecognizers.doubletap2,u.GestureRecognizers.pan,u.GestureRecognizers.pinch],handlePointerEventMouse:!1,inputClass:u.isIE11?u.Hammer.PointerEventInput:u.Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.onTouchPanBinded=this.onTouchPan.bind(this),this.onTouchPinchBinded=this.onTouchPinch.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded),this.hammer.on("panstart panmove panend",this.onTouchPanBinded),this.hammer.on("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.get("drag").requireFailure("pinch"),this.hammer.get("drag").requireFailure("pan")),S.bind(this)(),D.bind(this)(),R.bind(this)(),I.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),Object(n.addTraitEventDispatcher)(this)}u.GlobalManagerMixin.call(c.prototype);var d=c.prototype;function p(t){t.pageX=t.pointers[0].clientX,t.pageY=t.pointers[0].clientY}function f(){var t=this.getDocument().createElement("div");return t.style.position="absolute",t.style.top=0,t.style.bottom=0,t.style.left=0,t.style.right=0,t.style.overflow="hidden",t.style.visibility="hidden",O(t,!1),t}function y(t){var e=this.getDocument().createElement("div");return m(e,t),e.className="selector-drag-point Bimfish-markups-extension-core-make-me-bigger sdp-handle-"+t,e.classList.add("adsk-viewing-viewer"),e.setAttribute("data-sdp-handle",t),e}function g(){var t=this.getDocument().createElement("div");return t.classList.add("adsk-viewing-viewer"),t.classList.add("selector-rotate-point"),t.classList.add("Bimfish-markups-extension-core-make-me-bigger"),m(t,"w"),t}function v(){var t=this.getDocument().createElement("div");return t.classList.add("adsk-viewing-viewer"),t.classList.add("selector-rotate-point"),t.classList.add("Bimfish-markups-extension-core-make-me-bigger"),t.classList.add("rotation-bridge"),m(t,"w"),t}function m(t,e){var i;switch(e){case"n":case"s":i="ns-resize";break;case"w":case"e":i="ew-resize";break;case"ne":case"sw":i="nesw-resize";break;case"nw":case"se":i="nwse-resize"}t.style.cursor=i}function M(t){["n","s","w","e","nw","ne","sw","se"].forEach(function(e){this.selection.handle[e]=y.call(this,e),t.appendChild(this.selection.handle[e])}.bind(this))}function x(t){return N(t,".selector-drag-point")}function E(t){return N(t,".selector-rotate-point")}function k(){var t=this.getDocument().createElement("div");return O(t,!0),t.classList.add("selector-box"),this.selection.rotationBridge=v.bind(this)(),t.appendChild(this.selection.rotationBridge),this.selection.rotationHandle=g.bind(this)(),t.appendChild(this.selection.rotationHandle),M.bind(this)(t),this.selection.element=t,u.isMobileDevice()||(this.onWheelBinded=this.onWheel.bind(this),this.selection.element.addEventListener("wheel",this.onWheelBinded),this.selection.element.addEventListener("DOMMouseScroll",this.onWheelBinded)),this.selectionLayer.appendChild(this.selection.element),b.bind(this)(!1),t}function b(t){this.selection.active=t,this.selection.element.style.display=t?"block":"none"}function T(t,e,i){this.selection.x=t,this.selection.y=e,this.selection.rotation=i;var n=this.markup.getBoundingRect();n.width+=2*this.frameMargin,n.height+=2*this.frameMargin;var s=function(t,e){return"translate3d("+t+"px,"+e+"px,0)"}(t,e)+" rotate("+i+"rad)",o=n.width/2+"px "+n.height/2+"px";this.selection.element.style.msTransform=this.selection.element.style.webkitTransform=this.selection.element.style.transform=s,this.selection.element.style.msTransformOrigin=this.selection.element.style.webkitTransformOrigin=this.selection.element.style.transformOrigin=o}function w(t,e){this.selection.width=t,this.selection.height=e,this.selection.element.style.width=t+"px",this.selection.element.style.height=e+"px"}function S(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}d.unload=function(){this.containingDiv.removeChild(this.selectionLayer),this.selectionLayer=null},d.setSelection=function(t,e,i,n,s){var o=this.frameMargin,r=2*o;w.bind(this)(i+r,n+r),T.bind(this)(t-o,e-o,s),b.bind(this)(!0),this.selectionLayer.style.visibility="visible"},d.setMarkup=function(t){if(this.hammer&&this.hammer.set({enable:null!==t}),this.markup=t,b.bind(this)(!1),t){var e=t.getBoundingRect(),i=t.getRotation();this.frameMargin=void 0!==e.margin?e.margin:n.EDIT_FRAME_DEFAULT_MARGIN,this.setSelection(e.x,e.y,e.width,e.height,i),this.enableResizeHandles(),this.enableRotationHandle(),t.preventReposition?this.selectionLayer.firstChild.style.cursor="":this.selectionLayer.firstChild.style.cursor="move"}},d.startDrag=function(t){this.markup&&this.markup.preventReposition||(this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(t,this.editor.getMousePosition()))},d.isActive=function(){return this.selection.active},d.isDragging=function(){return this.selection.dragging},d.isResizing=function(){return this.selection.resizing},d.isRotating=function(){return this.selection.rotating},d.onMouseMove=function(t){},d.onMouseUp=function(t){},d.onWheel=function(t){this.editor.viewer.toolController.mousewheel(t)},d.onTouchPan=function(t){this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),t.preventDefault()},d.onTouchPinch=function(t){this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),t.preventDefault()},d.onHammerDrag=function(t){function e(t,e,i){var n=e.getBoundingClientRect();t.mousePosition.x=i.pageX-n.left,t.mousePosition.y=i.pageY-n.top}switch(p(t),t.type){case"dragstart":e(this.editor.input,this.editor.svg,t),this.editor.callSnapperMouseDown(),E(t.target)?this._onRotationMouseDown(t):x(t.target)?this._onResizeMouseDown(t):this.startDrag(t),t.preventDefault();break;case"dragmove":e(this.editor.input,this.editor.svg,t),this.editor.callSnapperMouseMove(),this.onMouseMove(t),t.preventDefault();break;case"dragend":e(this.editor.input,this.editor.svg,t),this.onMouseUp(t),t.preventDefault()}},d.onHammerDoubleTap=function(t){p(t),function(t,e,i){var n=e.getBoundingClientRect();t.mousePosition.x=i.pageX-n.left,t.mousePosition.y=i.pageY-n.top}(this.editor.input,this.editor.svg,t),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},d.enableResizeHandles=function(){var t,e=this.markup;if(e.isHeightConstrained()||e.isWidthConstrained()){for(var i in this.selection.handle)(t=this.selection.handle[i])&&(t.style.display="none");e.isHeightConstrained()||(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block"),e.isWidthConstrained()||(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block")}else for(var i in this.selection.handle)(t=this.selection.handle[i])&&(t.style.display="block")},d.enableRotationHandle=function(){var t=this.markup.isRotationConstrained()?"none":"block";this.selection.rotationHandle.style.display=t,this.selection.rotationBridge.style.display=t},d._handleRightClickDown=function(t){return!(u.isMobileDevice()||!l.isRightClick(t,this.editor.viewer.navigation)&&!l.isMiddleClick(t))&&(this.editor.input.onMouseDownRightClick(t),!0)};var C,A,P=!1;function j(t,e){e?t.classList.add("selected"):t.classList.remove("selected")}function D(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function I(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function R(){var t=function(t){if(!t.defaultPrevented){this.selection.dragging=!1;var e=this.editor.editMode;e&&e.onMouseDoubleClick(this.markup)}}.bind(this);this.selectionLayer.addEventListener("dblclick",t)}function O(t,e){t.style.pointerEvents=e?"auto":"none"}function _(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function N(t,e){return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.mozMatchesSelector?t.mozMatchesSelector(e):!!t.webkitMatchesSelector&&t.webkitMatchesSelector(e)}d._onRepositionMouseDown=function(t,e){if(!(this._handleRightClickDown(t)||this.markup&&this.markup.preventReposition)){P=!u.isMobileDevice()&&u.isTouchDevice();var i=!(t instanceof this.getWindow().MouseEvent);if((i||!x(t.target)&&!E(t.target))&&(e=i?e:this.editor.getMousePosition(),this.initialCursor=e,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),t&&t.altKey){var n=this.editor;new o.CloneMarkup(n,n.getId(),this.markup,this.markup.position).execute()}this.dispatchEvent({type:s.EVENT_EDITFRAME_EDITION_START})}}},d._onRepositionMouseMove=function(t){if(P)P=!1;else if(this.selection.dragging&&this.markup&&!this.markup.preventReposition){var e=this.editor.getMousePosition(),i=this.editor.input.constrainAxis;this.areAxisConstrained!==i&&(this.areAxisConstrained=i,this.axisConstrains=i?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=e.x-this.initialCursor.x,this.initialPosition.y+=e.y-this.initialCursor.y,this.initialCursor.x=e.x,this.initialCursor.y=e.y);var n={x:e.x-this.initialCursor.x,y:e.y-this.initialCursor.y};0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(n.x)>15?(this.axisConstrains.x=1,n.x+=n.x<0?15:-15):Math.abs(n.y)>15&&(this.axisConstrains.y=1,n.y+=n.y<0?15:-15));var s=this.initialPosition.x+n.x*this.axisConstrains.x,o=this.initialPosition.y+n.y*this.axisConstrains.y;T.bind(this)(s,o,this.selection.rotation);var a=this.editor.positionFromClientToMarkups(s,o);new r.SetPosition(this.editor,this.markup,a).execute()}},d._onRepositionMouseUp=function(){this.markup&&this.markup.preventReposition||(this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.dispatchEvent({type:s.EVENT_EDITFRAME_EDITION_END})))},d._onResizeMouseDown=function(t){if(!this._handleRightClickDown(t)){var e=t.target;if(x(e)){this.selection.handle.resizing=e;var i=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=i+"-resize";var n=this.editor.getMousePosition(),o=this.markup.getClientPosition(),r=this.markup.getBoundingRect();this.initial={x:o.x,y:o.y,width:r.width,height:r.height,mouseX:n.x,mouseY:n.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),j(t.target,!0),this.dispatchEvent({type:s.EVENT_EDITFRAME_EDITION_START}))}}},d._onResizeMouseMove=function(t){if(this.selection.resizing){var e=this.editor.getMousePosition(),i=this.initial,n={x:e.x-i.mouseX,y:e.y-i.mouseY},s=new THREE.Vector3(n.x,n.y,0),o=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);n=s.applyMatrix4(o);var r=i.x,h=i.y,u=i.width,l=i.height,c=new THREE.Vector3,d=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&-1!==["nw","ne","sw","se"].indexOf(d)){var p=new THREE.Vector3(n.x,n.y,0);switch(d){case"nw":n.set(-i.width,-i.height,0);break;case"ne":case"sw":n.set(i.width,-i.height,0);break;case"se":n.set(i.width,i.height,0)}n.normalize(),n=p.projectOnVector(n)}if({n:function(){l-=n.y,c.y=n.y},s:function(){l+=n.y,c.y=n.y},w:function(){u-=n.x,c.x=n.x},e:function(){u+=n.x,c.x=n.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}}[d](),!(u<=this.markup.getMinWidth()||l<=this.markup.getMinHeight())){var f=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),y=c.applyMatrix4(f),g=this.editor.positionFromClientToMarkups(r+.5*y.x,h+.5*y.y),v=this.editor.sizeFromClientToMarkups(u,l);new a.SetSize(this.editor,this.markup,g,v.x,v.y).execute()}}},d._onResizeMouseUp=function(t){for(var e in this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.selection.handle)this.selection.handle[e]&&j(this.selection.handle[e],!1);this.editor.closeActionGroup(),this.dispatchEvent({type:s.EVENT_EDITFRAME_EDITION_END}),this.onMouseMove=function(){},this.onMouseUp=function(){}},d._onRotationMouseDown=function(t){this._handleRightClickDown(t)||E(t.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,A=this.editor.getMousePosition(),C=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),j(t.target,!0),this.dispatchEvent({type:s.EVENT_EDITFRAME_EDITION_START}))},d._onRotationMouseMove=function(t){if(this.selection.rotating){var e=this.editor.getMousePosition(),i=this.markup.getClientPosition(),s=_(i,e)-_(i,A)+C;if(this.editor.input.snapRotations){var o=Object(n.degreesToRadians)(22.5);s=Math.ceil(s/o)*o}T.bind(this)(this.selection.x,this.selection.y,s),new h.SetRotation(this.editor,this.markup,s).execute()}},d._onRotationMouseUp=function(t){this.selection.rotating=!1,C=null,A=null,j(this.selection.rotationHandle,!1),this.editor.closeActionGroup(),this.dispatchEvent({type:s.EVENT_EDITFRAME_EDITION_END})}},"./extensions/Markup/core/EditModeManager.js":
/*!***************************************************!*\
  !*** ./extensions/Markup/core/EditModeManager.js ***!
  \***************************************************/
/*! exports provided: theEditModeManager */function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.r(e),i.d(e,"theEditModeManager",(function(){return o}));var s={},o=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,o;return e=t,(i=[{key:"register",value:function(t,e){if(t in s)throw new Error("EditMode with id (".concat(t,") already registered."));s[t]=e}},{key:"unregister",value:function(t){t in s&&delete s[t]}},{key:"getClass",value:function(t){return s[t]||null}},{key:"getRegistered",value:function(){var t={};for(var e in s)s.hasOwnProperty(e)&&(t[e]=s[e]);return t}}])&&n(e.prototype,i),o&&n(e,o),t}())},"./extensions/Markup/core/Markup.js":
/*!******************************************!*\
  !*** ./extensions/Markup/core/Markup.js ***!
  \******************************************/
/*! exports provided: Markup */function(t,e,i){"use strict";i.r(e),i.d(e,"Markup",(function(){return a}));var n=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),s=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),o=i(/*! ./MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),r=Bimfish.Viewing;function a(t,e,i){this.id=t,this.type="",this.editor=e,this.viewer=e.viewer,this.setGlobalManager(this.viewer.globalManager),this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=Object(s.createStyle)(i,this.editor),this.style=Object(s.copyStyle)(e.getDefaultStyle(),this.style),this.highlightColor="#0696D7",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.minWidth=-1e4,this.minHeight=-1e4,this.highlighted=!1,this.selected=!1,this.checkLineSegment=n.checkLineSegment.bind(this),this.checkPolygon=n.checkPolygon.bind(this),this.renderToCanvasX=n.renderToCanvas.bind(this),Object(n.addTraitEventDispatcher)(this)}r.GlobalManagerMixin.call(a.prototype);var h=a.prototype;h.destroy=function(){this.unselect(),this.setParent(null)},h.setParent=function(t){var e=this.shape;e.parentNode&&e.parentNode.removeChild(e),t&&t.appendChild(e)},h.clone=function(){var t=Object.create(this.__proto__),e=this.getCloneOverrides();for(var i in this)if(this.hasOwnProperty(i)){var n=this[i];e.hasOwnProperty(i)?t[i]=e[i]:null!=n?n.clone instanceof Function?t[i]=n.clone():n instanceof Function?t[i]=n.bind(t):n.nodeType?t[i]=n.cloneNode(!0):n instanceof r.GlobalManager?(r.GlobalManagerMixin.call(t),t.setGlobalManager(n)):t[i]=n instanceof Object?JSON.parse(JSON.stringify(n)):n:t[i]=n}return this.cloneShape(t),t},h.cloneShape=function(t){t.shape.markup=t.shape.childNodes.item(0),t.shape.hitarea=t.shape.childNodes.item(1),t.bindDomEvents()},h.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},h.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.dispatchEvent({type:o.EVENT_MARKUP_SELECTED,markup:this}))},h.unselect=function(){this.selected=!1},h.highlight=function(t){this.interactionsDisabled||(this.highlighted=t,this.updateStyle())},h.getStyle=function(){return Object(s.cloneStyle)(this.style)},h.setStyle=function(t){Object(s.copyStyle)(t,this.style),this.updateStyle()},h.updateStyle=function(){},h.edit=function(){this.dispatchEvent({type:o.EVENT_MARKUP_ENTER_EDITION,markup:this})},h.cancel=function(){this.dispatchEvent({type:o.EVENT_MARKUP_CANCEL_EDITION,markup:this})},h.deleteMarkup=function(){this.dispatchEvent({type:o.EVENT_MARKUP_DELETE_EDITION,markup:this})},h.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},h.getClientPosition=function(){var t=this.position;return this.editor.positionFromMarkupsToClient(t.x,t.y)},h.getClientSize=function(){var t=this.size;return this.editor.sizeFromMarkupsToClient(t.x,t.y)},h.getBoundingRect=function(){var t=this.rotation;0!==t&&this.setRotation(0);var e=this.viewer.impl.getCanvasBoundingClientRect(),i=this.shape.markup.getBoundingClientRect(),n=i.top-e.top,s=this.style["stroke-width"]||0,o=this.editor.sizeFromMarkupsToClient(s,0).x;return 0!==t&&this.setRotation(t),{x:i.left-e.left-o,y:n-o,width:i.width+2*o,height:i.height+2*o}},h.setRotation=function(t){this.rotation=t,this.updateStyle()},h.getRotation=function(){return this.rotation},h.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.updateStyle()},h.setSize=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},h.isWidthConstrained=function(){return this.constraintWidth},h.isHeightConstrained=function(){return this.constraintHeight},h.isRotationConstrained=function(){return this.constraintRotation},h.setMinWidth=function(t){this.minWidth=t},h.setMinHeight=function(t){this.minHeight=t},h.getMinWidth=function(){return this.minWidth},h.getMinHeight=function(){return this.minHeight},h.disableInteractions=function(t){this.interactionsDisabled=t},h.setStrokeWidth=function(t){},h.constrainsToBounds=function(t){},h.onMouseDown=function(t){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(t))},h.generatePoint3d=function(t){var e=this.viewer,i=this.generateBoundingPolygon(),n=this;function s(i,s){var o=n.checkLineSegment(i.x,i.y,s.x,s.y,t),r=o&&e.clientToWorld(o.x,o.y);return r&&r.point}var o=i.xVertices,r=i.yVertices,a=new THREE.Vector2(o[0]+o[1],r[0]+r[1]).multiplyScalar(.5),h=new THREE.Vector2(o[0]+o[3],r[0]+r[3]).multiplyScalar(.5),u=new THREE.Vector2(o[2]+o[1],r[2]+r[1]).multiplyScalar(.5),l=new THREE.Vector2(o[2]+o[3],r[2]+r[3]).multiplyScalar(.5),c=h.clone().add(u).multiplyScalar(.5);return s(c,u)||s(c,h)||s(c,a)||s(c,l)||function(i){var s=n.checkPolygon(i,t),o=s&&e.clientToWorld(s.x,s.y);return o&&o.point}(i)},h.generateBoundingBox=function(){for(var t={min:{x:0,y:0},max:{x:0,y:0}},e=this.generateBoundingPolygon(),i=e.vertexCount,n=e.xVertices,s=e.yVertices,o=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,u=0;u<i;++u){var l=n[u],c=s[u];o=Math.min(o,l),r=Math.min(r,c),a=Math.max(a,l),h=Math.max(h,c)}return t.min.x=o,t.min.y=r,t.max.x=a,t.max.y=h,t},h.generateBoundingPolygon=function(){var t=this.getClientPosition(),e=this.getClientSize();e.x*=.5,e.y*=.5;var i=new THREE.Vector3(-e.x,-e.y).add(t),n=new THREE.Vector3(e.x,-e.y).add(t),s=new THREE.Vector3(e.x,e.y).add(t),o=new THREE.Vector3(-e.x,e.y).add(t);if(0!==this.rotation){var r=(new THREE.Matrix4).makeTranslation(-t.x,-t.y,0),a=(new THREE.Matrix4).makeRotationZ(this.rotation),h=(new THREE.Matrix4).makeTranslation(t.x,t.y,0).multiply(a).multiply(r);i.applyMatrix4(h),n.applyMatrix4(h),s.applyMatrix4(h),o.applyMatrix4(h)}return{vertexCount:4,xVertices:new Float32Array([i.x,n.x,s.x,o.x]),yVertices:new Float32Array([i.y,n.y,s.y,o.y])}},h.setMetadata=function(){return null},h.setMouseDisabledWhenTouching=function(t){if(t.isFirst)this.shape.removeEventListener("mousedown",this.onMouseDownBinded);else if(t.isFinal){var e=this;setTimeout((function(){e.shape.addEventListener("mousedown",e.onMouseDownBinded)}),10)}},h.bindDomEvents=function(){Object(n.isTouchDevice)()&&(this.hammer=new r.Hammer.Manager(this.shape,{recognizers:[r.GestureRecognizers.singletap],handlePointerEventMouse:!1,inputClass:r.isIE11?r.Hammer.PointerEventInput:r.Hammer.TouchInput}),this.onSingleTapBinded=function(t){this.onMouseDown(t)}.bind(this),this.onHammerInputBinded=function(t){this.setMouseDisabledWhenTouching(t)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("hammer.input",this.onHammerInputBinded)),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseOutBinded=function(){this.highlight(!1)}.bind(this),this.onMouseOverBinded=function(){this.highlight(!0)}.bind(this),this.shape.addEventListener("mousedown",this.onMouseDownBinded),this.shape.addEventListener("mouseout",this.onMouseOutBinded),this.shape.addEventListener("mouseover",this.onMouseOverBinded)},h.renderToCanvas=function(t,e,i,n,s){this.renderToCanvasX(this.shape,e,i,n,t,s)},h.getPath=function(){},h.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",Object(n.radiansToDegrees)(-this.rotation),")"].join(" ")}},"./extensions/Markup/core/MarkupArrow.js":
/*!***********************************************!*\
  !*** ./extensions/Markup/core/MarkupArrow.js ***!
  \***********************************************/
/*! exports provided: MarkupArrow */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupArrow",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeArrow */"./extensions/Markup/core/edit-modes/EditModeArrow.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.checkLineSegment=o.checkLineSegment.bind(this),this.type=s.MARKUP_TYPE_ARROW,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=Object(o.createMarkupPathSvg)(),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModeArrow(this.editor)},u.set=function(t,e,i,n){var s=new THREE.Vector2(t,e),o=new THREE.Vector2(i,n),r=o.clone().sub(s).normalize();this.size.x=s.distanceTo(o),this.rotation=Math.acos(r.dot(new THREE.Vector2(1,0))),this.rotation=n>e?2*Math.PI-this.rotation:this.rotation;var a=this.head,h=this.tail;a.set(i,n,0),h.set(t,e,0),this.position.x=h.x+.5*(a.x-h.x),this.position.y=h.y+.5*(a.y-h.y),this.updateStyle()},u.setRotation=function(t){this.rotation=t;var e=Math.cos(-t),i=Math.sin(-t),n=new THREE.Vector2(e,i);n.multiplyScalar(.5*this.size.x);var s=new THREE.Vector2(this.position.x,this.position.y),o=s.clone().sub(n),r=s.clone().add(n);this.head.set(r.x,r.y,0),this.tail.set(o.x,o.y,0),this.updateStyle()},u.setSize=function(t,e,i){var n=Math.cos(-this.rotation),s=Math.sin(-this.rotation),o=new THREE.Vector2(n,s);o.multiplyScalar(.5*e);var r=new THREE.Vector2(t.x,t.y),a=r.clone().sub(o),h=r.clone().add(o);this.head.set(h.x,h.y,0),this.tail.set(a.x,a.y,0),this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.updateStyle()},u.updateStyle=function(){var t=this.style,e=this.shape,i=t["stroke-width"],n=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),s=this.getTransform();this.size.y=3*i,this.style["fill-color"]=t["stroke-color"],this.style["fill-opacity"]=t["stroke-opacity"],Object(o.setAttributeToMarkupSvg)(e,"d",this.getPath().join(" ")),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",i),Object(o.setAttributeToMarkupSvg)(e,"stroke",n),Object(o.setAttributeToMarkupSvg)(e,"fill",n),Object(o.setAttributeToMarkupSvg)(e,"transform",s),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.setPosition=function(t,e){var i=this.head,n=this.tail,s=i.x-n.x,o=i.y-n.y,r=t+.5*s,a=e+.5*o;i.x=r,i.y=a,n.x=r-s,n.y=a-o,this.position.x=n.x+.5*(i.x-n.x),this.position.y=n.y+.5*(i.y-n.y),this.updateStyle()},u.generatePoint3d=function(t){var e=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),i=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),n=e.clone().sub(i).normalize(),s=this.checkLineSegment(e.x,e.y,e.x+200*n.x,e.y+200*n.y,t),o=s&&this.viewer.clientToWorld(s.x,s.y);return o&&o.point},u.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.head=[this.head.x,this.head.y].join(" "),t.tail=[this.tail.x,this.tail.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},u.getPath=function(){var t=this.size.x,e=this.size.y,i=e/3,n=this.style["stroke-width"],s=t-3*n,o=t-s,r=.3*n;return["M",.5*-t,.5*-e+i,"l",s,0,"l",-r,-i,"l",o+r,1.5*i,"l",-o-r,1.5*i,"l",r,-i,"l",-s,0,"z"]}},"./extensions/Markup/core/MarkupCallout.js":
/*!*************************************************!*\
  !*** ./extensions/Markup/core/MarkupCallout.js ***!
  \*************************************************/
/*! exports provided: MarkupCallout */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupCallout",(function(){return u}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeCallout */"./extensions/Markup/core/edit-modes/EditModeCallout.js"),h=100;function u(t,e,i){n.Markup.call(this,t,e,["font-size","stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.createSvgElement=o.createSvgElement.bind(this),this.type=s.MARKUP_TYPE_CALLOUT,this.textShape=Object(o.createMarkupTextSvg)(),this.rectShape=Object(o.createMarkupPathSvg)(),this.shape=Object(o.createMarkupGroupSvg)([this.rectShape,this.textShape]),this.isFrameUsed=!0,this.constraintRotation=!0,this.constraintHeight=!0,this.constraintWidth=!1,this.size.x=i.x,this.size.y=i.y,this.currentText="",this.currentTextLines=[""],this.prevHighlight=!1,this.isHelperTextActive=!1,this.lineHeight=130,this.minWidth=6*this.getClientFontSize(),this.bindDomEvents()}u.prototype=Object.create(n.Markup.prototype),u.prototype.constructor=u;var l=u.prototype;l.getEditMode=function(){return new a.EditModeCallout(this.editor)},l.set=function(t,e,i,n){this.position.x=t.x,this.position.y=t.y,this.size.x=e.x,this.size.y=e.y,this.setIsFilledFrameUsed(n),this.setText(i)},l.setSize=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i;this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle(!0)},l.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle()},l.setStyle=function(t){var e=Object(r.isStyleEqual)(t,this.style);e||Object(r.copyStyle)(t,this.style),this.updateStyle(!e)},l.setText=function(t){this.currentText=t},l.getText=function(){return this.currentText},l.getTextLines=function(){return this.currentTextLines.concat()},l.highlightChanged=function(){if(this.highlighted&&this.highlighted!==this.prevHighlight){var t=this.rectShape,e=this.textShape,i=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(style["stroke-color"],style["stroke-opacity"]);return Object(o.setAttributeToMarkupSvg)(e,"fill",i),this.isFrameUsed&&Object(o.setAttributeToMarkupSvg)(t,"stroke",i),this.prevHighlight=!0,!1}return!0},l.updateTextBoxStyle=function(){var t=this.editor.duringEditMode&&this.editor.editMode;t&&t.type===this.type||(t=this.getEditMode()),t.updateTextBoxStyle()},l.setIsHelperTextActive=function(t){this.isHelperTextActive=t},l.updateStyle=function(t){if(this.highlightChanged()){this.prevHighlight=!1;var e=this.style,i=this.rectShape,n=this.textShape,s=this.style["font-size"],r=this.style["font-family"],a=this.style["font-weight"],u=this.style["font-style"],l=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(e["stroke-color"],e["stroke-opacity"]),c=this.style["stroke-width"];h=s>1?1:100,this.rebuildTextSvg(t);var d=this.editor,p=this.getTextContainerTransform(),f=this.getTextTransform();Object(o.setAttributeToMarkupSvg)(n,"font-family",r),Object(o.setAttributeToMarkupSvg)(n,"font-size",s*h),Object(o.setAttributeToMarkupSvg)(n,"fill",l),Object(o.setAttributeToMarkupSvg)(n,"font-weight",a),Object(o.setAttributeToMarkupSvg)(n,"font-style",u),Object(o.setMarkupTextSvgTransform)(n,p,f),Object(o.updateMarkupTextSvgClipper)(n,this.size.x,this.size.y),Object(o.updateMarkupTextSvgHitarea)(n,this.size.x,this.size.y,d);var y=this.getPath().join(" "),g=this.getTransform(),v=Object(o.composeRGBAString)(e["fill-color"],e["fill-opacity"]);Object(o.setAttributeToMarkupSvg)(i,"d",y),Object(o.setAttributeToMarkupSvg)(i,"stroke-width",c),Object(o.setAttributeToMarkupSvg)(i,"stroke",l),Object(o.setAttributeToMarkupSvg)(i,"transform",g),Object(o.setAttributeToMarkupSvg)(i,"fill",v),Object(o.updateMarkupPathSvgHitarea)(i,d)}},l.rebuildTextSvg=function(t){var e=this.editor.duringEditMode&&this.editor.editMode;if(e&&e.type===this.type||((e=this.getEditMode()).textInputHelper.textArea.value=this.currentText,e.textInputHelper.setStyle(this.style)),!e.textInputHelper.textMarkup||e.textInputHelper.textMarkup===this){var i=Object(r.cloneStyle)(e.textInputHelper.style),n=e.textInputHelper.textArea.value,s=e.textInputHelper.getTextValuesForMarkup(this,t);if(this.currentTextLines=s.textValues.lines,s.newPos){var o=this.editor.positionFromClientToMarkups(s.newPos.x,s.newPos.y),a=this.editor.sizeFromClientToMarkups(s.width,s.height);this.position.x=o.x,this.position.y=o.y,this.size.x=a.x,this.size.y=a.y}e.selectedMarkup===this||e.textInputHelper.firstEdit||(e.textInputHelper.textArea.value=n,e.textInputHelper.setStyle(i));var u=this.createSvgElement("text");u.setAttribute("id","markup"),u.setAttribute("alignment-baseline","middle"),this.textShape.childNodes[0].removeChild(this.textShape.markup),this.textShape.childNodes[0].appendChild(u),this.textShape.markup=u;var l=this.getLineHeight()*h*(this.lineHeight/100),c=this.getLineHeight()*h/2,d=c,p=c;this.currentTextLines.forEach(function(t){var e=this.createSvgElement("tspan");e.setAttribute("x",d),e.setAttribute("y",p),e.textContent=t,u.appendChild(e),p+=l}.bind(this))}},l.setIsFilledFrameUsed=function(t){this.isFrameUsed=t;var e=this.rectShape.parentNode===this.shape;t&&!e?this.shape.insertBefore(this.rectShape,this.shape.firstChild):!t&&e&&this.shape.removeChild(this.rectShape)},l.setIsFilledFrameVisible=function(t){this.rectShape.markup.style.display=t&&this.isFrameUsed?"block":"none"},l.setIsShapeVisible=function(t){this.shape.style.display=t?"block":"none"},l.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.text=String(this.currentText),t.isframeused=this.isFrameUsed?1:0,this.addMarkupMetadata(this.shape,t)},l.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},l.getLineHeight=function(){return this.style["font-size"]},l.getTextContainerTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",Object(o.radiansToDegrees)(-this.rotation),")","scale(1,-1)"].join(" ")},l.getTextTransform=function(){var t=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-t,")","rotate(",Object(o.radiansToDegrees)(-this.rotation),")","scale("+1/h+","+-1/h+")"].join(" ")},l.cloneShape=function(t){t.textShape=Object(o.createMarkupTextSvg)(),t.rectShape=Object(o.createMarkupPathSvg)(),t.shape=Object(o.createMarkupGroupSvg)([t.rectShape,t.textShape]),t.bindDomEvents()},l.getPath=function(){var t=this.style["stroke-width"],e=this.size.x+t,i=this.size.y+t,n=.5*-e,s=.5*-i,r=[];return Object(o.createRectanglePath)(n,s,e,i,!1,r),r},l.getBoundingRect=function(){var t=this.getClientPosition(),e=this.getClientSize(),i=this.style["stroke-width"],n=this.editor.sizeFromMarkupsToClient(i,0).x+o.EDIT_FRAME_DEFAULT_MARGIN;return{x:t.x-e.x/2,y:t.y-e.y/2,width:e.x,height:e.y,margin:n}}},"./extensions/Markup/core/MarkupCircle.js":
/*!************************************************!*\
  !*** ./extensions/Markup/core/MarkupCircle.js ***!
  \************************************************/
/*! exports provided: MarkupCircle */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupCircle",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeCircle */"./extensions/Markup/core/edit-modes/EditModeCircle.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.type=s.MARKUP_TYPE_CIRCLE,this.shape=Object(o.createMarkupPathSvg)(),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModeCircle(this.editor)},u.set=function(t,e){this.setSize(t,e.x,e.y)},u.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],s=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),r=Object(o.composeRGBAString)(t["fill-color"],t["fill-opacity"]),a=this.getTransform();Object(o.setAttributeToMarkupSvg)(e,"d",i),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",n),Object(o.setAttributeToMarkupSvg)(e,"stroke",s),Object(o.setAttributeToMarkupSvg)(e,"fill",r),Object(o.setAttributeToMarkupSvg)(e,"transform",a),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},u.getPath=function(){var t=this.size;if(1===t.x||1===t.y)return[""];var e=this.style["stroke-width"],i=t.x-e,n=t.y-e,s=-.5*i,r=[];return Object(o.createEllipsePath)(s,0,i,n,!1,r),r}},"./extensions/Markup/core/MarkupCloud.js":
/*!***********************************************!*\
  !*** ./extensions/Markup/core/MarkupCloud.js ***!
  \***********************************************/
/*! exports provided: MarkupCloud */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupCloud",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeCloud */"./extensions/Markup/core/edit-modes/EditModeCloud.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.type=s.MARKUP_TYPE_CLOUD,this.shape=Object(o.createMarkupPathSvg)(),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModeCloud(this.editor)},u.set=function(t,e){this.setSize(t,e.x,e.y)},u.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],s=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),r=Object(o.composeRGBAString)(t["fill-color"],t["fill-opacity"]),a=this.getTransform();Object(o.setAttributeToMarkupSvg)(e,"d",i),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",n),Object(o.setAttributeToMarkupSvg)(e,"stroke",s),Object(o.setAttributeToMarkupSvg)(e,"fill",r),Object(o.setAttributeToMarkupSvg)(e,"transform",a),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},u.getPath=function(){var t=this.position,e=this.size,i=this.style["stroke-width"],n=2*i;function s(t,e,i,n,s){return s.push("a"),s.push(i),s.push(n),s.push(0),s.push(1),s.push(1),s.push(t),s.push(e),s}function r(t,e,i,n,o){switch(t){case"LT":return s(e,-i,e,i,o);case"RT":return s(e,i,e,i,o);case"RB":return s(-e,i,e,i,o);case"LB":return s(-e,-i,e,i,o)}}function a(t,e,i,n){var s=2*i,o=Math.abs(e-t-n),r=Math.round(o/s),a=.05*(s+=(o-s*r)/r),h=3.5*(i=.5*s)/3;return{count:r,radius:i,diameter:s,p1:{x:a,y:-h},p2:{x:s-a,y:-h},p3:{x:s,y:0}}}var h=t.x,u=t.y,l=t.x+e.x,c=t.y+e.y,d=5*n,p=[];if(e.x<d||e.y<d){var f=e.x-i,y=e.y-i,g=.5*-f,v=0;Object(o.createEllipsePath)(g,v,f,y,!1,p)}else{var m=a(h,l,n,i),M=a(u,c,n,i),x=m.diameter,E=M.diameter,k=m.radius,b=M.radius;m=a(h+x,l-x,n,i),M=a(u+E,c-E,n,i);var T=.5*i;g=.5*-e.x+T+k,v=.5*-e.y+T+2*b;p.push("M"),p.push(g),p.push(v),r("LT",k,b,0,p),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(i.p1.x),e.push(i.p1.y),e.push(i.p2.x),e.push(i.p2.y),e.push(i.p3.x),e.push(i.p3.y)}(m,p),r("RT",k,b,0,p),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(-i.p1.y),e.push(i.p1.x),e.push(-i.p2.y),e.push(i.p2.x),e.push(-i.p3.y),e.push(i.p3.x)}(M,p),r("RB",k,b,0,p),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(-i.p1.x),e.push(-i.p1.y),e.push(-i.p2.x),e.push(-i.p2.y),e.push(-i.p3.x),e.push(-i.p3.y)}(m,p),r("LB",k,b,0,p),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(i.p1.y),e.push(-i.p1.x),e.push(i.p2.y),e.push(-i.p2.x),e.push(i.p3.y),e.push(-i.p3.x)}(M,p)}return p.push("z"),p}},"./extensions/Markup/core/MarkupDimension.js":
/*!***************************************************!*\
  !*** ./extensions/Markup/core/MarkupDimension.js ***!
  \***************************************************/
/*! exports provided: MarkupDimension */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupDimension",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeDimension */"./extensions/Markup/core/edit-modes/EditModeDimension.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","font-size","font-family","font-style","font-weight"]),this.type=s.MARKUP_TYPE_DIMENSION,this.constraintHeight=!0,this.constraintWidth=!0,this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.createSvgElement=o.createSvgElement.bind(this),this.checkLineSegment=o.checkLineSegment.bind(this),this.measureTextLines=o.measureTextLines.bind(this),this.firstAnchor=new THREE.Vector3,this.secondAnchor=new THREE.Vector3,this.shape=Object(o.createMarkupPathSvg)(),this.text=Object(o.createMarkupTextSvg)(),this.shape.appendChild(this.text),this.textSize={x:0,y:0},this.initialText="Add Length",this.currentText=" ",this.viewer.model.is2d()||(this.preventReposition=!0,this.constraintRotation=!0),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModeDimension(this.editor)},u.set=function(t,e,i,n,s){var o=new THREE.Vector2(t,e),r=new THREE.Vector2(i,n),a=r.clone().sub(o).normalize();this.size.x=o.distanceTo(r),this.rotation=Math.acos(a.dot(new THREE.Vector2(1,0))),this.rotation=n>e?2*Math.PI-this.rotation:this.rotation;var h=this.firstAnchor,u=this.secondAnchor;h.set(i,n,0),u.set(t,e,0),this.position.x=u.x+.5*(h.x-u.x),this.position.y=u.y+.5*(h.y-u.y),this.currentText=s,this.updateStyle()},u.setRotation=function(t){90===Object(o.radiansToDegrees)(t)&&(t=Object(o.degreesToRadians)(-90)),this.rotation=t;var e=Math.cos(-t),i=Math.sin(-t),n=new THREE.Vector2(e,i);n.multiplyScalar(.5*this.size.x);var s=new THREE.Vector2(this.position.x,this.position.y),r=s.clone().sub(n),a=s.clone().add(n);this.firstAnchor.set(a.x,a.y,0),this.secondAnchor.set(r.x,r.y,0),this.updateStyle()},u.setSize=function(t,e,i){var n=Math.cos(-this.rotation),s=Math.sin(-this.rotation),o=new THREE.Vector2(n,s);o.multiplyScalar(.5*e);var r=new THREE.Vector2(t.x,t.y),a=r.clone().sub(o),h=r.clone().add(o);this.firstAnchor.set(h.x,h.y,0),this.secondAnchor.set(a.x,a.y,0),this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.updateStyle()},u.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},u.updateStyle=function(){var t=this.style,e=this.shape,i=t["stroke-width"],n=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),s=this.getTransform();this.rebuildTextSvg(this.currentText),Object(o.setAttributeToMarkupSvg)(e,"d",this.getPath().join(" ")),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",i/2),Object(o.setAttributeToMarkupSvg)(e,"stroke",n),Object(o.setAttributeToMarkupSvg)(e,"fill",n),Object(o.setAttributeToMarkupSvg)(e,"transform",s),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.rebuildTextSvg=function(t){var e=this.style,i=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(e["stroke-color"],e["stroke-opacity"]),n=e["stroke-width"],s=this.createSvgElement("text");s.setAttribute("id","markup"),s.setAttribute("alignment-baseline","middle");var r=this.text,a=this.editor;r.childNodes[0].removeChild(r.markup),r.childNodes[0].appendChild(s),r.markup=s;var h=this.createSvgElement("tspan");h.textContent=t,s.appendChild(h);var u=this.measureTextLines([t],e,a)[0],l=this.textSize=a.sizeFromClientToMarkups(u.width,u.height),c=10*n/2,d=2*n/2,p=l.x+2*n>=this.size.x?d+c/2:d;this.size.y=c+l.y+p;var f=this.getTextTransform(.8*l.y+p,!0),y=this.getTextTransform(l.y+p,!1);Object(o.setAttributeToMarkupSvg)(r,"font-family",e["font-family"]),Object(o.setAttributeToMarkupSvg)(r,"font-size",e["font-size"]),Object(o.setAttributeToMarkupSvg)(r,"font-weight",e["font-weight"]),Object(o.setAttributeToMarkupSvg)(r,"font-style",e["font-style"]),Object(o.setAttributeToMarkupSvg)(r,"text-rendering","auto"),Object(o.setAttributeToMarkupSvg)(r,"fill",i),Object(o.setMarkupTextSvgTransform)(r,y,f),Object(o.updateMarkupTextSvgBackground)(r,l.x,l.y,"none"),Object(o.updateMarkupTextSvgClipper)(r,l.x,l.y),Object(o.updateMarkupTextSvgHitarea)(r,l.x,l.y,a)},u.shouldFlip=function(){return this.firstAnchor.x<this.secondAnchor.x},u.getTextTransform=function(t,e){var i=this.shouldFlip()?-1:1;return e=e?-1:1,90===Object(o.radiansToDegrees)(this.rotation)&&(this.rotation=Object(o.degreesToRadians)(-90)),["translate(",this.position.x,",",this.position.y,")","rotate(",Object(o.radiansToDegrees)(-this.rotation),")","translate(",-i*this.textSize.x/2,",",-i*t,")","scale("+i+","+i*e+")"].join(" ")},u.setPosition=function(t,e){var i=this.firstAnchor,n=this.secondAnchor,s=i.x-n.x,o=i.y-n.y,r=t+.5*s,a=e+.5*o;i.x=r,i.y=a,n.x=r-s,n.y=a-o,this.position.x=n.x+.5*(i.x-n.x),this.position.y=n.y+.5*(i.y-n.y),this.updateStyle()},u.generatePoint3d=function(t){var e=this.editor.positionFromMarkupsToClient(this.firstAnchor.x,this.firstAnchor.y),i=this.editor.positionFromMarkupsToClient(this.secondAnchor.x,this.secondAnchor.y),n=e.clone().sub(i).normalize(),s=this.checkLineSegment(e.x,e.y,e.x+200*n.x,e.y+200*n.y,t),o=s&&this.viewer.clientToWorld(s.x,s.y);return o&&o.point},u.setMetadata=function(){this.text.setAttribute("pointer-events","none");var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.firstAnchor=[this.firstAnchor.x,this.firstAnchor.y].join(" "),t.secondAnchor=[this.secondAnchor.x,this.secondAnchor.y].join(" "),t.text=String(this.currentText),this.addMarkupMetadata(this.shape,t)},u.getText=function(){return this.currentText===this.initialText?"":this.currentText},u.getPath=function(){var t=this.style["stroke-width"],e=this.size.x-t/2,i=10*t/2;return["M",.5*-e,0,"l",0,i/2,"l",0,-i/2,"l",e,0,"l",0,i/2,"l",0,-i,"l",0,i/2,"l",-e,0,"l",0,-i/2,"z"]},u.cloneShape=function(t){t.shape=Object(o.createMarkupPathSvg)(),t.text=Object(o.createMarkupTextSvg)(),t.shape.appendChild(t.text),t.bindDomEvents()},u.getBoundingRect=function(){var t=this.getClientPosition(),e=this.getClientSize();return{x:t.x-e.x/2,y:t.y-e.y/2,width:e.x,height:e.y}}},"./extensions/Markup/core/MarkupEvents.js":
/*!************************************************!*\
  !*** ./extensions/Markup/core/MarkupEvents.js ***!
  \************************************************/
/*! exports provided: EVENT_EDITMODE_CHANGED, EVENT_EDITMODE_ENTER, EVENT_EDITMODE_LEAVE, EVENT_MARKUP_SELECTED, EVENT_MARKUP_DRAGGING, EVENT_MARKUP_ENTER_EDITION, EVENT_MARKUP_CANCEL_EDITION, EVENT_MARKUP_DELETE_EDITION, EVENT_HISTORY_CHANGED, EVENT_EDITMODE_CREATION_BEGIN, EVENT_EDITMODE_CREATION_END, EVENT_MARKUP_DESELECT, EVENT_EDITFRAME_EDITION_START, EVENT_EDITFRAME_EDITION_END */function(t,e,i){"use strict";i.r(e),i.d(e,"EVENT_EDITMODE_CHANGED",(function(){return n})),i.d(e,"EVENT_EDITMODE_ENTER",(function(){return s})),i.d(e,"EVENT_EDITMODE_LEAVE",(function(){return o})),i.d(e,"EVENT_MARKUP_SELECTED",(function(){return r})),i.d(e,"EVENT_MARKUP_DRAGGING",(function(){return a})),i.d(e,"EVENT_MARKUP_ENTER_EDITION",(function(){return h})),i.d(e,"EVENT_MARKUP_CANCEL_EDITION",(function(){return u})),i.d(e,"EVENT_MARKUP_DELETE_EDITION",(function(){return l})),i.d(e,"EVENT_HISTORY_CHANGED",(function(){return c})),i.d(e,"EVENT_EDITMODE_CREATION_BEGIN",(function(){return d})),i.d(e,"EVENT_EDITMODE_CREATION_END",(function(){return p})),i.d(e,"EVENT_MARKUP_DESELECT",(function(){return f})),i.d(e,"EVENT_EDITFRAME_EDITION_START",(function(){return y})),i.d(e,"EVENT_EDITFRAME_EDITION_END",(function(){return g}));var n="EVENT_EDITMODE_CHANGED",s="EVENT_EDITMODE_ENTER",o="EVENT_EDITMODE_LEAVE",r="EVENT_MARKUP_SELECTED",a="EVENT_MARKUP_DRAGGING",h="EVENT_MARKUP_ENTER_EDITION",u="EVENT_MARKUP_CANCEL_EDITION",l="EVENT_MARKUP_DELETE_EDITION",c="EVENT_HISTORY_CHANGED",d="EVENT_EDITMODE_CREATION_BEGIN",p="EVENT_EDITMODE_CREATION_END",f="EVENT_MARKUP_DESELECT",y="EVENT_EDITFRAME_EDITION_START",g="EVENT_EDITFRAME_EDITION_END"},"./extensions/Markup/core/MarkupFreehand.js":
/*!**************************************************!*\
  !*** ./extensions/Markup/core/MarkupFreehand.js ***!
  \**************************************************/
/*! exports provided: MarkupFreehand */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupFreehand",(function(){return r}));var n=i(/*! ./MarkupPen */"./extensions/Markup/core/MarkupPen.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./edit-modes/EditModeFreehand */"./extensions/Markup/core/edit-modes/EditModeFreehand.js");function r(t,e){n.MarkupPen.call(this,t,e),this.type=s.MARKUP_TYPE_FREEHAND}r.prototype=Object.create(n.MarkupPen.prototype),r.prototype.constructor=r,r.prototype.getEditMode=function(){return new o.EditModeFreehand(this.editor)}},"./extensions/Markup/core/MarkupHighlight.js":
/*!***************************************************!*\
  !*** ./extensions/Markup/core/MarkupHighlight.js ***!
  \***************************************************/
/*! exports provided: MarkupHighlight */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupHighlight",(function(){return r}));var n=i(/*! ./MarkupPen */"./extensions/Markup/core/MarkupPen.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./edit-modes/EditModeHighlight */"./extensions/Markup/core/edit-modes/EditModeHighlight.js");function r(t,e){n.MarkupPen.call(this,t,e),this.type=s.MARKUP_TYPE_HIGHLIGHT}r.prototype=Object.create(n.MarkupPen.prototype),r.prototype.constructor=r,r.prototype.getEditMode=function(){return new o.EditModeHighlight(this.editor)}},"./extensions/Markup/core/MarkupPen.js":
/*!*********************************************!*\
  !*** ./extensions/Markup/core/MarkupPen.js ***!
  \*********************************************/
/*! exports provided: MarkupPen */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupPen",(function(){return r}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),o=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity"]),this.addMarkupMetadata=s.addMarkupMetadata.bind(this),this.shape=Object(s.createMarkupPathSvg)(),this.bindDomEvents()}r.prototype=Object.create(n.Markup.prototype),r.prototype.constructor=r;var a=r.prototype;a.set=function(t,e,i,n){this.rotation=0,this.isAbsoluteCoords=n,this.isAbsoluteCoords?this.updatePath(i):(this.locations=i.slice(0),this.size.x=0===e.x?1:e.x,this.size.y=0===e.y?1:e.y,this.setSize(t,e.x,e.y),this.updateStyle())},a.setPosition=function(t,e){this.position.x=t,this.position.y=e;var i=this.shape,n=this.getTransform();Object(s.setAttributeToMarkupSvg)(i,"transform",n),Object(s.updateMarkupPathSvgHitarea)(i,this.editor)},a.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:Object(s.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]);Object(s.setAttributeToMarkupSvg)(e,"stroke-width",n),Object(s.setAttributeToMarkupSvg)(e,"stroke-linejoin","round"),Object(s.setAttributeToMarkupSvg)(e,"stroke-linecap","round"),Object(s.setAttributeToMarkupSvg)(e,"stroke",o),Object(s.setAttributeToMarkupSvg)(e,"fill","none"),this.updatePath(i),Object(s.updateMarkupPathSvgHitarea)(e,this.editor)},a.updatePath=function(t){var e=this.shape,i=this.isAbsoluteCoords?"scale(1)":this.getTransform();Object(s.setAttributeToMarkupSvg)(e,"transform",i),Object(s.setAttributeToMarkupSvg)(e,"d",t)},a.setSize=function(t,e,i){e=0===e?1:e,i=0===i?1:i;for(var n=this.locations,s=n.length,o=e/this.size.x,r=i/this.size.y,a=0;a<s;++a){var h=n[a];h.x*=o,h.y*=r}this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},a.setMetadata=function(){var t=Object(o.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),t.locations=this.locations.map((function(t){return[t.x,t.y].join(" ")})).join(" "),this.addMarkupMetadata(this.shape,t)},a.getPath=function(){var t=[],e=this.locations,i=e.length;if(i>1){t.push("M"),t.push(+e[0].x.toFixed(6)),t.push(+e[0].y.toFixed(6));for(var n=1;n<i;++n){var s=e[n-1],o=e[n];t.push("l"),t.push(+(o.x-s.x).toFixed(6)),t.push(+(o.y-s.y).toFixed(6))}}return t}},"./extensions/Markup/core/MarkupPolyLine.js":
/*!**************************************************!*\
  !*** ./extensions/Markup/core/MarkupPolyLine.js ***!
  \**************************************************/
/*! exports provided: MarkupPolyline */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupPolyline",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModePolyline */"./extensions/Markup/core/edit-modes/EditModePolyline.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.type=s.MARKUP_TYPE_POLYLINE,this.shape=Object(o.createMarkupPathSvg)("path"),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModePolyline(this.editor)},u.set=function(t,e,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===e.x?1:e.x,this.size.y=0===e.y?1:e.y,this.closed=n,this.setSize(t,e.x,e.y),this.updateStyle()},u.updateStyle=function(){var t=this.style,e=this.shape,i=this.style["stroke-width"],n=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),s=this.closed?Object(o.composeRGBAString)(t["fill-color"],t["fill-opacity"]):"none",r=this.getTransform();Object(o.setAttributeToMarkupSvg)(e,"d",this.getPath().join(" ")),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",i),Object(o.setAttributeToMarkupSvg)(e,"stroke",n),Object(o.setAttributeToMarkupSvg)(e,"fill",s),Object(o.setAttributeToMarkupSvg)(e,"transform",r),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.setSize=function(t,e,i){e=0===e?1:e,i=0===i?1:i;for(var n=this.locations,s=n.length,o=e/this.size.x,r=i/this.size.y,a=0;a<s;++a){var h=n[a];h.x*=o,h.y*=r}this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},u.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),t.locations=this.locations.map((function(t){return[t.x,t.y].join(" ")})).join(" "),this.addMarkupMetadata(this.shape,t)},u.getPath=function(){var t=[],e=this.locations,i=e.length;if(0===i)return" ";t.push("M"),t.push(e[0].x),t.push(e[0].y);for(var n=1;n<i;++n){var s=e[n-1],o=e[n];t.push("l"),t.push(o.x-s.x),t.push(o.y-s.y)}return this.closed&&t.push("z"),t}},"./extensions/Markup/core/MarkupPolycloud.js":
/*!***************************************************!*\
  !*** ./extensions/Markup/core/MarkupPolycloud.js ***!
  \***************************************************/
/*! exports provided: MarkupPolycloud */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupPolycloud",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModePolycloud */"./extensions/Markup/core/edit-modes/EditModePolycloud.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.type=s.MARKUP_TYPE_POLYCLOUD,this.locations=[],this.shape=Object(o.createMarkupPathSvg)(),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModePolycloud(this.editor)},u.set=function(t,e,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===e.x?1:e.x,this.size.y=0===e.y?1:e.y,this.closed=n,this.setSize(t,e.x,e.y),this.updateStyle()},u.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],s=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),r=this.closed?Object(o.composeRGBAString)(t["fill-color"],t["fill-opacity"]):"none",a=this.getTransform();Object(o.setAttributeToMarkupSvg)(e,"d",i),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",n),Object(o.setAttributeToMarkupSvg)(e,"stroke",s),Object(o.setAttributeToMarkupSvg)(e,"fill",r),Object(o.setAttributeToMarkupSvg)(e,"transform",a),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.setSize=function(t,e,i){e=0===e?1:e,i=0===i?1:i;for(var n=this.locations,s=n.length,o=e/this.size.x,r=i/this.size.y,a=0;a<s;++a){var h=n[a];h.x*=o,h.y*=r}this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},u.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),t.locations=this.locations.map((function(t){return[t.x,t.y].join(" ")})).join(" "),this.addMarkupMetadata(this.shape,t)},u.getPath=function(){function t(t,e,i,n){var s=e.radius,o=i.radius,r=t.length;if(s>0&&o>0&&s+o>r&&Math.abs(s-o)<r){var a=t.pointA.x,h=t.pointA.y,u=t.pointB.x,l=t.pointB.y,c=.25*Math.sqrt((r+s+o)*(r+s-o)*(r-s+o)*(-r+s+o)),d=(a+u)/2+(u-a)*(s*s-o*o)/(2*r*r),p=2*(h-l)/(r*r)*c,f=(h+l)/2+(l-h)*(s*s-o*o)/(2*r*r),y=2*(a-u)/(r*r)*c,g=d+p,v=d-p,m=f-y,M=f+y;if(Math.abs((g-a)*(g-a)+(m-h)*(m-h)-s*s)>1e-7){var x=m;m=M,M=x}var E=new THREE.Vector3(g,m,0);return Math.sign(E.clone().sub(t.pointA).cross(t.vecAB).z)!==n&&E.set(v,M,0),e.pointB=E.clone(),i.pointA=E.clone(),!0}return!1}function e(t,e,i){var n=t.bodyCount;if(0!==n){var s=t.bodyRadius,o=t.bodyDiameter,r=.05*o,a=3.5*s/3,h=new THREE.Vector3(r,e*-a),u=new THREE.Vector3(o-r,e*-a),l=new THREE.Vector3(o,0),c=Math.acos(t.vecAB.x)*(t.vecAB.y<0?-1:1),d=(new THREE.Matrix4).makeRotationZ(c);h.applyMatrix4(d),u.applyMatrix4(d),l.applyMatrix4(d);for(var p=0;p<n;++p)i.push("c"),i.push(h.x),i.push(h.y),i.push(u.x),i.push(u.y),i.push(l.x),i.push(l.y)}}function i(t,e,i,n){e&&(n.push("M"),n.push(t.pointA.x),n.push(t.pointA.y));var s=1===i?t.large:!t.large;return 0!==t.radius&&(n.push("a"),n.push(t.radius),n.push(t.radius),n.push(0),n.push(s?1:0),n.push(1===i?1:0),n.push(t.pointB.x-t.pointA.x),n.push(t.pointB.y-t.pointA.y)),n}var n=2*this.style["stroke-width"],s=function(t){switch(t.length){case 0:case 1:return 1;case 2:var e=t[0],i=t[1];return e.y>i.y?1:-1;default:var n=t[0],s=t[1],o=t[2];return(s.x-n.x)*(s.y+n.y)+(o.x-s.x)*(o.y+s.y)<0?1:-1}}(this.locations),o=this.closed,r=[],a=function(t,e){for(var i=t.length,n=[],s=i-(e?0:1),o=0;o<s;++o){var r=t[o],a=t[(o+1)%i],h=a.x-r.x,u=a.y-r.y,l=Math.sqrt(h*h+u*u);n.push({index:o,pointA:new THREE.Vector3(r.x,r.y,0),pointB:new THREE.Vector3(a.x,a.y,0),vecAB:new THREE.Vector3(h/l,u/l,0),vecBA:new THREE.Vector3(-h/l,-u/l,0),length:l})}return n}(this.locations,o),h=function(t,e,i){for(var n=[],s=t.length,o=0;o<s;++o){var r=t[0!==o?o-1:s-1],a=t[o],h=r.vecBA.clone().cross(a.vecAB).z<0;r.length<e||a.length<e||0===o&&!i?n.push({pointA:a.pointA.clone(),pointB:a.pointA.clone(),radius:0,large:!1}):n.push({pointA:a.pointA.clone().add(r.vecBA.clone().multiplyScalar(e)),pointB:a.pointA.clone().add(a.vecAB.clone().multiplyScalar(e)),radius:e,large:h})}return n}(a,n,o),u=h.length;!function(e,i,n,s){for(var o=2*n,r=e.length,a=0;a<r;++a){var h=e[a],u=i[a],l=i[(a+1)%r];h.bodyA=h.vecAB.clone().multiplyScalar(u.radius).add(h.pointA),h.bodyB=h.vecBA.clone().multiplyScalar(l.radius).add(h.pointB),t(h,u,l,s)?(h.body=0,h.bodyDiameter=h.bodyCount=0):(h.body=h.bodyB.clone().sub(h.bodyA).length(),h.bodyCount=Math.round(h.body/o),0===h.bodyCount&&h.body>.5*n&&(h.bodyCount=1),h.bodyDiameter=o+(h.body-o*h.bodyCount)/h.bodyCount),h.bodyRadius=.5*h.bodyDiameter}}(a,h,n,s);for(var l=0;l<u;++l)i(h[l],0===l,s,r),e(a[l],s,r);return o&&r.push("z"),r}},"./extensions/Markup/core/MarkupRectangle.js":
/*!***************************************************!*\
  !*** ./extensions/Markup/core/MarkupRectangle.js ***!
  \***************************************************/
/*! exports provided: MarkupRectangle */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupRectangle",(function(){return h}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeRectangle */"./extensions/Markup/core/edit-modes/EditModeRectangle.js");function h(t,e){n.Markup.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.type=s.MARKUP_TYPE_RECTANGLE,this.shape=Object(o.createMarkupPathSvg)(),this.bindDomEvents()}h.prototype=Object.create(n.Markup.prototype),h.prototype.constructor=h;var u=h.prototype;u.getEditMode=function(){return new a.EditModeRectangle(this.editor)},u.set=function(t,e){this.position.x=t.x,this.position.y=t.y,this.size.x=e.x,this.size.y=e.y,this.updateStyle()},u.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],s=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(t["stroke-color"],t["stroke-opacity"]),r=Object(o.composeRGBAString)(t["fill-color"],t["fill-opacity"]),a=this.getTransform();Object(o.setAttributeToMarkupSvg)(e,"d",i),Object(o.setAttributeToMarkupSvg)(e,"stroke-width",n),Object(o.setAttributeToMarkupSvg)(e,"stroke",s),Object(o.setAttributeToMarkupSvg)(e,"fill",r),Object(o.setAttributeToMarkupSvg)(e,"transform",a),Object(o.updateMarkupPathSvgHitarea)(e,this.editor)},u.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},u.getPath=function(){var t=this.style["stroke-width"],e=this.size.x-t,i=this.size.y-t,n=.5*-e,s=.5*-i,r=[];return Object(o.createRectanglePath)(n,s,e,i,!1,r),r}},"./extensions/Markup/core/MarkupText.js":
/*!**********************************************!*\
  !*** ./extensions/Markup/core/MarkupText.js ***!
  \**********************************************/
/*! exports provided: MarkupText */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupText",(function(){return u}));var n=i(/*! ./Markup */"./extensions/Markup/core/Markup.js"),s=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),a=i(/*! ./edit-modes/EditModeText */"./extensions/Markup/core/edit-modes/EditModeText.js"),h=100;function u(t,e,i){n.Markup.call(this,t,e,["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]),this.createSvgElement=o.createSvgElement.bind(this),this.addMarkupMetadata=o.addMarkupMetadata.bind(this),this.type=s.MARKUP_TYPE_TEXT,this.shape=Object(o.createMarkupTextSvg)(),this.constraintRotation=!0,this.constraintHeight=!0,this.constraintWidth=!1,this.size.x=i.x,this.size.y=i.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.prevHighlight=!1,this.isHelperTextActive=!1,this.lineHeight=130,this.minWidth=6*this.getClientFontSize(),this.bindDomEvents()}u.prototype=Object.create(n.Markup.prototype),u.prototype.constructor=u;var l=u.prototype;l.getEditMode=function(){return new a.EditModeText(this.editor)},l.set=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e.x,this.size.y=e.y,this.setText(i)},l.setSize=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i;this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle(!0)},l.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle()},l.setStyle=function(t){var e=Object(r.isStyleEqual)(t,this.style);e||Object(r.copyStyle)(t,this.style),this.updateStyle(!e)},l.setText=function(t){this.currentText=t},l.getText=function(){return this.currentText},l.getTextLines=function(){return this.currentTextLines.concat()},l.highlightChanged=function(){if(this.highlighted&&this.highlighted!==this.prevHighlight){var t=this.shape,e=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(style["stroke-color"],style["stroke-opacity"]);return Object(o.setAttributeToMarkupSvg)(t,"fill",e),this.prevHighlight=!0,!1}return!0},l.updateTextBoxStyle=function(){var t=this.editor.duringEditMode&&this.editor.editMode;t&&t.type===this.type||(t=this.getEditMode()),t.updateTextBoxStyle()},l.setIsHelperTextActive=function(t){this.isHelperTextActive=t},l.updateStyle=function(t){if(this.highlightChanged()){this.prevHighlight=!1;var e=this.style,i=this.shape,n=this.style["font-size"],s=this.style["font-family"],r=this.style["font-weight"],a=this.style["font-style"],u=this.highlighted?this.highlightColor:Object(o.composeRGBAString)(e["stroke-color"],e["stroke-opacity"]),l=Object(o.composeRGBAString)(e["fill-color"],e["fill-opacity"]);h=n>1?1:100,this.rebuildTextSvg(t),Object(o.setAttributeToMarkupSvg)(i,"font-family",s),Object(o.setAttributeToMarkupSvg)(i,"font-size",n*h),Object(o.setAttributeToMarkupSvg)(i,"fill",u),Object(o.setAttributeToMarkupSvg)(i,"font-weight",r),Object(o.setAttributeToMarkupSvg)(i,"font-style",a);var c=this.editor,d=this.getTransform(),p=this.getTextTransform();Object(o.setMarkupTextSvgTransform)(i,d,p),Object(o.updateMarkupTextSvgBackground)(i,this.size.x,this.size.y,l),Object(o.updateMarkupTextSvgClipper)(i,this.size.x,this.size.y),Object(o.updateMarkupTextSvgHitarea)(i,this.size.x,this.size.y,c)}},l.rebuildTextSvg=function(t){var e=this.editor.duringEditMode&&this.editor.editMode;if(e&&e.type===this.type||((e=this.getEditMode()).textInputHelper.textArea.value=this.currentText,e.textInputHelper.setStyle(this.style)),!e.textInputHelper.textMarkup||e.textInputHelper.textMarkup===this){var i=Object(r.cloneStyle)(e.textInputHelper.style),n=e.textInputHelper.textArea.value,s=e.textInputHelper.getTextValuesForMarkup(this,t);if(this.currentTextLines=s.textValues.lines,s.newPos){var o=this.editor.positionFromClientToMarkups(s.newPos.x,s.newPos.y),a=this.editor.sizeFromClientToMarkups(s.width,s.height);this.position.x=o.x,this.position.y=o.y,this.size.x=a.x,this.size.y=a.y}e.selectedMarkup===this||e.textInputHelper.firstEdit||(e.textInputHelper.textArea.value=n,e.textInputHelper.setStyle(i));var u=this.createSvgElement("text");u.setAttribute("id","markup"),u.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(u),this.shape.markup=u;var l=this.getLineHeight()*h*(this.lineHeight/100),c=this.getLineHeight()*h/2,d=c,p=c;this.currentTextLines.forEach(function(t){var e=this.createSvgElement("tspan");e.setAttribute("x",d),e.setAttribute("y",p),e.textContent=t,u.appendChild(e),p+=l}.bind(this))}},l.setIsShapeVisible=function(t){this.shape.style.display=t?"block":"none"},l.setMetadata=function(){var t=Object(r.cloneStyle)(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.text=String(this.currentText),this.addMarkupMetadata(this.shape,t)},l.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},l.getLineHeight=function(){return this.style["font-size"]},l.getTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",Object(o.radiansToDegrees)(-this.rotation),")","scale(1,-1)"].join(" ")},l.getTextTransform=function(){var t=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-t,")","rotate(",Object(o.radiansToDegrees)(-this.rotation),")","scale("+1/h+","+-1/h+")"].join(" ")},l.cloneShape=function(t){t.shape=Object(o.createMarkupTextSvg)(),t.bindDomEvents()},l.getBoundingRect=function(){var t=this.getClientPosition(),e=this.getClientSize();return{x:t.x-e.x/2,y:t.y-e.y/2,width:e.x,height:e.y}}},"./extensions/Markup/core/MarkupTool.js":
/*!**********************************************!*\
  !*** ./extensions/Markup/core/MarkupTool.js ***!
  \**********************************************/
/*! exports provided: MarkupTool */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupTool",(function(){return s}));var n=Bimfish.Viewing.Private;function s(){Bimfish.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.is2d=!1,this.coreExt=null,this.hotkeysEnabled=!0;var t=!1,e=!1;this.allowNavigation=function(t){this.allowNav=t},this.setCoreExtension=function(t){this.coreExt=t},this.setHotkeysEnabled=function(t){this.hotkeysEnabled=t},this.activate=function(t,e){this.panTool=e.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan"),this.is2d=e.model.is2d(),this.viewer=e},this.deactivate=function(t){this.panTool&&this.panTool.deactivate("pan")},this.handleKeyDown=function(i,n){if(!this.coreExt.editMode)return!1;if(!this.hotkeysEnabled)return!0;switch(n){case Bimfish.Viewing.KeyCode.CONTROL:t=!0;break;case Bimfish.Viewing.KeyCode.SHIFT:e=!0;break;case Bimfish.Viewing.KeyCode.x:t&&!this.allowNav&&this.coreExt.cut();break;case Bimfish.Viewing.KeyCode.c:t&&!this.allowNav&&this.coreExt.copy();break;case Bimfish.Viewing.KeyCode.v:t&&!this.allowNav&&this.coreExt.paste();break;case Bimfish.Viewing.KeyCode.d:t&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Bimfish.Viewing.KeyCode.z:!t||e||this.allowNav?t&&e&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Bimfish.Viewing.KeyCode.y:t&&!this.allowNav&&this.coreExt.redo();break;case Bimfish.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Bimfish.Viewing.KeyCode.BACKSPACE:case Bimfish.Viewing.KeyCode.DELETE:var s=this.coreExt.getSelection();s&&this.coreExt.deleteMarkup(s);break;case Bimfish.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(i,n){if(!this.coreExt.editMode)return!1;if(!this.hotkeysEnabled)return!0;switch(n){case Bimfish.Viewing.KeyCode.CONTROL:t=!1;break;case Bimfish.Viewing.KeyCode.SHIFT:e=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(t,e){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(t,e)},this.handleDoubleClick=function(t,e){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(t,e)},this.handleSingleTap=function(t){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(t)},this.handleDoubleTap=function(t){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(t)},this.handleWheelInput=function(t,e){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleWheelInput)&&(this.coreExt.callSnapperMouseMove(),this.panTool.handleWheelInput(t,e))},this.handleButtonDown=function(t,e){return!(this.allowNav||this.is2d&&(n.isRightClick(t,this.viewer.navigation)||n.isMiddleClick(t)))||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(t,e)},this.handleButtonUp=function(t,e){return!(this.allowNav||this.is2d&&(n.isRightClick(t,this.viewer.navigation)||n.isMiddleClick(t)))||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(t,e)},this.handleMouseMove=function(t){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(t)},this.handleGesture=function(t){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(t)},this.handleBlur=function(t){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(t)}}},"./extensions/Markup/core/MarkupTypes.js":
/*!***********************************************!*\
  !*** ./extensions/Markup/core/MarkupTypes.js ***!
  \***********************************************/
/*! exports provided: MARKUP_TYPE_ARROW, MARKUP_TYPE_TEXT, MARKUP_TYPE_RECTANGLE, MARKUP_TYPE_CIRCLE, MARKUP_TYPE_CLOUD, MARKUP_TYPE_FREEHAND, MARKUP_TYPE_HIGHLIGHT, MARKUP_TYPE_POLYLINE, MARKUP_TYPE_POLYCLOUD, MARKUP_TYPE_CALLOUT, MARKUP_TYPE_DIMENSION */function(t,e,i){"use strict";i.r(e),i.d(e,"MARKUP_TYPE_ARROW",(function(){return n})),i.d(e,"MARKUP_TYPE_TEXT",(function(){return s})),i.d(e,"MARKUP_TYPE_RECTANGLE",(function(){return o})),i.d(e,"MARKUP_TYPE_CIRCLE",(function(){return r})),i.d(e,"MARKUP_TYPE_CLOUD",(function(){return a})),i.d(e,"MARKUP_TYPE_FREEHAND",(function(){return h})),i.d(e,"MARKUP_TYPE_HIGHLIGHT",(function(){return u})),i.d(e,"MARKUP_TYPE_POLYLINE",(function(){return l})),i.d(e,"MARKUP_TYPE_POLYCLOUD",(function(){return c})),i.d(e,"MARKUP_TYPE_CALLOUT",(function(){return d})),i.d(e,"MARKUP_TYPE_DIMENSION",(function(){return p}));var n="arrow",s="label",o="rectangle",r="ellipse",a="cloud",h="freehand",u="highlight",l="polyline",c="polycloud",d="callout",p="dimension"},"./extensions/Markup/core/Markups.css":
/*!********************************************!*\
  !*** ./extensions/Markup/core/Markups.css ***!
  \********************************************/
/*! no static exports found */function(t,e,i){var n=i(/*! !../../../node_modules/css-loader!../../../node_modules/sass-loader/dist/cjs.js!./Markups.css */"./node_modules/css-loader/index.js!./node_modules/sass-loader/dist/cjs.js!./extensions/Markup/core/Markups.css");"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(/*! ../../../node_modules/style-loader/lib/addStyles.js */"./node_modules/style-loader/lib/addStyles.js")(n,s);n.locals&&(t.exports=n.locals)},"./extensions/Markup/core/MarkupsCore.js":
/*!***********************************************!*\
  !*** ./extensions/Markup/core/MarkupsCore.js ***!
  \***********************************************/
/*! exports provided: MarkupsCore */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupsCore",(function(){return v}));var n=i(/*! ./edit-actions/EditActionManager */"./extensions/Markup/core/edit-actions/EditActionManager.js"),s=i(/*! ./MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),o=i(/*! ./MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),r=i(/*! ./MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),a=i(/*! ./StyleUtils */"./extensions/Markup/core/StyleUtils.js"),h=i(/*! ./DomElementStyle */"./extensions/Markup/core/DomElementStyle.js"),u=i(/*! ./edit-clipboard/Clipboard */"./extensions/Markup/core/edit-clipboard/Clipboard.js"),l=i(/*! ./edit-input/InputHandler */"./extensions/Markup/core/edit-input/InputHandler.js"),c=i(/*! ./EditFrame */"./extensions/Markup/core/EditFrame.js"),d=i(/*! ./MarkupTool */"./extensions/Markup/core/MarkupTool.js"),p=i(/*! ./edit-modes/EditModeArrow */"./extensions/Markup/core/edit-modes/EditModeArrow.js");i(/*! ./edit-modes/BuiltinEditModes */"./extensions/Markup/core/edit-modes/BuiltinEditModes.js"),i(/*! ./Markups.css */"./extensions/Markup/core/Markups.css");function f(t,e,i,n,s,o,r){try{var a=t[o](r),h=a.value}catch(t){return void i(t)}a.done?e(h):Promise.resolve(h).then(n,s)}function y(t){return function(){var e=this,i=arguments;return new Promise((function(n,s){var o=t.apply(e,i);function r(t){f(o,n,s,r,a,"next",t)}function a(t){f(o,n,s,r,a,"throw",t)}r(void 0)}))}}var g=Bimfish.Viewing.MeasureCommon;function v(t,e){Bimfish.Viewing.Extension.call(this,t,e),this.options=this.options||{},this.markups=[],this.styles={},this.activeLayer="",this.duringViewMode=!1,this.duringEditMode=!1,this.svgLayersMap={},this.actionManager=new n.EditActionManager(50),this.actionManager.addEventListener(s.EVENT_HISTORY_CHANGED,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new u.Clipboard(this),this.input=new l.InputHandler,this.input.setGlobalManager(this.globalManager),this.createSvgElement=r.createSvgElement.bind(this),this.addSvgMetadata=r.addSvgMetadata.bind(this),this.checkPolygon=r.checkPolygon.bind(this),Object(r.addTraitEventDispatcher)(this),t.addEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,function(){this.getStrokeWidth(),this.getFontWidth()}.bind(this),{once:!0}),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(t){var e=this;e.onViewerResize(t),requestAnimationFrame((function(){e.duringViewMode&&e.onViewerResize(t)}))}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this),this.onUnitsCalibrationStartsBinded=this.onUnitsCalibrationStarts.bind(this),t.addEventListener(g.Events.UNITS_CALIBRATION_STARTS_EVENT,this.onUnitsCalibrationStartsBinded)}v.prototype=Object.create(Bimfish.Viewing.Extension.prototype),v.prototype.constructor=v;var m=v.prototype;m.load=y(regeneratorRuntime.mark((function t(){var e,i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.svg=this.createSvgElement("svg"),Object(r.setSvgParentAttributes)(e),(i=new h.DomElementStyle).setAttribute("position","absolute"),i.setAttribute("left","0"),i.setAttribute("top","0"),i.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),i.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),e.setAttribute("style",i.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new c.EditFrame(this.viewer.container,this),this.editFrame.addEventListener(s.EVENT_EDITFRAME_EDITION_START,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(s.EVENT_EDITFRAME_EDITION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),n=this.options.markupToolClass||d.MarkupTool,this.changeMarkupTool(n,!this.options.markupDisableHotkeys),t.next=18,this.viewer.loadExtension("Bimfish.Snapping");case 18:return this.snapper=new Bimfish.Viewing.Extensions.Snapping.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper),t.abrupt("return",!0);case 21:case"end":return t.stop()}}),t,this)}))),m.changeMarkupTool=function(t,e){this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.markupTool=new t,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(e),this.viewer.toolController.registerTool(this.markupTool)},m.unload=function(){this.hide(),this.input.detachFrom(this),this.editFrame.unload(),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var t=this.svg;return t&&this.onMouseDownBinded&&(t.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),t.parentNode&&t.parentNode.removeChild(t),this.editModeSvgLayerNode=null,this.svg=null,!0},v.prototype.getStrokeWidth=function(){return(!this.initialStrokeWidth||this.viewer.model&&!this.viewer.model.is2d())&&(this.initialStrokeWidth=this.sizeFromClientToMarkups(0,r.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS).y),this.initialStrokeWidth},v.prototype.getFontWidth=function(){return(!this.initialFontWidth||this.viewer.model&&!this.viewer.model.is2d())&&(this.initialFontWidth=this.sizeFromClientToMarkups(0,r.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS).y),this.initialFontWidth},v.prototype.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},v.prototype.enterEditMode=function(t){function e(t,e){if(t)for(var i=t.markups,n=0;n<i.length;n++){i[n].disableInteractions(e)}}if(t&&!this.svgLayersMap[t])return console.warn("No such layer exists."),!1;if(!this.duringViewMode&&!this.show())return!1;if(!this.editModeSvgLayerNode){var i=this.createSvgElement("g");this.editModeSvgLayerNode={markups:[],svg:i},this.editModeSvgLayerNode.svg.setAttribute("cursor","default")}if(this.editModeSvgLayerNode.svg.parentNode==this.svg&&t||this.svg.appendChild(this.editModeSvgLayerNode.svg),this.svg.setAttribute("cursor","crosshair"),t){var n=this.svgLayersMap[t];if(n){var o=this.editModeSvgLayerNode.svg.parentNode;for(var r in o&&o.removeChild(this.editModeSvgLayerNode.svg),e(this.editModeSvgLayerNode,!0),this.svgLayersMap)for(var a=this.svgLayersMap[r].markups,h=0;h<a.length;h++){var u=a[h];r!==t.toString()?u.disableInteractions(!0):u.disableInteractions(!1)}this.activeLayer=t,this.editingLayer=t;var l=n.svg;l.parentNode&&this.svg.removeChild(l),this.markups=n.markups.slice(),this.svg.appendChild(l)}}else{if(this.editingLayer){for(var c=0;c<this.markups.length;c++){this.markups[c].disableInteractions(!0)}e(this.editModeSvgLayerNode,!1)}this.editingLayer="",this.editModeSvgLayerNode?this.markups=this.editModeSvgLayerNode.markups.slice():this.markups=[],this.activeLayer=""}return this.input.enterEditMode(),this.activateTool(!0),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new p.EditModeArrow(this)),this.actionManager.clear(),this.dispatchEvent({type:s.EVENT_EDITMODE_ENTER}),this.allowNavigation(!1),!0},v.prototype.leaveEditMode=function(){return!this.duringEditMode||!this.duringViewMode||!!this.viewer&&(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.snapper&&(this.snapper.indicator.clearOverlays(),this.snapper.clearSnapped()),this.editModeSvgLayerNode&&this.editModeSvgLayerNode.svg.parentNode&&this.svg.removeChild(this.editModeSvgLayerNode.svg),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.dispatchEvent({type:s.EVENT_EDITMODE_LEAVE}),!0)},v.prototype.toggle=function(){this.duringViewMode?this.hide():this.show()},v.prototype.show=function(){var t=this.viewer;if(!t||!t.model||!this.svg)return!1;if(this.duringViewMode||this.duringEditMode)return!0;t.addEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),t.addEventListener(Bimfish.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),t.container.appendChild(this.svg),t.reorderElements(this.svg),this.input.enterViewMode(),Object(r.hideLmvUi)(t),this.onViewerRolloverObject=t.impl.rolloverObject,t.impl.rolloverObject=function(){},this.activateTool(!0);var e=t.impl.camera;return this.onViewerResize({width:e.clientWidth,height:e.clientHeight}),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},v.prototype.hide=function(){var t=this.viewer;if(!t||!this.duringViewMode)return!0;if(this.duringEditMode&&!this.leaveEditMode())return!1;t.removeEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),t.removeEventListener(Bimfish.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var e=this.svg;return e.parentNode&&e.parentNode.removeChild(e),this.unloadMarkupsAllLayers(),Object(r.removeAllMetadata)(e),this.input.leaveViewMode(),Object(r.restoreLmvUi)(t),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,!0},v.prototype.clear=function(){if(this.duringEditMode){var t=this.editingLayer?this.svgLayersMap[this.editingLayer]:this.editModeSvgLayerNode;if(t){var e=t.markups,i=t.svg;if(i&&i.childNodes.length>0)for(;i.childNodes.length;)i.removeChild(i.childNodes[0]);for(;e.length>0;){var n=e[0];this.removeMarkup(n),n.destroy()}}}else console.warn("Clear only removes markups when in Edit Mode.")},v.prototype.generateData=function(){var t=this.editModeSvgLayerNode.svg;this.editMode&&this.editMode.onSave(),Object(r.removeAllMetadata)(this.svg),this.activeLayer&&(t=this.svgLayersMap[this.activeLayer].svg);var e=this.createSvgElement("svg");Object(r.transferChildNodes)(this.svg,e),Object(r.transferChildNodes)(t,this.svg);var i=[this.addSvgMetadata(this.svg,{"data-model-version":"4"})];this.markups.forEach((function(t){var e=t.setMetadata();e&&i.push(e)}));var n=Object(r.svgNodeToString)(this.svg);return i.forEach((function(t){t.parentNode.removeChild(t)})),Object(r.transferChildNodes)(this.svg,t),Object(r.transferChildNodes)(e,this.svg),e=null,n},v.prototype.generatePoints3d=function(){var t={markups:[],main:null},e=this.markups,i=e.length;if(0===i)return t;for(var n=this.viewer.impl.renderer().readbackTargetId(),s=0;s<i;++s){var r=e[s],a=r.generatePoint3d(n)||null;t.markups.push({id:r.id,type:r.type,point:a||null})}if(1===i){var h=t.markups[0].point;return t.main=h&&h.clone(),t}for(s=0;s<i;++s){var u=t.markups[s];if(u.type===o.MARKUP_TYPE_ARROW&&null!==u.point)return t.main=u.point.clone(),t}var l=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;for(s=0;s<i;++s){var f=e[s].generateBoundingBox();l=Math.min(l,f.min.x),c=Math.min(c,f.min.y),d=Math.max(d,f.max.x),p=Math.max(p,f.max.y)}var y={vertexCount:4};y.xVertices=new Float32Array([l,d,d,l]),y.yVertices=new Float32Array([c,c,p,p]);var g=this.checkPolygon(y,n),v=g&&this.viewer.clientToWorld(g.x,g.y);return t.main=v&&v.point,t},v.prototype.renderToCanvas=function(t,e,i){var n,s=this.bounds.width,o=this.bounds.height,r=this.getSvgViewBox(s,o),a=0,h=[],u=function(){e&&++a===h.length&&e()}.bind(this);if(i)for(var l=Object.keys(this.svg.childNodes),c=Object.keys(this.svgLayersMap),d=0;d<l.length;d++)for(var p=0;p<c.length;p++)n=this.svgLayersMap[c[p]],this.svg.childNodes[l[d]]===n.svg&&(h=h.concat(n.markups));else n=this.svgLayersMap[this.activeLayer]||this.editModeSvgLayerNode,h=n.markups;0===h.length?e():h.forEach((function(e){e.renderToCanvas(t,r,s,o,u)}))},v.prototype.changeEditMode=function(t){var e=this.editMode;e&&e.destroy(),t.addEventListener(s.EVENT_EDITMODE_CREATION_BEGIN,function(){this.disableMarkupInteractions(!0)}.bind(this)),t.addEventListener(s.EVENT_EDITMODE_CREATION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),t.addEventListener(s.EVENT_MARKUP_DESELECT,function(t){this.dispatchEvent(t)}.bind(this)),this.editMode=t,this.styles[t.type]=Object(a.cloneStyle)(t.getStyle()),this.dispatchEvent({type:s.EVENT_EDITMODE_CHANGED,target:t})},v.prototype.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},v.prototype.allowNavigation=function(t){var e=this.editMode;this.navigating=t,t?(this.svg.setAttribute("pointer-events","none"),e&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted");for(var i=this.markups,n=i.length,s=0;s<n;++s)i[s].updateStyle();if(e&&e.notifyAllowNavigation(t),t&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;t&&this.snapper&&(this.snapper.indicator.clearOverlays(),this.snapper.clearSnapped()),this.markupTool.allowNavigation(t)},v.prototype.disableMarkupInteractions=function(t){this.editModeSvgLayerNode&&this.editModeSvgLayerNode.svg.setAttribute("cursor",t?"inherit":"default"),this.markups.forEach((function(e){e.disableInteractions(t)}))},v.prototype.activateTool=function(t){if(t)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Bimfish.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var e=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(e)}this.viewer.removeEventListener(Bimfish.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},v.prototype.onToolChange=function(t){if(t.toolName===this.markupTool.getName()){if(t.active){var e=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:e,zoom:e,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(t.active)}},v.prototype.onUnitsCalibrationStarts=function(t){this.duringEditMode&&this.hide()},m.changeInputHandler=function(t){this.input.detachFrom(this),t.attachTo(this),this.input=t,this.duringEditMode&&t.enterEditMode(),this.duringViewMode&&t.enterViewMode()},v.prototype.copy=function(){this.clipboard.copy()},v.prototype.cut=function(){this.clipboard.cut()},v.prototype.paste=function(){this.clipboard.paste()},v.prototype.undo=function(){this.actionManager.undo()},v.prototype.redo=function(){this.actionManager.redo()},v.prototype.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},v.prototype.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},m.beginActionGroup=function(){this.actionManager.beginActionGroup()},m.closeActionGroup=function(){this.actionManager.closeActionGroup()},m.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},m.getId=function(){return++this.nextId},m.onEditActionHistoryChanged=function(t){var e=t.data;if("undo"!==e.action&&-1!==e.targetId){var i=this.getMarkup(e.targetId);this.selectMarkup(i)}if("undo"===e.action&&!this.isUndoStackEmpty()){i=this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());this.selectMarkup(i)}this.dispatchEvent(t)},v.prototype.getMarkup=function(t){for(var e=this.markups,i=e.length,n=0;n<i;++n)if(e[n].id==t)return e[n];return null},v.prototype.selectMarkup=function(t){if(t)if(this.editMode.type===t.type)this.editMode.setSelection(t);else{var e=t.getEditMode();e.setSelection(null),this.changeEditMode(e),this.setStyle(t.getStyle()),this.editMode.setSelection(t)}else this.editMode&&this.editMode.setSelection(null)},v.prototype.getSelection=function(){return this.editMode.getSelection()},v.prototype.deleteMarkup=function(t,e){(!this.editMode||this.editMode&&this.editMode.selectedMarkup.id!==t.id)&&(this.editMode=t.getEditMode()),this.editMode.deleteMarkup(t,e)},m.addMarkup=function(t){var e,i=this.activeLayer,n=this.svgLayersMap[i]||"";if(n){var o=n.svg;t.setParent(o),n.markups.push(t),e=n.markups.slice()}else t.setParent(this.editModeSvgLayerNode.svg),this.editModeSvgLayerNode.markups.push(t),e=this.editModeSvgLayerNode.markups.slice();t.addEventListener(s.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),t.addEventListener(s.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),t.addEventListener(s.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),t.addEventListener(s.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded),this.duringEditMode&&(this.markups=e)},m.removeMarkup=function(t){if(!t)return!1;var e=this;if(-1===function(t){var i,n=-1;if(e.editModeSvgLayerNode){var s=e.editModeSvgLayerNode.markups;if(-1!==(i=s.indexOf(t)))return s.splice(i,1),n=s.slice(),""===e.activeLayer&&(e.markups=n),n}if(e.svgLayersMap)for(var o in e.svgLayersMap){var r=e.svgLayersMap[o].markups;if(-1!==(i=r.indexOf(t)))return r.splice(i,1),n=r.slice(),e.activeLayer===o&&(e.markups=n),n}return n}(t))return!1;t.setParent(null),t.removeEventListener(s.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),t.removeEventListener(s.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),t.removeEventListener(s.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),t.removeEventListener(s.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded);var i=this.editMode;i&&(i.getSelection()===t&&this.selectMarkup(null))},v.prototype.setStyle=function(t){var e=this.styles,i=this.editMode;Object(a.copyStyle)(t,e[i.type]),i.setStyle(e[i.type])},v.prototype.getStyle=function(){return Object(a.cloneStyle)(this.styles[this.editMode.type])},v.prototype.getDefaultStyle=function(){return this.defaultStyle=this.defaultStyle||Object(a.createStyle)(["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","fill-opacity"],this),this.defaultStyle},m.bringToFront=function(t){this.sendMarkupTo(t,this.markups.length-1)},m.sendToBack=function(t){this.sendMarkupTo(t,0)},m.bringForward=function(t){var e=this.markups.indexOf(t);this.sendMarkupTo(t,e+1)},m.bringBackward=function(t){var e=this.markups.indexOf(t);this.sendMarkupTo(t,e-1)},m.sendMarkupTo=function(t,e){var i=this.markups,n=i.indexOf(t);if(!(-1===n||e<0||e>=i.length))if(i.splice(n,1),e=n>e?e-1:e,i.splice(e,0,t),t.setParent(null),this.activeLayer){var s=this.svgLayersMap[this.activeLayer].svg;t.setParent(s)}else t.setParent(this.editModeSvgLayerNode.svg)},v.prototype.loadMarkups=function(t,e){if(this.duringEditMode)return console.warn("Markups will not be loaded during the edit mode"),!1;if(!this.duringViewMode)return!1;if(!e)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var i=Object(r.stringToSvgNode)(t);if(!i)return!1;if(e in this.svgLayersMap&&this.svg.childNodes.length>0)return console.warn("This layer is already loaded, will not load again."),!1;this.activeLayer=e;var n=this.svgLayersMap[e];n&&delete this.svgLayersMap[e],n={markups:[],svgString:t,svg:this.createLayerNode()},this.svgLayersMap[e]=n;for(var s=i.childNodes,o=0;o<s.length;o++){var a=s[o],h=Object(r.createMarkupFromSVG)(a,this);h&&this.duringEditMode&&this.editingLayer!==this.activeLayer&&h.disableInteractions(!0),h||"metadata"===a.localName||(n.svg.appendChild(a),o--,"function"==typeof a.setAttribute&&a.setAttribute("pointer-events","none"))}var u=this.svgLayersMap[this.activeLayer].svg;return this.svg.appendChild(u),this.duringEditMode&&this.editingLayer!==this.activeLayer&&(this.activeLayer=this.editingLayer,this.editingLayer&&(this.markups=this.svgLayersMap[this.activeLayer].markups.slice())),!0},m.createLayerNode=function(){var t=this.createSvgElement("g");return t.setAttribute("cursor","default"),t},v.prototype.revertLayer=function(t){if(!t)return console.warn("revertLayer failed because no layerId was supplied."),!1;var e=this.svgLayersMap[t];if(!e)return console.warn("The supplied layer does not exist."),!1;this.duringEditMode&&this.leaveEditMode();var i=this.markups.slice();this.markups=e.markups;var n=e.svgString;if(this.unloadMarkups(t),this.loadMarkups(n,t),this.editingLayer){if(this.editingLayer!==t){this.markups=i;var s=this.svgLayersMap[this.editingLayer];s&&(s.markups=i)}}else this.editModeSvgLayerNode&&(this.editModeSvgLayerNode.markups=i);if(this.editingLayer||0===this.editingLayer.length){var o=0===this.editingLayer.length?this.editModeSvgLayerNode.svg:this.svgLayersMap[this.editingLayer].svg;o.parentNode==this.svg&&(this.svg.removeChild(o),this.svg.appendChild(o))}return!0},v.prototype.unloadMarkups=function(t){if(!t)return console.warn("unloadMarkups failed; No layerId provided."),!1;var e=this.svgLayersMap[t];if(!e)return console.warn("No such layer exists to unload."),!1;for(var i=e.markups.slice(),n=i.length,s=0;s<n;s++){var o=i[s];this.removeMarkup(o),o.destroy()}return e.svg.parentNode===this.svg&&this.svg.removeChild(e.svg),delete this.svgLayersMap[t],this.activeLayer.toString()===t.toString()&&(this.activeLayer=""),this.editingLayer&&this.editingLayer.toString()===t.toString()&&(this.editingLayer="",this.duringEditMode&&this.leaveEditMode()),!0},v.prototype.unloadMarkupsAllLayers=function(){this.activeLayer="";var t,e=this;for(t in function(){if(e.editModeSvgLayerNode)for(var t=e.editModeSvgLayerNode.markups.slice(),i=t.length,n=0;n<i;n++){var s=t[n];e.removeMarkup(s),s.destroy()}}(),this.svgLayersMap)this.unloadMarkups(t)},v.prototype.hideMarkups=function(t){if(!t)return console.warn("hideMarkups failed; No layerId provided."),!1;var e=this.svgLayersMap[t];if(!e)return!1;var i=e.svg;return i.parentNode!=this.svg?(console.warn("Layer is already hidden."),!1):(this.svg.removeChild(i),!0)},v.prototype.showMarkups=function(t){if(!t)return console.warn("showMarkups failed; No layerId provided."),!1;var e=this.svgLayersMap[t];if(!e)return!1;var i=e.svg;this.svg.appendChild(i)},m.positionFromClientToMarkups=function(t,e){return this.clientToMarkups(t,e)},m.positionFromMarkupsToClient=function(t,e){return this.markupsToClient(t,e)},m.vectorFromClientToMarkups=function(t,e){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(t,e);return{x:n.x-i.x,y:n.y-i.y}},m.vectorFromMarkupsToClient=function(t,e){var i=this.markupsToClient(0,0),n=this.markupsToClient(t,e);return{x:n.x-i.x,y:n.y-i.y}},m.sizeFromClientToMarkups=function(t,e){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(t,e);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},m.sizeFromMarkupsToClient=function(t,e){var i=this.markupsToClient(0,0),n=this.markupsToClient(t,e);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},m.markupsToClient=function(t,e){var i=this.viewer.impl.camera,n=new THREE.Vector3(t,e,0);if(i.isPerspective){var s=this.viewer.impl.getCanvasBoundingClientRect();n.x=n.x/1e3*(.5*s.height)+.5*s.width,n.y=-n.y/1e3*(.5*s.height)+.5*s.height}else{n.applyMatrix4(i.matrixWorld),n.sub(i.position);var o=this.viewer.model&&this.viewer.model.getData().globalOffset;o&&n.sub(o),(n=Object(r.worldToClient)(n,this.viewer,!1)).z=0}return n},m.clientToMarkups=function(t,e){var i=this.viewer.impl.camera,n=new THREE.Vector3(t,e,0);if(i.isPerspective){var s=this.viewer.impl.getCanvasBoundingClientRect();n.x=(n.x-.5*s.width)/(.5*s.height)*1e3,n.y=-(n.y-.5*s.height)/(.5*s.height)*1e3}else{n=Object(r.clientToWorld)(n.x,n.y,0,this.viewer);var o=this.viewer.model&&this.viewer.model.getData().globalOffset;o&&n.add(o),n.add(i.position),n.applyMatrix4(i.matrixWorldInverse),n.z=0}return n},m.getSvgViewBox=function(t,e){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(t,e),s=Math.min(i.x,n.x),o=Math.min(i.y,n.y);return[s,o,Math.max(i.x,n.x)-s,Math.max(i.y,n.y)-o].join(" ")},m.getBounds=function(){return this.bounds},m.getMousePosition=function(){return this.editMode.useWithSnapping()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition()},m.getSnapPosition=function(){var t=g.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer),e=this.project(t);return{x:e.x,y:e.y}},m.project=function(t){var e=this.viewer.navigation.getCamera(),i=this.viewer.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(t);return n.project(e),new THREE.Vector3(Math.round((n.x+1)/2*i.width),Math.round((1-n.y)/2*i.height),n.z)},m.onCameraChange=function(t){var e=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==e){this.svg&&this.svg.setAttribute("viewBox",e);var i=this.editMode;if(i){if(this.editFrame.isActive()){var n=i.getSelection();this.editFrame.setMarkup(n)}i.updateTextBoxStyle&&i.updateTextBoxStyle(),this.snapper&&i.useWithSnapping()&&this.snapper.indicator.render()}}},m.onViewerResize=function(t){this.bounds.x=0,this.bounds.y=0,this.bounds.width=t.width,this.bounds.height=t.height,this.svg&&(this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height)),this.onCameraChange()},m.callSnapperMouseDown=function(){if(this.editMode&&this.editMode.useWithSnapping()){var t=this.input.getMousePosition();this.snapper&&(this.snapper.onMouseDown(t),this.snapper.indicator.render())}else this.snapper&&(this.snapper.clearSnapped(),this.snapper.indicator.clearOverlays())},m.callSnapperMouseMove=function(){if(this.editMode&&this.editMode.useWithSnapping()){var t=this.input.getMousePosition();this.snapper&&(this.snapper.onMouseMove(t),this.snapper.indicator.render())}},m.onMouseMove=function(t){this.navigating||(this.editFrame.isActive()&&"mousemove"===t.type&&this.editFrame.onMouseMove(t),this.callSnapperMouseMove(),this.editMode&&this.editMode.onMouseMove(t))},m.onMouseDown=function(t){Object(r.dismissLmvHudMessage)(),this.callSnapperMouseDown();var e=this.getBounds(),i=this.getMousePosition();i.x>=e.x&&i.x<=e.x+e.width&&i.y>=e.y&&i.y<=e.y+e.height&&this.editMode.onMouseDown(t),this.editMode.creating||t.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1},m.onMouseUp=function(t){this.navigating||(this.editFrame.isActive()?this.editFrame.onMouseUp(t):this.ignoreNextMouseUp||this.editMode.onMouseUp(t))},m.onMouseDoubleClick=function(t){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(t)},m.onUserCancel=function(){this.editMode&&(this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect())},m.onMarkupSelected=function(t){this.selectMarkup(t.markup),this.dispatchEvent(t)},m.onMarkupEnterEdition=function(t){},m.onMarkupCancelEdition=function(t){this.onUserCancel()},m.onMarkupDeleteEdition=function(t){this.removeMarkup(t.markup),this.editMode.deleteMarkup()},Bimfish.Viewing.theExtensionManager.registerExtension("Bimfish.Viewing.MarkupsCore",v)},"./extensions/Markup/core/MarkupsCoreUtils.js":
/*!****************************************************!*\
  !*** ./extensions/Markup/core/MarkupsCoreUtils.js ***!
  \****************************************************/
/*! exports provided: MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS, EDIT_FRAME_DEFAULT_MARGIN, isTouchDevice, createSvgElement, setSvgParentAttributes, createMarkupGroupSvg, createMarkupPathSvg, setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, createMarkupTextSvg, setMarkupTextSvgTransform, updateMarkupTextSvgHitarea, updateMarkupTextSvgBackground, updateMarkupTextSvgClipper, addSvgMetadata, addMarkupMetadata, removeAllMetadata, transferChildNodes, getUniqueID, svgNodeToString, stringToSvgNode, addTraitEventDispatcher, removeTraitEventDispatcher, worldToClient, clientToWorld, clientToViewport, viewportToClient, worldToViewport, metersToModel, radiansToDegrees, degreesToRadians, sign, areMarkupsPointsInClientRange, hideLmvUi, restoreLmvUi, hideLmvPanels, showLmvToolsAndPanels, hideLmvToolsAndPanels, dismissLmvHudMessage, getStrokeWidth, createMarkupFromSVG, composeRGBAString, checkLineSegment, checkPolygon, createStyleSheet, addRuleToStyleSheet, measureTextLines, createArcTo, createEllipsePath, createRectanglePath, renderToCanvas, simplify */function(t,e,i){"use strict";i.r(e),i.d(e,"MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS",(function(){return E})),i.d(e,"MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS",(function(){return k})),i.d(e,"MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS",(function(){return b})),i.d(e,"EDIT_FRAME_DEFAULT_MARGIN",(function(){return T})),i.d(e,"isTouchDevice",(function(){return w})),i.d(e,"createSvgElement",(function(){return S})),i.d(e,"setSvgParentAttributes",(function(){return C})),i.d(e,"createMarkupGroupSvg",(function(){return A})),i.d(e,"createMarkupPathSvg",(function(){return P})),i.d(e,"setAttributeToMarkupSvg",(function(){return j})),i.d(e,"updateMarkupPathSvgHitarea",(function(){return D})),i.d(e,"createMarkupTextSvg",(function(){return I})),i.d(e,"setMarkupTextSvgTransform",(function(){return R})),i.d(e,"updateMarkupTextSvgHitarea",(function(){return O})),i.d(e,"updateMarkupTextSvgBackground",(function(){return _})),i.d(e,"updateMarkupTextSvgClipper",(function(){return N})),i.d(e,"addSvgMetadata",(function(){return B})),i.d(e,"addMarkupMetadata",(function(){return z})),i.d(e,"removeAllMetadata",(function(){return H})),i.d(e,"transferChildNodes",(function(){return L})),i.d(e,"getUniqueID",(function(){return V})),i.d(e,"svgNodeToString",(function(){return F})),i.d(e,"stringToSvgNode",(function(){return U})),i.d(e,"addTraitEventDispatcher",(function(){return G})),i.d(e,"removeTraitEventDispatcher",(function(){return Y})),i.d(e,"worldToClient",(function(){return W})),i.d(e,"clientToWorld",(function(){return K})),i.d(e,"clientToViewport",(function(){return X})),i.d(e,"viewportToClient",(function(){return q})),i.d(e,"worldToViewport",(function(){return $})),i.d(e,"metersToModel",(function(){return Z})),i.d(e,"radiansToDegrees",(function(){return J})),i.d(e,"degreesToRadians",(function(){return Q})),i.d(e,"sign",(function(){return tt})),i.d(e,"areMarkupsPointsInClientRange",(function(){return et})),i.d(e,"hideLmvUi",(function(){return it})),i.d(e,"restoreLmvUi",(function(){return nt})),i.d(e,"hideLmvPanels",(function(){return st})),i.d(e,"showLmvToolsAndPanels",(function(){return ot})),i.d(e,"hideLmvToolsAndPanels",(function(){return rt})),i.d(e,"dismissLmvHudMessage",(function(){return at})),i.d(e,"getStrokeWidth",(function(){return ht})),i.d(e,"createMarkupFromSVG",(function(){return ut})),i.d(e,"composeRGBAString",(function(){return lt})),i.d(e,"checkLineSegment",(function(){return ct})),i.d(e,"checkPolygon",(function(){return dt})),i.d(e,"createStyleSheet",(function(){return pt})),i.d(e,"addRuleToStyleSheet",(function(){return ft})),i.d(e,"measureTextLines",(function(){return yt})),i.d(e,"createArcTo",(function(){return gt})),i.d(e,"createEllipsePath",(function(){return vt})),i.d(e,"createRectanglePath",(function(){return mt})),i.d(e,"renderToCanvas",(function(){return Mt})),i.d(e,"simplify",(function(){return xt}));var n=i(/*! ../core/MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),s=i(/*! ./edit-actions/CreateArrow */"./extensions/Markup/core/edit-actions/CreateArrow.js"),o=i(/*! ./edit-actions/CreateRectangle */"./extensions/Markup/core/edit-actions/CreateRectangle.js"),r=i(/*! ./edit-actions/CreateText */"./extensions/Markup/core/edit-actions/CreateText.js"),a=i(/*! ./edit-actions/CreateCallout */"./extensions/Markup/core/edit-actions/CreateCallout.js"),h=i(/*! ./edit-actions/CreateCircle */"./extensions/Markup/core/edit-actions/CreateCircle.js"),u=i(/*! ./edit-actions/CreateCloud */"./extensions/Markup/core/edit-actions/CreateCloud.js"),l=i(/*! ./edit-actions/CreateFreehand */"./extensions/Markup/core/edit-actions/CreateFreehand.js"),c=i(/*! ./edit-actions/CreatePolyline */"./extensions/Markup/core/edit-actions/CreatePolyline.js"),d=i(/*! ./edit-actions/CreatePolycloud */"./extensions/Markup/core/edit-actions/CreatePolycloud.js"),p=i(/*! ./edit-actions/CreateHighlight */"./extensions/Markup/core/edit-actions/CreateHighlight.js"),f=i(/*! ./edit-actions/CreateDimension */"./extensions/Markup/core/edit-actions/CreateDimension.js"),y=i(/*! ./DomElementStyle */"./extensions/Markup/core/DomElementStyle.js"),g=i(/*! ../../../thirdparty/canvg/canvg.js */"./thirdparty/canvg/canvg.js"),v=Bimfish.Viewing,m=Bimfish.Viewing.Private,M=v.getGlobal(),x=M.document,E=1,k=10,b=15,T=7,w=function(){return!(!v.isTouchDevice||"function"!=typeof Hammer)&&v.isTouchDevice()},S=function(t){return(this&&this.getDocument&&this.getDocument()||x).createElementNS("http://www.w3.org/2000/svg",t)},C=function(t){return t.setAttribute("version","1.1"),t.setAttribute("baseProfile","full"),t.setAttribute("layer-order-id","markups-svg"),t},A=function(t){t=t||[];var e=S("g");e.setAttribute("cursor","default"),e.setAttribute("pointer-events","none");for(var i=0;i<t.length;i++)e.appendChild(t[i]);return e},P=function(){var t=S("g");t.setAttribute("cursor","inherit"),t.setAttribute("pointer-events","none");var e=S("path");e.setAttribute("id","markup");var i=S("path");return i.setAttribute("id","hitarea"),i.setAttribute("fill","transparent"),i.setAttribute("stroke","transparent"),t.markup=e,t.hitarea=i,t.appendChild(e),t.appendChild(i),t},j=function(t,e,i){t.markup.setAttribute(e,i)},D=function(t,e){var i=t.markup,n=t.hitarea,s=e.sizeFromClientToMarkups(0,b).y;s+=parseFloat(i.getAttribute("stroke-width"))+s;var o=i.getAttribute("fill"),r=i.getAttribute("stroke"),a=""!==r&&"none"!==r,h=""!==o&&"none"!==o;if(n.setAttribute("d",i.getAttribute("d")),n.setAttribute("stroke-width",s),n.setAttribute("transform",i.getAttribute("transform")),e.duringEditMode&&!e.navigating){if(a&&h)return void t.setAttribute("pointer-events","painted");if(a)return void t.setAttribute("pointer-events","stroke");if(h)return void t.setAttribute("pointer-events","fill")}t.setAttribute("pointer-events","none")},I=function(){var t=S("g");t.setAttribute("cursor","default");var e="markup-clipper-"+V(),i="url(#"+e+")",n=S("clipPath");n.setAttribute("id",e),n.removeAttribute("pointer-events"),n.rect=S("rect"),n.appendChild(n.rect);var s=S("rect");s.setAttribute("id","markup-background"),s.removeAttribute("pointer-events");var o=S("text");o.setAttribute("id","markup");var r=S("rect");r.setAttribute("id","hitarea"),r.setAttribute("fill","transparent"),r.setAttribute("stroke","none"),r.setAttribute("stroke-width","0");var a=S("g");return a.setAttribute("clip-path",i),a.appendChild(n),a.appendChild(s),a.appendChild(o),t.appendChild(a),t.appendChild(r),t.clipper=n,t.background=s,t.markup=o,t.hitarea=r,t},R=function(t,e,i){t.clipper.rect.setAttribute("transform",e),t.background.setAttribute("transform",e),t.markup.setAttribute("transform",i),t.hitarea.setAttribute("transform",e)},O=function(t,e,i,n){var s=t.hitarea,o=n.sizeFromClientToMarkups(0,b).y;s.setAttribute("x",-o),s.setAttribute("y",-o),s.setAttribute("width",e+2*o),s.setAttribute("height",i+2*o),t.setAttribute("pointer-events",n.navigating?"none":"painted")},_=function(t,e,i,n){var s=t.background;s.setAttribute("x",0),s.setAttribute("y",0),s.setAttribute("width",e),s.setAttribute("height",i),s.setAttribute("fill",n)},N=function(t,e,i){var n=t.clipper;n.rect.setAttribute("x",0),n.rect.setAttribute("y",0),n.rect.setAttribute("width",e),n.rect.setAttribute("height",i)},B=function(t,e){var i=this&&this.getDocument&&this.getDocument()||x,n=i.createElementNS("http://www.w3.org/2000/svg","metadata"),s=i.createElement("markup_document");return n.appendChild(s),s.setAttribute("data-model-version",e["data-model-version"]),t.insertBefore(n,t.firstChild),n},z=function(t,e){var i=this&&this.getDocument&&this.getDocument()||x,n=i.createElementNS("http://www.w3.org/2000/svg","metadata"),s=i.createElement("markup_element");for(var o in n.appendChild(s),e)e.hasOwnProperty(o)&&s.setAttribute(o,e[o]);return t.insertBefore(n,t.firstChild),n},H=function t(e){if(e.getElementsByTagName)for(var i=e.getElementsByTagName("metadata"),n=0;n<i.length;++n){var s=i[n];s.parentNode&&s.parentNode.removeChild(s)}var o=e.children||e.childNodes;if(o)for(n=0;n<o.length;++n)t(o[n])},L=function(t,e){for(var i=t.children||t.childNodes,n=[],s=0;s<i.length;++s)n.push(i[s]);n.forEach((function(t){e.appendChild(t)}))},V=function(){return THREE.Math.generateUUID()},F=function(t){var e;try{var i=[];!function t(e,i){var n=e.hitarea,s=n&&n.parentNode;s&&(i.push({hitarea:n,parent:s}),s.removeChild(n));for(var o=e.childNodes,r=o.length,a=0;a<r;++a)t(o.item(a),i)}(t,i),e=(new XMLSerializer).serializeToString(t),function(t){for(var e=t.length,i=0;i<e;++i){var n=t[i];n.parent.appendChild(n.hitarea)}}(i)}catch(t){e="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return e},U=function(t){var e=null;try{e=(new DOMParser).parseFromString(t,"text/xml").firstChild}catch(t){e=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return e},G=function(t){t.listeners={},t.addEventListener=function(t,e){void 0===this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(e)},t.hasEventListener=function(t,e){if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},t.removeEventListener=function(t,e){if(this.listeners[t]instanceof Array)for(var i=this.listeners[t],n=0,s=i.length;n<s;n++)if(i[n]===e){i.splice(n,1);break}},t.dispatchEvent=function(t){if("string"==typeof t&&(t={type:t}),t.target||(t.target=this),!t.type)throw new Error("event type unknown.");if(this.listeners[t.type]instanceof Array)for(var e=this.listeners[t.type].slice(),i=0;i<e.length;i++)e[i].call(this,t)}},Y=function(t){try{delete t.listeners,delete t.addEventListener,delete t.hasEventListener,delete t.removeEventListener,delete t.dispatchEvent}catch(t){}},W=function(t,e,i){var n=$(t,e),s=q(n.x,n.y,e);return s.z=0,i&&(s.x=Math.floor(s.x)+.5,s.y=Math.floor(s.y)+.5),s},K=function(t,e,i,n){var s=X(t,e,n);return s.z=i,s.unproject(n.impl.camera),s},X=function(t,e,i){return i.impl.clientToViewport(t,e)},q=function(t,e,i){return i.impl.viewportToClient(t,e)},$=function(t,e){var i=new THREE.Vector3;return i.x=t.x,i.y=t.y,i.z=t.z,i.project(e.impl.camera),i},Z=function(t,e){return 1/e.model.getUnitScale()*t},J=function(t){return t*(180/Math.PI)},Q=function(t){return t*(Math.PI/180)},tt=function(t){return t>=0?1:-1},et=function(t,e,i,n){i=n.sizeFromClientToMarkups(0,i).y;var s=t.x-e.x,o=t.y-e.y;return i*i>=s*s+o*o},it=function(t){t.toolbar&&(t.setActiveNavigationTool(),at(),st(!0,t),rt(t))},nt=function(t){t.toolbar&&(at(),st(!1,t),ot(t))},st=function(t,e){var i=e.dockingPanels;if(i)for(var n=0;n<i.length;++n){var s=i[n],o=s.container;o.classList.contains("dockingPanelVisible")&&(o.style.display=t?"none":"block",s.visibilityChanged())}},ot=function(t){t&&t.model&&!t.model.is2d()&&t.getExtension("Bimfish.ViewCubeUi",(function(t){t.displayViewCube(!0,!1),t.displayHomeButton(!0)}));var e=t.getDocument().getElementsByClassName("toolbar-animation-subtoolbar");if(e.length>0&&(e[0].style.display=""),t.toolbar)for(var i=t.toolbar.container,n=i.children.length,s=0;s<n;++s)i.children[s].style.display=""},rt=function(t){t&&t.model&&!t.model.is2d()&&t.getExtension("Bimfish.ViewCubeUi",(function(t){t.displayViewCube(!1,!1),t.displayHomeButton(!1)}));var e=t.getDocument().getElementsByClassName("toolbar-animation-subtoolbar");if(e.length>0){e[0].style.display="none";var i=t.impl.keyFrameAnimator;if(i&&!i.isPaused){i.pauseCameraAnimations(),i.pause();var n=t.modelTools.getControl("toolbar-animationPlay");n&&(n.setIcon("toolbar-animation-pause-icon"),n.setToolTip("Pause"))}}if(t.toolbar)for(var s=t.toolbar.container,o=s.children.length,r=0;r<o;++r)s.children[r].style.display="none"},at=function(){try{for(var t=!0;t;)t=Bimfish.Viewing.Private.HudMessage.dismiss()}catch(t){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},ht=function(t,e){return e.sizeFromClientToMarkups(0,t).y},ut=function(t,e){if(!t.childNodes[0])return null;var i=t.childNodes[0].childNodes[0]||"",y=function(){var e=t.childNodes[1]||"",i=!1;if("string"!=typeof e){var n=e.getAttribute("d").split(" ");"z"===n[n.length-1].toLowerCase()&&(i=!0)}return i},g=function(){for(var t=[],e=i.getAttribute("locations").split(" ")||"",n=0;n<e.length;n+=2){var s={x:parseFloat(e[n]),y:parseFloat(e[n+1])};t.push(s)}return t},v=function(t){var e=new THREE.Vector3,n=(i.getAttribute(t)||i.getAttribute(t.toLowerCase())).split(" ");return e.x=parseFloat(n[0]),e.y=parseFloat(n[1]),e},M=function(){return v("position")},x=function(){return v("size")},E=function(){var t=i.getAttribute("rotation")||"";return parseFloat(t)},k=function(){return i.getAttribute("text")||""};if("string"!=typeof i){var b,T,w,S,C,A,P,j,D,I,R,O=e.getId(),_=function(t,e){for(var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-size","font-style","font-weight","stroke-linejoin"],n={},s=0;s<i.length;s++){var o=e.getAttribute(i[s]);if(null!=o)switch(i[s]){case"font-size":case"stroke-width":case"stroke-opacity":case"fill-opacity":n[i[s]]=parseFloat(o);break;case"stroke-linejoin":break;case"font-family":case"font-style":case"font-weight":case"stroke-color":case"fill-color":n[i[s]]=o;break;default:m.logger.warn("Style not recognized.")}}return n}(0,i);switch(i.getAttribute("type")||""){case n.MARKUP_TYPE_ARROW:C=v("tail"),A=v("head"),R=new s.CreateArrow(e,O,C,A,_);break;case n.MARKUP_TYPE_RECTANGLE:b=M(),T=x(),w=E(),R=new o.CreateRectangle(e,O,b,T,w,_);break;case n.MARKUP_TYPE_TEXT:b=M(),T=x(),j=k(),R=new r.CreateText(e,O,b,T,j,_);break;case n.MARKUP_TYPE_CALLOUT:b=M(),T=x(),j=k();var N=!!parseInt(i.getAttribute("isframeused"));R=new a.CreateCallout(e,O,b,T,j,_,N);break;case n.MARKUP_TYPE_CIRCLE:b=M(),T=x(),w=E(),R=new h.CreateCircle(e,O,b,T,w,_);break;case n.MARKUP_TYPE_CLOUD:b=M(),T=x(),w=E(),R=new u.CreateCloud(e,O,b,T,w,_);break;case n.MARKUP_TYPE_FREEHAND:b=M(),T=x(),w=E(),S=g(),R=new l.CreateFreehand(e,O,b,T,w,S,_);break;case n.MARKUP_TYPE_POLYLINE:b=M(),T=x(),w=E(),S=g(),P=y(),R=new c.CreatePolyline(e,O,b,T,w,S,_,P);break;case n.MARKUP_TYPE_POLYCLOUD:b=M(),T=x(),w=E(),S=g(),P=y(),R=new d.CreatePolycloud(e,O,b,T,w,S,_,P);break;case n.MARKUP_TYPE_HIGHLIGHT:b=M(),T=x(),w=E(),S=g(),R=new p.CreateHighlight(e,O,b,T,w,S,_);break;case n.MARKUP_TYPE_DIMENSION:D=v("firstAnchor"),I=v("secondAnchor"),j=k(),R=new f.CreateDimension(e,O,D,I,j,_);break;default:R=null}if(R){R.addToHistory=!1,R.execute();for(var B=e.svgLayersMap[e.activeLayer].markups,z=0;z<B.length;++z)if(B[z].id===O)return B[z]}return null}},lt=function(t,e){return!t||!e||e<=0?"none":["rgba("+parseInt("0x"+t.substr(1,2)),",",parseInt("0x"+t.substr(3,2)),",",parseInt("0x"+t.substr(5,2)),",",e,")"].join("")},ct=function(t,e,i,n,s){var o=(this&&this.getWindow&&this.getWindow()||M).devicePixelRatio||1;t*=o,e*=o,i*=o,n*=o;var r=s.width,a=s.height,h=s.buffer;function u(t,e){t=Math.round(t),e=Math.round(e);for(var i=0,n=0,s=-o;s<=o;s+=2*o)n+=l(t,e+s)?s:0;for(var r=-o;r<=o;r+=2*o)i+=l(t+r,e)?r:0;return{x:Math.round(t/o+i),y:Math.round((a-e)/o-n)}}function l(t,e){if(t<0||t>=r||e<0||e>=a)return!1;var i=4*(e*r+t);return 255!==h[i]||255!==h[i+1]||255!==h[i+2]}t=Math.round(t),i=Math.round(i),e=Math.round(a-e),n=Math.round(a-n);var c=i-t,d=0!==c?(n-e)/c:1,p=t,f=e;if(0!==c&&Math.abs(d)<=1){if(t<=i){for(;p<=i;++p,f+=d)if(l(p,Math.round(f)))return u(p,f)}else for(;p>=i;--p,f-=d)if(l(p,Math.round(f)))return u(p,f)}else if(d=0!==c?1/d:0,e<=n){for(;f<=n;++f,p+=d)if(l(Math.round(p),f))return u(p,f)}else for(;f>=n;--f,p-=d)if(l(Math.round(p),f))return u(p,f)},dt=function(t,e){if(!t||t.verxtexCount<3||!e)return null;var i=(this&&this.getWindow&&this.getWindow()||M).devicePixelRatio||1,n=e.width,s=e.height,o=e.buffer,r=t.vertexCount,a=Float32Array.from(t.xVertices),h=Float32Array.from(t.yVertices);function u(t,e){for(var n=0,o=0,r=-i;r<=i;r+=2*i)o+=l(t,e+r)?r:0;for(var a=-i;a<=i;a+=2*i)n+=l(t+a,e)?a:0;return{x:Math.round(t/i)+n,y:Math.round((s-e)/i-o)}}function l(e,i){if(e<0||e>=n||i<0||i>=s)return!1;var r=4*(i*n+e);return(255!==o[r]||255!==o[r+1]||255!==o[r+2])&&function(e,i){for(var n=!1,s=t.vertexCount,o=0,r=s-1;o<s;r=o++)h[o]>i!=h[r]>i&&e<(a[r]-a[o])*(i-h[o])/(h[r]-h[o])+a[o]&&(n=!n);return n}(e,i)}for(var c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY,y=0;y<r;++y){var g=a[y]=a[y]*i,v=h[y]=s-h[y]*i;c=Math.min(c,g),d=Math.min(d,v),p=Math.max(p,g),f=Math.max(f,v)}if(p<0||c>n||f<0||d>s)return null;var m=Math.round(p-c),x=Math.round(f-d),E=Math.round(.5*(c+p)),k=Math.round(.5*(d+f)),b=1,T=1;do{for(var w=E+b,S=k+T;E<w;++E)if(l(E,k))return u(E,k);for(;k<S;++k)if(l(E,k))return u(E,k);for(b<m?(w=E-++b,++b):w=E-b,T<x?(S=k-++T,++T):S=k-T;E>w;--E)if(l(E,k))return u(E,k);for(;k>S;--k)if(l(E,k))return u(E,k)}while(b<m||T<x)},pt=function(){var t=this&&this.getDocument&&this.getDocument()||x,e=t.createElement("style");return e.appendChild(t.createTextNode("")),t.head.appendChild(e),e.sheet},ft=function(t,e,i,n){"insertRule"in t?t.insertRule(e+"{"+i+"}",n):"addRule"in t&&t.addRule(e,i,n)},yt=function(t,e,i){var n=i.sizeFromMarkupsToClient(0,e["font-size"]).y,s=(new y.DomElementStyle).setAttribute("font-family",e["font-family"]).setAttribute("font-size",n+"px").setAttribute("font-weight",e["font-weight"]?"bold":"").setAttribute("font-style",e["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),o=(this&&this.getDocument&&this.getDocument()||x).createElement("div");o.setAttribute("style",s),i.viewer.container.appendChild(o);for(var r=[],a=t.length,h=0;h<a;++h)o.innerText=t[h],r.push({line:t[h],width:o.clientWidth,height:o.clientHeight});return i.viewer.container.removeChild(o),r},gt=function(t,e,i,n,s,o){return o.push(s?"a":"A"),o.push(i),o.push(n),o.push(0),o.push(1),o.push(1),o.push(t),o.push(e),o},vt=function(t,e,i,n,s,o){var r=.5*i,a=.5*n;o.push(s?"m":"M"),o.push(t),o.push(e),gt(i,0,r,a,!0,o),gt(-i,0,r,a,!0,o),o.push("z")},mt=function(t,e,i,n,s,o){o.push(s?"m":"M"),o.push(t),o.push(e),o.push("l"),o.push(i),o.push(0),o.push("l"),o.push(0),o.push(n),o.push("l"),o.push(-i),o.push(0),o.push("z")},Mt=function(t,e,i,n,s,o){var r=S("svg");v.isIE11||r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",i),r.setAttribute("height",n),r.setAttribute("viewBox",e),r.setAttribute("transform","scale(1,-1)");var a=t.parentNode.cloneNode(!0);r.appendChild(a);var h=this&&this.getWindow&&this.getWindow()||M,u=(this&&this.getDocument&&this.getDocument()||x).createElement("div"),l=r.cloneNode(!0);u.appendChild(l);var c=u.innerHTML;r=u=l=null;var d=function(){g(s.canvas,c,{ignoreMouse:!0,ignoreDimensions:!0,ignoreClear:!0,renderCallback:o})};if(v.isIE11)d();else{var p=new Image;p.onload=function(){s.drawImage(p,0,0),o()},p.onerror=function(){d()},p.src="data:image/svg+xml;base64,"+h.btoa(unescape(encodeURIComponent(c)))}},xt=function(t,e,i){if(t.length<=2)return t;function n(t,e,i){var n=e.x,s=e.y,o=i.x-n,r=i.y-s;if(0!==o||0!==r){var a=((t.x-n)*o+(t.y-s)*r)/(o*o+r*r);a>1?(n=i.x,s=i.y):a>0&&(n+=o*a,s+=r*a)}return(o=t.x-n)*o+(r=t.y-s)*r}var s=void 0!==e?e*e:1;return t=function(t,e){var i=t.length-1,s=[t[0]];return function t(e,i,s,o,r){for(var a,h=o,u=i+1;u<s;u++){var l=n(e[u],e[i],e[s]);l>h&&(a=u,h=l)}h>o&&(a-i>1&&t(e,i,a,o,r),r.push(e[a]),s-a>1&&t(e,a,s,o,r))}(t,0,i,e,s),s.push(t[i]),s}(t=i?t:function(t,e){for(var i,n,s,o,r,a=t[0],h=[a],u=1,l=t.length;u<l;u++)i=t[u],s=a,o=void 0,r=void 0,o=(n=i).x-s.x,r=n.y-s.y,o*o+r*r>e&&(h.push(i),a=i);return a!==i&&h.push(i),h}(t,s),s)}},"./extensions/Markup/core/StyleUtils.js":
/*!**********************************************!*\
  !*** ./extensions/Markup/core/StyleUtils.js ***!
  \**********************************************/
/*! exports provided: createStyle, copyStyle, isStyleEqual, cloneStyle, getStyleDefaultValues */function(t,e,i){"use strict";i.r(e),i.d(e,"createStyle",(function(){return n})),i.d(e,"copyStyle",(function(){return s})),i.d(e,"isStyleEqual",(function(){return o})),i.d(e,"cloneStyle",(function(){return r})),i.d(e,"getStyleDefaultValues",(function(){return a}));var n=function(t,e){for(var i={},n=0;n<t.length;++n)i[t[n]]=null;var s=a(i,e);for(n=0;n<t.length;++n){var o=t[n];i[o]=s[o].values[s[o].default].value}return i},s=function(t,e){for(var i in e)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},o=function(t,e){for(var i in e)if(t.hasOwnProperty(i)&&t[i]!==e[i])return!1;return!0},r=function(t){var e={};for(var i in t)e[i]=t[i];return e},a=function(t,e){function i(t){return{values:[{name:"Thin",value:t/2},{name:"Normal",value:t},{name:"Thick",value:4*t}],default:1}}function n(t){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:t?4:0}}var s,o=r(t),a=e.getStrokeWidth(),h=e.getFontWidth();for(var u in o)switch(u){case"stroke-width":o[u]={values:[{name:"Thin",value:(s=a)/3},{name:"Normal",value:s},{name:"Thick",value:3*s},{name:"Very Thick",value:9*s}],default:1};break;case"stroke-linejoin":o[u]={values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0};break;case"font-size":o[u]=i(h);break;case"font-family":o[u]={values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0};break;case"font-style":o[u]={values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0};break;case"font-weight":o[u]={values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0};break;case"stroke-color":case"fill-color":o[u]={values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"},{name:"yellow",value:"#ffff00"}],default:0};break;case"stroke-opacity":var l=!1;o[u]=n(l);break;case"fill-opacity":l=!0;o[u]=n(l)}return o}},"./extensions/Markup/core/edit-actions/CloneMarkup.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CloneMarkup.js ***!
  \************************************************************/
/*! exports provided: CloneMarkup */function(t,e,i){"use strict";i.r(e),i.d(e,"CloneMarkup",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s){n.EditAction.call(this,t,"CLONE-MARKUP",e),this.clone=i.clone(),this.clone.id=e,this.position={x:s.x,y:s.y}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor,e=this.clone,i=this.position;if(!t.getMarkup(this.targetId)){var n=e.clone();n.setPosition(i.x,i.y),t.addMarkup(n)}},o.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateArrow.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateArrow.js ***!
  \************************************************************/
/*! exports provided: CreateArrow */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateArrow",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupArrow */"./extensions/Markup/core/MarkupArrow.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r){n.EditAction.call(this,t,"CREATE-ARROW",e),this.selectOnExecution=!1,this.tail=s,this.head=i,this.style=Object(o.cloneStyle)(r)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupArrow(this.targetId,t);t.addMarkup(e),e.set(this.head.x,this.head.y,this.tail.x,this.tail.y),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateCallout.js":
/*!**************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateCallout.js ***!
  \**************************************************************/
/*! exports provided: CreateCallout */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateCallout",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupCallout */"./extensions/Markup/core/MarkupCallout.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a,h){n.EditAction.call(this,t,"CREATE-CALLOUT",e),this.text=r,this.position={x:i.x,y:i.y},this.size={x:s.x,y:s.y},this.style=Object(o.cloneStyle)(a),this.isFrameUsed=h}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=this.position,i=this.size,n=new s.MarkupCallout(this.targetId,t,i);t.addMarkup(n),n.setIsFilledFrameUsed(this.isFrameUsed),n.setText(this.text),n.setSize(e,i.x,i.y),n.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&(this.editor.removeMarkup(t),t.destroy())}},"./extensions/Markup/core/edit-actions/CreateCircle.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateCircle.js ***!
  \*************************************************************/
/*! exports provided: CreateCircle */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateCircle",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupCircle */"./extensions/Markup/core/MarkupCircle.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a){n.EditAction.call(this,t,"CREATE-CIRCLE",e),this.selectOnExecution=!1,this.position={x:i.x,y:i.y},this.size={x:s.x,y:s.y},this.rotation=r,this.style=Object(o.cloneStyle)(a)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupCircle(this.targetId,t);t.addMarkup(e),e.setSize(this.position,this.size.x,this.size.y),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateCloud.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateCloud.js ***!
  \************************************************************/
/*! exports provided: CreateCloud */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateCloud",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupCloud */"./extensions/Markup/core/MarkupCloud.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a){n.EditAction.call(this,t,"CREATE-CLOUD",e),this.selectOnExecution=!1,this.position={x:i.x,y:i.y},this.size={x:s.x,y:s.y},this.rotation=r,this.style=Object(o.cloneStyle)(a)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupCloud(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateDimension.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateDimension.js ***!
  \****************************************************************/
/*! exports provided: CreateDimension */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateDimension",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupDimension */"./extensions/Markup/core/MarkupDimension.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a){n.EditAction.call(this,t,"CREATE-DIMENSION",e),this.selectOnExecution=!1,this.secondAnchor=s,this.firstAnchor=i,this.text=r,this.style=Object(o.cloneStyle)(a)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupDimension(this.targetId,t);t.addMarkup(e),this.secondAnchor&&(e.set(this.firstAnchor.x,this.firstAnchor.y,this.secondAnchor.x,this.secondAnchor.y,this.text),e.setStyle(this.style))},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateFreehand.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateFreehand.js ***!
  \***************************************************************/
/*! exports provided: CreateFreehand */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateFreehand",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupFreehand */"./extensions/Markup/core/MarkupFreehand.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a,h){n.EditAction.call(this,t,"CREATE-FREEHAND",e),this.selectOnExecution=!1,this.position=i,this.size=s,this.rotation=r,this.movements=a.slice(0),this.style=Object(o.cloneStyle)(h)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupFreehand(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,!1),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateHighlight.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateHighlight.js ***!
  \****************************************************************/
/*! exports provided: CreateHighlight */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateHighlight",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupHighlight */"./extensions/Markup/core/MarkupHighlight.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a,h){n.EditAction.call(this,t,"CREATE-HIGHLIGHT",e),this.selectOnExecution=!1,this.position=i,this.size=s,this.rotation=r,this.movements=a.slice(0),this.style=Object(o.cloneStyle)(h)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupHighlight(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,!1),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreatePolycloud.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreatePolycloud.js ***!
  \****************************************************************/
/*! exports provided: CreatePolycloud */function(t,e,i){"use strict";i.r(e),i.d(e,"CreatePolycloud",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupPolycloud */"./extensions/Markup/core/MarkupPolycloud.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a,h,u){n.EditAction.call(this,t,"CREATE-POLYCLOUD",e),this.selectOnExecution=!1,this.position=i,this.size=s,this.rotation=r,this.movements=a.concat(),this.style=Object(o.cloneStyle)(h),this.closed=u}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupPolycloud(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,this.closed),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreatePolyline.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreatePolyline.js ***!
  \***************************************************************/
/*! exports provided: CreatePolyline */function(t,e,i){"use strict";i.r(e),i.d(e,"CreatePolyline",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupPolyLine */"./extensions/Markup/core/MarkupPolyLine.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a,h,u){n.EditAction.call(this,t,"CREATE-POLYLINE",e),this.selectOnExecution=!1,this.position=i,this.size=s,this.rotation=r,this.movements=a.concat(),this.closed=u,this.style=Object(o.cloneStyle)(h)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupPolyline(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,this.closed),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateRectangle.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateRectangle.js ***!
  \****************************************************************/
/*! exports provided: CreateRectangle */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateRectangle",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupRectangle */"./extensions/Markup/core/MarkupRectangle.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a){n.EditAction.call(this,t,"CREATE-RECTANGLE",e),this.selectOnExecution=!1,this.position={x:i.x,y:i.y},this.size={x:s.x,y:s.y},this.rotation=r,this.style=Object(o.cloneStyle)(a)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=new s.MarkupRectangle(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size),e.setRotation(this.rotation),e.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)}},"./extensions/Markup/core/edit-actions/CreateText.js":
/*!***********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/CreateText.js ***!
  \***********************************************************/
/*! exports provided: CreateText */function(t,e,i){"use strict";i.r(e),i.d(e,"CreateText",(function(){return r}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../MarkupText */"./extensions/Markup/core/MarkupText.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function r(t,e,i,s,r,a){n.EditAction.call(this,t,"CREATE-TEXT",e),this.text=r,this.position={x:i.x,y:i.y},this.size={x:s.x,y:s.y},this.style=Object(o.cloneStyle)(a)}r.prototype=Object.create(n.EditAction.prototype),r.prototype.constructor=r;var a=r.prototype;a.redo=function(){var t=this.editor,e=this.position,i=this.size,n=new s.MarkupText(this.targetId,t,i);t.addMarkup(n),n.set(e,i,this.text),n.setStyle(this.style)},a.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&(this.editor.removeMarkup(t),t.destroy())}},"./extensions/Markup/core/edit-actions/DeleteArrow.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteArrow.js ***!
  \************************************************************/
/*! exports provided: DeleteArrow */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteArrow",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateArrow */"./extensions/Markup/core/edit-actions/CreateArrow.js");function o(t,e){n.EditAction.call(this,t,"DELETE-ARROW",e.id),this.createArrow=new s.CreateArrow(t,e.id,e.tail,e.head,e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createArrow.undo()},r.undo=function(){this.createArrow.redo()}},"./extensions/Markup/core/edit-actions/DeleteCallout.js":
/*!**************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteCallout.js ***!
  \**************************************************************/
/*! exports provided: DeleteCallout */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteCallout",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateCallout */"./extensions/Markup/core/edit-actions/CreateCallout.js");function o(t,e){n.EditAction.call(this,t,"DELETE-CALLOUT",e.id);var i={x:e.position.x,y:e.position.y},o={x:e.size.x,y:e.size.y};this.createCallout=new s.CreateCallout(t,e.id,i,o,e.getText(),e.getStyle(),e.isFrameUsed)}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createCallout.undo()},r.undo=function(){this.createCallout.redo()}},"./extensions/Markup/core/edit-actions/DeleteCircle.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteCircle.js ***!
  \*************************************************************/
/*! exports provided: DeleteCircle */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteCircle",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateCircle */"./extensions/Markup/core/edit-actions/CreateCircle.js");function o(t,e){n.EditAction.call(this,t,"DELETE-CIRCLE",e.id),this.createCircle=new s.CreateCircle(t,e.id,e.position,e.size,e.rotation,e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createCircle.undo()},r.undo=function(){this.createCircle.redo()}},"./extensions/Markup/core/edit-actions/DeleteCloud.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteCloud.js ***!
  \************************************************************/
/*! exports provided: DeleteCloud */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteCloud",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateCloud */"./extensions/Markup/core/edit-actions/CreateCloud.js");function o(t,e){n.EditAction.call(this,t,"DELETE-CLOUD",e.id),this.createCloud=new s.CreateCloud(t,e.id,e.position,e.size,e.rotation,e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createCloud.undo()},r.undo=function(){this.createCloud.redo()}},"./extensions/Markup/core/edit-actions/DeleteDimension.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteDimension.js ***!
  \****************************************************************/
/*! exports provided: DeleteDimension */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteDimension",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateDimension */"./extensions/Markup/core/edit-actions/CreateDimension.js");function o(t,e){n.EditAction.call(this,t,"DELETE-DIMENSION",e.id),this.createDimension=new s.CreateDimension(t,e.id,e.secondAnchor,e.firstAnchor,e.currentText,e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createDimension.undo()},r.undo=function(){this.createDimension.redo()}},"./extensions/Markup/core/edit-actions/DeleteFreehand.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteFreehand.js ***!
  \***************************************************************/
/*! exports provided: DeleteFreehand */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteFreehand",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateFreehand */"./extensions/Markup/core/edit-actions/CreateFreehand.js");function o(t,e){n.EditAction.call(this,t,"DELETE-FREEHAND",e.id),this.createFreehand=new s.CreateFreehand(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createFreehand.undo()},r.undo=function(){this.createFreehand.redo()}},"./extensions/Markup/core/edit-actions/DeleteHighlight.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteHighlight.js ***!
  \****************************************************************/
/*! exports provided: DeleteHighlight */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteHighlight",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateHighlight */"./extensions/Markup/core/edit-actions/CreateHighlight.js");function o(t,e){n.EditAction.call(this,t,"DELETE-HIGHLIGHT",e.id),this.createHighlight=new s.CreateHighlight(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createHighlight.undo()},r.undo=function(){this.createHighlight.redo()}},"./extensions/Markup/core/edit-actions/DeletePolycloud.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeletePolycloud.js ***!
  \****************************************************************/
/*! exports provided: DeletePolycloud */function(t,e,i){"use strict";i.r(e),i.d(e,"DeletePolycloud",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreatePolycloud */"./extensions/Markup/core/edit-actions/CreatePolycloud.js");function o(t,e){n.EditAction.call(this,t,"DELETE-POLYCLOUD",e.id),this.createPolycloud=new s.CreatePolycloud(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle(),e.closed)}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createPolycloud.undo()},r.undo=function(){this.createPolycloud.redo()}},"./extensions/Markup/core/edit-actions/DeletePolyline.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeletePolyline.js ***!
  \***************************************************************/
/*! exports provided: DeletePolyline */function(t,e,i){"use strict";i.r(e),i.d(e,"DeletePolyline",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreatePolyline */"./extensions/Markup/core/edit-actions/CreatePolyline.js");function o(t,e){n.EditAction.call(this,t,"DELETE-POLYLINE",e.id),this.createPolyline=new s.CreatePolyline(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle(),e.closed)}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createPolyline.undo()},r.undo=function(){this.createPolyline.redo()}},"./extensions/Markup/core/edit-actions/DeleteRectangle.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteRectangle.js ***!
  \****************************************************************/
/*! exports provided: DeleteRectangle */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteRectangle",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateRectangle */"./extensions/Markup/core/edit-actions/CreateRectangle.js"),o=function(t,e){n.EditAction.call(this,t,"DELETE-RECTANGLE",e.id),this.createRectangle=new s.CreateRectangle(t,e.id,e.position,e.size,e.rotation,e.getStyle())};o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createRectangle.undo()},r.undo=function(){this.createRectangle.redo()}},"./extensions/Markup/core/edit-actions/DeleteText.js":
/*!***********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/DeleteText.js ***!
  \***********************************************************/
/*! exports provided: DeleteText */function(t,e,i){"use strict";i.r(e),i.d(e,"DeleteText",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ./CreateText */"./extensions/Markup/core/edit-actions/CreateText.js");function o(t,e){n.EditAction.call(this,t,"DELETE-TEXT",e.id);var i={x:e.position.x,y:e.position.y},o={x:e.size.x,y:e.size.y};this.createText=new s.CreateText(t,e.id,i,o,e.getText(),e.getStyle())}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){this.createText.undo()},r.undo=function(){this.createText.redo()}},"./extensions/Markup/core/edit-actions/EditAction.js":
/*!***********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/EditAction.js ***!
  \***********************************************************/
/*! exports provided: EditAction */function(t,e,i){"use strict";function n(t,e,i){this.type=e,this.editor=t,this.targetId=i,this.addToHistory=!0,this.selectOnExecution=!0}i.r(e),i.d(e,"EditAction",(function(){return n})),n.prototype.execute=function(){this.editor.actionManager.execute(this)},n.prototype.redo=function(){},n.prototype.undo=function(){},n.prototype.merge=function(t){return!1},n.prototype.isIdentity=function(){return!1}},"./extensions/Markup/core/edit-actions/EditActionGroup.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/EditActionGroup.js ***!
  \****************************************************************/
/*! exports provided: EditActionGroup */function(t,e,i){"use strict";function n(){this.actions=[],this.closed=!0}i.r(e),i.d(e,"EditActionGroup",(function(){return n}));var s=n.prototype;s.open=function(){return!!this.closed&&(this.closed=!1,!0)},s.close=function(){return!this.closed&&(this.closed=!0,!0)},s.undo=function(){for(var t=this.actions,e=-1,i=t.length-1;i>=0;--i){var n=t[i];n.undo(),-1!==n.targetId&&(e=n.targetId)}return e},s.redo=function(){for(var t=this.actions,e=t.length,i=-1,n=0;n<e;++n){var s=t[n];s.redo(),-1!==s.targetId&&(i=s.targetId)}return i},s.isOpen=function(){return!this.closed},s.isClosed=function(){return this.closed},s.isEmpty=function(){return 0===this.actions.length},s.addAction=function(t){return!this.closed&&(this.actions.push(t),this.compact(),!0)},s.compact=function(){for(var t=this.actions,e=t.length,i=0;i<e;++i){var n=t[i];if(n.isIdentity())t.splice(i,1),--e,--i;else for(var s=i+1;s<e;++s){var o=t[s];if(n.type===o.type&&n.merge(o)){t.splice(s,1),--e,--i;break}}}},s.getTargetId=function(){for(var t=this.actions,e=t.length,i=-1,n=0;n<e;++n){var s=t[n];-1!==s.targetId&&(i=s.targetId)}return i}},"./extensions/Markup/core/edit-actions/EditActionManager.js":
/*!******************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/EditActionManager.js ***!
  \******************************************************************/
/*! exports provided: EditActionManager */function(t,e,i){"use strict";i.r(e),i.d(e,"EditActionManager",(function(){return r}));var n=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),s=i(/*! ../MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),o=i(/*! ./EditActionGroup */"./extensions/Markup/core/edit-actions/EditActionGroup.js");function r(t){this.historySize=t,this.undoStack=[],this.redoStack=[],Object(n.addTraitEventDispatcher)(this)}var a=r.prototype;a.execute=function(t){var e=this.redoStack,i=this.undoStack;e.splice(0,e.length),t.redo();var n=this.getEditActionGroup();n.isOpen()?n.addAction(t):(n.open(),n.addAction(t),n.close()),i.length>this.historySize&&i.splice(0,1);var o=t.selectOnExecution?t.targetId:-1;this.dispatchEvent({type:s.EVENT_HISTORY_CHANGED,data:{action:"execute",targetId:o}})},a.beginActionGroup=function(){var t=this.undoStack,e=t.length;0===e||t[e-1].isClosed()?this.getEditActionGroup().open():console.warn("Markups - Undo/Redo - Action edit group already open.")},a.closeActionGroup=function(){var t=this.undoStack,e=t.length;if(0!==e){var i=t[e-1];i.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),i.isEmpty()&&t.pop()}else console.warn("Markups - Undo/Redo - There is no action edit group to close.")},a.cancelActionGroup=function(){var t=this.undoStack,e=t.length;if(0!==e){var i=t[e-1];i.close()?(i.undo(),t.pop(),this.dispatchEvent({type:s.EVENT_HISTORY_CHANGED,data:{action:"cancel",targetId:-1}})):console.warn("Markups - Undo/Redo - Action edit group already closed.")}else console.warn("Markups - Undo/Redo - There is no action edit group to close.")},a.undo=function(){var t=this.undoStack,e=this.redoStack;if(0!==t.length){var i=t.pop(),n=i.undo();e.push(i),this.dispatchEvent({type:s.EVENT_HISTORY_CHANGED,data:{action:"undo",targetId:n}})}},a.redo=function(){var t=this.undoStack,e=this.redoStack;if(0!==e.length){var i=e.pop(),n=i.redo();t.push(i),this.dispatchEvent({type:s.EVENT_HISTORY_CHANGED,data:{action:"redo",targetId:n}})}},a.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.dispatchEvent({type:s.EVENT_HISTORY_CHANGED,data:{action:"clear",targetId:-1}})},a.isUndoStackEmpty=function(){return 0===this.undoStack.length},a.isRedoStackEmpty=function(){return 0===this.redoStack.length},a.getLastElementInUndoStack=function(){var t=this.undoStack;return t[t.length-1]},a.getEditActionGroup=function(){var t=this.undoStack,e=this.undoStack.length,i=null;return 0===e||t[e-1].isClosed()?(i=new o.EditActionGroup,t.push(i)):i=t[e-1],i}},"./extensions/Markup/core/edit-actions/SetArrow.js":
/*!*********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetArrow.js ***!
  \*********************************************************/
/*! exports provided: SetArrow */function(t,e,i){"use strict";i.r(e),i.d(e,"SetArrow",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s){n.EditAction.call(this,t,"SET-ARROW",e.id),this.newHead={x:i.x,y:i.y},this.newTail={x:s.x,y:s.y},this.oldHead={x:e.head.x,y:e.head.y},this.oldTail={x:e.tail.x,y:e.tail.y}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},o.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newHead=t.newHead,this.newTail=t.newTail,!0)},o.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.head.x-e.x)>=1e-4||Math.abs(n.head.y-e.y)>=1e-4||Math.abs(n.tail.x-i.x)>=1e-4||Math.abs(n.tail.y-i.y)>=1e-4)&&n.set(e.x,e.y,i.x,i.y)}},o.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y}},"./extensions/Markup/core/edit-actions/SetCallout.js":
/*!***********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetCallout.js ***!
  \***********************************************************/
/*! exports provided: SetCallout */function(t,e,i){"use strict";i.r(e),i.d(e,"SetCallout",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o,r){n.EditAction.call(this,t,"SET-CALLOUT",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y},this.newSize={x:s.x,y:s.y},this.oldSize={x:e.size.x,y:e.size.y},this.newText=o,this.oldText=e.getText(),this.newIsFrameUsed=r,this.oldIsFrameUsed=e.isFrameUsed}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.newPosition,this.newSize,this.newText,this.newIsFrameUsed)},o.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.oldPosition,this.oldSize,this.oldText,this.oldIsFrameUsed)}},"./extensions/Markup/core/edit-actions/SetCircle.js":
/*!**********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetCircle.js ***!
  \**********************************************************/
/*! exports provided: SetCircle */function(t,e,i){"use strict";i.r(e),i.d(e,"SetCircle",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s){n.EditAction.call(this,t,"SET-CIRCLE",e.id),this.newPosition={x:i.x,y:i.y},this.newSize={x:s.x,y:s.y},this.oldPosition={x:e.position.x,y:e.position.y},this.oldSize={x:e.size.x,y:e.size.y}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},o.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)},o.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},o.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y}},"./extensions/Markup/core/edit-actions/SetCloud.js":
/*!*********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetCloud.js ***!
  \*********************************************************/
/*! exports provided: SetCloud */function(t,e,i){"use strict";i.r(e),i.d(e,"SetCloud",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s){n.EditAction.call(this,t,"SET-CLOUD",e.id),this.newPosition={x:i.x,y:i.y},this.newSize={x:s.x,y:s.y},this.oldPosition={x:e.position.x,y:e.position.y},this.oldSize={x:e.size.x,y:e.size.y}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},o.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)},o.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},o.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y}},"./extensions/Markup/core/edit-actions/SetDimension.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetDimension.js ***!
  \*************************************************************/
/*! exports provided: SetDimension */function(t,e,i){"use strict";i.r(e),i.d(e,"SetDimension",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o){n.EditAction.call(this,t,"SET-DIMENSION",e.id),this.newFirstAnchor={x:i.x,y:i.y},this.newSecondAnchor={x:s.x,y:s.y},this.oldFirstAnchor={x:e.firstAnchor.x,y:e.firstAnchor.y},this.oldSecondAnchor={x:e.secondAnchor.x,y:e.secondAnchor.y},this.newText=o,this.oldText=e.currentText}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){this.applyState(this.newFirstAnchor,this.newSecondAnchor,this.newText)},o.undo=function(){this.applyState(this.oldFirstAnchor,this.oldSecondAnchor,this.oldText)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newFirstAnchor=t.newFirstAnchor,this.newSecondAnchor=t.newSecondAnchor,this.newText=t.newText,!0)},o.applyState=function(t,e,i){var n=this.editor.getMarkup(this.targetId);n&&n.set(t.x,t.y,e.x,e.y,i)},o.isIdentity=function(){return this.newText===this.oldText&&(!this.newFirstAnchor||!this.newSecondAnchor||this.newFirstAnchor.x===this.oldFirstAnchor.x&&this.newFirstAnchor.y===this.oldFirstAnchor.y&&this.newSecondAnchor.x===this.oldSecondAnchor.x&&this.newSecondAnchor.y===this.oldSecondAnchor.y)}},"./extensions/Markup/core/edit-actions/SetFreehand.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetFreehand.js ***!
  \************************************************************/
/*! exports provided: SetFreehand */function(t,e,i){"use strict";i.r(e),i.d(e,"SetFreehand",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o,r){n.EditAction.call(this,t,"SET-FREEHAND",e.id),this.position=i,this.size=s,this.locations=r?o:o.slice(0),this.isAbsoluteCoords=r}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.isAbsoluteCoords)},o.undo=function(){},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.isAbsoluteCoords?t.locations:t.locations.slice(0),this.position=t.position,this.size=t.size,this.isAbsoluteCoords=t.isAbsoluteCoords,!0)},o.isIdentity=function(){return!1}},"./extensions/Markup/core/edit-actions/SetHighlight.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetHighlight.js ***!
  \*************************************************************/
/*! exports provided: SetHighlight */function(t,e,i){"use strict";i.r(e),i.d(e,"SetHighlight",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o,r){n.EditAction.call(this,t,"SET-HIGHLIGHT",e.id),this.position=i,this.size=s,this.locations=r?o:o.slice(0),this.isAbsoluteCoords=r}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.isAbsoluteCoords)},o.undo=function(){},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.isAbsoluteCoords?t.locations:t.locations.slice(0),this.position=t.position,this.size=t.size,this.isAbsoluteCoords=t.isAbsoluteCoords,!0)},o.isIdentity=function(){return!1}},"./extensions/Markup/core/edit-actions/SetPolycloud.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetPolycloud.js ***!
  \*************************************************************/
/*! exports provided: SetPolycloud */function(t,e,i){"use strict";i.r(e),i.d(e,"SetPolycloud",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o,r){n.EditAction.call(this,t,"SET-POLYCLOUD",e.id),this.position=i,this.size=s,this.locations=o.concat(),this.closed=r}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.closed)},o.undo=function(){},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.locations.concat(),this.position=t.position,this.size=t.size,this.closed=t.closed,!0)},o.isIdentity=function(){return!1}},"./extensions/Markup/core/edit-actions/SetPolyline.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetPolyline.js ***!
  \************************************************************/
/*! exports provided: SetPolyline */function(t,e,i){"use strict";i.r(e),i.d(e,"SetPolyline",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o,r){n.EditAction.call(this,t,"SET-POLYLINE",e.id),this.position=i,this.size=s,this.locations=o.concat(),this.closed=r}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.closed)},o.undo=function(){},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.locations.concat(),this.position=t.position,this.size=t.size,this.closed=t.closed,!0)},o.isIdentity=function(){return!1}},"./extensions/Markup/core/edit-actions/SetPosition.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetPosition.js ***!
  \************************************************************/
/*! exports provided: SetPosition */function(t,e,i){"use strict";i.r(e),i.d(e,"SetPosition",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i){n.EditAction.call(this,t,"SET-POSITION",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setPosition(this.newPosition.x,this.newPosition.y)},o.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setPosition(this.oldPosition.x,this.oldPosition.y)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,!0)},o.isIdentity=function(){var t=this.newPosition,e=this.oldPosition;return t.x===e.x&&t.y===e.y}},"./extensions/Markup/core/edit-actions/SetRectangle.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetRectangle.js ***!
  \*************************************************************/
/*! exports provided: SetRectangle */function(t,e,i){"use strict";i.r(e),i.d(e,"SetRectangle",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s){n.EditAction.call(this,t,"SET-RECTANGLE",e.id),this.newPosition={x:i.x,y:i.y},this.newSize={x:s.x,y:s.y},this.oldPosition={x:e.position.x,y:e.position.y},this.oldSize={x:e.size.x,y:e.size.y}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},o.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)},o.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},o.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y}},"./extensions/Markup/core/edit-actions/SetRotation.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetRotation.js ***!
  \************************************************************/
/*! exports provided: SetRotation */function(t,e,i){"use strict";i.r(e),i.d(e,"SetRotation",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i){n.EditAction.call(this,t,"SET-ROTATION",e.id);var s=e.getRotation();this.newRotation={angle:i},this.oldRotation={angle:s}}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setRotation(this.newRotation.angle)},o.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setRotation(this.oldRotation.angle)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newRotation=t.newRotation,!0)},o.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle}},"./extensions/Markup/core/edit-actions/SetSize.js":
/*!********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetSize.js ***!
  \********************************************************/
/*! exports provided: SetSize */function(t,e,i){"use strict";i.r(e),i.d(e,"SetSize",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o){n.EditAction.call(this,t,"SET-SIZE",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y},this.newWidth=s,this.oldWidth=e.size.x,this.newHeight=o,this.oldHeight=e.size.y}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setSize(this.newPosition,this.newWidth,this.newHeight)},o.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},o.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newWidth=t.newWidth,this.newHeight=t.newHeight,!0)},o.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight}},"./extensions/Markup/core/edit-actions/SetStyle.js":
/*!*********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetStyle.js ***!
  \*********************************************************/
/*! exports provided: SetStyle */function(t,e,i){"use strict";i.r(e),i.d(e,"SetStyle",(function(){return o}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js"),s=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js");function o(t,e,i){n.EditAction.call(this,t,"SET-STYLE",e.id),this.newStyle=Object(s.cloneStyle)(i),this.oldStyle=e.getStyle()}o.prototype=Object.create(n.EditAction.prototype),o.prototype.constructor=o;var r=o.prototype;r.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setStyle(this.newStyle)},r.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setStyle(this.oldStyle)}},"./extensions/Markup/core/edit-actions/SetText.js":
/*!********************************************************!*\
  !*** ./extensions/Markup/core/edit-actions/SetText.js ***!
  \********************************************************/
/*! exports provided: SetText */function(t,e,i){"use strict";i.r(e),i.d(e,"SetText",(function(){return s}));var n=i(/*! ./EditAction */"./extensions/Markup/core/edit-actions/EditAction.js");function s(t,e,i,s,o){n.EditAction.call(this,t,"SET-TEXT",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y},this.newSize={x:s.x,y:s.y},this.oldSize={x:e.size.x,y:e.size.y},this.newText=o,this.oldText=e.getText()}s.prototype=Object.create(n.EditAction.prototype),s.prototype.constructor=s;var o=s.prototype;o.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.newPosition,this.newSize,this.newText)},o.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.oldPosition,this.oldSize,this.oldText)}},"./extensions/Markup/core/edit-clipboard/Clipboard.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-clipboard/Clipboard.js ***!
  \************************************************************/
/*! exports provided: Clipboard */function(t,e,i){"use strict";i.r(e),i.d(e,"Clipboard",(function(){return o}));var n=i(/*! ../edit-actions/CloneMarkup */"./extensions/Markup/core/edit-actions/CloneMarkup.js"),s=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js");function o(t){this.editor=t,this.content=null,this.pastePosition={x:0,y:0},Object(s.addTraitEventDispatcher)(this)}var r=o.prototype;r.copy=function(){var t=this.editor.getSelection();t&&(this.content=t.clone(),this.pastePosition.x=t.position.x,this.pastePosition.y=t.position.y)},r.cut=function(){var t=this.editor.getSelection();t&&(this.copy(),this.editor.deleteMarkup(t))},r.paste=function(){var t=this.content;if(t){var e=this.editor,i=this.pastePosition,s=e.sizeFromClientToMarkups(20,20);i.x+=s.x,i.y-=s.y,new n.CloneMarkup(e,e.getId(),t,i).execute()}}},"./extensions/Markup/core/edit-input/InputHandler.js":
/*!***********************************************************!*\
  !*** ./extensions/Markup/core/edit-input/InputHandler.js ***!
  \***********************************************************/
/*! exports provided: InputHandler */function(t,e,i){"use strict";i.r(e),i.d(e,"InputHandler",(function(){return u}));var n=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),s=Bimfish.Viewing,o=s.Private,r=!1,a=!1,h=!1;function u(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.duringEditMode=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onTouchPanBinded=this.onTouchPan.bind(this),this.onTouchPinchBinded=this.onTouchPinch.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.onHammerInputBinded=this.onHammerInput.bind(this),this.isMouseDown=!1}s.GlobalManagerMixin.call(u.prototype);var l=u.prototype;function c(t,e){var i=t.editor.svg.getBoundingClientRect();t.makeSameXY=e.shiftKey,t.snapRotations=e.shiftKey,t.keepAspectRatio=e.shiftKey,t.constrainAxis=e.shiftKey,t.mousePosition.x=e.clientX-i.left,t.mousePosition.y=e.clientY-i.top}function d(t){t.shiftKey=!1,t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY}l.attachTo=function(t){this.editor&&this.detachFrom(this.editor),this.editor=t,Object(n.isTouchDevice)()&&(this.hammer=new s.Hammer.Manager(t.svg,{recognizers:[s.GestureRecognizers.drag,s.GestureRecognizers.doubletap,s.GestureRecognizers.doubletap2,s.GestureRecognizers.singletap,s.GestureRecognizers.singletap2,s.GestureRecognizers.press,s.GestureRecognizers.pan,s.GestureRecognizers.pinch],handlePointerEventMouse:!1,inputClass:s.isIE11?s.Hammer.PointerEventInput:s.Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},l.onHammerInput=function(t){this.setMouseDisabledWhenTouching(t)},l.setMouseDisabledWhenTouching=function(t){if(t.isFirst&&!h)this.enableMouseButtons(!1),h=!0;else if(t.isFinal){var e=this;setTimeout((function(){e.enableMouseButtons(a),h=!1}),10)}},l.enableMouseButtons=function(t){t&&!r?(this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.addEventListener("wheel",this.onWheelBinded),this.editor.svg.addEventListener("DOMMouseScroll",this.onWheelBinded),this.addDocumentEventListener("mousemove",this.onMouseMoveBinded),this.addDocumentEventListener("mouseup",this.onMouseUpBinded)):!t&&r&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded),this.editor.svg.removeEventListener("DOMMouseScroll",this.onWheelBinded),this.removeDocumentEventListener("mousemove",this.onMouseMoveBinded),this.removeDocumentEventListener("mouseup",this.onMouseUpBinded)),a=r,r=t},l.detachFrom=function(t){this.hammer&&this.hammer.destroy(),this.removeDocumentEventListener("mousemove",this.onMouseMoveBinded),this.removeDocumentEventListener("mouseup",this.onMouseUpBinded),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=t},l.enterEditMode=function(){this.duringEditMode||(this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("panstart panmove panend",this.onTouchPanBinded),this.hammer.on("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded),this.hammer.on("hammer.input",this.onHammerInputBinded),this.hammer.get("drag").requireFailure("pinch"),this.hammer.get("drag").requireFailure("pan")),s.isMobileDevice()||this.enableMouseButtons(!0),this.duringEditMode=!0)},l.leaveEditMode=function(){this.duringEditMode&&(this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("panstart panmove panend",this.onTouchPanBinded),this.hammer.off("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded),this.hammer.off("hammer.input",this.onHammerInputBinded)),s.isMobileDevice()||this.enableMouseButtons(!1),this.duringEditMode=!1)},l.enterViewMode=function(){},l.leaveViewMode=function(){},l.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},l.onWheel=function(t){s.isMobileDevice()||this.editor.viewer.toolController.mousewheel(t),t.preventDefault()},l.onMouseMove=function(t){c(this,t),s.isMobileDevice()||this.editor.viewer.toolController.mousemove(t),this.editor.onMouseMove(t),t.preventDefault()},l.onMouseDownRightClick=function(t){var e=this.getDocument();s.isIE11&&s.inFullscreen(e)||e.activeElement&&e.activeElement.blur&&e.activeElement.blur(),this.editor.viewer.toolController.__clientToCanvasCoords(t),this.editor.markupTool.handleButtonDown(t,2)},l.onMouseUpRightClick=function(t){this.editor.viewer.toolController.__clientToCanvasCoords(t),this.editor.markupTool.handleButtonUp(t,2)},l.onMouseDown=function(t){c(this,t),s.isMobileDevice()||!o.isRightClick(t,this.editor.viewer.navigation)&&!o.isMiddleClick(t)?(this.isMouseDown=!0,this.editor.onMouseDown(t),t.preventDefault()):this.onMouseDownRightClick(t)},l.onMouseUp=function(t){c(this,t),s.isMobileDevice()||!o.isRightClick(t,this.editor.viewer.navigation)&&!o.isMiddleClick(t)?(this.isMouseDown=!1,this.editor.onMouseUp(t),t.preventDefault()):this.onMouseUpRightClick(t)},l.onMouseDoubleClick=function(t){c(this,t),this.editor.onMouseDoubleClick(t),t.preventDefault()},l.onTouchDrag=function(t){switch(d(t),t.type){case"dragstart":this.onMouseDown(t);break;case"dragmove":this.onMouseMove(t);break;case"dragend":this.onMouseUp(t)}t.preventDefault()},l.onTouchPan=function(t){this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),t.preventDefault()},l.onTouchPinch=function(t){c(this,t),this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),this.mousePosition.x=this.mousePosition.y=null,this.editor.callSnapperMouseMove(),t.preventDefault()},l.onSingleTap=function(t){d(t),this.onMouseDown(t),this.onMouseUp(t),t.preventDefault()},l.onDoubleTap=function(t){d(t),this.onMouseDoubleClick(t),t.preventDefault()}},"./extensions/Markup/core/edit-modes/BuiltinEditModes.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/BuiltinEditModes.js ***!
  \***************************************************************/
/*! no exports provided */function(t,e,i){"use strict";i.r(e);var n=i(/*! ../EditModeManager */"./extensions/Markup/core/EditModeManager.js"),s=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),o=i(/*! ./EditModeArrow */"./extensions/Markup/core/edit-modes/EditModeArrow.js"),r=i(/*! ./EditModeText */"./extensions/Markup/core/edit-modes/EditModeText.js"),a=i(/*! ./EditModeRectangle */"./extensions/Markup/core/edit-modes/EditModeRectangle.js"),h=i(/*! ./EditModeCircle */"./extensions/Markup/core/edit-modes/EditModeCircle.js"),u=i(/*! ./EditModeCloud */"./extensions/Markup/core/edit-modes/EditModeCloud.js"),l=i(/*! ./EditModeFreehand */"./extensions/Markup/core/edit-modes/EditModeFreehand.js"),c=i(/*! ./EditModeHighlight */"./extensions/Markup/core/edit-modes/EditModeHighlight.js"),d=i(/*! ./EditModePolyline */"./extensions/Markup/core/edit-modes/EditModePolyline.js"),p=i(/*! ./EditModePolycloud */"./extensions/Markup/core/edit-modes/EditModePolycloud.js"),f=i(/*! ./EditModeCallout */"./extensions/Markup/core/edit-modes/EditModeCallout.js"),y=i(/*! ./EditModeDimension */"./extensions/Markup/core/edit-modes/EditModeDimension.js");n.theEditModeManager.register(s.MARKUP_TYPE_ARROW,o.EditModeArrow),n.theEditModeManager.register(s.MARKUP_TYPE_TEXT,r.EditModeText),n.theEditModeManager.register(s.MARKUP_TYPE_RECTANGLE,a.EditModeRectangle),n.theEditModeManager.register(s.MARKUP_TYPE_CIRCLE,h.EditModeCircle),n.theEditModeManager.register(s.MARKUP_TYPE_CLOUD,u.EditModeCloud),n.theEditModeManager.register(s.MARKUP_TYPE_FREEHAND,l.EditModeFreehand),n.theEditModeManager.register(s.MARKUP_TYPE_HIGHLIGHT,c.EditModeHighlight),n.theEditModeManager.register(s.MARKUP_TYPE_POLYLINE,d.EditModePolyline),n.theEditModeManager.register(s.MARKUP_TYPE_POLYCLOUD,p.EditModePolycloud),n.theEditModeManager.register(s.MARKUP_TYPE_CALLOUT,f.EditModeCallout),n.theEditModeManager.register(s.MARKUP_TYPE_DIMENSION,y.EditModeDimension)},"./extensions/Markup/core/edit-modes/EditMode.js":
/*!*******************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditMode.js ***!
  \*******************************************************/
/*! exports provided: EditMode */function(t,e,i){"use strict";i.r(e),i.d(e,"EditMode",(function(){return a}));var n=i(/*! ../MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),s=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js"),o=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),r=i(/*! ../edit-actions/SetStyle */"./extensions/Markup/core/edit-actions/SetStyle.js");function a(t,e,i){this.editor=t,this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.type=e,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=Object(s.createStyle)(i,this.editor),this.style=Object(s.copyStyle)(t.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,Object(o.addTraitEventDispatcher)(this)}Bimfish.Viewing.GlobalManagerMixin.call(a.prototype);var h=a.prototype;h.destroy=function(){this.unselect(),Object(o.removeTraitEventDispatcher)(this)},h.unselect=function(){var t=!1,e=this.selectedMarkup,i=null;e&&(i=e.id,e.unselect(),this.selectedMarkup=null,t=!0),this.editor.editFrame.setMarkup(null),t&&this.dispatchEvent({type:n.EVENT_MARKUP_DESELECT,markupId:i})},h.creationBegin=function(){this.creating||(this.creating=!0,this.dispatchEvent({type:n.EVENT_EDITMODE_CREATION_BEGIN}))},h.creationEnd=function(t){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?(this.creationCancel(),t=!0):(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.selectedMarkup=null))),this.creating=!1,this.dispatchEvent({type:n.EVENT_EDITMODE_CREATION_END,creationCancelled:!!t}))},h.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(!0),this.selectedMarkup=null},h.setStyle=function(t){this.style=t;var e=this.selectedMarkup;e&&new r.SetStyle(this.editor,e,t).execute()},h.getStyle=function(){return this.style},h.setSelection=function(t){this.selectedMarkup!==t&&(this.unselect(),t&&t.select()),this.selectedMarkup=t;var e=this.editor;t&&e.bringToFront(t),this.isTextInputHelperActive()&&e.editFrame.markup?this.textInputHelper.setEditFrame():this.creating||e.editFrame.setMarkup(t)},h.getSelection=function(){return this.selectedMarkup},h.deleteMarkup=function(t,e){return!1},h.isMinSizeValid=function(){if(0!==this.minSize){var t=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return t.x*t.x+t.y*t.y>=this.minSize*this.minSize}return!0},h.startDragging=function(){var t=this.selectedMarkup,e=this.editor.getMousePosition();t&&(this.dragging=!0,this.draggingAnnotationIniPosition=t.getClientPosition(),this.draggingMouseIniPosition.set(e.x,e.y))},h.finishDragging=function(){var t=this.dragging,e=this.selectedMarkup;this.dragging=!1,e&&t&&e.finishDragging()},h.getFinalMouseDraggingPosition=function(){var t=this.editor,e=t.getBounds(),i=t.getMousePosition(),n=this.initialX,s=this.initialY,r=Math.min(Math.max(e.x,i.x),e.x+e.width),a=Math.min(Math.max(e.y,i.y),e.y+e.height);if(r==n&&a==s&&(r++,a++),t.input.makeSameXY){var h=Math.abs(r-n),u=Math.abs(a-s),l=Math.max(h,u);r=n+l*Object(o.sign)(r-n),a=s+l*Object(o.sign)(a-s)}return{x:r,y:a}},h.notifyAllowNavigation=function(t){},h.onMouseMove=function(t){},h.onMouseDown=function(){},h.onMouseUp=function(t){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},h.onMouseDoubleClick=function(t){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},h.onSave=function(){this.creating&&this.creationCancel()},h.getDraggingPosition=function(){var t=this.editor.getMousePosition(),e=t.x-this.draggingMouseIniPosition.x,i=t.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+e,y:this.draggingAnnotationIniPosition.y+i}},h.isInsideBounds=function(t,e,i){return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height},h.useWithSnapping=function(){return this.viewer.model.is2d()},h.isTextInputHelperActive=function(){return this.textInputHelper&&this.textInputHelper.isActive()}},"./extensions/Markup/core/edit-modes/EditModeArrow.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeArrow.js ***!
  \************************************************************/
/*! exports provided: EditModeArrow */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeArrow",(function(){return u}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeleteArrow */"./extensions/Markup/core/edit-actions/DeleteArrow.js"),o=i(/*! ../edit-actions/CreateArrow */"./extensions/Markup/core/edit-actions/CreateArrow.js"),r=i(/*! ../edit-actions/SetArrow */"./extensions/Markup/core/edit-actions/SetArrow.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),h=Bimfish.Viewing.MeasureCommon;function u(t){n.EditMode.call(this,t,a.MARKUP_TYPE_ARROW,["stroke-width","stroke-color","stroke-opacity"])}u.prototype=Object.create(n.EditMode.prototype),u.prototype.constructor=u;var l=u.prototype;l.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new s.DeleteArrow(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},l.onMouseDown=function(){if(n.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();if(this.initialX=e.x,this.initialY=e.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,t.snapper){var i=t.snapper.getGeometryType();i!==h.SnapType.SNAP_VERTEX&&i!==h.SnapType.SNAP_EDGE&&i!==h.SnapType.SNAP_MIDPOINT&&i!==h.SnapType.SNAP_CIRCLE_CENTER||(this.lineSnapped=t.snapper.getEdge())}var s=3.5*this.style["stroke-width"],r=this.head=t.positionFromClientToMarkups(this.initialX,this.initialY),a={x:r.x+Math.cos(.25*Math.PI)*s,y:r.y+Math.sin(.25*-Math.PI)*s};(function(t,e,i,n){this.isInsideBounds(e.x,e.y,n)||(e.y=t.y+Math.sin(.25*Math.PI)*i,this.isInsideBounds(e.x,e.y,n)||(e.x=t.x+Math.cos(.25*-Math.PI)*i,this.isInsideBounds(e.x,e.y,n)||(e.y=t.y+Math.sin(.25*-Math.PI)*i)))}).bind(this)(r,a,s,t.getBounds()),t.beginActionGroup();var u=new THREE.Vector2(a.x-r.x,a.y-r.y);u.lengthSq()<s*s&&(u=u.normalize().multiplyScalar(s),a.x=r.x+u.x,a.y=r.y+u.y);var l=t.getId();new o.CreateArrow(t,l,r,a,this.style).execute(),this.selectedMarkup=t.getMarkup(l),this.creationBegin()}},l.onMouseMove=function(t){n.EditMode.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i=this.editor,s=this.getFinalMouseDraggingPosition(),o=this.initialX,a=this.initialY;if(i.snapper&&!i.snapper.isSnapped()&&this.lineSnapped){var u=i.project(this.lineSnapped.vertices[0]),l=i.project(this.lineSnapped.vertices[1]),c=new THREE.Vector3(s.x,s.y,u.z),d=h.nearestPointInPointToLine(c,u,l),p=-(u.x-l.x)/(u.y-l.y),f=o+1,y=p*f+(a-p*o),g=new THREE.Vector3(f,y,u.z),v=new THREE.Vector3(o,a,u.z),m=h.nearestPointInPointToLine(c,v,g);d.distanceTo(c)<=20?(s.x=d.x,s.y=d.y):m.distanceTo(c)<=20&&(s.x=m.x,s.y=m.y)}var M=this.head,x=i.positionFromClientToMarkups(s.x,s.y),E=new THREE.Vector2(x.x-M.x,x.y-M.y),k=3.5*e.style["stroke-width"];E.lengthSq()<k*k&&(E=E.normalize().multiplyScalar(k),x.x=M.x+E.x,x.y=M.y+E.y),this.size=i.sizeFromClientToMarkups(s.x-o,s.y-a),new r.SetArrow(i,e,M,x).execute()}}},"./extensions/Markup/core/edit-modes/EditModeCallout.js":
/*!**************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeCallout.js ***!
  \**************************************************************/
/*! exports provided: EditModeCallout */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeCallout",(function(){return d}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeleteCallout */"./extensions/Markup/core/edit-actions/DeleteCallout.js"),o=i(/*! ../edit-actions/CreateCallout */"./extensions/Markup/core/edit-actions/CreateCallout.js"),r=i(/*! ../edit-actions/SetCallout */"./extensions/Markup/core/edit-actions/SetCallout.js"),a=i(/*! ../edit-actions/SetStyle */"./extensions/Markup/core/edit-actions/SetStyle.js"),h=i(/*! ../edit-actions/SetSize */"./extensions/Markup/core/edit-actions/SetSize.js"),u=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),l=i(/*! ../MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),c=i(/*! ./EditorTextInput */"./extensions/Markup/core/edit-modes/EditorTextInput.js");function d(t){n.EditMode.call(this,t,u.MARKUP_TYPE_CALLOUT,["font-size","stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]),this.style["fill-opacity"]=1,this.style["fill-color"]="#ffffff";var e=new c.EditorTextInput(this.viewer.container,this.editor,!1,"Text",360);e.addEventListener(e.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_ACTIVE,this.onHelperSetActive.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_INACTIVE,this.onHelperSetActive.bind(this),!1),this.textInputHelper=e,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}d.prototype=Object.create(n.EditMode.prototype),d.prototype.constructor=d;var p=d.prototype;p.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type===this.type){var i=new s.DeleteCallout(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},p.setStyle=function(t){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(t):n.EditMode.prototype.setStyle.call(this,t)},p.notifyAllowNavigation=function(t){t&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},p.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),n.EditMode.prototype.destroy.call(this)},p.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())this.textInputHelper.acceptAndExit();else if(!this.selectedMarkup){var t=this.editor,e=t.getMousePosition(),i=t.sizeFromMarkupsToClient(0,this.style["font-size"]).y,n=6*i,s=1*i,r=this.size=t.sizeFromClientToMarkups(n,s),a=t.positionFromClientToMarkups(e.x+.5*n,e.y+.5*s);this.creationBegin(),t.beginActionGroup();var h=new o.CreateCallout(t,t.getId(),a,r,"",this.style,!0);h.execute(),this.creationEnd(),this.selectedMarkup=t.getMarkup(h.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},p.onMouseUp=function(t){},p.onMouseDoubleClick=function(t){t===this.selectedMarkup&&(this.editor.selectMarkup(t),this.editor.editFrame.setMarkup(t),this.textInputHelper&&this.textInputHelper.setActive(t,!1))},p.onHelperSetActive=function(t){var e=t.data,i=e.markup;i&&(i.setIsHelperTextActive(e.isActive),i.setIsShapeVisible(!e.isActive))},p.onHelperTextChange=function(t){var e=t.data,i=e.markup,n=e.style,o=this.selectedMarkup;if(this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===e.newText)return this.editor.cancelActionGroup(),new s.DeleteCallout(this.editor,i).execute(),void(i!==o&&this.editor.selectMarkup(o));e.firstEdit||this.editor.beginActionGroup();var u=this.editor.positionFromClientToMarkups(e.newPos.x,e.newPos.y),c=this.editor.sizeFromClientToMarkups(e.width,e.height);new h.SetSize(this.editor,i,u,c.x,c.y).execute(),new r.SetCallout(this.editor,i,i.position,i.size,e.newText,i.isFrameUsed).execute(),new a.SetStyle(this.editor,i,n).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(o)},p.onHistoryChange=function(t){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},p.onSave=function(){if(n.EditMode.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var t=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),t&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},p.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()}},"./extensions/Markup/core/edit-modes/EditModeCircle.js":
/*!*************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeCircle.js ***!
  \*************************************************************/
/*! exports provided: EditModeCircle */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeCircle",(function(){return h}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeleteCircle */"./extensions/Markup/core/edit-actions/DeleteCircle.js"),o=i(/*! ../edit-actions/CreateCircle */"./extensions/Markup/core/edit-actions/CreateCircle.js"),r=i(/*! ../edit-actions/SetCircle */"./extensions/Markup/core/edit-actions/SetCircle.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js");function h(t){n.EditMode.call(this,t,a.MARKUP_TYPE_CIRCLE,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"])}h.prototype=Object.create(n.EditMode.prototype),h.prototype.constructor=h;var u=h.prototype;u.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new s.DeleteCircle(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},u.onMouseMove=function(t){n.EditMode.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i=this.editor,s=this.getFinalMouseDraggingPosition();s=i.clientToMarkups(s.x,s.y);var o=Math.abs(this.firstPosition.x-s.x),a=Math.abs(this.firstPosition.y-s.y),h={x:.5*(this.firstPosition.x+s.x),y:.5*(this.firstPosition.y+s.y)},u=this.size={x:o,y:a};new r.SetCircle(i,e,h,u).execute()}},u.onMouseDown=function(){if(n.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y;var i=this.firstPosition=t.clientToMarkups(this.initialX,this.initialY),s=this.size=t.sizeFromClientToMarkups(1,1);t.beginActionGroup();var r=t.getId();new o.CreateCircle(t,r,i,s,0,this.style).execute(),this.selectedMarkup=t.getMarkup(r),this.creationBegin()}}},"./extensions/Markup/core/edit-modes/EditModeCloud.js":
/*!************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeCloud.js ***!
  \************************************************************/
/*! exports provided: EditModeCloud */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeCloud",(function(){return h}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeleteCloud */"./extensions/Markup/core/edit-actions/DeleteCloud.js"),o=i(/*! ../edit-actions/CreateCloud */"./extensions/Markup/core/edit-actions/CreateCloud.js"),r=i(/*! ../edit-actions/SetCloud */"./extensions/Markup/core/edit-actions/SetCloud.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js");function h(t){n.EditMode.call(this,t,a.MARKUP_TYPE_CLOUD,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"])}h.prototype=Object.create(n.EditMode.prototype),h.prototype.constructor=h;var u=h.prototype;u.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new s.DeleteCloud(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},u.onMouseMove=function(t){n.EditMode.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i=this.editor,s=this.getFinalMouseDraggingPosition(),o=i.clientToMarkups(s.x,s.y),a={x:(this.firstPosition.x+o.x)/2,y:(this.firstPosition.y+o.y)/2},h=this.size={x:Math.abs(o.x-this.firstPosition.x),y:Math.abs(o.y-this.firstPosition.y)};new r.SetCloud(i,e,a,h).execute()}},u.onMouseDown=function(){if(n.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y;var i=this.firstPosition=t.clientToMarkups(this.initialX,this.initialY),s=this.size=t.sizeFromClientToMarkups(1,1);t.beginActionGroup();var r=t.getId();new o.CreateCloud(t,r,i,s,0,this.style).execute(),this.selectedMarkup=t.getMarkup(r),this.creationBegin()}}},"./extensions/Markup/core/edit-modes/EditModeDimension.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeDimension.js ***!
  \****************************************************************/
/*! exports provided: EditModeDimension */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeDimension",(function(){return f}));var n,s=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),o=i(/*! ../edit-actions/DeleteDimension */"./extensions/Markup/core/edit-actions/DeleteDimension.js"),r=i(/*! ../edit-actions/CreateDimension */"./extensions/Markup/core/edit-actions/CreateDimension.js"),a=i(/*! ../edit-actions/SetDimension */"./extensions/Markup/core/edit-actions/SetDimension.js"),h=i(/*! ../edit-actions/SetStyle */"./extensions/Markup/core/edit-actions/SetStyle.js"),u=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),l=i(/*! ../MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),c=i(/*! ./EditorTextInput */"./extensions/Markup/core/edit-modes/EditorTextInput.js"),d=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),p=Bimfish.Viewing.MeasureCommon;function f(t){var e=this;s.EditMode.call(this,t,u.MARKUP_TYPE_DIMENSION,["stroke-width","stroke-color","stroke-opacity","font-size","font-family","font-style","font-weight"]),this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.measurement=new p.Measurement(p.MeasurementTypes.MEASUREMENT_DISTANCE);var i=this.viewer,n=i.getExtension("Bimfish.Measure");function o(){e.cancelEditModeChange=!0,t.enterEditMode()}n||(console.error("Demension markup cant work without measure extension. Please load measure extension first"),o()),this.sharedMeasureConfig=n.sharedMeasureConfig,(n.forceCalibrate||i.model.getData().isLeaflet||i.model.getData().isPdf)&&!n.calibrationTool.isCalibrated()&&(n.openCalibrationRequiredDialog("dimension"),o())}f.prototype=Object.create(s.EditMode.prototype),f.prototype.constructor=f;var y=f.prototype;y.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new o.DeleteDimension(this.editor,t);return i.addToHistory=!e,i.execute(),this.creating=!1,this.dragging=!1,!0}return!1},y.updateTextBoxStyle=function(t){this.isTextInputHelperActive()&&(t||(t=this.textInputHelper.textMarkup.getStyle()),this.textInputHelper.setStyle(t),this.updateTextBox(this.textInputHelper.textMarkup))},y.setStyle=function(t){s.EditMode.prototype.setStyle.call(this,t),this.updateTextBoxStyle(t)},y.notifyAllowNavigation=function(t){t&&this.isTextInputHelperActive()&&this.textInputHelper.acceptAndExit()},y.creationBegin=function(){s.EditMode.prototype.creationBegin.call(this)},y.creationEnd=function(){this.dragging=!1,s.EditMode.prototype.creationEnd.call(this)},y.isMinSizeValid=function(){if(0!==this.minSize){var t=this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x,this.selectedMarkup.size.y);return t.x*t.x>=this.minSize*this.minSize}return!0},y.creationCancel=function(){s.EditMode.prototype.creationCancel.call(this),this.creating=!1,this.dragging=!1},y.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.destroy(),this.textInputHelper=null),this.updateViewportId(),s.EditMode.prototype.destroy.call(this)},y.getDistance=function(){if(this.measurement.computeResult(this.measurement.picks,this.viewer),this.viewer.model&&this.measurement.distanceXYZ){var t=Bimfish.Viewing.Private.convertUnits(this.viewer.model.getUnitString(),this.sharedMeasureConfig.units,this.sharedMeasureConfig.calibrationFactor,this.measurement.distanceXYZ);return Bimfish.Viewing.Private.formatValueWithUnits(t,this.sharedMeasureConfig.units,3,this.sharedMeasureConfig.precision)}return null},y.updateMeasurement=function(t){var e=this.editor,i=this.measurement.getPick(t);return n?(i.geomType=p.SnapType.SNAP_VERTEX,i.geomVertex=n,i.intersectPoint=n):e.snapper.copyResults(i),i},y.updateViewportId=function(t){this.viewer.model&&this.viewer.model.is2d()&&(t?(this.viewer.impl.updateViewportId(t),this.editor.snapper.setViewportId(t)):(this.viewer.impl.updateViewportId(0),this.editor.snapper.setViewportId(null)))},y.pickFirstAnchor=function(){var t=this.editor;this.measurement.clearAllPicks();var e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y,this.firstAnchor=t.positionFromClientToMarkups(this.initialX,this.initialY),t.beginActionGroup();var i=t.getId();new r.CreateDimension(t,i,this.firstAnchor,null,this.currentText,this.style).execute(),this.selectedMarkup=t.getMarkup(i),this.creationBegin();var n=this.updateMeasurement(1);this.updateViewportId(n.viewportIndex2d)},y.pickSecondAnchor=function(t){var e=this.editor,i=this.selectedMarkup;if(this.secondAnchor=this.getFinalMouseDraggingPosition(),this.updateMeasurement(2),p.correctPerpendicularPicks(this.measurement.getPick(1),this.measurement.getPick(2),this.viewer,e.snapper)){var n=p.getSnapResultPosition(this.measurement.getPick(2),this.viewer);this.secondAnchor=e.project(n),e.snapper.indicator.render()}var s=e.positionFromClientToMarkups(this.secondAnchor.x,this.secondAnchor.y);this.size.x=i.size.x,this.size.y=i.size.y,i.currentText=this.getDistance(),new a.SetDimension(e,i,this.firstAnchor,s,i.currentText).execute(),new h.SetStyle(e,i,this.style).execute(),t&&!i.currentText&&this.isMinSizeValid()&&(i.currentText="",this.editor.selectMarkup(null),this.updateTextBox(i))},y.onMouseDown=function(t){if(!Bimfish.Viewing.Private.isRightClick(t,this.viewer.navigation))if(n=null,this.isTextInputHelperActive())this.textInputHelper.acceptAndExit();else if(s.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup||this.creating){var e=this.editor.snapper.isSnapped();this.selectedMarkup||this.creating||!e?this.selectedMarkup&&this.creating&&(e?this.pickSecondAnchor(!0):(this.deleteMarkup(this.selectedMarkup,!0),this.creating=!0),this.updateViewportId(),this.creationEnd()):this.pickFirstAnchor()}},y.onMouseUp=function(t){this.dragging&&(this.onMouseDown(t),this.dragging=!1)},y.onMouseMove=function(t){n=null,this.selectedMarkup&&this.creating&&(this.dragging=!0,this.pickSecondAnchor(!1))},y.getFinalMouseDraggingPosition=function(){var t=this.editor,e=t.getBounds(),i=t.getMousePosition();t.snapper.isSnapped()||t.viewer.model&&t.viewer.model.is2d()&&(n=p.inverseProject(i,t.viewer));var s=this.initialX,o=this.initialY,r=Math.min(Math.max(e.x,i.x),e.x+e.width),a=Math.min(Math.max(e.y,i.y),e.y+e.height);(r==s&&a==o&&(r++,a++),t.input.constrainAxis&&t.viewer.model.is2d())&&(Math.abs(r-s)>Math.abs(a-o)?a=o:r=s,t.snapper.onMouseMove({x:r,y:a}),t.snapper.isSnapped()?(t.snapper.copyResults(this.measurement.getPick(2)),n=null):n=p.inverseProject({x:r,y:a},t.viewer));return{x:r,y:a}},y.isVisibleChar=function(t){return t>47&&t<58||32==t||t>64&&t<91||t>95&&t<112||t>185&&t<193||t>218&&t<223},y.measureTextLine=function(t,e,i){return t=0===(t=t.replace(new RegExp(" ","g"),"")).length?e.initialText:t,Object(d.measureTextLines)([t+"|"],this.style,i)[0]},y.handleKeyDown=function(t){var e=this.textInputHelper;if(t.keyCode!==Bimfish.Viewing.KeyCode.ENTER){var i=e.textMarkup,n=e.textArea.value;t.keyCode===Bimfish.Viewing.KeyCode.BACKSPACE&&(n=n.substring(0,n.length-1)),n.length<15&&this.isVisibleChar(t.keyCode)&&(n+=t.key);var s=this.measureTextLine(n,i,this.editor);this.updateTextBox(i,s)}},y.updateTextBox=function(t,e){this.textInputHelper||(this.textInputHelper=new c.EditorTextInput(this.viewer.container,this.editor,!0,t.initialText,15),this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.handleKeyDownBinded=this.handleKeyDown.bind(this)),t.text.style.display="none",e||(e=this.measureTextLine(this.textInputHelper.textArea.value,t,this.editor));var i=this.getTextAreaTransform(t,e);this.textInputHelper.styleTextArea.setAttribute("text-align","center"),this.textInputHelper.setActive(t,!1),this.textInputHelper.textArea.style.position="static",this.textInputHelper.textArea.style.padding="0",this.textInputHelper.textArea.style.width=e.width+"px",this.textInputHelper.textArea.style.height=e.height+"px",this.textInputHelper.textArea.style.transform=i,this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.editor.actionManager.addEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.textArea.removeEventListener("keydown",this.handleKeyDownBinded),this.textInputHelper.textArea.addEventListener("keydown",this.handleKeyDownBinded)},y.getTextAreaTransform=function(t,e){var i=t.getClientPosition(),n=Object(d.radiansToDegrees)(t.rotation)%360;return n>90&&n<=270&&t.shouldFlip()&&(n=180+n),["translate(",i.x-e.width/2+"px,",i.y-this.viewer.container.clientHeight-e.height+"px)","rotate(",n+"deg)","translate(0px,",e.height+"px)"].join(" ")},y.onMouseDoubleClick=function(t){t===this.selectedMarkup&&(this.editor.selectMarkup(null),this.updateTextBox(t))},y.onHelperTextChange=function(t){var e=t.data,i=e.markup,n=e.style,s=this.editor;i.text.style.display="block",""===e.newText&&(e.newText=i.initialText),e.firstEdit||s.beginActionGroup(),new h.SetStyle(s,i,n).execute(),new a.SetDimension(s,i,i.firstAnchor,i.secondAnchor,e.newText).execute(),s.closeActionGroup(),s.selectMarkup(null)},y.onHistoryChange=function(t){this.isTextInputHelperActive()&&(this.textInputHelper.textMarkup.text.style.display="block",this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},y.onSave=function(){if(s.EditMode.prototype.onSave.call(this),this.isTextInputHelperActive()){this.editor.actionManager.removeEventListener(l.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded);var t=this.textInputHelper.textMarkup;this.textInputHelper.acceptAndExit(),t.text.style.display="block"}},y.useWithSnapping=function(){return!0}},"./extensions/Markup/core/edit-modes/EditModeFreehand.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeFreehand.js ***!
  \***************************************************************/
/*! exports provided: EditModeFreehand */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeFreehand",(function(){return h}));var n=i(/*! ./EditModePen */"./extensions/Markup/core/edit-modes/EditModePen.js"),s=i(/*! ../edit-actions/DeleteFreehand */"./extensions/Markup/core/edit-actions/DeleteFreehand.js"),o=i(/*! ../edit-actions/CreateFreehand */"./extensions/Markup/core/edit-actions/CreateFreehand.js"),r=i(/*! ../edit-actions/SetFreehand */"./extensions/Markup/core/edit-actions/SetFreehand.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js");function h(t){n.EditModePen.call(this,t,a.MARKUP_TYPE_FREEHAND,["stroke-width","stroke-color","stroke-opacity"])}h.prototype=Object.create(n.EditModePen.prototype),h.prototype.constructor=h;var u=h.prototype;u.createPen=function(t,e,i,n,s){return new o.CreateFreehand(this.editor,t,e,i,n,s,this.style)},u.deletePen=function(t){return new s.DeleteFreehand(this.editor,t)},u.setPen=function(t,e,i,n){return new r.SetFreehand(this.editor,this.selectedMarkup,t,e,i,n)}},"./extensions/Markup/core/edit-modes/EditModeHighlight.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeHighlight.js ***!
  \****************************************************************/
/*! exports provided: EditModeHighlight */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeHighlight",(function(){return h}));var n=i(/*! ./EditModePen */"./extensions/Markup/core/edit-modes/EditModePen.js"),s=i(/*! ../edit-actions/DeleteHighlight */"./extensions/Markup/core/edit-actions/DeleteHighlight.js"),o=i(/*! ../edit-actions/CreateHighlight */"./extensions/Markup/core/edit-actions/CreateHighlight.js"),r=i(/*! ../edit-actions/SetHighlight */"./extensions/Markup/core/edit-actions/SetHighlight.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js");function h(t){n.EditModePen.call(this,t,a.MARKUP_TYPE_HIGHLIGHT,["stroke-width","stroke-color","stroke-opacity"]);var e=t.getStrokeWidth();this.style["stroke-opacity"]=.5,this.style["stroke-color"]="#ffff00",this.style["stroke-width"]=4*e}h.prototype=Object.create(n.EditModePen.prototype),h.prototype.constructor=h;var u=h.prototype;u.createPen=function(t,e,i,n,s){return new o.CreateHighlight(this.editor,t,e,i,n,s,this.style)},u.deletePen=function(t){return new s.DeleteHighlight(this.editor,t)},u.setPen=function(t,e,i,n){return new r.SetHighlight(this.editor,this.selectedMarkup,t,e,i,n)}},"./extensions/Markup/core/edit-modes/EditModePen.js":
/*!**********************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModePen.js ***!
  \**********************************************************/
/*! exports provided: EditModePen */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModePen",(function(){return o}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js");function o(t,e,i){n.EditMode.call(this,t,e,i),this.smoothen=!0,this.bufferSize=8}o.prototype=Object.create(n.EditMode.prototype);var r=o.prototype;r.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type===this.type){var i=this.deletePen(t);return i.addToHistory=!e,i.execute(),!0}return!1},r.onMouseMove=function(t){if(n.EditMode.prototype.onMouseMove.call(this,t),this.selectedMarkup&&this.creating){var e=this.editor,i=e.getMousePosition(),s=this.movements,o=e.clientToMarkups(i.x,i.y);if(this.smoothen)this.appendToBuffer(o),this.amendPath();else{var r=this.lastX-i.x,a=this.lastY-i.y;s.length>1&&r*r+a*a<25?(s[s.length-1]=o,this.removeFromAbsolutePath(1)):(s.push(o),this.lastX=i.x,this.lastY=i.y),this.addToAbsolutePath([o])}this.setPen(this.position,this.size,this.absolutePath,!0).execute()}},r.onMouseDown=function(){if(n.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor;t.snapper&&t.snapper.clearSnapped();var e=t.getMousePosition();this.lastX=this.initialX=e.x,this.lastY=this.initialY=e.y;var i=this.position=t.clientToMarkups(this.initialX,this.initialY);this.movements=[i],this.smoothen&&(this.buffer=[],this.movementsLastIndex=null,this.appendToBuffer(i));var s=this.size=t.sizeFromClientToMarkups(1,1);t.beginActionGroup();var o=t.getId();this.createPen(o,i,s,0,[{x:0,y:0}]).execute(),this.createAbsolutePath(i),this.selectedMarkup=t.getMarkup(o),this.creationBegin()}},r.onMouseUp=function(){if(this.creating){var t=this.movements,e=this.viewer.impl.camera.right-this.viewer.impl.camera.left,i=this.viewer.impl.camera.top-this.viewer.impl.camera.bottom,o=e*e+i*i,r=(t=Object(s.simplify)(t,1e-8*o,!0)).map((function(t){return t.x})),a=t.map((function(t){return t.y})),h=Math.min.apply(null,r),u=Math.min.apply(null,a),l=Math.max.apply(null,r)-h,c=Math.max.apply(null,a)-u,d={x:h+.5*l,y:u+.5*c},p=this.size={x:l,y:c},f=t.map((function(t){return{x:t.x-d.x,y:t.y-d.y}}));this.setPen(d,p,f,!1).execute(),n.EditMode.prototype.onMouseUp.call(this)}else n.EditMode.prototype.onMouseUp.call(this)},r.createPen=function(){console.error("createPen not implemented")},r.deletePen=function(){console.error("deletePen not implemented")},r.setPen=function(){console.error("setPen not implemented")},r.useWithSnapping=function(){return!1},r.createAbsolutePath=function(t){this.absolutePath="M"+ +t.x.toFixed(6)+" "+ +t.y.toFixed(6),this.absolutePathIndexes=[0]},r.removeFromAbsolutePath=function(t){(t=Math.min(t,this.absolutePathIndexes.length))>0&&(this.absolutePath=this.absolutePath.slice(0,this.absolutePathIndexes[this.absolutePathIndexes.length-t]),this.absolutePathIndexes.splice(this.absolutePathIndexes.length-t))},r.addToAbsolutePath=function(t){for(var e=0;e<t.length;e++)this.absolutePathIndexes.push(this.absolutePath.length),this.absolutePath+=" L"+ +t[e].x.toFixed(6)+" "+ +t[e].y.toFixed(6)},r.appendToBuffer=function(t){for(this.buffer.push(t);this.buffer.length>this.bufferSize;)this.buffer.shift()},r.amendPath=function(){var t=this.getAveragePoint(0);if(t){this.movementsLastIndex&&(this.removeFromAbsolutePath(this.movements.length-this.movementsLastIndex),this.movements.splice(this.movementsLastIndex));var e=[t];this.movementsLastIndex=this.movements.length+1;for(var i=2;i<this.buffer.length;i+=2){var n=this.getAveragePoint(i);e.push(n)}this.addToAbsolutePath(e),this.movements.push.apply(this.movements,e)}},r.getAveragePoint=function(t){var e=this.buffer.length;if(e%2==1||e>=this.bufferSize){for(var i,n=0,s=0,o=0,r=t;r<e;r++)o++,n+=(i=this.buffer[r]).x,s+=i.y;return{x:n/o,y:s/o}}return null}},"./extensions/Markup/core/edit-modes/EditModePolycloud.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModePolycloud.js ***!
  \****************************************************************/
/*! exports provided: EditModePolycloud */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModePolycloud",(function(){return u}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeletePolycloud */"./extensions/Markup/core/edit-actions/DeletePolycloud.js"),o=i(/*! ../edit-actions/CreatePolycloud */"./extensions/Markup/core/edit-actions/CreatePolycloud.js"),r=i(/*! ../edit-actions/SetPolycloud */"./extensions/Markup/core/edit-actions/SetPolycloud.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),h=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js");function u(t){n.EditMode.call(this,t,a.MARKUP_TYPE_POLYCLOUD,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}u.prototype=Object.create(n.EditMode.prototype),u.prototype.constructor=u;var l=u.prototype;function c(t,e){var i=function(t,e){var i=t.map((function(t){return t[e]}));return Math.min.apply(null,i)},n=function(t,e){var i=t.map((function(t){return t[e]}));return Math.max.apply(null,i)},s=e.style["stroke-width"],o=2*s+.5*s,r=i(t,"x")-o,a=i(t,"y")-o,h=n(t,"x")+o-r,u=n(t,"y")+o-a;e.size={x:h,y:u},e.position={x:r+.5*h,y:a+.5*u};var l=e.position;return t.map((function(t){return{x:t.x-l.x,y:t.y-l.y}}))}l.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=this.movements;if(!(this.creating&&i.length>=2)){var n=new s.DeletePolycloud(this.editor,t);return n.addToHistory=!e,n.execute(),this.creationEnd(),!0}i.pop(),i.pop();var o=i.length-1;if(o>=0){var a=i[o];i.push(a);var h=c(i,this);new r.SetPolycloud(this.editor,t,this.position,this.size,h).execute()}}return!1},l.onMouseMove=function(t){n.EditMode.prototype.onMouseMove.call(this,t);var e=this.editor,i=this.selectedMarkup;if(i&&this.creating){this.dragging=!0;var s=this.movements;s.splice(s.length-1,1);var o=e.getMousePosition();o=e.clientToMarkups(o.x,o.y),s.length>=2&&Object(h.areMarkupsPointsInClientRange)(s[0],o,25,this.editor)&&(o=s[0]),s.push(o);var a=c(s,this);new r.SetPolycloud(e,i,this.position,this.size,a).execute()}},l.onMouseDown=function(){if(n.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var t=this.editor,e=t.getMousePosition();e=t.clientToMarkups(e.x,e.y);var i=this.size=t.sizeFromClientToMarkups(1,1);this.movements=[e,e],t.beginActionGroup();var s=t.getId();new o.CreatePolycloud(t,s,e,i,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=t.getMarkup(s),this.creationBegin()}},l.onMouseUp=function(t){if(n.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var e=this.editor,i=e.getMousePosition(),s=this.movements,o=!1;if(i=e.clientToMarkups(i.x,i.y),!(s.length>1&&Object(h.areMarkupsPointsInClientRange)(s[s.length-2],i,25,this.editor))){s.length>2&&Object(h.areMarkupsPointsInClientRange)(s[0],i,25,this.editor)&&(i=s[0],o=!0),s.splice(s.length-1,1),o||(s.push(i),s.push(i));var a=this.selectedMarkup,u=c(s,a);new r.SetPolycloud(e,a,a.position,a.size,u,o).execute(),o&&this.creationEnd()}}},l.onMouseDoubleClick=function(t){if(this.creating){var e=this.movements;if(e.splice(Math.max(0,e.length-1)),e.length<2)this.creationCancel();else{var i=this.selectedMarkup,n=c(e,i);new r.SetPolycloud(this.editor,i,i.position,i.size,n,!0).execute(),this.creationEnd()}}},l.destroy=function(){this.onMouseDoubleClick(),n.EditMode.prototype.creationEnd.call(this),n.EditMode.prototype.destroy.call(this)},l.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),n.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},l.creationCancel=function(){n.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1}},"./extensions/Markup/core/edit-modes/EditModePolyline.js":
/*!***************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModePolyline.js ***!
  \***************************************************************/
/*! exports provided: EditModePolyline */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModePolyline",(function(){return u}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeletePolyline */"./extensions/Markup/core/edit-actions/DeletePolyline.js"),o=i(/*! ../edit-actions/CreatePolyline */"./extensions/Markup/core/edit-actions/CreatePolyline.js"),r=i(/*! ../edit-actions/SetPolyline */"./extensions/Markup/core/edit-actions/SetPolyline.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),h=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js");function u(t){n.EditMode.call(this,t,a.MARKUP_TYPE_POLYLINE,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}u.prototype=Object.create(n.EditMode.prototype),u.prototype.constructor=u;var l=u.prototype;function c(t,e){var i=function(t,e){var i=t.map((function(t){return t[e]}));return Math.min.apply(null,i)},n=function(t,e){var i=t.map((function(t){return t[e]}));return Math.max.apply(null,i)},s=i(t,"x"),o=i(t,"y"),r=n(t,"x")-s,a=n(t,"y")-o;e.size={x:r,y:a},e.position={x:s+.5*r,y:o+.5*a};var h=e.position;return t.map((function(t){return{x:t.x-h.x,y:t.y-h.y}}))}l.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=this.movements;if(!(this.creating&&i.length>=2)){var n=new s.DeletePolyline(this.editor,t);return n.addToHistory=!e,n.execute(),this.creationEnd(),!0}i.pop(),i.pop();var o=i.length-1;if(o>=0){var a=i[o];i.push(a);var h=c(i,this);new r.SetPolyline(this.editor,t,this.position,this.size,h).execute()}}return!1},l.onMouseMove=function(t){n.EditMode.prototype.onMouseMove.call(this,t);var e=this.editor,i=this.selectedMarkup;if(i&&this.creating){this.dragging=!0;var s=this.movements;s.splice(s.length-1,1);var o=e.getMousePosition();o=e.clientToMarkups(o.x,o.y),s.length>=2&&Object(h.areMarkupsPointsInClientRange)(s[0],o,25,this.editor)&&(o=s[0]),s.push(o);var a=c(s,this);new r.SetPolyline(e,i,this.position,this.size,a).execute()}},l.onMouseDown=function(t){if(n.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var e=this.editor,i=e.getMousePosition();i=e.clientToMarkups(i.x,i.y);var s=this.size=e.sizeFromClientToMarkups(1,1);this.movements=[i,i],e.beginActionGroup();var r=e.getId();new o.CreatePolyline(e,r,i,s,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},l.onMouseUp=function(){if(n.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var t=this.editor,e=t.getMousePosition(),i=this.movements,s=!1;if(e=t.clientToMarkups(e.x,e.y),!(i.length>1&&Object(h.areMarkupsPointsInClientRange)(i[i.length-2],e,25,this.editor))){i.length>2&&Object(h.areMarkupsPointsInClientRange)(i[0],e,25,this.editor)&&(e=i[0],s=!0),i.splice(i.length-1,1),s||(i.push(e),i.push(e));var o=this.selectedMarkup,a=c(i,o);new r.SetPolyline(t,o,o.position,o.size,a,s).execute(),s&&this.creationEnd()}}},l.destroy=function(){this.onMouseDoubleClick(),n.EditMode.prototype.creationEnd.call(this),n.EditMode.prototype.destroy.call(this)},l.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),n.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},l.creationCancel=function(){n.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},l.onMouseDoubleClick=function(t){if(this.creating){var e=this.movements;if(e.splice(Math.max(0,e.length-1)),e.length<2)this.creationCancel();else{var i=this.selectedMarkup,n=c(e,i);new r.SetPolyline(this.editor,i,i.position,i.size,n,this.closed).execute(),this.creationEnd()}}}},"./extensions/Markup/core/edit-modes/EditModeRectangle.js":
/*!****************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeRectangle.js ***!
  \****************************************************************/
/*! exports provided: EditModeRectangle */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeRectangle",(function(){return u}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeleteRectangle */"./extensions/Markup/core/edit-actions/DeleteRectangle.js"),o=i(/*! ../edit-actions/CreateRectangle */"./extensions/Markup/core/edit-actions/CreateRectangle.js"),r=i(/*! ../edit-actions/SetRectangle */"./extensions/Markup/core/edit-actions/SetRectangle.js"),a=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),h=Bimfish.Viewing.MeasureCommon;function u(t){n.EditMode.call(this,t,a.MARKUP_TYPE_RECTANGLE,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"])}u.prototype=Object.create(n.EditMode.prototype),u.prototype.constructor=u;var l=u.prototype;l.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new s.DeleteRectangle(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},l.onMouseMove=function(t){n.EditMode.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i,s,o=this.editor,a=this.getFinalMouseDraggingPosition(),u=o.clientToMarkups(a.x,a.y),l={x:(this.firstCorner.x+u.x)/2,y:(this.firstCorner.y+u.y)/2};if(o.snapper&&this.lineSnapped){var c=o.project(this.lineSnapped.vertices[0]),d=o.project(this.lineSnapped.vertices[1]),p=c.z;c=o.clientToMarkups(c.x,c.y),d=o.clientToMarkups(d.x,d.y),c=new THREE.Vector3(c.x,c.y,p),d=new THREE.Vector3(d.x,d.y,p);var f=new THREE.Vector3(u.x,u.y,p),y=h.nearestPointInPointToLine(f,c,d);s=f.distanceTo(y);var g=-(c.x-d.x)/(c.y-d.y),v=this.firstCorner.y-g*this.firstCorner.x,m=this.firstCorner.x+1,M=g*m+v,x=new THREE.Vector3(m,M,p),E=new THREE.Vector3(this.firstCorner.x,this.firstCorner.y,p),k=h.nearestPointInPointToLine(f,E,x);i=f.distanceTo(k)}else i=u.x-this.firstCorner.x,s=u.y-this.firstCorner.y;var b=this.size={x:Math.abs(i),y:Math.abs(s)};new r.SetRectangle(o,e,l,b).execute()}},l.onMouseDown=function(){if(n.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y;var i=this.firstCorner=t.clientToMarkups(this.initialX,this.initialY),s=this.size=t.sizeFromClientToMarkups(1,1),r=0;if(this.lineSnapped=null,t.snapper)if(t.snapper.getGeometryType()===h.SnapType.SNAP_EDGE){this.lineSnapped=t.snapper.getEdge();var a=t.project(this.lineSnapped.vertices[0]),u=t.project(this.lineSnapped.vertices[1]),l=u.x-a.x,c=u.y-a.y;r=this.rotation=Math.atan2(c,l)}t.beginActionGroup();var d=t.getId();new o.CreateRectangle(t,d,i,s,r,this.style).execute(),this.selectedMarkup=t.getMarkup(d),this.creationBegin()}}},"./extensions/Markup/core/edit-modes/EditModeText.js":
/*!***********************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditModeText.js ***!
  \***********************************************************/
/*! exports provided: EditModeText */function(t,e,i){"use strict";i.r(e),i.d(e,"EditModeText",(function(){return p}));var n=i(/*! ./EditMode */"./extensions/Markup/core/edit-modes/EditMode.js"),s=i(/*! ../edit-actions/DeleteText */"./extensions/Markup/core/edit-actions/DeleteText.js"),o=i(/*! ../edit-actions/DeleteCallout */"./extensions/Markup/core/edit-actions/DeleteCallout.js"),r=i(/*! ../edit-actions/CreateText */"./extensions/Markup/core/edit-actions/CreateText.js"),a=i(/*! ../edit-actions/SetText */"./extensions/Markup/core/edit-actions/SetText.js"),h=i(/*! ../edit-actions/SetSize */"./extensions/Markup/core/edit-actions/SetSize.js"),u=i(/*! ../edit-actions/SetStyle */"./extensions/Markup/core/edit-actions/SetStyle.js"),l=i(/*! ../MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),c=i(/*! ../MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),d=i(/*! ./EditorTextInput */"./extensions/Markup/core/edit-modes/EditorTextInput.js");function p(t){n.EditMode.call(this,t,l.MARKUP_TYPE_TEXT,["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]);var e=new d.EditorTextInput(this.viewer.container,this.editor,!1,"Text",260);e.addEventListener(e.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_ACTIVE,this.onHelperSetActive.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_INACTIVE,this.onHelperSetActive.bind(this),!1),this.textInputHelper=e,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}p.prototype=Object.create(n.EditMode.prototype),p.prototype.constructor=p;var f=p.prototype;f.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new s.DeleteText(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},f.setStyle=function(t){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(t):n.EditMode.prototype.setStyle.call(this,t)},f.notifyAllowNavigation=function(t){t&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},f.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),n.EditMode.prototype.destroy.call(this)},f.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())this.textInputHelper.acceptAndExit();else if(!this.selectedMarkup){var t=this.editor,e=t.getMousePosition(),i=t.sizeFromMarkupsToClient(0,this.style["font-size"]).y,n=15*i,s=1*i,o=this.size=t.sizeFromClientToMarkups(n,s),a=t.positionFromClientToMarkups(e.x+.5*n,e.y+.5*s);this.creationBegin(),t.beginActionGroup();var h=new r.CreateText(t,t.getId(),a,o,"",this.style);h.execute(),this.creationEnd(),this.selectedMarkup=t.getMarkup(h.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},f.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()},f.onMouseUp=function(t){},f.onMouseDoubleClick=function(t){t===this.selectedMarkup&&(this.editor.selectMarkup(t),this.editor.editFrame.setMarkup(t),this.textInputHelper&&this.textInputHelper.setActive(t,!1))},f.onHelperSetActive=function(t){var e=t.data,i=e.markup;i&&(i.setIsHelperTextActive(e.isActive),i.setIsShapeVisible(!e.isActive))},f.onHelperTextChange=function(t){var e=t.data,i=e.markup,n=e.style,s=this.selectedMarkup;if(this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===e.newText)return this.editor.cancelActionGroup(),new o.DeleteCallout(this.editor,i).execute(),void(i!==s&&this.editor.selectMarkup(s));e.firstEdit||this.editor.beginActionGroup();var r=this.editor.positionFromClientToMarkups(e.newPos.x,e.newPos.y),l=this.editor.sizeFromClientToMarkups(e.width,e.height);new h.SetSize(this.editor,i,r,l.x,l.y).execute(),new a.SetText(this.editor,i,i.position,i.size,e.newText).execute(),new u.SetStyle(this.editor,i,n).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(s)},f.onHistoryChange=function(t){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},f.onSave=function(){if(n.EditMode.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var t=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),t&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},f.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()}},"./extensions/Markup/core/edit-modes/EditorTextAutosize.js":
/*!*****************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditorTextAutosize.js ***!
  \*****************************************************************/
/*! exports provided: autosize */function(t,e,i){"use strict";i.r(e),i.d(e,"autosize",(function(){return c}));
/*!
                  Based on Autosize 4.0.0
                  license: MIT
                  http://www.jacklmoore.com/autosize
              */
var n,s,o="function"==typeof Map?new Map:(n=[],s=[],{has:function(t){return n.indexOf(t)>-1},get:function(t){return s[n.indexOf(t)]},set:function(t,e){-1===n.indexOf(t)&&(n.push(t),s.push(e))},delete:function(t){var e=n.indexOf(t);e>-1&&(n.splice(e,1),s.splice(e,1))}}),r=function(t){return new Event(t,{bubbles:!0})};try{new Event("test")}catch(t){r=function(t){var e=Bimfish.Viewing.getGlobal().document.createEvent("Event");return e.initEvent(t,!0,!1),e}}function a(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!o.has(t)){var e=null,i=t.clientWidth,n=null,s=this,a=function(){t.clientWidth!==i&&c()},h=function(e){s.removeWindowEventListener("resize",a,!1),t.removeEventListener("input",c,!1),t.removeEventListener("keyup",c,!1),t.removeEventListener("autosize:destroy",h,!1),t.removeEventListener("autosize:update",c,!1),Object.keys(e).forEach((function(i){t.style[i]=e[i]})),o.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflow:t.style.overflow,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",h,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",c,!1),s.addWindowEventListener("resize",a,!1),t.addEventListener("input",c,!1),t.addEventListener("autosize:update",c,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",o.set(t,{destroy:h,update:c}),function(){var i=s.getWindow().getComputedStyle(t,null);"vertical"===i.resize?t.style.resize="none":"both"===i.resize&&(t.style.resize="horizontal"),e="content-box"===i.boxSizing?-(parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)):parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),isNaN(e)&&(e=0),c()}()}function u(e){var i=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=i,t.style.overflow=e}function l(){var n=t.style.height,o=function(t){for(var e=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&e.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return e}(t),r=s.getDocument(),a=r.documentElement&&r.documentElement.scrollTop;t.style.height="";var h=t.scrollHeight+e;0!==t.scrollHeight?(t.style.height=h+"px",i=t.clientWidth,o.forEach((function(t){t.node.scrollTop!==t.scrollTop&&(t.node.scrollTop=t.scrollTop)})),a&&(r.documentElement.scrollTop=a)):t.style.height=n}function c(){l();var e=s.getWindow(),i=Math.round(parseFloat(t.style.height)),o=e.getComputedStyle(t,null),a="content-box"===o.boxSizing?Math.round(parseFloat(o.height)):t.offsetHeight;if(a!==i?"hidden"===o.overflow&&(u("scroll"),l(),a="content-box"===o.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight):"hidden"!==o.overflow&&(u("hidden"),l(),a="content-box"===o.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight),n!==a){n=a;var h=r("autosize:resized");try{t.dispatchEvent(h)}catch(t){}}}}function h(t){var e=o.get(t);e&&e.destroy()}function u(t){var e=o.get(t);e&&e.update()}var l=(Bimfish.Viewing.getGlobal(),"undefined"!=typeof window&&"function"==typeof window.getComputedStyle),c=function(t,e){var i=this;return l&&t&&Array.prototype.forEach.call(t.length?t:[t],(function(t){return a.bind(i)(t,e)})),t};c.destroy=function(t){return l&&t&&Array.prototype.forEach.call(t.length?t:[t],h),t},c.update=function(t){return l&&t&&Array.prototype.forEach.call(t.length?t:[t],u),t}},"./extensions/Markup/core/edit-modes/EditorTextInput.js":
/*!**************************************************************!*\
  !*** ./extensions/Markup/core/edit-modes/EditorTextInput.js ***!
  \**************************************************************/
/*! exports provided: EditorTextInput */function(t,e,i){"use strict";i.r(e),i.d(e,"EditorTextInput",(function(){return h}));var n=i(/*! ./EditorTextAutosize */"./extensions/Markup/core/edit-modes/EditorTextAutosize.js"),s=i(/*! ../MarkupsCoreUtils */"./extensions/Markup/core/MarkupsCoreUtils.js"),o=i(/*! ../StyleUtils */"./extensions/Markup/core/StyleUtils.js"),r=i(/*! ../DomElementStyle */"./extensions/Markup/core/DomElementStyle.js"),a=i(/*! ../../../../thirdparty/resize-observer-polyfill/ResizeObserver.min.js */"./thirdparty/resize-observer-polyfill/ResizeObserver.min.js");function h(t,e,i,o,h){this.parentDiv=t,this.editor=e,this.setGlobalManager(e.viewer.globalManager),this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.EVENT_TEXT_SET_ACTIVE="EVENT_CO2_TEXT_SET_ACTIVE",this.EVENT_TEXT_SET_INACTIVE="EVENT_CO2_TEXT_SET_INACTIVE";var u=this.getDocument();i?(this.textArea=u.createElement("input"),this.textArea.setAttribute("type","text")):(this.textArea=u.createElement("textarea"),this.textArea.rows="1",Bimfish.Viewing.isIE11||(this.textArea.dir="auto")),this.firstEdit=!0,this.defaultText=o,this.textArea.setAttribute("maxlength",h),this.textArea.setAttribute("data-i18n",o),this.startingHeight=0,n.autosize.bind(this)(this.textArea),new a(function(t,e){this.setEditFrame()}.bind(this)).observe(this.textArea),this.styleTextArea=new r.DomElementStyle,this.styleTextArea.setAttribute("position","absolute").setAttribute("resize","none").setAttribute("box-sizing","border-box").setAttribute("-moz-box-sizing","border-box").setAttribute("-webkit-box-sizing","border-box").setAttribute("overflow","hidden").setAttribute("outline","none").setAttribute("border","none").setAttribute("z-index","1").setAttribute("padding","10px"),this.measureDiv=u.createElement("div"),Object(s.addTraitEventDispatcher)(this)}Bimfish.Viewing.GlobalManagerMixin.call(h.prototype);var u=h.prototype;function l(t){if(0===t.length)return"";for(var e=t.length-1,i=e;i>=0;--i)if(" "!==t.charAt(i)){e=i;break}return t.substr(0,e+1)}function c(t){if(0===t.length)return"";for(var e=0,i=0;i<t.length;++i)if(" "!==t.charAt(i)){e=i;break}return t.substr(e)}u.destroy=function(){this.setInactive()},u.setActive=function(t,e){if(this.textMarkup!==t){var i=Bimfish.Viewing.i18n.translate(this.defaultText);if(this.textArea.setAttribute("placeholder",i),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=t,this.firstEdit=e||!1,this.constrainToCanvas=e,this.initFromMarkup(),this.constrainToCanvas=!1,!Bimfish.Viewing.isIOSDevice()){var n=this.textArea;this.getWindow().requestAnimationFrame((function(){n.focus()}))}var s={markup:this.textMarkup,firstEdit:this.firstEdit,isActive:!0};this.dispatchEvent({type:this.EVENT_TEXT_SET_ACTIVE,data:s})}},u.setInactive=function(){var t={markup:this.textMarkup,isActive:!1};Bimfish.Viewing.isIOSDevice()&&this.textArea.blur(),this.removeWindowEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null,this.dispatchEvent({type:this.EVENT_TEXT_SET_INACTIVE,data:t})},u.isActive=function(){return!!this.textMarkup},u.setEditFrame=function(){if(this.editor.editFrame.markup&&this.textMarkup&&this.editor.editFrame.markup===this.textMarkup){var t=parseFloat(this.textArea.style.width),e=parseFloat(this.textArea.style.height),i=this.textMarkup.getClientPosition(),n=this.textMarkup.getRotation(),s=i.x-t/2,o=i.y-this.startingHeight/2;this.editor.editFrame.setSelection(s,o,t,e,n)}},u.initFromMarkup=function(t){var e=this.textMarkup,i=e.getClientPosition(),n=e.getClientSize(),s=e.getClientFontSize()/2;this.startingHeight=n.y;var o=i.x-.5*n.x,r=i.y-.5*n.y,a=e.lineHeight+"%";this.styleTextArea.setAttribute("line-height",a),this.styleTextArea.setAttribute("padding",s+"px"),this.setPosAndSize(o,r,n.x,n.y),t?(this.setStyle(e.getStyle()),this.textArea.value=e.getText()):(this.textArea.value=e.getText(),this.setStyle(e.getStyle()))},u.setPosAndSize=function(t,e,i,n){this.constrainToCanvas&&(t+i>=this.editor.viewer.container.clientWidth&&(t=this.editor.viewer.container.clientWidth-(i+10)),e+n>=this.editor.viewer.container.clientHeight&&(e=this.editor.viewer.container.clientHeight-(n+10)),t<5&&(t=5,i=this.editor.viewer.container.clientWidth-10)),this.styleTextArea.setAttribute("left",t+"px").setAttribute("top",e+"px").setAttribute("width",i+"px").setAttribute("height",n+"px")},u.setStyle=function(t){if(this.style){var e={};this.injectSizeValues(e),this.setPosAndSize(e.newPos.x-.5*e.width,e.newPos.y-.5*e.height,e.width,e.height)}var i=this.editor.sizeFromMarkupsToClient(0,t["font-size"]).y,s=this.editor.sizeFromMarkupsToClient(0,t["stroke-width"]).y,r=this.styleTextArea.setAttribute("color",t["stroke-color"]).setAttribute("outline",s+"px solid "+t["stroke-color"]).setAttribute("font-family",t["font-family"]).setAttribute("font-size",i+"px").setAttribute("font-weight",t["font-weight"]).setAttribute("font-style",t["font-style"]).getStyleString();this.textArea.setAttribute("style",r),this.style=Object(o.cloneStyle)(t),n.autosize.update(this.textArea)},u.getTextValuesForMarkup=function(t,e){var i=this.isActive(),n=this.textMarkup,s=this.firstEdit;this.setActive(t,!1);var o={markup:t,textValues:this.getTextValues()};return i?this.setActive(n,s):(e&&this.injectSizeValues(o),this.setInactive()),o},u.getTextValues=function(){var t=this.textArea.value;return t===this.defaultText&&(t=""),{text:t,lines:this.generateLines()}},u.acceptAndExit=function(){var t=this.getTextValues(),e=this.textMarkup,i={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:t.text,newLines:t.lines};this.injectSizeValues(i),this.dispatchEvent({type:this.EVENT_TEXT_CHANGE,data:i}),this.setInactive(),e.updateStyle(!0)},u.injectSizeValues=function(t){var e=parseFloat(this.textArea.style.width),i=parseFloat(this.textArea.style.height),n=parseFloat(this.textArea.style.left),s=parseFloat(this.textArea.style.top);t.width=e,t.height=i,t.newPos={x:n+.5*e,y:s+.5*i}},u.onCameraChanged=function(t){var e=this.textArea.value;this.textMarkup.style=Object(o.cloneStyle)(this.style),this.style=null,this.initFromMarkup(!0),this.textArea.value=e,this.setEditFrame()},u.generateLines=function(){var t=this.textArea.value.split(/\r*\n/),e=this.styleTextArea.clone().removeAttribute(["top","left","width","height"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",e),this.parentDiv.appendChild(this.measureDiv);for(var i=this.textArea.clientWidth-2*parseFloat(this.textArea.style.padding),n=[],s=0,o=t.length;s<o;++s){var r=l(t[s]);r=""===r?" ":r,this.splitLine(r,i,n)}return this.parentDiv.removeChild(this.measureDiv),n},u.splitLine=function(t,e,i){if(""!==t)for(var n="",s=!1;!s;){if(this.measureDiv.innerText=t,this.measureDiv.clientWidth-2*parseFloat(this.measureDiv.style.padding)<=e)i.push(t),this.splitLine(c(n),e,i),s=!0;else{var o=this.getShorterLine(t);1===o.length?(this.splitWord(t,n,e,i),s=!0):(t=o[0],n=o[1]+n)}}},u.getShorterLine=function(t){var e=t.lastIndexOf(" ");if(-1===e)return[t];for(;" "===t.charAt(e-1);)e--;var i=t.substr(e);return[t.substr(0,e),i]},u.splitWord=function(t,e,i,n){for(var s=1;;){var o=t.substr(0,s);if(this.measureDiv.innerText=o,this.measureDiv.clientWidth-2*parseFloat(this.measureDiv.style.padding)>i){if(1===s)return n.push(o),void this.splitWord(t.substr(1),e,i,n);var r=t.substr(0,s-1);n.push(r);var a=t.substr(s-1);return void this.splitLine(a+e,i,n)}if(++s>t.length)return void n.push(t)}}},"./extensions/Markup/gui/MarkupsGui.css":
/*!**********************************************!*\
  !*** ./extensions/Markup/gui/MarkupsGui.css ***!
  \**********************************************/
/*! no static exports found */function(t,e,i){var n=i(/*! !../../../node_modules/css-loader!../../../node_modules/sass-loader/dist/cjs.js!./MarkupsGui.css */"./node_modules/css-loader/index.js!./node_modules/sass-loader/dist/cjs.js!./extensions/Markup/gui/MarkupsGui.css");"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(/*! ../../../node_modules/style-loader/lib/addStyles.js */"./node_modules/style-loader/lib/addStyles.js")(n,s);n.locals&&(t.exports=n.locals)},"./extensions/Markup/gui/MarkupsGui.js":
/*!*********************************************!*\
  !*** ./extensions/Markup/gui/MarkupsGui.js ***!
  \*********************************************/
/*! exports provided: MarkupsGui */function(t,e,i){"use strict";i.r(e),i.d(e,"MarkupsGui",(function(){return h}));var n=i(/*! ../core/StyleUtils */"./extensions/Markup/core/StyleUtils.js"),s=i(/*! ../core/MarkupEvents */"./extensions/Markup/core/MarkupEvents.js"),o=i(/*! ../core/MarkupTypes */"./extensions/Markup/core/MarkupTypes.js"),r=i(/*! ../core/EditModeManager */"./extensions/Markup/core/EditModeManager.js");i(/*! ./MarkupsGui.css */"./extensions/Markup/gui/MarkupsGui.css");function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){Bimfish.Viewing.Extension.call(this,t,e),this.domEvents=[],this.name="markup",this.onEditModeEnter=this.onEditModeEnter.bind(this),this.onEditModeLeave=this.onEditModeLeave.bind(this),this.onEditModeChange=this.onEditModeChange.bind(this),this.onMarkupSelected=this.onMarkupSelected.bind(this)}h.prototype=Object.create(Bimfish.Viewing.Extension.prototype),h.prototype.constructor=h;var u=h.prototype,l=Bimfish.Viewing.Private;u.load=function(){var t=this;return this.viewer.loadExtension("Bimfish.Viewing.MarkupsCore").then((function(e){t.core=e,t.core.addEventListener(s.EVENT_EDITMODE_ENTER,t.onEditModeEnter),t.core.addEventListener(s.EVENT_EDITMODE_LEAVE,t.onEditModeLeave),t.core.addEventListener(s.EVENT_EDITMODE_CHANGED,t.onEditModeChange),t.core.addEventListener(s.EVENT_MARKUP_SELECTED,t.onMarkupSelected)})),!0},u.unload=function(){return this.deactivate(),this.unhookAllEvents(),this.core.removeEventListener(s.EVENT_EDITMODE_ENTER,this.onEditModeEnter),this.core.removeEventListener(s.EVENT_EDITMODE_LEAVE,this.onEditModeLeave),this.core.removeEventListener(s.EVENT_EDITMODE_CHANGED,this.onEditModeChange),this.core.removeEventListener(s.EVENT_MARKUP_SELECTED,this.onMarkupSelected),this.destroyToolUi(),this.destroyToolbarUI(),this.core=null,!0},u.onToolbarCreated=function(t){var e=this;this.viewer;this.markupToolButton=new Bimfish.Viewing.UI.Button("toolbar-markupTool"),this.markupToolButton.setToolTip("Markup"),this.markupToolButton.setIcon("adsk-icon-markup"),this.markupToolButton.onClick=function(){e.activate()};var i=t.getControl(Bimfish.Viewing.TOOLBAR.MODELTOOLSID);i&&i.addControl(this.markupToolButton,{index:0})},u.destroyToolbarUI=function(){this.markupToolButton&&(this.viewer.getToolbar()&&this.markupToolButton.removeFromParent(),this.markupToolButton=null)},u.onEditModeEnter=function(){l.logger.log("ENTER edit mode"),this.showToolsUi()},u.onEditModeLeave=function(){l.logger.log("LEAVE edit mode"),this.hideToolsUi()},u.onEditModeChange=function(t){if(this.domToolSelect&&!this.ignoreChangeEvent)for(var e=this.core.editMode,i=this.domToolSelect.options,n=0,s=i.length;n<s;n++){if(i[n].value===e.type){this.domToolSelect.selectedIndex=n;break}}},u.onMarkupSelected=function(t){var e=t.markup,i=this.core.editMode;this.setStylesUi(i,e)},u.showToolsUi=function(){this.createToolsUi();var t=this.core.isNavigationAllowed();this.setControlVisibility(".lmv-markup-gui-enterNavMode",t,"inline-block"),this.exitNavigationMode(),this.domContent.style.display="block",this.viewer.container.appendChild(this.domRoot)},u.hideToolsUi=function(){this.domRoot&&this.domRoot.parentNode&&this.domRoot.parentNode.removeChild(this.domRoot)},u.createToolsUi=function(){if(!this.domRoot){var t=['<div class="lmv-markup-gui-toolbar-content">','<button class="lmv-markup-gui-collapse-btn">&lt;-&gt;</button>','<button class="lmv-markup-editmode-done">Exit</button>','<div class="lmv-markup-gui-collapse-content">','<div class="lmv-markup-gui-editMode">','<button class="lmv-markup-gui-enterNavMode">Navigate</button>','<button class="lmv-markup-gui-undo">&#8617;</button>','<button class="lmv-markup-gui-redo">&#8618;</button>',"<br>",'<button class="lmv-markup-gui-delete">Delete</button>','<button class="lmv-markup-gui-duplicate">Duplicate</button>',"<br>",'<button class="lmv-markup-gui-cut">Cut</button>','<button class="lmv-markup-gui-copy">Copy</button>','<button class="lmv-markup-gui-paste">Paste</button>',"<br>","<span>Markup:</span>",'<select class="lmv-markup-tool-select">',i("Arrow",o.MARKUP_TYPE_ARROW),i("Rectangle",o.MARKUP_TYPE_RECTANGLE),i("Circle",o.MARKUP_TYPE_CIRCLE),i("Text",o.MARKUP_TYPE_TEXT),i("Callout",o.MARKUP_TYPE_CALLOUT),i("Cloud",o.MARKUP_TYPE_CLOUD),i("PolyLine",o.MARKUP_TYPE_POLYLINE),i("Polycloud",o.MARKUP_TYPE_POLYCLOUD),i("Freehand",o.MARKUP_TYPE_FREEHAND),i("Highlight",o.MARKUP_TYPE_HIGHLIGHT),i("Dimension",o.MARKUP_TYPE_DIMENSION),"</select>","<br>",'<div class="lmv-markup-gui-style-options"></div>',"</div>",'<div class="lmv-markup-gui-navMode" style="display:none;">','<button class="lmv-markup-gui-exitNavMode">Back to Markup</button>',"</div>","</div>","</div>"].join(""),e=this.getDocument();this.domRoot=e.createElement("div"),this.domRoot.className="lmv-markup-gui-toolbar",this.domRoot.innerHTML=t,this.domContent=this.domRoot.querySelector(".lmv-markup-gui-collapse-content"),this.domToolSelect=this.domRoot.querySelector(".lmv-markup-tool-select"),this.domStylesRoot=this.domRoot.querySelector(".lmv-markup-gui-style-options"),this.hookEvent("click",".lmv-markup-gui-collapse-btn",this.onToggleCollapse.bind(this)),this.hookEvent("click",".lmv-markup-editmode-done",this.onEditModeDone.bind(this)),this.hookEvent("click",".lmv-markup-gui-enterNavMode",this.enterNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-exitNavMode",this.exitNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-undo",this.onUndoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-redo",this.onRedoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-delete",this.onDeleteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-cut",this.onCutClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-copy",this.onCopyClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-paste",this.onPasteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-duplicate",this.onDuplicateClick.bind(this)),this.hookEvent("change",".lmv-markup-tool-select",this.onSelectEditMode.bind(this)),this.hookEvent("change",".lmv-markup-gui-style-select",this.onStyleChange.bind(this)),this.setStylesUi(this.core.editMode)}function i(t,e){return['<option value="',e,'">',t,"</option>"].join("")}},u.destroyToolUi=function(){this.domRoot&&(this.hideToolsUi(),this.domRoot=null)},u.getEditMode=function(t){var e=r.theEditModeManager.getClass(t);return e?new e(this.core):null},u.onToggleCollapse=function(){var t=this.domContent.style.display;this.domContent.style.display="none"===t?"block":"none"},u.onEditModeDone=function(){this.deactivate()},u.enterNavigationMode=function(){this.core.allowNavigation(!0),this.setControlVisibility(".lmv-markup-gui-editMode",!1),this.setControlVisibility(".lmv-markup-gui-navMode",!0)},u.exitNavigationMode=function(){this.core.allowNavigation(!1),this.setControlVisibility(".lmv-markup-gui-editMode",!0),this.setControlVisibility(".lmv-markup-gui-navMode",!1)},u.onUndoClick=function(){this.core.undo()},u.onRedoClick=function(){this.core.redo()},u.onDeleteClick=function(){var t=this.core.getSelection();t&&this.core.deleteMarkup(t)},u.onCutClick=function(){this.core.cut()},u.onCopyClick=function(){this.core.copy()},u.onPasteClick=function(){this.core.paste()},u.onDuplicateClick=function(){this.core.getSelection()&&(this.core.copy(),this.core.paste())},u.onSelectEditMode=function(t){var e=t.target.value,i=this.getEditMode(e);i?i.cancelEditModeChange?l.logger.warn("There was a problem selecting current editMode"):(this.ignoreChangeEvent=!0,this.core.changeEditMode(i),this.ignoreChangeEvent=!1,this.setStylesUi(i),this.domToolSelect.blur()):l.logger.error("Markup editMode not found for type: "+e)},u.onStyleChange=function(t){var e=t.target,i=e.options[e.selectedIndex],n=e.getAttribute("style-key"),s=e.getAttribute("value-type");e.blur();var o,r,a=this.core.getSelection(),h=a?a.getStyle():this.core.getStyle();h[n]=(o=i.value,"number"===(r=s)?Number(o):"boolean"===r?"true"===o:o),this.core.setStyle(h)},u.setStylesUi=function(t,e){l.logger.log("set ui for "+t.type);var i=e?e.style:t.style,s=Object(n.getStyleDefaultValues)(i,this.core);for(var o in this.domStylesRoot.innerHTML="",s){var r=this.getUiForStyleKey(o,s[o],i[o]);this.domStylesRoot.appendChild(r)}},u.getUiForStyleKey=function(t,e,i){for(var n=e.default,s=[],o=e.values,r=0,h=o.length;r<h;++r){var u=['<option value="',o[r].value,'">',o[r].name,"</option>"].join("");s.push(u),this.valueEquals(o[r].value,i)&&(n=r)}var l=a(o[0].value),c=this.getDocument().createElement("div"),d=["<span>",t,"</span>",'<select class="lmv-markup-gui-style-select" style-key="',t,'" value-type="',l,'">',s.join(""),"</select>"].join("");return c.innerHTML=d,c.querySelector("select").selectedIndex=n,c},u.valueEquals=function(t,e){return t===e},u.setControlVisibility=function(t,e,i){i||(i="block"),this.domRoot.querySelector(t).style.display=e?i:"none"},u.hookEvent=function(t,e,i){var n=function(t){this.matchesSelector(t.target,e)&&i(t)}.bind(this);this.domRoot.addEventListener(t,n),this.domEvents.push({str:t,handler:n})},u.unhookAllEvents=function(){var t=this.domRoot;this.domEvents.forEach((function(e){t.removeEventListener(e.str,e.handler)})),this.domEvents=[]},u.matchesSelector=function(t,e){return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.mozMatchesSelector?t.mozMatchesSelector(e):!!t.webkitMatchesSelector&&t.webkitMatchesSelector(e)},u.getStyleOptions=function(t){var e=t.getStyle();return Object(n.getStyleDefaultValues)(e,this.core)},u.activate=function(){return this.activeStatus||(this.core.enterEditMode(),this.activeStatus=!0),!0},u.deactivate=function(){return this.activeStatus&&(this.core.hide(),this.activeStatus=!1),!0},Bimfish.Viewing.theExtensionManager.registerExtension("Bimfish.Viewing.MarkupsGui",h)},"./node_modules/css-loader/index.js!./node_modules/sass-loader/dist/cjs.js!./extensions/Markup/core/Markups.css":
/*!*************************************************************************************************************!*\
  !*** ./node_modules/css-loader!./node_modules/sass-loader/dist/cjs.js!./extensions/Markup/core/Markups.css ***!
  \*************************************************************************************************************/
/*! no static exports found */function(t,e,i){(t.exports=i(/*! ../../../node_modules/css-loader/lib/css-base.js */"./node_modules/css-loader/lib/css-base.js")(!1)).push([t.i,'.adsk-viewing-viewer .Bimfish-markups-extension-core-make-me-bigger:after {\n  content: "";\n  position: absolute;\n  top: -15px;\n  bottom: -15px;\n  left: -15px;\n  right: -15px; }\n\n.adsk-viewing-viewer .Bimfish-markups-extension-core-make-me-bigger.rotation-bridge:after {\n  top: 0;\n  bottom: 0px; }\n\n.adsk-viewing-viewer .selector-box {\n  position: absolute;\n  border: 1px dashed #0696D7;\n  background: rgba(6, 150, 215, 0.05);\n  z-index: 1;\n  cursor: move;\n  box-sizing: border-box; }\n\n.adsk-viewing-viewer .selector-drag-point,\n.adsk-viewing-viewer .selector-rotate-point {\n  position: absolute;\n  height: 8px;\n  width: 8px;\n  border-radius: 8px;\n  /*HANDLE_SIZE*/\n  background: #FFFFFF;\n  /*HANDLE_BACKGROUND_COLOR*/\n  border-color: rgba(107, 120, 127, 0.7);\n  /* HANDLE_BORDER_COLOR; */\n  border-width: 1px;\n  /* BORDER_WIDTH */\n  border-style: solid; }\n\n.adsk-viewing-viewer .selector-rotate-point {\n  top: calc(100% + 22px);\n  /* 30 - 8 = 22 */\n  left: calc(50% + 1px);\n  transform: translate3d(-50%, 0px, 0px); }\n\n.adsk-viewing-viewer .selector-drag-point.selected,\n.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge) {\n  background: #0696D7;\n  border-color: #0696D7; }\n\n.adsk-viewing-viewer .rotation-bridge {\n  position: absolute;\n  background-color: rgba(0, 0, 0, 0);\n  height: 30px;\n  width: 0px;\n  top: 100%;\n  left: calc(50% + 1px);\n  border: unset;\n  border-left: 1px dashed #0696D7; }\n\n/*var placementOffset = -6;*/\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-n {\n  top: -6px;\n  left: calc(50% - 4px);\n  position: relative; }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-s {\n  top: calc(100% - 14px);\n  left: calc(50% - 4px);\n  position: relative; }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-w {\n  left: -6px;\n  top: 50%;\n  transform: translate3d(0, -50%, 0); }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-e {\n  right: -6px;\n  top: 50%;\n  transform: translate3d(0, -50%, 0); }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw {\n  top: -6px;\n  left: -6px; }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne {\n  top: -6px;\n  right: -6px; }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw {\n  bottom: -6px;\n  left: -6px; }\n\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-se {\n  bottom: -6px;\n  right: -6px; }\n',""])},"./node_modules/css-loader/index.js!./node_modules/sass-loader/dist/cjs.js!./extensions/Markup/gui/MarkupsGui.css":
/*!***************************************************************************************************************!*\
  !*** ./node_modules/css-loader!./node_modules/sass-loader/dist/cjs.js!./extensions/Markup/gui/MarkupsGui.css ***!
  \***************************************************************************************************************/
/*! no static exports found */function(t,e,i){(t.exports=i(/*! ../../../node_modules/css-loader/lib/css-base.js */"./node_modules/css-loader/lib/css-base.js")(!1)).push([t.i,'.adsk-icon-markup:before {\n  content: "a"; }\n\n.lmv-markup-gui-toolbar {\n  position: absolute;\n  top: 0;\n  margin: 5px 5px;\n  color: #000000; }\n\n.lmv-markup-gui-toolbar-content > * {\n  margin: 0 2px; }\n\n.lmv-markup-gui-style-options {\n  display: inline-block; }\n',""])},"./node_modules/css-loader/lib/css-base.js":
/*!*************************************************!*\
  !*** ./node_modules/css-loader/lib/css-base.js ***!
  \*************************************************/
/*! no static exports found */function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[i].concat(o).concat([s]).join("\n")}var r;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];"number"==typeof o&&(n[o]=!0)}for(s=0;s<t.length;s++){var r=t[s];"number"==typeof r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},"./node_modules/style-loader/lib/addStyles.js":
/*!****************************************************!*\
  !*** ./node_modules/style-loader/lib/addStyles.js ***!
  \****************************************************/
/*! no static exports found */function(t,e,i){var n,s,o={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},h=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),u=null,l=0,c=[],d=i(/*! ./urls */"./node_modules/style-loader/lib/urls.js");function p(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=o[n.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](n.parts[r]);for(;r<n.parts.length;r++)s.parts.push(M(n.parts[r],e))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(M(n.parts[r],e));o[n.id]={id:n.id,refs:1,parts:a}}}}function f(t,e){for(var i=[],n={},s=0;s<t.length;s++){var o=t[s],r=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function y(t,e){var i=h(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),c.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=h(t.insertAt.before,i);i.insertBefore(e,s)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return m(e,t.attrs),y(t,e),e}function m(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function M(t,e){var i,n,s,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var r=l++;i=u||(u=v(e)),n=k.bind(null,i,r,!1),s=k.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),y(t,e),e}(e),n=T.bind(null,i,e),s=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=v(e),n=b.bind(null,i),s=function(){g(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=f(t,e);return p(i,e),function(t){for(var n=[],s=0;s<i.length;s++){var r=i[s];(a=o[r.id]).refs--,n.push(a)}t&&p(f(t,e),e);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var x,E=(x=[],function(t,e){return x[t]=e,x.filter(Boolean).join("\n")});function k(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=E(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function b(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function T(t,e,i){var n=i.css,s=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||o)&&(n=d(n)),s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}},"./node_modules/style-loader/lib/urls.js":
/*!***********************************************!*\
  !*** ./node_modules/style-loader/lib/urls.js ***!
  \***********************************************/
/*! no static exports found */function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var s,o=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(s=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")}))}},"./thirdparty/canvg/canvg.js":
/*!***********************************!*\
  !*** ./thirdparty/canvg/canvg.js ***!
  \***********************************/
/*! no static exports found */function(t,e,i){var n,s,o,r;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}r=function(t,e,i){"use strict";return t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i,function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(i){var n;i.exports,(n=window).DOMParser=window.DOMParser;var s=n.document;function o(t,e){var i;return(i=s.createElement("canvas")).width=t,i.height=e,i}var r,a=function i(a,h,u){if(null!=a||null!=h||null!=u){var l=function(i){var a={opts:i,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,rootEmSize:12,emSize:12,log:function(){}};1==a.opts.log&&"undefined"!=typeof console&&(a.log=function(t){console.log(t)}),a.init=function(t){var e=0;a.UniqueId=function(){return"canvg"+ ++e},a.Definitions={},a.Styles={},a.StylesSpecificity={},a.Animations=[],a.Images=[],a.ctx=t,a.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},a.init(),a.ImagesLoaded=function(){for(var t=0;t<a.Images.length;t++)if(!a.Images[t].loaded)return!1;return!0},a.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},a.compressSpaces=function(t){return t.replace(/(?!\u3000)\s+/gm," ")},a.ajax=function(t){var e;return(e=n.XMLHttpRequest?new n.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(e.open("GET",t,!1),e.send(null),e.responseText):null},a.parseXml=function(t){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var e=new Windows.Data.Xml.Dom.XmlDocument,s=new Windows.Data.Xml.Dom.XmlLoadSettings;return s.prohibitDtd=!1,e.loadXml(t,s),e}if(!n.DOMParser)return t=t.replace(/<!DOCTYPE svg[^>]*>/,""),(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t),e;try{var o=i.xmldom?new n.DOMParser(i.xmldom):new n.DOMParser;return o.parseFromString(t,"image/svg+xml")}catch(e){return(o=i.xmldom?new n.DOMParser(i.xmldom):new n.DOMParser).parseFromString(t,"text/xml")}},a.Property=function(t,e){this.name=t,this.value=e},a.Property.prototype.getValue=function(){return this.value},a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var t=parseFloat(this.value);return(this.value+"").match(/%$/)&&(t/=100),t},a.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},a.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():t},a.Property.prototype.addOpacity=function(e){var i=this.value;if(null!=e.value&&""!=e.value&&"string"==typeof this.value){var n=new t(this.value);n.ok&&(i="rgba("+n.r+", "+n.g+", "+n.b+", "+e.numValue()+")")}return new a.Property(this.name,i)},a.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),a.Definitions[t]},a.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},a.Property.prototype.getFillStyleDefinition=function(t,e){var i=this.getDefinition();if(null!=i&&i.createGradient)return i.createGradient(a.ctx,t,e);if(null!=i&&i.createPattern){if(i.getHrefAttribute().hasValue()){var n=i.attribute("patternTransform");i=i.getHrefAttribute().getDefinition(),n.hasValue()&&(i.attribute("patternTransform",!0).value=n.value)}return i.createPattern(a.ctx,t)}return null},a.Property.prototype.getDPI=function(){return 96},a.Property.prototype.getREM=function(){return a.rootEmSize},a.Property.prototype.getEM=function(){return a.emSize},a.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},a.Property.prototype.isPixels=function(){if(!this.hasValue())return!1;var t=this.value+"";return!!t.match(/px$/)||!!t.match(/^[0-9]+$/)},a.Property.prototype.toPixels=function(t,e){if(!this.hasValue())return 0;var i=this.value+"";if(i.match(/rem$/))return this.numValue()*this.getREM(t);if(i.match(/em$/))return this.numValue()*this.getEM(t);if(i.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(i.match(/px$/))return this.numValue();if(i.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(i.match(/pc$/))return 15*this.numValue();if(i.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(i.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(i.match(/in$/))return this.numValue()*this.getDPI(t);if(i.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(t);var n=this.numValue();return e&&n<1?n*a.ViewPort.ComputeSize(t):n},a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/s$/)?1e3*this.numValue():(t.match(/ms$/),this.numValue())},a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var h={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return a.Property.prototype.toTextBaseline=function(){return this.hasValue()?h[this.value]:null},a.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,e,i,n,s,o){var r=null!=o?this.Parse(o):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:s=s||r.fontFamily,fontSize:n||r.fontSize,fontStyle:t||r.fontStyle,fontWeight:i||r.fontWeight,fontVariant:e||r.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(e){for(var i={},n=a.trim(a.compressSpaces(e||"")).split(" "),s={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},o="",r=0;r<n.length;r++)s.fontStyle||-1==t.Styles.indexOf(n[r])?s.fontVariant||-1==t.Variants.indexOf(n[r])?s.fontWeight||-1==t.Weights.indexOf(n[r])?s.fontSize?"inherit"!=n[r]&&(o+=n[r]):("inherit"!=n[r]&&(i.fontSize=n[r].split("/")[0]),s.fontStyle=s.fontVariant=s.fontWeight=s.fontSize=!0):("inherit"!=n[r]&&(i.fontWeight=n[r]),s.fontStyle=s.fontVariant=s.fontWeight=!0):("inherit"!=n[r]&&(i.fontVariant=n[r]),s.fontStyle=s.fontVariant=!0):("inherit"!=n[r]&&(i.fontStyle=n[r]),s.fontStyle=!0);return""!=o&&(i.fontFamily=o),i}},a.ToNumberArray=function(t){for(var e=a.trim(a.compressSpaces((t||"").replace(/,/g," "))).split(" "),i=0;i<e.length;i++)e[i]=parseFloat(e[i]);return e},a.Point=function(t,e){this.x=t,this.y=e},a.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},a.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],i=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=i},a.CreatePoint=function(t){var e=a.ToNumberArray(t);return new a.Point(e[0],e[1])},a.CreatePath=function(t){for(var e=a.ToNumberArray(t),i=[],n=0;n<e.length;n+=2)i.push(new a.Point(e[n],e[n+1]));return i},a.BoundingBox=function(t,e,i,n){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,i,n,s,o){var r=t+2/3*(i-t),a=e+2/3*(n-e),h=r+1/3*(s-t),u=a+1/3*(o-e);this.addBezierCurve(t,e,r,h,a,u,s,o)},this.addBezierCurve=function(t,e,i,n,s,o,r,a){var h=[t,e],u=[i,n],l=[s,o],c=[r,a];this.addPoint(h[0],h[1]),this.addPoint(c[0],c[1]);for(var d=0;d<=1;d++){var p=function(t){return Math.pow(1-t,3)*h[d]+3*Math.pow(1-t,2)*t*u[d]+3*(1-t)*Math.pow(t,2)*l[d]+Math.pow(t,3)*c[d]},f=6*h[d]-12*u[d]+6*l[d],y=-3*h[d]+9*u[d]-9*l[d]+3*c[d],g=3*u[d]-3*h[d];if(0!=y){var v=Math.pow(f,2)-4*g*y;if(!(v<0)){var m=(-f+Math.sqrt(v))/(2*y);0<m&&m<1&&(0==d&&this.addX(p(m)),1==d&&this.addY(p(m)));var M=(-f-Math.sqrt(v))/(2*y);0<M&&M<1&&(0==d&&this.addX(p(M)),1==d&&this.addY(p(M)))}}else{if(0==f)continue;var x=-g/f;0<x&&x<1&&(0==d&&this.addX(p(x)),1==d&&this.addY(p(x)))}}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(i,n)},a.Transform=function(t){var e=this;this.Type={},this.Type.translate=function(t){this.p=a.CreatePoint(t),this.apply=function(t){t.translate(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var e=a.ToNumberArray(t);this.angle=new a.Property("angle",e[0]),this.cx=e[1]||0,this.cy=e[2]||0,this.apply=function(t){t.translate(this.cx,this.cy),t.rotate(this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.unapply=function(t){t.translate(this.cx,this.cy),t.rotate(-1*this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=a.CreatePoint(t),this.apply=function(t){t.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=a.ToNumberArray(t),this.apply=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(t){var e=this.m[0],i=this.m[2],n=this.m[4],s=this.m[1],o=this.m[3],r=this.m[5],a=1/(e*(1*o-0*r)-i*(1*s-0*r)+n*(0*s-0*o));t.transform(a*(1*o-0*r),a*(0*r-1*s),a*(0*n-1*i),a*(1*e-0*n),a*(i*r-n*o),a*(n*s-e*r))},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=e.Type.matrix,this.base(t),this.angle=new a.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;e>=0;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)};for(var i=a.trim(a.compressSpaces(t)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),n=0;n<i.length;n++)if("none"!==i[n]){var s=a.trim(i[n].split("(")[0]),o=i[n].split("(")[1].replace(")",""),r=this.Type[s];if(void 0!==r){var h=new r(o);h.type=s,this.transforms.push(h)}}},a.AspectRatio=function(t,e,i,n,s,o,r,h,u,l){var c=(e=(e=a.compressSpaces(e)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",d=e.split(" ")[1]||"meet",p=i/n,f=s/o,y=Math.min(p,f),g=Math.max(p,f);"meet"==d&&(n*=y,o*=y),"slice"==d&&(n*=g,o*=g),u=new a.Property("refX",u),l=new a.Property("refY",l),u.hasValue()&&l.hasValue()?t.translate(-y*u.toPixels("x"),-y*l.toPixels("y")):(c.match(/^xMid/)&&("meet"==d&&y==f||"slice"==d&&g==f)&&t.translate(i/2-n/2,0),c.match(/YMid$/)&&("meet"==d&&y==p||"slice"==d&&g==p)&&t.translate(0,s/2-o/2),c.match(/^xMax/)&&("meet"==d&&y==f||"slice"==d&&g==f)&&t.translate(i-n,0),c.match(/YMax$/)&&("meet"==d&&y==p||"slice"==d&&g==p)&&t.translate(0,s-o)),"none"==c?t.scale(p,f):"meet"==d?t.scale(y,y):"slice"==d&&t.scale(g,g),t.translate(null==r?0:-r,null==h?0:-h)},a.Element={},a.EmptyProperty=new a.Property("EMPTY",""),a.Element.ElementBase=function(t){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(t,e){var i=this.attributes[t];return null!=i?i:(1==e&&(i=new a.Property(t,""),this.attributes[t]=i),i||a.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if("href"==t||t.match(/:href$/))return this.attributes[t];return a.EmptyProperty},this.style=function(t,e,i){var n=this.styles[t];if(null!=n)return n;var s=this.attribute(t);if(null!=s&&s.hasValue())return this.styles[t]=s,s;if(1!=i){var o=this.parent;if(null!=o){var r=o.style(t);if(null!=r&&r.hasValue())return r}}return 1==e&&(n=new a.Property(t,""),this.styles[t]=n),n||a.EmptyProperty},this.render=function(t){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(t.save(),this.style("mask").hasValue()){var e=this.style("mask").getDefinition();null!=e&&e.apply(t,this)}else if(this.style("filter").hasValue()){var i=this.style("filter").getDefinition();null!=i&&i.apply(t,this)}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(t,e){var i=t;e&&(i=a.CreateElement(t)),i.parent=this,"title"!=i.type&&this.children.push(i)},this.addStylesFromStyleDefinition=function(){for(var e in a.Styles)if("@"!=e[0]&&r(t,e)){var i=a.Styles[e],n=a.StylesSpecificity[e];if(null!=i)for(var s in i){var o=this.stylesSpecificity[s];void 0===o&&(o="000"),n>=o&&(this.styles[s]=i[s],this.stylesSpecificity[s]=n)}}};var e=new RegExp("^[A-Z-]+$"),i=function(t){return e.test(t)?t.toLowerCase():t};if(null!=t&&1==t.nodeType){for(var n=0;n<t.attributes.length;n++){var s=t.attributes[n],o=i(s.nodeName);this.attributes[o]=new a.Property(o,s.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var h=this.attribute("style").value.split(";");for(n=0;n<h.length;n++)if(""!=a.trim(h[n])){var u=h[n].split(":"),l=a.trim(u[0]),c=a.trim(u[1]);this.styles[l]=new a.Property(l,c)}}for(this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=this),n=0;n<t.childNodes.length;n++){var d=t.childNodes[n];if(1==d.nodeType&&this.addChild(d,!0),this.captureTextNodes&&(3==d.nodeType||4==d.nodeType)){var p=d.value||d.text||d.textContent||"";""!=a.compressSpaces(p)&&this.addChild(new a.Element.tspan(d),!1)}}}},a.Element.RenderedElementBase=function(t){this.base=a.Element.ElementBase,this.base(t),this.calculateOpacity=function(){for(var t=1,e=this;null!=e;){var i=e.style("opacity",!1,!0);i.hasValue()&&(t*=i.numValue()),e=e.parent}return t},this.setContext=function(t,e){if(!e){var i;if(this.style("fill").isUrlDefinition())null!=(i=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(t.fillStyle=i);else if(this.style("fill").hasValue()){var n;"currentColor"==(n=this.style("fill")).value&&(n.value=this.style("color").value),"inherit"!=n.value&&(t.fillStyle="none"==n.value?"rgba(0,0,0,0)":n.value)}if(this.style("fill-opacity").hasValue()&&(n=(n=new a.Property("fill",t.fillStyle)).addOpacity(this.style("fill-opacity")),t.fillStyle=n.value),this.style("stroke").isUrlDefinition())null!=(i=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(t.strokeStyle=i);else if(this.style("stroke").hasValue()){var s;"currentColor"==(s=this.style("stroke")).value&&(s.value=this.style("color").value),"inherit"!=s.value&&(t.strokeStyle="none"==s.value?"rgba(0,0,0,0)":s.value)}if(this.style("stroke-opacity").hasValue()&&(s=(s=new a.Property("stroke",t.strokeStyle)).addOpacity(this.style("stroke-opacity")),t.strokeStyle=s.value),this.style("stroke-width").hasValue()){var o=this.style("stroke-width").toPixels();t.lineWidth=0==o?.001:o}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("paint-order").hasValue()&&(t.paintOrder=this.style("paint-order").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var r=a.ToNumberArray(this.style("stroke-dasharray").value);void 0!==t.setLineDash?t.setLineDash(r):void 0!==t.webkitLineDash?t.webkitLineDash=r:void 0===t.mozDash||1==r.length&&0==r[0]||(t.mozDash=r);var h=this.style("stroke-dashoffset").toPixels();void 0!==t.lineDashOffset?t.lineDashOffset=h:void 0!==t.webkitLineDashOffset?t.webkitLineDashOffset=h:void 0!==t.mozDashOffset&&(t.mozDashOffset=h)}}if(void 0!==t.font){t.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var u=this.style("font-size",!1,!1);u.isPixels()&&(a.emSize=u.toPixels())}if(this.style("transform",!1,!0).hasValue()&&new a.Transform(this.style("transform",!1,!0).value).apply(t),this.style("clip-path",!1,!0).hasValue()){var l=this.style("clip-path",!1,!0).getDefinition();null!=l&&l.apply(t)}t.globalAlpha=this.calculateOpacity()}},a.Element.RenderedElementBase.prototype=new a.Element.ElementBase,a.Element.PathElementBase=function(t){this.base=a.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new a.BoundingBox},this.renderChildren=function(t){this.path(t),a.Mouse.checkPath(this,t),""!=t.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?t.fill(this.style("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()&&(i=this.style("marker-start").getDefinition()).render(t,e[0][0],e[0][1]),this.style("marker-mid").isUrlDefinition())for(var i=this.style("marker-mid").getDefinition(),n=1;n<e.length-1;n++)i.render(t,e[n][0],e[n][1]);this.style("marker-end").isUrlDefinition()&&(i=this.style("marker-end").getDefinition()).render(t,e[e.length-1][0],e[e.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase,a.Element.svg=function(t){this.base=a.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),a.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){if(t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,t.canvas.style&&void 0!==t.font&&void 0!==n.getComputedStyle){t.font=n.getComputedStyle(t.canvas).getPropertyValue("font");var e=new a.Property("fontSize",a.Font.Parse(t.font).fontSize);e.hasValue()&&(a.rootEmSize=a.emSize=e.toPixels("y"))}this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var i=a.ViewPort.width(),s=a.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){i=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");var o=0,r=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(o=-this.attribute("refX").toPixels("x"),r=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(t.beginPath(),t.moveTo(o,r),t.lineTo(i,r),t.lineTo(i,s),t.lineTo(o,s),t.closePath(),t.clip())}if(a.ViewPort.SetCurrent(i,s),this.attribute("viewBox").hasValue()){var h=a.ToNumberArray(this.attribute("viewBox").value),u=h[0],l=h[1];i=h[2],s=h[3],a.AspectRatio(t,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),i,a.ViewPort.height(),s,u,l,this.attribute("refX").value,this.attribute("refY").value),a.ViewPort.RemoveCurrent(),a.ViewPort.SetCurrent(h[2],h[3])}}},a.Element.svg.prototype=new a.Element.RenderedElementBase,a.Element.rect=function(t){this.base=a.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y"),o=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(r=o),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(o=r),o=Math.min(o,n/2),r=Math.min(r,s/2),null!=t){var h=(Math.sqrt(2)-1)/3*4;t.beginPath(),t.moveTo(e+o,i),t.lineTo(e+n-o,i),t.bezierCurveTo(e+n-o+h*o,i,e+n,i+r-h*r,e+n,i+r),t.lineTo(e+n,i+s-r),t.bezierCurveTo(e+n,i+s-r+h*r,e+n-o+h*o,i+s,e+n-o,i+s),t.lineTo(e+o,i+s),t.bezierCurveTo(e+o-h*o,i+s,e,i+s-r+h*r,e,i+s-r),t.lineTo(e,i+r),t.bezierCurveTo(e,i+r-h*r,e+o-h*o,i,e+o,i),t.closePath()}return new a.BoundingBox(e,i,e+n,i+s)}},a.Element.rect.prototype=new a.Element.PathElementBase,a.Element.circle=function(t){this.base=a.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("cx").toPixels("x"),i=this.attribute("cy").toPixels("y"),n=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(e,i,n,0,2*Math.PI,!1),t.closePath()),new a.BoundingBox(e-n,i-n,e+n,i+n)}},a.Element.circle.prototype=new a.Element.PathElementBase,a.Element.ellipse=function(t){this.base=a.Element.PathElementBase,this.base(t),this.path=function(t){var e=(Math.sqrt(2)-1)/3*4,i=this.attribute("rx").toPixels("x"),n=this.attribute("ry").toPixels("y"),s=this.attribute("cx").toPixels("x"),o=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(s+i,o),t.bezierCurveTo(s+i,o+e*n,s+e*i,o+n,s,o+n),t.bezierCurveTo(s-e*i,o+n,s-i,o+e*n,s-i,o),t.bezierCurveTo(s-i,o-e*n,s-e*i,o-n,s,o-n),t.bezierCurveTo(s+e*i,o-n,s+i,o-e*n,s+i,o),t.closePath()),new a.BoundingBox(s-i,o-n,s+i,o+n)}},a.Element.ellipse.prototype=new a.Element.PathElementBase,a.Element.line=function(t){this.base=a.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var e=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)),new a.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},a.Element.line.prototype=new a.Element.PathElementBase,a.Element.polyline=function(t){this.base=a.Element.PathElementBase,this.base(t),this.points=a.CreatePath(this.attribute("points").value),this.path=function(t){var e=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)e.addPoint(this.points[i].x,this.points[i].y),null!=t&&t.lineTo(this.points[i].x,this.points[i].y);return e},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return t.length>0&&t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},a.Element.polyline.prototype=new a.Element.PathElementBase,a.Element.polygon=function(t){this.base=a.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo(this.points[0].x,this.points[0].y),t.closePath()),e}},a.Element.polygon.prototype=new a.Element.polyline,a.Element.path=function(t){this.base=a.Element.PathElementBase,this.base(t);var e=this.attribute("d").value;e=e.replace(/,/gm," ");for(var i=0;i<2;i++)e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(e=(e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),i=0;i<2;i++)e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),e=a.compressSpaces(e),e=a.trim(e),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new a.Point(0,0),this.control=new a.Point(0,0),this.current=new a.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t,t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t,t},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,i){null!=i&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(i)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(e),this.path=function(t){var e=this.PathParser;e.reset();var i=new a.BoundingBox;for(null!=t&&t.beginPath();!e.isEnd();)switch(e.nextCommand(),e.command){case"M":case"m":var n=e.getAsCurrentPoint();for(e.addMarker(n),i.addPoint(n.x,n.y),null!=t&&t.moveTo(n.x,n.y),e.start=e.current;!e.isCommandOrEnd();)n=e.getAsCurrentPoint(),e.addMarker(n,e.start),i.addPoint(n.x,n.y),null!=t&&t.lineTo(n.x,n.y);break;case"L":case"l":for(;!e.isCommandOrEnd();){var s=e.current;n=e.getAsCurrentPoint(),e.addMarker(n,s),i.addPoint(n.x,n.y),null!=t&&t.lineTo(n.x,n.y)}break;case"H":case"h":for(;!e.isCommandOrEnd();){var o=new a.Point((e.isRelativeCommand()?e.current.x:0)+e.getScalar(),e.current.y);e.addMarker(o,e.current),e.current=o,i.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"V":case"v":for(;!e.isCommandOrEnd();)o=new a.Point(e.current.x,(e.isRelativeCommand()?e.current.y:0)+e.getScalar()),e.addMarker(o,e.current),e.current=o,i.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y);break;case"C":case"c":for(;!e.isCommandOrEnd();){var r=e.current,h=e.getPoint(),u=e.getAsControlPoint(),l=e.getAsCurrentPoint();e.addMarker(l,u,h),i.addBezierCurve(r.x,r.y,h.x,h.y,u.x,u.y,l.x,l.y),null!=t&&t.bezierCurveTo(h.x,h.y,u.x,u.y,l.x,l.y)}break;case"S":case"s":for(;!e.isCommandOrEnd();)r=e.current,h=e.getReflectedControlPoint(),u=e.getAsControlPoint(),l=e.getAsCurrentPoint(),e.addMarker(l,u,h),i.addBezierCurve(r.x,r.y,h.x,h.y,u.x,u.y,l.x,l.y),null!=t&&t.bezierCurveTo(h.x,h.y,u.x,u.y,l.x,l.y);break;case"Q":case"q":for(;!e.isCommandOrEnd();)r=e.current,u=e.getAsControlPoint(),l=e.getAsCurrentPoint(),e.addMarker(l,u,u),i.addQuadraticCurve(r.x,r.y,u.x,u.y,l.x,l.y),null!=t&&t.quadraticCurveTo(u.x,u.y,l.x,l.y);break;case"T":case"t":for(;!e.isCommandOrEnd();)r=e.current,u=e.getReflectedControlPoint(),e.control=u,l=e.getAsCurrentPoint(),e.addMarker(l,u,u),i.addQuadraticCurve(r.x,r.y,u.x,u.y,l.x,l.y),null!=t&&t.quadraticCurveTo(u.x,u.y,l.x,l.y);break;case"A":case"a":for(;!e.isCommandOrEnd();){r=e.current;var c=e.getScalar(),d=e.getScalar(),p=e.getScalar()*(Math.PI/180),f=e.getScalar(),y=e.getScalar(),g=(l=e.getAsCurrentPoint(),new a.Point(Math.cos(p)*(r.x-l.x)/2+Math.sin(p)*(r.y-l.y)/2,-Math.sin(p)*(r.x-l.x)/2+Math.cos(p)*(r.y-l.y)/2)),v=Math.pow(g.x,2)/Math.pow(c,2)+Math.pow(g.y,2)/Math.pow(d,2);v>1&&(c*=Math.sqrt(v),d*=Math.sqrt(v));var m=(f==y?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(d,2)-Math.pow(c,2)*Math.pow(g.y,2)-Math.pow(d,2)*Math.pow(g.x,2))/(Math.pow(c,2)*Math.pow(g.y,2)+Math.pow(d,2)*Math.pow(g.x,2)));isNaN(m)&&(m=0);var M=new a.Point(m*c*g.y/d,m*-d*g.x/c),x=new a.Point((r.x+l.x)/2+Math.cos(p)*M.x-Math.sin(p)*M.y,(r.y+l.y)/2+Math.sin(p)*M.x+Math.cos(p)*M.y),E=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},k=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(E(t)*E(e))},b=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(k(t,e))},T=b([1,0],[(g.x-M.x)/c,(g.y-M.y)/d]),w=[(g.x-M.x)/c,(g.y-M.y)/d],S=[(-g.x-M.x)/c,(-g.y-M.y)/d],C=b(w,S);k(w,S)<=-1&&(C=Math.PI),k(w,S)>=1&&(C=0);var A=1-y?1:-1,P=T+A*(C/2),j=new a.Point(x.x+c*Math.cos(P),x.y+d*Math.sin(P));if(e.addMarkerAngle(j,P-A*Math.PI/2),e.addMarkerAngle(l,P-A*Math.PI),i.addPoint(l.x,l.y),null!=t&&!isNaN(T)&&!isNaN(C)){k=c>d?c:d;var D=c>d?1:c/d,I=c>d?d/c:1;t.translate(x.x,x.y),t.rotate(p),t.scale(D,I),t.arc(0,0,k,T,T+C,1-y),t.scale(1/D,1/I),t.rotate(-p),t.translate(-x.x,-x.y)}}break;case"Z":case"z":null!=t&&i.x1!==i.x2&&i.y1!==i.y2&&t.closePath(),e.current=e.start}return i},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),i=[],n=0;n<t.length;n++)i.push([t[n],e[n]]);return i}},a.Element.path.prototype=new a.Element.PathElementBase,a.Element.pattern=function(t){this.base=a.Element.ElementBase,this.base(t),this.createPattern=function(t){var e=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),n=new a.Element.svg;n.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value),n.attributes.width=new a.Property("width",e+"px"),n.attributes.height=new a.Property("height",i+"px"),n.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value),n.children=this.children;var s=o(e,i),r=s.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&r.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var h=-1;h<=1;h++)for(var u=-1;u<=1;u++)r.save(),n.attributes.x=new a.Property("x",h*s.width),n.attributes.y=new a.Property("y",u*s.height),n.render(r),r.restore();return t.createPattern(s,"repeat")}},a.Element.pattern.prototype=new a.Element.ElementBase,a.Element.marker=function(t){this.base=a.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,e,i){if(e){t.translate(e.x,e.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(i),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var n=new a.Element.svg;n.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value),n.attributes.refX=new a.Property("refX",this.attribute("refX").value),n.attributes.refY=new a.Property("refY",this.attribute("refY").value),n.attributes.width=new a.Property("width",this.attribute("markerWidth").value),n.attributes.height=new a.Property("height",this.attribute("markerHeight").value),n.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black")),n.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none")),n.children=this.children,n.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-i),t.translate(-e.x,-e.y)}}},a.Element.marker.prototype=new a.Element.ElementBase,a.Element.defs=function(t){this.base=a.Element.ElementBase,this.base(t),this.render=function(){}},a.Element.defs.prototype=new a.Element.ElementBase,a.Element.GradientBase=function(t){this.base=a.Element.ElementBase,this.base(t),this.stops=[];for(var e=0;e<this.children.length;e++){var i=this.children[e];"stop"==i.type&&this.stops.push(i)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(t){for(var e=0;e<this.attributesToInherit.length;e++){var i=this.attributesToInherit[e];!this.attribute(i).hasValue()&&t.attribute(i).hasValue()&&(this.attribute(i,!0).value=t.attribute(i).value)}},this.createGradient=function(t,e,i){var n=this;this.getHrefAttribute().hasValue()&&(n=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(n));var s=function(t){return i.hasValue()?new a.Property("color",t).addOpacity(i).value:t},r=this.getGradient(t,e);if(null==r)return s(n.stops[n.stops.length-1].color);for(var h=0;h<n.stops.length;h++)r.addColorStop(n.stops[h].offset,s(n.stops[h].color));if(this.attribute("gradientTransform").hasValue()){var u=a.ViewPort.viewPorts[0],l=new a.Element.rect;l.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),l.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),l.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),l.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS);var c=new a.Element.g;c.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),c.children=[l];var d=new a.Element.svg;d.attributes.x=new a.Property("x",0),d.attributes.y=new a.Property("y",0),d.attributes.width=new a.Property("width",u.width),d.attributes.height=new a.Property("height",u.height),d.children=[c];var p=o(u.width,u.height),f=p.getContext("2d");return f.fillStyle=r,d.render(f),f.createPattern(p,"no-repeat")}return r}},a.Element.GradientBase.prototype=new a.Element.ElementBase,a.Element.linearGradient=function(t){this.base=a.Element.GradientBase,this.base(t),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(t,e){var i="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox(t):null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var n="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),s="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return n==o&&s==r?null:t.createLinearGradient(n,s,o,r)}},a.Element.linearGradient.prototype=new a.Element.GradientBase,a.Element.radialGradient=function(t){this.base=a.Element.GradientBase,this.base(t),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(t,e){var i=e.getBoundingBox(t);this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var n="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),s="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=n,r=s;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(r="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var a="objectBoundingBox"==this.gradientUnits()?(i.width()+i.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return t.createRadialGradient(o,r,0,n,s,a)}},a.Element.radialGradient.prototype=new a.Element.GradientBase,a.Element.stop=function(t){this.base=a.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var e=this.style("stop-color",!0);""===e.value&&(e.value="#000"),this.style("stop-opacity").hasValue()&&(e=e.addOpacity(this.style("stop-opacity"))),this.color=e.value},a.Element.stop.prototype=new a.Element.ElementBase,a.Element.AnimateBase=function(t){this.base=a.Element.ElementBase,this.base(t),a.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+t;var e=!1;if(this.begin<this.duration){var i=this.calcValue();this.attribute("type").hasValue()&&(i=this.attribute("type").value+"("+i+")"),this.getProperty().value=i,e=!0}return e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var e=t.progress*(this.values.value.length-1),i=Math.floor(e),n=Math.ceil(e);t.from=new a.Property("from",parseFloat(this.values.value[i])),t.to=new a.Property("to",parseFloat(this.values.value[n])),t.progress=(e-i)/(n-i)}else t.from=this.from,t.to=this.to;return t}},a.Element.AnimateBase.prototype=new a.Element.ElementBase,a.Element.animate=function(t){this.base=a.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress();return t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress+this.initialUnits}},a.Element.animate.prototype=new a.Element.AnimateBase,a.Element.animateColor=function(e){this.base=a.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),i=new t(e.from.value),n=new t(e.to.value);if(i.ok&&n.ok){var s=i.r+(n.r-i.r)*e.progress,o=i.g+(n.g-i.g)*e.progress,r=i.b+(n.b-i.b)*e.progress;return"rgb("+parseInt(s,10)+","+parseInt(o,10)+","+parseInt(r,10)+")"}return this.attribute("from").value}},a.Element.animateColor.prototype=new a.Element.AnimateBase,a.Element.animateTransform=function(t){this.base=a.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),e=a.ToNumberArray(t.from.value),i=a.ToNumberArray(t.to.value),n="",s=0;s<e.length;s++)n+=e[s]+(i[s]-e[s])*t.progress+" ";return n}},a.Element.animateTransform.prototype=new a.Element.animate,a.Element.font=function(t){this.base=a.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var e=0;e<this.children.length;e++){var i=this.children[e];"font-face"==i.type?(this.fontFace=i,i.style("font-family").hasValue()&&(a.Definitions[i.style("font-family").value]=this)):"missing-glyph"==i.type?this.missingGlyph=i:"glyph"==i.type&&(""!=i.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[i.unicode]&&(this.glyphs[i.unicode]=[]),this.glyphs[i.unicode][i.arabicForm]=i):this.glyphs[i.unicode]=i)}this.render=function(){}},a.Element.font.prototype=new a.Element.ElementBase,a.Element.fontface=function(t){this.base=a.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},a.Element.fontface.prototype=new a.Element.ElementBase,a.Element.missingglyph=function(t){this.base=a.Element.path,this.base(t),this.horizAdvX=0},a.Element.missingglyph.prototype=new a.Element.path,a.Element.glyph=function(t){this.base=a.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},a.Element.glyph.prototype=new a.Element.path,a.Element.text=function(t){this.captureTextNodes=!0,this.base=a.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t);var e=this.style("dominant-baseline").toTextBaseline();null==e&&(e=this.style("alignment-baseline").toTextBaseline()),null!=e&&(t.textBaseline=e)},this.initializeCoordinates=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(t,this,0)},this.getBoundingBox=function(t){this.initializeCoordinates(t);for(var e=null,i=0;i<this.children.length;i++){var n=this.getChildBoundingBox(t,this,this,i);null==e?e=n:e.addBoundingBox(n)}return e},this.renderChildren=function(t){this.initializeCoordinates(t);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,this,e)},this.getAnchorDelta=function(t,e,i){var n=this.style("text-anchor").valueOrDefault("start");if("start"!=n){for(var s=0,o=i;o<e.children.length;o++){var r=e.children[o];if(o>i&&r.attribute("x").hasValue())break;s+=r.measureTextRecursive(t)}return-1*("end"==n?s:s/2)}return 0},this.adjustChildCoordinates=function(t,e,i,n){var s=i.children[n];return s.attribute("x").hasValue()?(s.x=s.attribute("x").toPixels("x")+e.getAnchorDelta(t,i,n),s.attribute("dx").hasValue()&&(s.x+=s.attribute("dx").toPixels("x"))):(s.attribute("dx").hasValue()&&(e.x+=s.attribute("dx").toPixels("x")),s.x=e.x),e.x=s.x+s.measureText(t),s.attribute("y").hasValue()?(s.y=s.attribute("y").toPixels("y"),s.attribute("dy").hasValue()&&(s.y+=s.attribute("dy").toPixels("y"))):(s.attribute("dy").hasValue()&&(e.y+=s.attribute("dy").toPixels("y")),s.y=e.y),e.y=s.y,s},this.getChildBoundingBox=function(t,e,i,n){var s=this.adjustChildCoordinates(t,e,i,n),o=s.getBoundingBox(t);for(n=0;n<s.children.length;n++){var r=e.getChildBoundingBox(t,e,s,n);o.addBoundingBox(r)}return o},this.renderChild=function(t,e,i,n){var s=this.adjustChildCoordinates(t,e,i,n);for(s.render(t),n=0;n<s.children.length;n++)e.renderChild(t,e,s,n)}},a.Element.text.prototype=new a.Element.RenderedElementBase,a.Element.TextElementBase=function(t){this.base=a.Element.RenderedElementBase,this.base(t),this.getGlyph=function(t,e,i){var n=e[i],s=null;if(t.isArabic){var o="isolated";(0==i||" "==e[i-1])&&i<e.length-2&&" "!=e[i+1]&&(o="terminal"),i>0&&" "!=e[i-1]&&i<e.length-2&&" "!=e[i+1]&&(o="medial"),i>0&&" "!=e[i-1]&&(i==e.length-1||" "==e[i+1])&&(o="initial"),void 0!==t.glyphs[n]&&null==(s=t.glyphs[n][o])&&"glyph"==t.glyphs[n].type&&(s=t.glyphs[n])}else s=t.glyphs[n];return null==s&&(s=t.missingGlyph),s},this.renderChildren=function(t){var e=this.parent.style("font-family").getDefinition();if(null==e)"stroke"==t.paintOrder?(""!=t.strokeStyle&&t.strokeText(a.compressSpaces(this.getText()),this.x,this.y),""!=t.fillStyle&&t.fillText(a.compressSpaces(this.getText()),this.x,this.y)):(""!=t.fillStyle&&t.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(a.compressSpaces(this.getText()),this.x,this.y));else{var i=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),n=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),s=this.getText();e.isRTL&&(s=s.split("").reverse().join(""));for(var o=a.ToNumberArray(this.parent.attribute("dx").value),r=0;r<s.length;r++){var h=this.getGlyph(e,s,r),u=i/e.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(u,-u);var l=t.lineWidth;t.lineWidth=t.lineWidth*e.fontFace.unitsPerEm/i,"italic"==n&&t.transform(1,0,.4,1,0,0),h.render(t),"italic"==n&&t.transform(1,0,-.4,1,0,0),t.lineWidth=l,t.scale(1/u,-1/u),t.translate(-this.x,-this.y),this.x+=i*(h.horizAdvX||e.horizAdvX)/e.fontFace.unitsPerEm,void 0===o[r]||isNaN(o[r])||(this.x+=o[r])}}},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),i=0;i<this.children.length;i++)e+=this.children[i].measureTextRecursive(t);return e},this.measureText=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e){var i=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),n=0,s=this.getText();e.isRTL&&(s=s.split("").reverse().join(""));for(var o=a.ToNumberArray(this.parent.attribute("dx").value),r=0;r<s.length;r++)n+=(this.getGlyph(e,s,r).horizAdvX||e.horizAdvX)*i/e.fontFace.unitsPerEm,void 0===o[r]||isNaN(o[r])||(n+=o[r]);return n}var h=a.compressSpaces(this.getText());if(!t.measureText)return 10*h.length;t.save(),this.setContext(t,!0);var u=t.measureText(h).width;return t.restore(),u},this.getBoundingBox=function(t){var e=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);return new a.BoundingBox(this.x,this.y-e,this.x+this.measureText(t),this.y)}},a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase,a.Element.tspan=function(t){this.captureTextNodes=!0,this.base=a.Element.TextElementBase,this.base(t),this.text=a.compressSpaces(t.value||t.text||t.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},a.Element.tspan.prototype=new a.Element.TextElementBase,a.Element.tref=function(t){this.base=a.Element.TextElementBase,this.base(t),this.getText=function(){var t=this.getHrefAttribute().getDefinition();if(null!=t)return t.children[0].getText()}},a.Element.tref.prototype=new a.Element.TextElementBase,a.Element.a=function(t){this.base=a.Element.TextElementBase,this.base(t),this.hasText=t.childNodes.length>0;for(var e=0;e<t.childNodes.length;e++)3!=t.childNodes[e].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].value||t.childNodes[0].data:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var e=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-e.toPixels("y"),this.x+this.measureText(t),this.y))}else if(this.children.length>0){var i=new a.Element.g;i.children=this.children,i.parent=this,i.render(t)}},this.onclick=function(){n.open(this.getHrefAttribute().value)},this.onmousemove=function(){a.ctx.canvas.style.cursor="pointer"}},a.Element.a.prototype=new a.Element.TextElementBase,a.Element.image=function(t){this.base=a.Element.RenderedElementBase,this.base(t);var e=this.getHrefAttribute().value;if(""!=e){var i=e.match(/\.svg$/);if(a.Images.push(this),this.loaded=!1,i)this.img=a.ajax(e),this.loaded=!0;else{this.img=s.createElement("img"),1==a.opts.useCORS&&(this.img.crossOrigin="Anonymous");var n=this;this.img.onload=function(){n.loaded=!0},this.img.onerror=function(){a.log('ERROR: image "'+e+'" not found'),n.loaded=!0},this.img.src=e}this.renderChildren=function(t){var e=this.attribute("x").toPixels("x"),s=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");0!=o&&0!=r&&(t.save(),i?t.drawSvg(this.img,e,s,o,r):(t.translate(e,s),a.AspectRatio(t,this.attribute("preserveAspectRatio").value,o,this.img.width,r,this.img.height,0,0),n.loaded&&(void 0===this.img.complete||this.img.complete)&&t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y");return new a.BoundingBox(t,e,t+i,e+n)}}},a.Element.image.prototype=new a.Element.RenderedElementBase,a.Element.g=function(t){this.base=a.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(t){for(var e=new a.BoundingBox,i=0;i<this.children.length;i++)e.addBoundingBox(this.children[i].getBoundingBox(t));return e}},a.Element.g.prototype=new a.Element.RenderedElementBase,a.Element.symbol=function(t){this.base=a.Element.RenderedElementBase,this.base(t),this.render=function(){}},a.Element.symbol.prototype=new a.Element.RenderedElementBase,a.Element.style=function(t){this.base=a.Element.ElementBase,this.base(t);for(var e="",i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].data;e=e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var n=(e=a.compressSpaces(e)).split("}");for(i=0;i<n.length;i++)if(""!=a.trim(n[i]))for(var s=n[i].split("{"),o=s[0].split(","),r=s[1].split(";"),h=0;h<o.length;h++){var u=a.trim(o[h]);if(""!=u){for(var l=a.Styles[u]||{},c=0;c<r.length;c++){var d=r[c].indexOf(":"),p=r[c].substr(0,d),f=r[c].substr(d+1,r[c].length-d);null!=p&&null!=f&&(l[a.trim(p)]=new a.Property(a.trim(p),a.trim(f)))}if(a.Styles[u]=l,a.StylesSpecificity[u]=y(u),"@font-face"==u)for(var g=l["font-family"].value.replace(/"/g,""),v=l.src.value.split(","),m=0;m<v.length;m++)if(v[m].indexOf('format("svg")')>0)for(var M=v[m].indexOf("url"),x=v[m].indexOf(")",M),E=v[m].substr(M+5,x-M-6),k=a.parseXml(a.ajax(E)).getElementsByTagName("font"),b=0;b<k.length;b++){var T=a.CreateElement(k[b]);a.Definitions[g]=T}}}},a.Element.style.prototype=new a.Element.ElementBase,a.Element.use=function(t){this.base=a.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate(0,this.attribute("y").toPixels("y"))};var e=this.getHrefAttribute().getDefinition();this.path=function(t){null!=e&&e.path(t)},this.elementTransform=function(){if(null!=e&&e.style("transform",!1,!0).hasValue())return new a.Transform(e.style("transform",!1,!0).value)},this.getBoundingBox=function(t){if(null!=e)return e.getBoundingBox(t)},this.renderChildren=function(t){if(null!=e){var i=e;"symbol"==e.type&&((i=new a.Element.svg).type="svg",i.attributes.viewBox=new a.Property("viewBox",e.attribute("viewBox").value),i.attributes.preserveAspectRatio=new a.Property("preserveAspectRatio",e.attribute("preserveAspectRatio").value),i.attributes.overflow=new a.Property("overflow",e.attribute("overflow").value),i.children=e.children),"svg"==i.type&&(this.attribute("width").hasValue()&&(i.attributes.width=new a.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(i.attributes.height=new a.Property("height",this.attribute("height").value)));var n=i.parent;i.parent=null,i.render(t),i.parent=n}}},a.Element.use.prototype=new a.Element.RenderedElementBase,a.Element.mask=function(t){this.base=a.Element.ElementBase,this.base(t),this.apply=function(t,e){var i=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),s=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");if(0==s&&0==r){for(var h=new a.BoundingBox,u=0;u<this.children.length;u++)h.addBoundingBox(this.children[u].getBoundingBox(t));i=Math.floor(h.x1),n=Math.floor(h.y1),s=Math.floor(h.width()),r=Math.floor(h.height())}var l=e.style("mask").value;e.style("mask").value="";var c=o(i+s,n+r),d=c.getContext("2d");this.renderChildren(d);var p=o(i+s,n+r),f=p.getContext("2d");e.render(f),f.globalCompositeOperation="destination-in",f.fillStyle=d.createPattern(c,"no-repeat"),f.fillRect(0,0,i+s,n+r),t.fillStyle=f.createPattern(p,"no-repeat"),t.fillRect(0,0,i+s,n+r),e.style("mask").value=l},this.render=function(){}},a.Element.mask.prototype=new a.Element.ElementBase,a.Element.clipPath=function(t){this.base=a.Element.ElementBase,this.base(t),this.apply=function(t){var e="undefined"!=typeof CanvasRenderingContext2D,i=t.beginPath,n=t.closePath;e&&(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath=function(){}),i.call(t);for(var s=0;s<this.children.length;s++){var o=this.children[s];if(void 0!==o.path){var r=void 0!==o.elementTransform&&o.elementTransform();!r&&o.style("transform",!1,!0).hasValue()&&(r=new a.Transform(o.style("transform",!1,!0).value)),r&&r.apply(t),o.path(t),e&&(CanvasRenderingContext2D.prototype.closePath=n),r&&r.unapply(t)}}n.call(t),t.clip(),e&&(CanvasRenderingContext2D.prototype.beginPath=i,CanvasRenderingContext2D.prototype.closePath=n)},this.render=function(){}},a.Element.clipPath.prototype=new a.Element.ElementBase,a.Element.filter=function(t){this.base=a.Element.ElementBase,this.base(t),this.apply=function(t,e){var i=e.getBoundingBox(t),n=Math.floor(i.x1),s=Math.floor(i.y1),r=Math.floor(i.width()),a=Math.floor(i.height()),h=e.style("filter").value;e.style("filter").value="";for(var u=0,l=0,c=0;c<this.children.length;c++){var d=this.children[c].extraFilterDistance||0;u=Math.max(u,d),l=Math.max(l,d)}var p=o(r+2*u,a+2*l),f=p.getContext("2d");for(f.translate(-n+u,-s+l),e.render(f),c=0;c<this.children.length;c++)"function"==typeof this.children[c].apply&&this.children[c].apply(f,0,0,r+2*u,a+2*l);t.drawImage(p,0,0,r+2*u,a+2*l,n-u,s-l,r+2*u,a+2*l),e.style("filter",!0).value=h},this.render=function(){}},a.Element.filter.prototype=new a.Element.ElementBase,a.Element.feDropShadow=function(t){this.base=a.Element.ElementBase,this.base(t),this.addStylesFromStyleDefinition(),this.apply=function(){}},a.Element.feDropShadow.prototype=new a.Element.ElementBase,a.Element.feMorphology=function(t){this.base=a.Element.ElementBase,this.base(t),this.apply=function(){}},a.Element.feMorphology.prototype=new a.Element.ElementBase,a.Element.feComposite=function(t){this.base=a.Element.ElementBase,this.base(t),this.apply=function(){}},a.Element.feComposite.prototype=new a.Element.ElementBase,a.Element.feColorMatrix=function(t){this.base=a.Element.ElementBase,this.base(t);var e=a.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var i=e[0];e=[.213+.787*i,.715-.715*i,.072-.072*i,0,0,.213-.213*i,.715+.285*i,.072-.072*i,0,0,.213-.213*i,.715-.715*i,.072+.928*i,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var n=e[0]*Math.PI/180,s=function(t,e,i){return t+Math.cos(n)*e+Math.sin(n)*i};e=[s(.213,.787,-.213),s(.715,-.715,-.715),s(.072,-.072,.928),0,0,s(.213,-.213,.143),s(.715,.285,.14),s(.072,-.072,-.283),0,0,s(.213,-.213,-.787),s(.715,-.715,.715),s(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function o(t,e,i,n,s,o){return t[i*n*4+4*e+o]}function r(t,e,i,n,s,o,r){t[i*n*4+4*e+o]=r}function h(t,i){var n=e[t];return n*(n<0?i-255:i)}this.apply=function(t,e,i,n,s){var a=t.getImageData(0,0,n,s);for(i=0;i<s;i++)for(e=0;e<n;e++){var u=o(a.data,e,i,n,0,0),l=o(a.data,e,i,n,0,1),c=o(a.data,e,i,n,0,2),d=o(a.data,e,i,n,0,3);r(a.data,e,i,n,0,0,h(0,u)+h(1,l)+h(2,c)+h(3,d)+h(4,1)),r(a.data,e,i,n,0,1,h(5,u)+h(6,l)+h(7,c)+h(8,d)+h(9,1)),r(a.data,e,i,n,0,2,h(10,u)+h(11,l)+h(12,c)+h(13,d)+h(14,1)),r(a.data,e,i,n,0,3,h(15,u)+h(16,l)+h(17,c)+h(18,d)+h(19,1))}t.clearRect(0,0,n,s),t.putImageData(a,0,0)}},a.Element.feColorMatrix.prototype=new a.Element.ElementBase,a.Element.feGaussianBlur=function(t){this.base=a.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,i,n,o,r){e&&void 0!==e.canvasRGBA?(t.canvas.id=a.UniqueId(),t.canvas.style.display="none",s.body.appendChild(t.canvas),e.canvasRGBA(t.canvas,i,n,o,r,this.blurRadius),s.body.removeChild(t.canvas)):a.log("ERROR: StackBlur.js must be included for blur to work")}},a.Element.feGaussianBlur.prototype=new a.Element.ElementBase,a.Element.title=function(){},a.Element.title.prototype=new a.Element.ElementBase,a.Element.desc=function(){},a.Element.desc.prototype=new a.Element.ElementBase,a.Element.MISSING=function(t){a.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},a.Element.MISSING.prototype=new a.Element.ElementBase,a.CreateElement=function(t){var e=t.nodeName.replace(/^[^:]+:/,"");e=e.replace(/\-/g,"");var i=null;return(i=void 0!==a.Element[e]?new a.Element[e](t):new a.Element.MISSING(t)).type=t.nodeName,i},a.load=function(t,e){a.loadXml(t,a.ajax(e))},a.loadXml=function(t,e){a.loadXmlDoc(t,a.parseXml(e))},a.loadXmlDoc=function(t,e){a.init(t);var i=function(e){for(var i=t.canvas;i;)e.x-=i.offsetLeft,e.y-=i.offsetTop,i=i.offsetParent;return n.scrollX&&(e.x+=n.scrollX),n.scrollY&&(e.y+=n.scrollY),e};1!=a.opts.ignoreMouse&&(t.canvas.onclick=function(t){var e=i(new a.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));a.Mouse.onclick(e.x,e.y)},t.canvas.onmousemove=function(t){var e=i(new a.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));a.Mouse.onmousemove(e.x,e.y)});var s=a.CreateElement(e.documentElement);s.root=!0,s.addStylesFromStyleDefinition();var o=!0,r=function(){a.ViewPort.Clear(),t.canvas.parentNode?a.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight):a.ViewPort.SetCurrent(800,600),1!=a.opts.ignoreDimensions&&(s.style("width").hasValue()&&(t.canvas.width=s.style("width").toPixels("x"),t.canvas.style&&(t.canvas.style.width=t.canvas.width+"px")),s.style("height").hasValue()&&(t.canvas.height=s.style("height").toPixels("y"),t.canvas.style&&(t.canvas.style.height=t.canvas.height+"px")));var i=t.canvas.clientWidth||t.canvas.width,n=t.canvas.clientHeight||t.canvas.height;if(1==a.opts.ignoreDimensions&&s.style("width").hasValue()&&s.style("height").hasValue()&&(i=s.style("width").toPixels("x"),n=s.style("height").toPixels("y")),a.ViewPort.SetCurrent(i,n),null!=a.opts.offsetX&&(s.attribute("x",!0).value=a.opts.offsetX),null!=a.opts.offsetY&&(s.attribute("y",!0).value=a.opts.offsetY),null!=a.opts.scaleWidth||null!=a.opts.scaleHeight){var r=null,h=null,u=a.ToNumberArray(s.attribute("viewBox").value);null!=a.opts.scaleWidth&&(s.attribute("width").hasValue()?r=s.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(u[2])||(r=u[2]/a.opts.scaleWidth)),null!=a.opts.scaleHeight&&(s.attribute("height").hasValue()?h=s.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(u[3])||(h=u[3]/a.opts.scaleHeight)),null==r&&(r=h),null==h&&(h=r),s.attribute("width",!0).value=a.opts.scaleWidth,s.attribute("height",!0).value=a.opts.scaleHeight,s.style("transform",!0,!0).value+=" scale("+1/r+","+1/h+")"}1!=a.opts.ignoreClear&&t.clearRect(0,0,i,n),s.render(t),o&&(o=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(e))},h=!0;a.ImagesLoaded()&&(h=!1,r()),a.intervalID=setInterval((function(){var t=!1;if(h&&a.ImagesLoaded()&&(h=!1,t=!0),1!=a.opts.ignoreMouse&&(t=t||a.Mouse.hasEvents()),1!=a.opts.ignoreAnimation)for(var e=0;e<a.Animations.length;e++){var i=a.Animations[e].update(1e3/a.FRAMERATE);t=t||i}"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(t=!0),t&&(r(),a.Mouse.runEvents())}),1e3/a.FRAMERATE)},a.stop=function(){a.intervalID&&clearInterval(a.intervalID)},a.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var i=0;i<this.events.length;i++){var n=this.events[i];e.isPointInPath&&e.isPointInPath(n.x,n.y)&&(this.eventElements[i]=t)}},this.checkBoundingBox=function(t,e){for(var i=0;i<this.events.length;i++){var n=this.events[i];e.isPointInBox(n.x,n.y)&&(this.eventElements[i]=t)}},this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var e=this.events[t],i=this.eventElements[t];i;)e.run(i),i=i.parent;this.events=[],this.eventElements=[]}},a}(u||{});"string"==typeof a&&(a=s.getElementById(a)),null!=a.svg&&a.svg.stop(),a.childNodes&&1==a.childNodes.length&&"OBJECT"==a.childNodes[0].nodeName||(a.svg=l);var c=a.getContext("2d");void 0!==h.documentElement?l.loadXmlDoc(c,h):"<"==h.substr(0,1)?l.loadXml(c,h):l.load(c,h)}else for(var d=s.querySelectorAll("svg"),p=0;p<d.length;p++){var f=d[p],g=s.createElement("canvas");if(void 0!==f.clientWidth&&void 0!==f.clientHeight)g.width=f.clientWidth,g.height=f.clientHeight;else{var v=f.getBoundingClientRect();g.width=v.width,g.height=v.height}f.parentNode.insertBefore(g,f),f.parentNode.removeChild(f);var m=s.createElement("div");m.appendChild(f),i(g,m.innerHTML)}};"undefined"==typeof Element||(void 0!==Element.prototype.matches?r=function(t,e){return t.matches(e)}:void 0!==Element.prototype.webkitMatchesSelector?r=function(t,e){return t.webkitMatchesSelector(e)}:void 0!==Element.prototype.mozMatchesSelector?r=function(t,e){return t.mozMatchesSelector(e)}:void 0!==Element.prototype.msMatchesSelector?r=function(t,e){return t.msMatchesSelector(e)}:void 0!==Element.prototype.oMatchesSelector?r=function(t,e){return t.oMatchesSelector(e)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(r=function(t,e){return $(t).is(e)}),void 0===r&&"undefined"!=typeof Sizzle&&(r=Sizzle.matchesSelector)));var h=/(\[[^\]]+\])/g,u=/(#[^\s\+>~\.\[:]+)/g,l=/(\.[^\s\+>~\.\[:]+)/g,c=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,d=/(:[\w-]+\([^\)]*\))/gi,p=/(:[^\s\+>~\.\[:]+)/g,f=/([^\s\+>~\.\[:]+)/g;function y(t){var e=[0,0,0],i=function(i,n){var s=t.match(i);null!=s&&(e[n]+=s.length,t=t.replace(i," "))};return t=(t=t.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),i(h,1),i(u,0),i(l,1),i(c,2),i(d,1),i(p,1),t=(t=t.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),i(f,2),e.join("")}"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,e,i,n,s,o){var r={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:e,offsetY:i,scaleWidth:n,scaleHeight:s};for(var h in o)o.hasOwnProperty(h)&&(r[h]=o[h]);a(this.canvas,t,r)}),i.exports=a}))},"object"===a(e)&&void 0!==t?t.exports=r(i(/*! ./rgbcolor */"./thirdparty/canvg/rgbcolor.js")):(s=[i(/*! ./rgbcolor */"./thirdparty/canvg/rgbcolor.js")],void 0===(o="function"==typeof(n=r)?n.apply(e,s):n)||(t.exports=o))},"./thirdparty/canvg/rgbcolor.js":
/*!**************************************!*\
  !*** ./thirdparty/canvg/rgbcolor.js ***!
  \**************************************/
/*! no static exports found */function(t,e,i){var n;
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */!function(s){function o(t){this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var i in e)t==i&&(t=e[i]);for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],s=0;s<n.length;s++){var r=n[s].re,a=n[s].process,h=r.exec(t);h&&(channels=a(h),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),i=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==i.length&&(i="0"+i),"#"+t+e+i},this.getHelpXML=function(){for(var t=new Array,i=0;i<n.length;i++)for(var s=n[i].example,r=0;r<s.length;r++)t[t.length]=s[r];for(var a in e)t[t.length]=a;var h=document.createElement("ul");h.setAttribute("id","rgbcolor-examples");for(i=0;i<t.length;i++)try{var u=document.createElement("li"),l=new o(t[i]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+l.toHex()+"; color:"+l.toHex(),c.appendChild(document.createTextNode("test"));var d=document.createTextNode(" "+t[i]+" -> "+l.toRGB()+" -> "+l.toHex());u.appendChild(c),u.appendChild(d),h.appendChild(u)}catch(t){}return h}}void 0===(n=function(){return o}.call(e,i,e,t))||(t.exports=n),s.RGBColor=o}("undefined"!=typeof window?window:this)},"./thirdparty/resize-observer-polyfill/ResizeObserver.min.js":
/*!*******************************************************************!*\
  !*** ./thirdparty/resize-observer-polyfill/ResizeObserver.min.js ***!
  \*******************************************************************/
/*! no static exports found */function(t,e){!function(i,n){"object"==typeof e&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):i.ResizeObserver=n()}(this,(function(){"use strict";var t=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some((function(t,n){return t[0]===e&&(i=n,!0)})),i}return function(){function e(){this.__entries__=[]}var i={size:{configurable:!0}};return i.size.get=function(){return this.__entries__.length},e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i+=1){var s=n[i];t.call(e,s[1],s[0])}},Object.defineProperties(e.prototype,i),e}()}(),e="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,i="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),n="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(i):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)},s=["top","right","bottom","left","width","height","size","weight"],o="undefined"!=typeof MutationObserver,r=function(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,s=!1,o=0;function r(){i&&(i=!1,t()),s&&h()}function a(){n(r)}function h(){var t=Date.now();if(i){if(t-o<2)return;s=!0}else i=!0,s=!1,setTimeout(a,20);o=t}return h}(this.refresh.bind(this))};r.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},r.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},r.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},r.prototype.connect_=function(){e&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),o?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){e&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(t){var e=t.propertyName;void 0===e&&(e=""),s.some((function(t){return!!~e.indexOf(t)}))&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null;var a=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i+=1){var s=n[i];Object.defineProperty(t,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return t},h=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||i},u=f(0,0,0,0);function l(t){return parseFloat(t)||0}function c(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];return e.reduce((function(e,i){return e+l(t["border-"+i+"-width"])}),0)}var d="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof h(t).SVGGraphicsElement}:function(t){return t instanceof h(t).SVGElement&&"function"==typeof t.getBBox};function p(t){return e?d(t)?f(0,0,(i=t.getBBox()).width,i.height):function(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return u;var n,s=h(t).getComputedStyle(t),o=function(t){for(var e={},i=0,n=["top","right","bottom","left"];i<n.length;i+=1){var s=n[i],o=t["padding-"+s];e[s]=l(o)}return e}(s),r=o.left+o.right,a=o.top+o.bottom,d=l(s.width),p=l(s.height);if("border-box"===s.boxSizing&&(Math.round(d+r)!==e&&(d-=c(s,"left","right")+r),Math.round(p+a)!==i&&(p-=c(s,"top","bottom")+a)),(n=t)!==h(n).document.documentElement){var y=Math.round(d+r)-e,g=Math.round(p+a)-i;1!==Math.abs(y)&&(d-=y),1!==Math.abs(g)&&(p-=g)}return f(o.left,o.top,d,p)}(t):u;var i}function f(t,e,i,n){return{x:t,y:e,width:i,height:n}}var y=function(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=t};y.prototype.isActive=function(){var t=p(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},y.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t};var g=function(t,e){var i,n,s,o,r,h,u,l=(n=(i=e).x,s=i.y,o=i.width,r=i.height,h="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(h.prototype),a(u,{x:n,y:s,width:o,height:r,top:s,right:n+o,bottom:r+s,left:n}),u);a(this,{target:t,contentRect:l})},v=function(e,i,n){if(this.activeObservations_=[],this.observations_=new t,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=i,this.callbackCtx_=n};v.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new y(t)),this.controller_.addObserver(this),this.controller_.refresh())}},v.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},v.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},v.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},v.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new g(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},v.prototype.clearActive=function(){this.activeObservations_.splice(0)},v.prototype.hasActive=function(){return this.activeObservations_.length>0};var m="undefined"!=typeof WeakMap?new WeakMap:new t,M=function(t){if(!(this instanceof M))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=r.getInstance(),i=new v(t,e,this);m.set(this,i)};return["observe","unobserve","disconnect"].forEach((function(t){M.prototype[t]=function(){return(e=m.get(this))[t].apply(e,arguments);var e}})),void 0!==i.ResizeObserver?i.ResizeObserver:M}))}});