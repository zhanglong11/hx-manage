/*!
 * LMV v7.9.0
 * 
 * Copyright 2019 Bimfish, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Bimfish, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Bimfish, Inc.
 * 
 * Bimfish Forge Viewer Usage Limitations:
 * 
 * The Bimfish Forge viewer can only be used to view files generated by
 * Bimfish Forge services. The Bimfish Forge Viewer JavaScript must be
 * delivered from an Bimfish hosted URL.
 */
Bimfish.Extensions.SplitScreen=function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./extensions/SplitScreen/SplitScreen.js")}({"./extensions/SplitScreen/SplitScreen.js":
/*!***********************************************!*\
  !*** ./extensions/SplitScreen/SplitScreen.js ***!
  \***********************************************/
/*! exports provided: SplitScreenExtension */function(e,t,i){"use strict";i.r(t),i.d(t,"SplitScreenExtension",(function(){return n}));var r=i(/*! ./SplitScreenGroundShadow */"./extensions/SplitScreen/SplitScreenGroundShadow.js"),o=i(/*! ./SplitScreenRenderContext */"./extensions/SplitScreen/SplitScreenRenderContext.js");AutodeskNamespace("Bimfish.Extensions.SplitScreen");function n(e,t){Bimfish.Viewing.Extension.call(this,e,t),this.options=t||{}}var s=n.prototype;function h(e,t,i){Math.abs(i-t);return Math.abs(e-t)>Math.abs(e-i)&&(e-=(i-t)/2),e=2*e-t}s.load=function(){var e=this;this.enabled=!0;var t=this.viewer.impl.renderer();if(this.context=new o.SplitScreenRenderContext(t,this.viewer),this.viewer.impl.setUserRenderContext(this.context,!0),this.groundShadow=new r.SplitScreenGroundShadow,this.groundShadow.attach(this.viewer),this.patchRayCast(),this.patchCoordinateConversions(),this.viewer.getExtension("Bimfish.DefaultTools.NavTools"))this.patchWorldUp();else{this.viewer.addEventListener(Bimfish.Viewing.EXTENSION_LOADED_EVENT,(function t(i){"Bimfish.DefaultTools.NavTools"===i.extensionId&&(e.patchWorldUp(),e.viewer.removeEventListener(Bimfish.Viewing.EXTENSION_LOADED_EVENT,t))}))}return this.collectControlsToHide(),this.onToolbarButtonsUpdated=function(){e.hideIncompatibleControls(!0)},this.viewer.addEventListener(Bimfish.Viewing.NAVIGATION_MODE_CHANGED_EVENT,this.onToolbarButtonsUpdated),this.handleResize=function(){var t=e.viewer.canvas.clientWidth,i=e.viewer.canvas.clientHeight,r=e.viewer.impl.camera;r.clientWidth=t,r.clientHeight=i,r.aspect=t/i,e.enabled&&(r.clientWidth/=2,e.context.getNumberOfViewports()>2?r.clientHeight/=2:r.aspect/=2),e.onToolbarButtonsUpdated()},this.viewer.addEventListener(Bimfish.Viewing.VIEWER_RESIZE_EVENT,this.handleResize),this.handleResize(),this.options.viewports?this.context.setViewports(this.options.viewports):(this.options.modelFilterLeft||this.options.modelFilterRight)&&(this.context.modelFilterLeft=this.options.modelFilterLeft,this.context.modelFilterRight=this.options.modelFilterRight),!0},s.mapCoords=function(e,t,i,r,o,n){var s=0,l=this.context.getNumberOfViewports();return l>=2&&(s=Math.abs(e-i)<Math.abs(e-r)?0:1,e=h(e,i,r)),l>=3&&(s+=Math.abs(t-o)<Math.abs(t-n)?0:2,t=h(t,n,o)),{x:e,y:t,viewportId:s}},s.hideIncompatibleControls=function(e){for(var t=0;t<this.controlsToHide.length;t++){var i=this.controlsToHide[t],r=e?"none":i.originalValue;i.control.setDisplay(r)}},s.collectControl=function(e){e&&this.controlsToHide.push({control:e,originalValue:e.container.style.display})},s.collectControlsToHide=function(){this.controlsToHide=[];var e=this.viewer.modelTools;this.collectControl(e.measurementToolbarButton),this.collectControl(e.getControl("toolbar-sectionTool")),this.collectControl(this.viewer.navTools.getControl("toolbar-zoomTools"))},s.patchRayCast=function(){this.castRayViewport=this.viewer.impl.castRayViewport.bind(this.viewer.impl);var e=function(){return!1},t=this;new THREE.Vector3;this.viewer.impl.castRayViewport=function(i,r,o,n,s){var h=t.viewer.impl.modelQueue().getModels().map((function(e){return e.id})),l=t.context.getViewports()[i.viewportId||0];return h=h.filter(l||e),t.castRayViewport(i,r,o,h,s)}},s.unpatchRayCast=function(){this.viewer.impl.castRayViewport=this.castRayViewport},s.patchCoordinateConversions=function(){var e=this;this.clientToViewport=this.viewer.impl.clientToViewport.bind(this.viewer.impl),this.screenToViewport=this.viewer.navigation.screenToViewport.bind(this.viewer.navigation),this.viewportToScreen=this.viewer.navigation.viewportToScreen.bind(this.viewer.navigation),this.rolloverObjectViewport=this.viewer.impl.rolloverObjectViewport.bind(this.viewer.impl),this.viewer.impl.clientToViewport=function(t,i){var r=e.clientToViewport(t,i),o=e.mapCoords(r.x,r.y,-1,1,1,-1);return r.x=o.x,r.y=o.y,r.viewportId=o.viewportId,r},this.viewer.navigation.screenToViewport=function(t,i){var r=e.mapCoords(t,i,0,1,0,1),o=e.screenToViewport(r.x,r.y);return o.viewportId=r.viewportId,o},this.viewer.navigation.viewportToScreen=function(t,i){var r=e.viewportToScreen(t,i);return r.x/=2,e.context.getNumberOfViewports()>2&&(r.y/=2),r},this.viewer.impl.rolloverObjectViewport=function(t){var i=new THREE.Vector3;return i.copy(t),i.x+=1,i.x/=2,i.x-=t.viewportId%2==0?1:0,e.context.getNumberOfViewports()>2&&(i.y+=1,i.y/=2,i.y-=t.viewportId>1?1:0),e.rolloverObjectViewport(i)}},s.unpatchCoordinateConversions=function(){this.viewer.impl.clientToViewport=this.clientToViewport,this.viewer.navigation.screenToViewport=this.screenToViewport,this.viewer.navigation.viewportToScreen=this.viewportToScreen,this.viewer.impl.rolloverObjectViewport=this.rolloverObjectViewport},s.patchWorldUp=function(){if(this.worldUpTool=this.viewer.toolController.getTool("worldup"),this.worldUpTool){this.worldUpHandleMouseMove=this.worldUpTool.handleMouseMove.bind(this.worldUpTool),this.worldUpHandleButtonDown=this.worldUpTool.handleButtonDown.bind(this.worldUpTool),this.worldUpHandleButtonUp=this.worldUpTool.handleButtonUp.bind(this.worldUpTool);var e=this,t=null;this.worldUpTool.handleButtonDown=function(i){var r=i.normalizedX,o=i.normalizedY,n=e.mapCoords(r,o,-1,1,1,-1);i.normalizedX=n.x,i.normalizedY=n.y,t=n.viewportId;n=e.worldUpHandleButtonDown(i);return i.normalizedX=r,i.normalizedY=o,n},this.worldUpTool.handleMouseMove=i(this.worldUpHandleMouseMove),this.worldUpTool.handleButtonUp=i(this.worldUpHandleButtonUp)}else console.warn("Failed to patch the world up tool");function i(i){return function(r){var o=r.normalizedX,n=r.normalizedY,s=e.mapCoords(o,n,-1,1,1,-1);t%2!=s.viewportId%2&&(s.x+=2*(s.viewportId%2-t%2)),t>1!=s.viewportId>1&&(s.y+=s.viewportId>1?-2:2),r.normalizedX=s.x,r.normalizedY=s.y;s=i(r);return r.normalizedX=o,r.normalizedY=n,s}}},s.unpatchWorldUp=function(){this.worldUpHandleMouseMove&&(this.worldUpTool.handleMouseMove=this.worldUpHandleMouseMove,this.worldUpHandleMouseMove=null),this.worldUpHandleButtonDown&&(this.worldUpTool.handleButtonDown=this.worldUpHandleButtonDown,this.worldUpHandleButtonDown=null),this.worldUpHandleButtonUp&&(this.worldUpTool.handleButtonUp=this.worldUpHandleButtonUp,this.worldUpHandleButtonUp=null)},s.unload=function(){this.viewer.impl.setUserRenderContext(this.context.context,!0),this.groundShadow.detach(this.viewer),this.unpatchRayCast(),this.unpatchCoordinateConversions(),this.unpatchWorldUp(),this.enabled=!1,this.handleResize(),this.viewer.removeEventListener(Bimfish.Viewing.VIEWER_RESIZE_EVENT,this.handleResize),this.hideIncompatibleControls(!1),this.viewer.removeEventListener(Bimfish.Viewing.NAVIGATION_MODE_CHANGED_EVENT,this.onToolbarButtonsUpdated)},Bimfish.Viewing.theExtensionManager.registerExtension("Bimfish.SplitScreen",n)},"./extensions/SplitScreen/SplitScreenGroundShadow.js":
/*!***********************************************************!*\
  !*** ./extensions/SplitScreen/SplitScreenGroundShadow.js ***!
  \***********************************************************/
/*! exports provided: SplitScreenGroundShadow */function(e,t,i){"use strict";i.r(t),i.d(t,"SplitScreenGroundShadow",(function(){return r}));function r(){this.attach=function(e){this.renderer=e.impl.glrenderer(),this.leftShadow=e.impl.setUserGroundShadow(this),this.rightShadow=new Bimfish.Viewing.Private.GroundShadow(this.renderer),e.impl.getMaterials().addMaterialNonHDR("SplitScreen_RightGroundShadowMaterial",this.rightShadow.getDepthMaterial()),this.rightShadow.enabled=this.leftShadow.enabled,this.rightShadow.setColor(this.leftShadow.getColor()),this.rightShadow.setAlpha(this.leftShadow.getAlpha()),e.impl.sceneUpdated()},this.detach=function(e){e.impl.getMaterials().removeNonHDRMaterial("SplitScreen_RightGroundShadowMaterial"),e.impl.setUserGroundShadow(this.leftShadow),e.impl.sceneUpdated()},this.createForward=function(e){this[e]=function(){return this.leftShadow[e].apply(this.leftShadow,arguments),this.rightShadow[e].apply(this.rightShadow,arguments)}.bind(this)};var e=["setTransform","setDirty","prepareGroundShadow","getStatus","clear","setColor","setAlpha"];for(var t in e)this.createForward(e[t]);Object.defineProperty(this,"enabled",{get:function(){return this.leftShadow.enabled},set:function(e){this.leftShadow.enabled=e,this.rightShadow.enabled=e}}),Object.defineProperty(this,"rendered",{get:function(){return this.leftShadow.rendered},set:function(e){this.leftShadow.rendered=e,this.rightShadow.rendered=e}}),this.renderShadow=function(e,t){var i=e.clientWidth,r=e.clientHeight;this.renderer.setViewport(0,0,i,r),this.leftShadow.renderShadow(e,t),this.renderer.setViewport(i,0,i,r),this.rightShadow.renderShadow(e,t)}}},"./extensions/SplitScreen/SplitScreenRenderContext.js":
/*!************************************************************!*\
  !*** ./extensions/SplitScreen/SplitScreenRenderContext.js ***!
  \************************************************************/
/*! exports provided: SplitScreenRenderContext */function(e,t,i){"use strict";function r(e,t){var i=function(){return!0},r=this,o=(new THREE.Color).setRGB(0,0,0);this.context=e,this.settings=this.context.settings,this._viewports=[i,i],Object.defineProperty(this,"modelFilterLeft",{enumerable:!0,get:function(){return this._viewports[0]},set:function(e){this._viewports[0]=e||i}}),Object.defineProperty(this,"modelFilterRight",{enumerable:!0,get:function(){return this._viewports[1]},set:function(e){this._viewports[1]=e||i}}),this.width=t.impl.canvas.clientWidth,this.height=t.impl.canvas.clientHeight,this.renderer=t.impl.glrenderer(),function(e){function t(t){return function(){return e[t].apply(e,arguments)}}for(var i in e){"function"==typeof e[i]&&(r[i]=t(i))}}(this.context),this.renderScenePart=function(e){this.renderer.enableViewportOnOffscreenTargets(!0);var t=this.width/2,i=r._viewports.length>2?this.height/2:this.height,o=r._viewports.length>2?i:0,n=r._viewports.map((function(t){return t(e.modelId)}));n[0]&&(this.renderer.setViewport(0,o,t,i),this.context.renderScenePart.apply(this.context,arguments)),n[1]&&(this.renderer.setViewport(t,o,t,i),this.context.renderScenePart.apply(this.context,arguments)),n[2]&&(this.renderer.setViewport(0,0,t,i),this.context.renderScenePart.apply(this.context,arguments)),n[3]&&(this.renderer.setViewport(t,0,t,i),this.context.renderScenePart.apply(this.context,arguments)),this.renderer.setViewport(0,0,this.width,this.height),this.renderer.enableViewportOnOffscreenTargets(!1)},this.isolateSelectionMeshes=function(e,t){var i=e.selection,r=i&&i.scene;if(!r)return[];for(var o=[],n=0;n<r.children.length;n++){var s=r.children[n];s instanceof THREE.Mesh&&s.visible&&(t&&s.model&&!t(s.model.id)&&(s.visible=!1,o.push(s)))}return o},this.setMeshesVisible=function(e){for(var t=0;t<e.length;t++)e[t].visible=!0},this.renderOverlays=function(e,t){var i,n=this.width/2,s=r._viewports.length>2?this.height/2:this.height,h=r._viewports.length>2?s:0,l=this.context.getNamedTarget("overlay"),a=!1;for(var d in e){if(e[d].scene.children.length){a=!0;break}}a&&(this.renderer.setClearColor(o,0),this.renderer.clearTarget(l,!0,!1,!1)),this.renderer.enableViewportOnOffscreenTargets(!0),i=this.isolateSelectionMeshes(e,r._viewports[0]),this.renderer.setViewport(0,h,n,s),this.context.renderOverlays(e,t,!0),this.setMeshesVisible(i),i=this.isolateSelectionMeshes(e,r._viewports[1]),this.renderer.setViewport(n,h,n,s),this.context.renderOverlays(e,t,!0),this.setMeshesVisible(i),r._viewports.length>=3&&(i=this.isolateSelectionMeshes(e,r._viewports[2]),this.renderer.setViewport(0,0,n,s),this.context.renderOverlays(e,t,!0),this.setMeshesVisible(i)),r._viewports.length>=4&&(i=this.isolateSelectionMeshes(e,r._viewports[3]),this.renderer.setViewport(n,0,n,s),this.context.renderOverlays(e,t,!0),this.setMeshesVisible(i)),this.renderer.setViewport(0,0,this.width,this.height),this.renderer.enableViewportOnOffscreenTargets(!1)},this.setSize=function(e,t,i){this.width=e,this.height=t,this.context.setSize(e,t,i)},this.setViewports=function(e){if((e=e.slice(0,4).map((function(e){return e||i}))).length<2){var r=e.length;e.length=2,e.fill(i,r)}this._viewports=e,t.resize()},this.addViewport=function(e){e=e||i,this._viewports.length<4&&(this._viewports.push(e),t.resize())},this.removeViewport=function(e){this._viewports.length<=2||e>=this._viewports.length||e<0||(this._viewports.splice(e,1),t.resize())},this.getViewports=function(){return this._viewports.slice(0)},this.getNumberOfViewports=function(){return this._viewports.length}}i.r(t),i.d(t,"SplitScreenRenderContext",(function(){return r}))}});