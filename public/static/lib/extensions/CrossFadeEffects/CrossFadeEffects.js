/*!
 * LMV v7.9.0
 * 
 * Copyright 2019 Bimfish, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Bimfish, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Bimfish, Inc.
 * 
 * Bimfish Forge Viewer Usage Limitations:
 * 
 * The Bimfish Forge viewer can only be used to view files generated by
 * Bimfish Forge services. The Bimfish Forge Viewer JavaScript must be
 * delivered from an Bimfish hosted URL.
 */
Bimfish.Extensions.CrossFadeEffects=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./extensions/CrossFadeEffects/CrossFadeEffects.js")}({"./extensions/CrossFadeEffects/CrossFadeEffects.js":
/*!*********************************************************!*\
  !*** ./extensions/CrossFadeEffects/CrossFadeEffects.js ***!
  \*********************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return f}));var n=r(/*! ./TargetCrossFade */"./extensions/CrossFadeEffects/TargetCrossFade.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=Bimfish.Viewing,u=l.Private,f=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=a(this,o(t).call(this,e,r))).crossFade=null,n.clientId=null,n.onClientChanged=null,n}var r,i,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),r=t,(i=[{key:"load",value:function(){return this.setCrossFadeEnabled(!0),!0}},{key:"unload",value:function(){this.setCrossFadeEnabled(!1)}},{key:"acquireControl",value:function(e,t){this.clientId&&this.clientId,this.clientId=e,this.onClientChanged&&this.onClientChanged(),this.onClientChanged=t}},{key:"setModelTargetIndex",value:function(e,t){this.crossFade.setModelTargetIndex(e,t),this.viewer.impl.invalidate(!0)}},{key:"setModelTargetIndexForAll",value:function(e){for(var t=this.viewer.getVisibleModels(),r=0;r<t.length;r++){var n=t[r];this.setModelTargetIndex(n.id,e)}}},{key:"setCrossFadeOpacity",value:function(e,t){this.crossFade.setCrossFadeOpacity(e,t),this.viewer.impl.invalidate(!0)}},{key:"getCrossFadeOpacity",value:function(e){return this.crossFade.getCrossFadeOpacity(e)}},{key:"setCrossFadeEnabled",value:function(e){if(e!==Boolean(this.crossFade)){var t=this.viewer.impl.renderer();if(e){var r=t.getBlendPass();this.crossFade=new n.TargetCrossFade(r),t.setCrossFade(this.crossFade)}else this.crossFade.dtor(),t.setCrossFade(null);var i=t.getColorTarget();if(i){var s=this.viewer.impl.glrenderer().getPixelRatio();t.setSize(i.width/s,i.height/s)}}}},{key:"renderFadingImage",value:function(e,t){var r=this.viewer.impl.renderer();this.crossFade.beginRenderToFadeTarget(e,r),this.viewer.impl.invalidate(!0,!0,!0);var n=this.viewer.impl.targetFrameBudget;t&&(this.viewer.impl.targetFrameBudget=t);var i=performance.now();this.viewer.impl.tick(i),this.targetFrameBudget=n,this.crossFade.endRenderFadeTarget(r)}},{key:"releaseFadingImage",value:function(e){this.setClearEnabled(e,!0)}},{key:"setClearEnabled",value:function(e,t){this.crossFade.setClearEnabled(e,t)}},{key:"fadeTarget",value:function(e,t,r,n,i){var s=this;return u.fadeValue(t,r,n,(function(t){s.setCrossFadeOpacity(e,t)}),i)}},{key:"fadeImage",value:function(e,t,r,i){for(var s=this,a=this.viewer.impl.modelQueue(),o=a.getModels().slice(),d=0;d<o.length;d++){var l=o[d];a.hideModel(l.id)}return this.crossFade.setFadeMode(n.TargetCrossFade.FadeMode.CROSSFADE),u.fadeValue(e,t,r,(function(e){s.setCrossFadeOpacity(0,1-e),s.setCrossFadeOpacity(1,e),s.viewer.impl.renderer().presentBuffer()}),(function(){s.crossFade.setFadeMode(n.TargetCrossFade.FadeMode.CROSSFADE);for(var e=0;e<o.length;e++){var t=o[e];a.showModel(t.id)}i&&i()}))}},{key:"fadeToViewerState",value:function(e,t){var r=this;this.renderFadingImage(0,300),e(),this.renderFadingImage(1,300);var n=this.viewer.impl.renderer(),i=n.getAOEnabled();n.setAOEnabled(!1),this.fadeImage(0,1,t,(function(){r.releaseFadingImage(0),r.releaseFadingImage(1),n.setAOEnabled(i)}))}}])&&s(r.prototype,i),l&&s(r,l),t}(l.Extension);Bimfish.Viewing.theExtensionManager.registerExtension("Bimfish.CrossFadeEffects",f)},"./extensions/CrossFadeEffects/TargetCrossFade.js":
/*!********************************************************!*\
  !*** ./extensions/CrossFadeEffects/TargetCrossFade.js ***!
  \********************************************************/
/*! exports provided: FadeMode, TargetCrossFade */function(e,t,r){"use strict";r.r(t),r.d(t,"FadeMode",(function(){return n})),r.d(t,"TargetCrossFade",(function(){return i}));var n={DECAL:0,CROSSFADE:1};function i(e){var t=[],r=[!0,!0],i=e,s=new THREE.Color,a=[],o=n.DECAL,d=!0;this.setModelTargetIndex=function(e,t){a[e]=t},this.setSaoHeuristicEnabled=function(e){d=e},this.getRenderSao=function(e){if(!d)return!0;var t=e.modelId&&a[e.modelId];if(void 0===t)return!0;for(var r=t,n=this.getCrossFadeOpacity(t),i=0;i<2;i++){var s=this.getCrossFadeOpacity(i);s>n&&(r=i,n=s)}return r==t},this.setCrossFadeOpacity=function(e,t){var r="crossFadeOpacity"+e;i.uniforms[r].value=t},this.getCrossFadeOpacity=function(e){var t="crossFadeOpacity"+e;return i.uniforms[t].value},this.updateBlendPass=function(e){void 0===e&&(e=t.length);var r="NUM_CROSSFADE_TARGETS",n=e||void 0;i.material.defines[r]!==n&&(e?i.material.defines[r]=n:delete i.material.defines[r],i.material.needsUpdate=!0);for(var s=0;s<e;s++){var a="tCrossFadeTex"+s;i.uniforms[a].value=t[s]}i.material.defines.TARGET_FADE_MODE!==o&&(i.material.defines.TARGET_FADE_MODE=o,i.material.needsUpdate=!0)},this.setFadeMode=function(e){e===n.DECAL||e===n.CROSSFADE?(o=e,this.updateBlendPass()):console.error("Unexpected fade mode enum")},this.clearTarget=function(e){e.setClearColor(s,0);for(var n=0;n<t.length;n++)r[n]&&e.clearTarget(t[n],!0,!0)},this.setClearEnabled=function(e,t){r[e]=t},this.disposeTargets=function(){for(var e=0;e<t.length;e++){var r=t[e];r&&r.dispose(),t[e]=null}},this.dtor=function(){this.disposeTargets(),this.updateBlendPass(),this.setCrossFadeOpacity(0,0),this.setCrossFadeOpacity(1,0)},this.chooseColorTarget=function(e,r){var n=e.modelId&&a[e.modelId];return void 0===n?r:t[n]},this.updateTargets=function(e,r,n,i){for(var s=0;s<2;s++){var a=t[s];!n&&a&&a.width===e&&a.height===r||(a&&a.dispose(),(a=new THREE.WebGLRenderTarget(e,r,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:i?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1})).generateMipmaps=!1,t[s]=a)}},this.beginRenderToFadeTarget=function(e,r){this.updateBlendPass(0);var n=t[e];r.setOffscreenTarget(n),this.setClearEnabled(e,!1)},this.endRenderFadeTarget=function(e){e.setOffscreenTarget(null),this.updateBlendPass()}}i.FadeMode=n}});